(()=>{"use strict";var t={429:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"NIL",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(e,"v1",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"v3",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"v4",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"v5",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"validate",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return l.default}});var o=u(i(990)),r=u(i(237)),n=u(i(355)),s=u(i(764)),a=u(i(314)),l=u(i(464)),c=u(i(435)),h=u(i(8)),d=u(i(222));function u(t){return t&&t.__esModule?t:{default:t}}},163:(t,e)=>{function i(t){return 14+(t+64>>>9<<4)+1}function o(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function r(t,e,i,r,n,s){return o((a=o(o(e,t),o(r,s)))<<(l=n)|a>>>32-l,i);var a,l}function n(t,e,i,o,n,s,a){return r(e&i|~e&o,t,e,n,s,a)}function s(t,e,i,o,n,s,a){return r(e&o|i&~o,t,e,n,s,a)}function a(t,e,i,o,n,s,a){return r(e^i^o,t,e,n,s,a)}function l(t,e,i,o,n,s,a){return r(i^(e|~o),t,e,n,s,a)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=function(t){if("string"==typeof t){const e=unescape(encodeURIComponent(t));t=new Uint8Array(e.length);for(let i=0;i<e.length;++i)t[i]=e.charCodeAt(i)}return function(t){const e=[],i=32*t.length,o="0123456789abcdef";for(let r=0;r<i;r+=8){const i=t[r>>5]>>>r%32&255,n=parseInt(o.charAt(i>>>4&15)+o.charAt(15&i),16);e.push(n)}return e}(function(t,e){t[e>>5]|=128<<e%32,t[i(e)-1]=e;let r=1732584193,c=-271733879,h=-1732584194,d=271733878;for(let e=0;e<t.length;e+=16){const i=r,u=c,f=h,g=d;r=n(r,c,h,d,t[e],7,-680876936),d=n(d,r,c,h,t[e+1],12,-389564586),h=n(h,d,r,c,t[e+2],17,606105819),c=n(c,h,d,r,t[e+3],22,-1044525330),r=n(r,c,h,d,t[e+4],7,-176418897),d=n(d,r,c,h,t[e+5],12,1200080426),h=n(h,d,r,c,t[e+6],17,-1473231341),c=n(c,h,d,r,t[e+7],22,-45705983),r=n(r,c,h,d,t[e+8],7,1770035416),d=n(d,r,c,h,t[e+9],12,-1958414417),h=n(h,d,r,c,t[e+10],17,-42063),c=n(c,h,d,r,t[e+11],22,-1990404162),r=n(r,c,h,d,t[e+12],7,1804603682),d=n(d,r,c,h,t[e+13],12,-40341101),h=n(h,d,r,c,t[e+14],17,-1502002290),c=n(c,h,d,r,t[e+15],22,1236535329),r=s(r,c,h,d,t[e+1],5,-165796510),d=s(d,r,c,h,t[e+6],9,-1069501632),h=s(h,d,r,c,t[e+11],14,643717713),c=s(c,h,d,r,t[e],20,-373897302),r=s(r,c,h,d,t[e+5],5,-701558691),d=s(d,r,c,h,t[e+10],9,38016083),h=s(h,d,r,c,t[e+15],14,-660478335),c=s(c,h,d,r,t[e+4],20,-405537848),r=s(r,c,h,d,t[e+9],5,568446438),d=s(d,r,c,h,t[e+14],9,-1019803690),h=s(h,d,r,c,t[e+3],14,-187363961),c=s(c,h,d,r,t[e+8],20,1163531501),r=s(r,c,h,d,t[e+13],5,-1444681467),d=s(d,r,c,h,t[e+2],9,-51403784),h=s(h,d,r,c,t[e+7],14,1735328473),c=s(c,h,d,r,t[e+12],20,-1926607734),r=a(r,c,h,d,t[e+5],4,-378558),d=a(d,r,c,h,t[e+8],11,-2022574463),h=a(h,d,r,c,t[e+11],16,1839030562),c=a(c,h,d,r,t[e+14],23,-35309556),r=a(r,c,h,d,t[e+1],4,-1530992060),d=a(d,r,c,h,t[e+4],11,1272893353),h=a(h,d,r,c,t[e+7],16,-155497632),c=a(c,h,d,r,t[e+10],23,-1094730640),r=a(r,c,h,d,t[e+13],4,681279174),d=a(d,r,c,h,t[e],11,-358537222),h=a(h,d,r,c,t[e+3],16,-722521979),c=a(c,h,d,r,t[e+6],23,76029189),r=a(r,c,h,d,t[e+9],4,-640364487),d=a(d,r,c,h,t[e+12],11,-421815835),h=a(h,d,r,c,t[e+15],16,530742520),c=a(c,h,d,r,t[e+2],23,-995338651),r=l(r,c,h,d,t[e],6,-198630844),d=l(d,r,c,h,t[e+7],10,1126891415),h=l(h,d,r,c,t[e+14],15,-1416354905),c=l(c,h,d,r,t[e+5],21,-57434055),r=l(r,c,h,d,t[e+12],6,1700485571),d=l(d,r,c,h,t[e+3],10,-1894986606),h=l(h,d,r,c,t[e+10],15,-1051523),c=l(c,h,d,r,t[e+1],21,-2054922799),r=l(r,c,h,d,t[e+8],6,1873313359),d=l(d,r,c,h,t[e+15],10,-30611744),h=l(h,d,r,c,t[e+6],15,-1560198380),c=l(c,h,d,r,t[e+13],21,1309151649),r=l(r,c,h,d,t[e+4],6,-145523070),d=l(d,r,c,h,t[e+11],10,-1120210379),h=l(h,d,r,c,t[e+2],15,718787259),c=l(c,h,d,r,t[e+9],21,-343485551),r=o(r,i),c=o(c,u),h=o(h,f),d=o(d,g)}return[r,c,h,d]}(function(t){if(0===t.length)return[];const e=8*t.length,o=new Uint32Array(i(e));for(let i=0;i<e;i+=8)o[i>>5]|=(255&t[i/8])<<i%32;return o}(t),8*t.length))}},790:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};e.default=i},314:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default="00000000-0000-0000-0000-000000000000"},222:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o,r=(o=i(435))&&o.__esModule?o:{default:o};e.default=function(t){if(!(0,r.default)(t))throw TypeError("Invalid UUID");let e;const i=new Uint8Array(16);return i[0]=(e=parseInt(t.slice(0,8),16))>>>24,i[1]=e>>>16&255,i[2]=e>>>8&255,i[3]=255&e,i[4]=(e=parseInt(t.slice(9,13),16))>>>8,i[5]=255&e,i[6]=(e=parseInt(t.slice(14,18),16))>>>8,i[7]=255&e,i[8]=(e=parseInt(t.slice(19,23),16))>>>8,i[9]=255&e,i[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,i[11]=e/4294967296&255,i[12]=e>>>24&255,i[13]=e>>>16&255,i[14]=e>>>8&255,i[15]=255&e,i}},58:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},319:(t,e)=>{let i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){if(!i&&(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!i))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(o)};const o=new Uint8Array(16)},757:(t,e)=>{function i(t,e,i,o){switch(t){case 0:return e&i^~e&o;case 1:case 3:return e^i^o;case 2:return e&i^e&o^i&o}}function o(t,e){return t<<e|t>>>32-e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=function(t){const e=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){const e=unescape(encodeURIComponent(t));t=[];for(let i=0;i<e.length;++i)t.push(e.charCodeAt(i))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);const n=t.length/4+2,s=Math.ceil(n/16),a=new Array(s);for(let e=0;e<s;++e){const i=new Uint32Array(16);for(let o=0;o<16;++o)i[o]=t[64*e+4*o]<<24|t[64*e+4*o+1]<<16|t[64*e+4*o+2]<<8|t[64*e+4*o+3];a[e]=i}a[s-1][14]=8*(t.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(t.length-1)&4294967295;for(let t=0;t<s;++t){const n=new Uint32Array(80);for(let e=0;e<16;++e)n[e]=a[t][e];for(let t=16;t<80;++t)n[t]=o(n[t-3]^n[t-8]^n[t-14]^n[t-16],1);let s=r[0],l=r[1],c=r[2],h=r[3],d=r[4];for(let t=0;t<80;++t){const r=Math.floor(t/20),a=o(s,5)+i(r,l,c,h)+d+e[r]+n[t]>>>0;d=h,h=c,c=o(l,30)>>>0,l=s,s=a}r[0]=r[0]+s>>>0,r[1]=r[1]+l>>>0,r[2]=r[2]+c>>>0,r[3]=r[3]+h>>>0,r[4]=r[4]+d>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}},8:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.unsafeStringify=s;var o,r=(o=i(435))&&o.__esModule?o:{default:o};const n=[];for(let t=0;t<256;++t)n.push((t+256).toString(16).slice(1));function s(t,e=0){return(n[t[e+0]]+n[t[e+1]]+n[t[e+2]]+n[t[e+3]]+"-"+n[t[e+4]]+n[t[e+5]]+"-"+n[t[e+6]]+n[t[e+7]]+"-"+n[t[e+8]]+n[t[e+9]]+"-"+n[t[e+10]]+n[t[e+11]]+n[t[e+12]]+n[t[e+13]]+n[t[e+14]]+n[t[e+15]]).toLowerCase()}e.default=function(t,e=0){const i=s(t,e);if(!(0,r.default)(i))throw TypeError("Stringified UUID is invalid");return i}},990:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o,r=(o=i(319))&&o.__esModule?o:{default:o},n=i(8);let s,a,l=0,c=0;e.default=function(t,e,i){let o=e&&i||0;const h=e||new Array(16);let d=(t=t||{}).node||s,u=void 0!==t.clockseq?t.clockseq:a;if(null==d||null==u){const e=t.random||(t.rng||r.default)();null==d&&(d=s=[1|e[0],e[1],e[2],e[3],e[4],e[5]]),null==u&&(u=a=16383&(e[6]<<8|e[7]))}let f=void 0!==t.msecs?t.msecs:Date.now(),g=void 0!==t.nsecs?t.nsecs:c+1;const v=f-l+(g-c)/1e4;if(v<0&&void 0===t.clockseq&&(u=u+1&16383),(v<0||f>l)&&void 0===t.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=f,c=g,a=u,f+=122192928e5;const w=(1e4*(268435455&f)+g)%4294967296;h[o++]=w>>>24&255,h[o++]=w>>>16&255,h[o++]=w>>>8&255,h[o++]=255&w;const p=f/4294967296*1e4&268435455;h[o++]=p>>>8&255,h[o++]=255&p,h[o++]=p>>>24&15|16,h[o++]=p>>>16&255,h[o++]=u>>>8|128,h[o++]=255&u;for(let t=0;t<6;++t)h[o+t]=d[t];return e||(0,n.unsafeStringify)(h)}},237:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i(925)),r=n(i(163));function n(t){return t&&t.__esModule?t:{default:t}}var s=(0,o.default)("v3",48,r.default);e.default=s},925:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.URL=e.DNS=void 0,e.default=function(t,e,i){function o(t,o,s,a){var l;if("string"==typeof t&&(t=function(t){t=unescape(encodeURIComponent(t));const e=[];for(let i=0;i<t.length;++i)e.push(t.charCodeAt(i));return e}(t)),"string"==typeof o&&(o=(0,n.default)(o)),16!==(null===(l=o)||void 0===l?void 0:l.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+t.length);if(c.set(o),c.set(t,o.length),c=i(c),c[6]=15&c[6]|e,c[8]=63&c[8]|128,s){a=a||0;for(let t=0;t<16;++t)s[a+t]=c[t];return s}return(0,r.unsafeStringify)(c)}try{o.name=t}catch(t){}return o.DNS=s,o.URL=a,o};var o,r=i(8),n=(o=i(222))&&o.__esModule?o:{default:o};const s="6ba7b810-9dad-11d1-80b4-00c04fd430c8";e.DNS=s;const a="6ba7b811-9dad-11d1-80b4-00c04fd430c8";e.URL=a},355:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=s(i(790)),r=s(i(319)),n=i(8);function s(t){return t&&t.__esModule?t:{default:t}}e.default=function(t,e,i){if(o.default.randomUUID&&!e&&!t)return o.default.randomUUID();const s=(t=t||{}).random||(t.rng||r.default)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){i=i||0;for(let t=0;t<16;++t)e[i+t]=s[t];return e}return(0,n.unsafeStringify)(s)}},764:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i(925)),r=n(i(757));function n(t){return t&&t.__esModule?t:{default:t}}var s=(0,o.default)("v5",80,r.default);e.default=s},435:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o,r=(o=i(58))&&o.__esModule?o:{default:o};e.default=function(t){return"string"==typeof t&&r.default.test(t)}},464:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o,r=(o=i(435))&&o.__esModule?o:{default:o};e.default=function(t){if(!(0,r.default)(t))throw TypeError("Invalid UUID");return parseInt(t.slice(14,15),16)}}},e={};function i(o){var r=e[o];if(void 0!==r)return r.exports;var n=e[o]={exports:{}};return t[o](n,n.exports,i),n.exports}(()=>{class t{actorID;constructor(e){this.actorID=t.validateActorID(e)}static validateActorID(t){if(null==t)throw new Error("The actor ID cannot be null or undefined.");return t}getActorID(){return this.actorID}}class e extends t{content;recipientsIDs;constructor(t,i,o){super(t),this.content=e.validateContent(i),this.recipientsIDs=null==o?[]:o}static validateContent(t){if(null==t)throw new Error("The content cannot be null or undefined.");return t}getContent(){return this.content}getRecipientsIDs(){return this.recipientsIDs}}class o extends e{static effort=1n;constructor(t,e){super(t,e)}getEffort(){return o.effort}static getEffort(){return o.effort}static overrideDefaultEffort(t){null==t?console.log("The new effort for VWBroadcastAction cannot be null or undefined. The default effort will be used instead."):(o.effort=t,console.log("The effort of VWBroadcastAction has been changed to "+t+"."))}}class r extends t{constructor(t){super(t)}}class n extends r{static effort=1n;constructor(t){super(t)}getEffort(){return n.effort}static overrideDefaultEffort(t){null==t?console.log("The new effort for VWCleanAction cannot be null or undefined. The default effort will be used instead."):(n.effort=t,console.log("The effort of VWCleanAction has been changed to "+t+"."))}}class s extends r{colour;static effort=1n;constructor(t,e){super(t),this.colour=s.validateColour(e)}getColour(){return this.colour}static validateColour(t){if(null==t)throw new Error("The dirt colour cannot be null or undefined.");return t}getEffort(){return s.effort}static overrideDefaultEffort(t){null==t?console.log("The new effort for VWDropDirtAction cannot be null or undefined. The default effort will be used instead."):(s.effort=t,console.log("The effort of VWDropDirtAction has been changed to "+t+"."))}}class a extends r{static effort=1n;constructor(t){super(t)}getEffort(){return a.effort}static overrideDefaultEffort(t){null==t?console.log("The new effort for VWIdleAction cannot be null or undefined. The default effort will be used instead."):(a.effort=t,console.log("The effort of VWIdleAction has been changed to "+t+"."))}}class l extends r{static effort=1n;constructor(t){super(t)}getEffort(){return l.effort}static overrideDefaultEffort(t){null==t?console.log("The new effort for VWMoveAction cannot be null or undefined. The default effort will be used instead."):(l.effort=t,console.log("The effort of VWMoveAction has been changed to "+t+"."))}}class c extends e{static effort=1n;constructor(t,e,i){super(t,e,i)}getEffort(){return 0===this.getRecipientsIDs().length?o.getEffort():c.effort}static overrideDefaultEffort(t){null==t?console.log("The new effort for VWSpeakAction cannot be null or undefined. The default effort will be used instead."):(c.effort=t,console.log("The effort of VWSpeakAction has been changed to "+t+"."))}}class h extends r{turningDirection;static effort=1n;constructor(t,e){super(t),this.turningDirection=h.validateTurningDirection(e)}static validateTurningDirection(t){if(null==t)throw new Error("The turning direction cannot be null or undefined.");return t}getTurningDirection(){return this.turningDirection}getEffort(){return h.effort}static overrideDefaultEffort(t){null==t?console.log("The new effort for VWTurnAction cannot be null or undefined. The default effort will be used instead."):(h.effort=t,console.log("The effort of VWTurnAction has been changed to "+t+"."))}}class d{value;constructor(t){this.value=t}static of(t){if(null==t)throw new Error("The value cannot be null or undefined.");return new d(t)}static ofNullable(t){return null==t?d.empty():new d(t)}static empty(){return new d(null)}isPresent(){return null!==this.value}isEmpty(){return null===this.value}get(){if(null===this.value||void 0===this.value)throw new Error("The value is null.");return this.value}orElse(t){return null===this.value||void 0===this.value?t:this.value}orElseGet(t){return null===this.value||void 0===this.value?t():this.value}orElseThrow(t){const e=null==t?new Error("The value is null or undefined."):t;if(null===this.value||void 0===this.value)throw e;return this.value}ifPresent(t){null!==this.value&&void 0!==this.value&&t(this.value)}ifPresentOrElse(t,e){null!==this.value&&void 0!==this.value?t(this.value):e()}filter(t){return null===this.value||void 0===this.value?d.empty():t(this.value)?this:d.empty()}map(t){return null===this.value||void 0===this.value?d.empty():d.of(t(this.value))}flatMap(t){return null===this.value||void 0===this.value?d.empty():t(this.value)}equals(t){return null!=t&&(this===t||t instanceof d&&(null===this.value?null===t.value:void 0===this.value?void 0===t.value:this.value===t.value))}}var u,f,g,v;!function(t){t.IMPOSSIBLE="IMPOSSIBLE",t.SUCCESS="SUCCESS",t.FAILURE="FAILURE"}(u||(u={}));class w{actionOutcome;action;constructor(t,e){this.actionOutcome=w.validateActionOutcome(t),this.action=w.validateAction(e)}static validateActionOutcome(t){if(null==t)throw new Error("The action outcome cannot be null or undefined.");return t}static validateAction(t){if(null==t)throw new Error("The action cannot be null or undefined.");return t}getActionOutcome(){return this.actionOutcome}getAction(){return this.action}}!function(t){t.NORTH="NORTH",t.EAST="EAST",t.SOUTH="SOUTH",t.WEST="WEST"}(f||(f={}));class p{x;y;constructor(t,e){this.x=p.validateX(t),this.y=p.validateY(e)}static validateX(t){if(null==t)throw new Error("The x coordinate cannot be null or undefined.");return t}static validateY(t){if(null==t)throw new Error("The y coordinate cannot be null or undefined.");return t}getX(){return this.x}getY(){return this.y}clone(){return new p(this.x,this.y)}getForwardCoord(t){if(null==t)throw new Error("The orientation cannot be null or undefined.");if(t===f.NORTH)return new p(this.x,this.y-1n);if(t===f.EAST)return new p(this.x+1n,this.y);if(t===f.SOUTH)return new p(this.x,this.y+1n);if(t===f.WEST)return new p(this.x-1n,this.y);throw new Error("The orientation is invalid.")}getLeftCoord(t){if(null==t)throw new Error("The orientation cannot be null or undefined.");if(t===f.NORTH)return new p(this.x-1n,this.y);if(t===f.EAST)return new p(this.x,this.y-1n);if(t===f.SOUTH)return new p(this.x+1n,this.y);if(t===f.WEST)return new p(this.x,this.y+1n);throw new Error("The orientation is invalid.")}getRightCoord(t){if(null==t)throw new Error("The orientation cannot be null or undefined.");if(t===f.NORTH)return new p(this.x+1n,this.y);if(t===f.EAST)return new p(this.x,this.y+1n);if(t===f.SOUTH)return new p(this.x-1n,this.y);if(t===f.WEST)return new p(this.x,this.y-1n);throw new Error("The orientation is invalid.")}getForwardLeftCoord(t){if(null==t)throw new Error("The orientation cannot be null or undefined.");if(t===f.NORTH)return new p(this.x-1n,this.y-1n);if(t===f.EAST)return new p(this.x+1n,this.y-1n);if(t===f.SOUTH)return new p(this.x+1n,this.y+1n);if(t===f.WEST)return new p(this.x-1n,this.y+1n);throw new Error("The orientation is invalid.")}getForwardRightCoord(t){if(null==t)throw new Error("The orientation cannot be null or undefined.");if(t===f.NORTH)return new p(this.x+1n,this.y-1n);if(t===f.EAST)return new p(this.x+1n,this.y+1n);if(t===f.SOUTH)return new p(this.x-1n,this.y+1n);if(t===f.WEST)return new p(this.x-1n,this.y-1n);throw new Error("The orientation is invalid.")}sum(t){return new p(this.x+t.x,this.y+t.y)}increment(t){return new p(this.x+t,this.y+t)}sub(t){return new p(this.x-t.x,this.y-t.y)}decrement(t){return new p(this.x-t,this.y-t)}toJsonObject(){return{x:this.x.toString(),y:this.y.toString()}}static fromJsonObject(t){if(null==t)throw new Error("The JSON representation cannot be null or undefined.");if(null===t.x||void 0===t.x)throw new Error("The x coordinate cannot be null or undefined.");if(null===t.y||void 0===t.y)throw new Error("The y coordinate cannot be null or undefined.");return new p(BigInt(t.x),BigInt(t.y))}toString(){return`(${this.x}, ${this.y})`}equals(t){return null!=t&&(this===t||t instanceof p&&this.x===t.x&&this.y===t.y)}static fromString(t){if(null==t)throw new Error("The coordinate string cannot be null or undefined.");if(t.length<5)throw new Error("The coordinate string is invalid.");{const e=t.substring(1,t.indexOf(",")),i=t.substring(t.indexOf(",")+2,t.length-1);return new p(BigInt(e),BigInt(i))}}}class m{key;value;constructor(t,e){this.key=t,this.value=e}getKey(){return this.key}getValue(){return this.value}setValue(t){this.value=t}}class E{entries;constructor(){this.entries=[]}put(t,e){let i=this.getEntry(t);null==i?this.entries.push(new m(t,e)):i.setValue(e)}get(t){const e=this.getEntry(t);return null==e?null:e.getValue()}remove(t){const e=this.getEntry(t);null!=e&&this.entries.splice(this.entries.indexOf(e),1)}containsKey(t){return null!==this.getEntry(t)&&void 0!==this.getEntry(t)}containsValue(t){for(let e of this.entries)if(e.getValue()===t)return!0;return!1}size(){return this.entries.length}isEmpty(){return 0===this.entries.length}clear(){this.entries=[]}getKeys(){return this.entries.map((t=>t.getKey()))}getValues(){return this.entries.map((t=>t.getValue()))}getEntry(t){return this.entries.find((e=>e.getKey().equals(t)))}toString(){let t="";for(let e of this.entries)t+=e.getKey()+" : "+e.getValue()+"\n";return t}equals(t){if(this.size()!==t.size())return!1;for(let e of this.entries)if(!t.containsKey(e.getKey())||t.get(e.getKey())!==e.getValue())return!1;return!0}clone(){const t=new E;for(let e of this.entries)t.put(e.getKey(),e.getValue());return t}static fromMap(t){const e=new E;for(let[i,o]of t)e.put(i,o);return e}toMap(){const t=new Map;for(let e of this.entries)t.set(e.getKey(),e.getValue());return t}static fromObject(t){const e=new E;for(let i in t)e.put(i,t[i]);return e}[Symbol.iterator](){let t=0,e=this.entries;return{next:()=>{if(t<e.length){const i=e[t];return t++,{value:[i.getKey(),i.getValue()],done:!1}}return{value:void 0,done:!0}}}}forEach(t){for(let e of this.entries)t(e.getValue(),e.getKey(),this)}}class A{}class T extends A{content;senderID;recipientID;constructor(t,e,i){super(),this.content=T.validateContent(t),this.senderID=T.validateSenderID(e),this.recipientID=T.validateRecipientID(i)}static validateContent(t){if(null==t)throw new Error("The content cannot be null or undefined.");return t}static validateSenderID(t){if(null==t)throw new Error("The sender ID cannot be null or undefined.");return t}static validateRecipientID(t){if(null==t)throw new Error("The recipient ID cannot be null or undefined.");return t}getContent(){return this.content}getSenderID(){return this.senderID}getRecipientID(){return this.recipientID}}class b{constructor(){}static getLeft(t){switch(t){case f.NORTH:return f.WEST;case f.SOUTH:return f.EAST;case f.EAST:return f.NORTH;case f.WEST:return f.SOUTH;default:throw new Error("Invalid orientation.")}}static getRight(t){switch(t){case f.NORTH:return f.EAST;case f.SOUTH:return f.WEST;case f.EAST:return f.SOUTH;case f.WEST:return f.NORTH;default:throw new Error("Invalid orientation.")}}static getOpposite(t){switch(t){case f.NORTH:return f.SOUTH;case f.SOUTH:return f.NORTH;case f.EAST:return f.WEST;case f.WEST:return f.EAST;default:throw new Error("Invalid orientation.")}}}!function(t){t.CENTER="CENTER",t.FORWARD="FORWARD",t.LEFT="LEFT",t.RIGHT="RIGHT",t.FORWARDLEFT="FORWARDLEFT",t.FORWARDRIGHT="FORWARDRIGHT"}(g||(g={}));class D extends A{locations;actionResults;constructor(t,e){super(),this.locations=new Map,this.actionResults=D.validateActionResults(e);for(const e of t.keys()){if(null==e)throw new Error("The position cannot be null or undefined.");if(null===t.get(e)||void 0===t.get(e))throw new Error("The location appearance cannot be null or undefined.");this.locations.set(e,t.get(e))}}static validateActionResults(t){if(null==t)throw new Error("The action results cannot be null or undefined.");if(t.some((t=>null==t)))throw new Error("The action results array cannot contain null or undefined elements.");if(0===t.length)throw new Error("The action results array cannot be empty.");return t}getLocations(){return this.locations}getLocationAt(t){return this.locations.has(t)&&null!==this.locations.get(t)&&void 0!==this.locations.get(t)?d.of(this.locations.get(t)):d.empty()}getCenter(){return this.getLocationAt(g.CENTER)}getLeft(){return this.getLocationAt(g.LEFT)}getRight(){return this.getLocationAt(g.RIGHT)}getForward(){return this.getLocationAt(g.FORWARD)}getForwardLeft(){return this.getLocationAt(g.FORWARDLEFT)}getForwardRight(){return this.getLocationAt(g.FORWARDRIGHT)}getOwnID(){return this.getCenter().orElseThrow().getActorAppearance().orElseThrow().getID()}getOwnColour(){return this.getCenter().orElseThrow().getActorAppearance().orElseThrow().getColour()}getOwnOrientation(){return this.getCenter().orElseThrow().getActorAppearance().orElseThrow().getOrientation()}getOwnCoordinates(){return this.getCenter().orElseThrow().getCoord()}getActionResults(){return this.actionResults}isWallImmediatelyAhead(){return this.getCenter().orElseThrow().hasWallOn(this.getOwnOrientation())}isWallOneStepAhead(){return!this.isWallImmediatelyAhead()&&this.getForward().orElseThrow().hasWallOn(this.getOwnOrientation())}isWallVisibleSomewhereAhead(){return this.isWallImmediatelyAhead()||this.isWallOneStepAhead()}isWallImmediatelyToTheLeft(){return this.getCenter().orElseThrow().hasWallOn(b.getLeft(this.getOwnOrientation()))}isWallOneStepToTheLeft(){return!this.isWallImmediatelyToTheLeft()&&this.getLeft().orElseThrow().hasWallOn(b.getLeft(this.getOwnOrientation()))}isWallVisibleSomewhereToTheLeft(){return this.isWallImmediatelyToTheLeft()||this.isWallOneStepToTheLeft()}isWallImmediatelyToTheRight(){return this.getCenter().orElseThrow().hasWallOn(b.getRight(this.getOwnOrientation()))}isWallOneStepToTheRight(){return!this.isWallImmediatelyToTheRight()&&this.getRight().orElseThrow().hasWallOn(b.getRight(this.getOwnOrientation()))}isWallVisibleSomewhereToTheRight(){return this.isWallImmediatelyToTheRight()||this.isWallOneStepToTheRight()}}class y{static validateActions(t){if(null==t)throw new Error("The actions array cannot be null or undefined.");if(t.some((t=>null==t)))throw new Error("The actions array cannot contain null or undefined actions.");if(0===t.length)throw new Error("At least one action per cycle must by attempted by each actor.");if(t.length>2)throw new Error("At most two actions per cycle can be attempted by each actor.");if(2===t.length&&t[0]instanceof r&&t[1]instanceof r)throw new Error("At most one physical action per cycle can be attempted by each actor.");if(2===t.length&&t[0]instanceof e&&t[1]instanceof e)throw new Error("At most one communicative action per cycle can be attempted by each actor.")}}class C{grid;constructor(t){this.grid=C.validateGrid(t)}static validateGrid(t){if(null==t)throw new Error("The grid cannot be null or undefined.");return t}getGridSize(){return Math.sqrt(this.grid.size())}getGrid(){return this.grid}getLocation(t){return d.ofNullable(this.grid.get(t))}getActors(){const t=[];for(const[e,i]of this.grid){const e=i.getActor();e.isPresent()&&t.push(e.orElseThrow())}return t}getActorsIDs(){const t=[];for(let[e,i]of this.grid){const e=i.getActor();e.isPresent()&&t.push(e.orElseThrow().getID())}return t}getActorsIDsExcept(t){const e=[];for(let[i,o]of this.grid){const i=o.getActor();i.isPresent()&&i.orElseThrow().getID()!==t&&e.push(i.orElseThrow().getID())}return e}getActorByID(t){for(let[e,i]of this.grid){const e=i.getActor();if(e.isPresent()&&e.orElseThrow().getID()===t)return e}return d.empty()}getActorByCoord(t){return this.getLocation(t).flatMap((t=>t.getActor()))}getActorCoordByID(t){for(let[e,i]of this.grid){const o=i.getActor();if(o.isPresent()&&o.orElseThrow().getID()===t)return d.of(e)}return d.empty()}addActorToLocation(t,e){if(null==t)throw new Error("The coordinates of the location cannot be null or undefined.");if(null==e)throw new Error("The actor cannot be null or undefined.");if(this.getActorByCoord(t).isPresent())throw new Error("There is already an actor at the location.");this.getLocation(t).ifPresent((t=>t.addActor(e)))}popActorByCoord(t){return this.getLocation(t).flatMap((t=>t.popActor()))}moveActor(t,e){if(null==t)throw new Error("The coordinates of the origin location cannot be null or undefined.");if(null==e)throw new Error("The coordinates of the destination location cannot be null or undefined.");if(t.equals(e))throw new Error("The destination location cannot be the same as the origin location.");if(!this.getActorByCoord(t).isPresent())throw new Error("There is no actor at the origin location.");if(this.getActorByCoord(e).isPresent())throw new Error("There is already an actor at the destination location.");{const i=this.popActorByCoord(t).orElseThrow();this.getLocation(e).orElseThrow().addActor(i)}}turnActor(t,e){if(null==t)throw new Error("The coordinates of the actor location cannot be null or undefined.");if(!this.getActorByCoord(t).isPresent())throw new Error("There is no actor at the origin location.");this.getActorByCoord(t).orElseThrow().turn(e)}getDirtsIDs(){const t=[];for(let[e,i]of this.grid){const e=i.getDirt();e.isPresent()&&t.push(e.orElseThrow().getID())}return t}getDirtByID(t){for(let[e,i]of this.grid){const e=i.getDirt();if(e.isPresent()&&e.orElseThrow().getID()===t)return e}return d.empty()}getDirtByCoord(t){return this.getLocation(t).flatMap((t=>t.getDirt()))}getDirtCoordByID(t){for(let[e,i]of this.grid){const o=i.getDirt();if(o.isPresent()&&o.orElseThrow().getID()===t)return d.of(e)}return d.empty()}cleanDirtByCoord(t){if(null==t)throw new Error("The coordinates of the dirt location cannot be null or undefined.");if(!this.getDirtByCoord(t).isPresent())throw new Error("There is no dirt at the location.");this.getLocation(t).orElseThrow().removeDirt()}addDirtToLocation(t,e){if(null==t)throw new Error("The coordinates of the location cannot be null or undefined.");if(null==e)throw new Error("The dirt cannot be null or undefined.");if(this.getDirtByCoord(t).isPresent())throw new Error("There is already a dirt at the location.");this.getLocation(t).ifPresent((t=>t.addDirt(e)))}}!function(t){t.GREEN="GREEN",t.ORANGE="ORANGE",t.WHITE="WHITE",t.USER="USER"}(v||(v={}));const I=i(429);class O{id;constructor(){this.id=I.v4()}getID(){return this.id}equals(t){return null!=t&&(this===t||t instanceof O&&this.id===t.id)}}class k{dirtID;colour;constructor(t,e){this.dirtID=k.validateDirtID(t),this.colour=k.validateColour(e)}static validateDirtID(t){if(null==t)throw new Error("The dirt ID cannot be null or undefined.");return t}static validateColour(t){if(null==t)throw new Error("The dirt colour cannot be null or undefined.");return t}getID(){return this.dirtID}getColour(){return this.colour}equals(t){return null!=t&&(this===t||t instanceof k&&this.dirtID===t.dirtID&&this.colour===t.colour)}}class S extends O{colour;constructor(t){super(),this.colour=S.validateColour(t)}static validateColour(t){if(null==t)throw new Error("The dirt colour cannot be null or undefined.");return t}getColour(){return this.colour}equals(t){return null!=t&&(this===t||t instanceof S&&super.equals(t)&&this.colour===t.colour)}getAppearance(){return new k(this.getID(),this.colour)}toJsonObject(){return{colour:this.getColour()}}static fromJsonObject(t){if(null==t)throw new Error("The dirt JSON object cannot be null or undefined.");if(null===t.colour||void 0===t.colour)throw new Error("The colour of a `VWDirt` cannot be null or undefined.");const e=t.colour;return new S(e)}}var L,B;!function(t){t.LEFT="left",t.RIGHT="right"}(L||(L={}));class W{actorID;colour;orientation;constructor(t,e,i){this.actorID=W.validateActorID(t),this.colour=W.validateColour(e),this.orientation=W.validateOrientation(i)}static validateActorID(t){if(null==t)throw new Error("The actor ID cannot be null or undefined.");return t}static validateColour(t){if(null==t)throw new Error("The actor colour cannot be null or undefined.");return t}static validateOrientation(t){if(null==t)throw new Error("The actor orientation cannot be null or undefined.");return t}getID(){return this.actorID}getColour(){return this.colour}getOrientation(){return this.orientation}}class _ extends O{colour;orientation;mind;observationSensor;listeningSensor;physicalActuator;CommunicativeActuator;constructor(t,e,i,o,r,n,s){super(),this.colour=_.validateColour(t),this.orientation=_.validateOrientation(e),this.mind=_.validateMind(i),this.observationSensor=null==o?d.empty():d.of(o),this.listeningSensor=null==r?d.empty():d.of(r),this.physicalActuator=null==n?d.empty():d.of(n),this.CommunicativeActuator=null==s?d.empty():d.of(s)}static validateColour(t){if(null==t)throw new Error("The colour cannot be null or undefined.");return t}static validateOrientation(t){if(null==t)throw new Error("The orientation cannot be null or undefined.");return t}static validateMind(t){if(null==t)throw new Error("The mind cannot be null or undefined.");return t}getColour(){return this.colour}getOrientation(){return this.orientation}getMind(){return this.mind}getObservationSensor(){return this.observationSensor}getListeningSensor(){return this.listeningSensor}getPhysicalActuator(){return this.physicalActuator}getCommunicativeActuator(){return this.CommunicativeActuator}getAppearance(){return new W(this.getID(),this.getColour(),this.getOrientation())}turn(t){if(null==t)throw new Error("The turning direction cannot be null or undefined.");if(t===L.LEFT)this.orientation=b.getLeft(this.orientation);else{if(t!==L.RIGHT)throw new Error("The turning direction is invalid.");this.orientation=b.getRight(this.orientation)}}cycle(){const t=this.getObservationSensor().orElseThrow().sourceAll().orElseThrow(),e=_.mergeObservations(t),i=this.sourceMessages();this.getMind().perceive(e,i),this.getMind().revise(),this.getMind().decide();const o=this.getMind().execute();y.validateActions(o),this.executeActions(o)}sourceMessages(){const t=[];return this.getListeningSensor().ifPresent((e=>e.sourceAll().ifPresent((e=>t.push(...e))))),t}static mergeObservations(t){if(null==t)throw new Error("The observations array cannot be null or undefined.");if(t.some((t=>null==t)))throw new Error("The observations array cannot contain null or undefined observations.");if(0===t.length)throw new Error("At least one observation must be present.");if(1===t.length)return t[0];if(2===t.length){const e=t[0].getActionResults().concat(t[1].getActionResults());return new D(t[1].getLocations(),e)}throw new Error("At most two observations can be present.")}executeActions(t){for(const i of t)if(i instanceof r)this.getPhysicalActuator().orElseThrow().sink(i);else{if(!(i instanceof e))throw new Error("The action is not supported.");this.getCommunicativeActuator().orElseThrow().sink(i)}}toJsonObject(t){if(null==t)throw new Error("The actor mind core path cannot be null or undefined.");return{colour:this.getColour(),orientation:this.getOrientation(),mind:t}}}class R extends _{constructor(t,e,i,o,r,n,s){super(R.validateColourForCleaningAgent(t),e,i,o,r,n,s)}static validateColourForCleaningAgent(t){if(null==t)throw new Error("The colour cannot be null or undefined.");if(t===v.USER)throw new Error("The colour of a cleaning agent cannot be USER.");return t}}class x extends _{constructor(t,e,i,o){super(v.USER,t,e,i,void 0,o)}}class N{queue;constructor(){this.queue=[]}enqueue(t){if(null==t)throw new Error("The perception cannot be null or undefined.");this.queue.push(t)}dequeue(){const t=this.queue.shift();if(null==t)throw new Error("No perceptions to dequeue.");return t}peek(){const t=this.queue[0];if(null==t)throw new Error("No perceptions to peek.");return t}isEmpty(){return 0===this.queue.length}}class M{actions;constructor(){this.actions=new N}sink(t){if(null==t)throw new Error("The action cannot be null or undefined.");this.actions.enqueue(t)}sinkAll(t){if(null==t)throw new Error("The actions cannot be null or undefined.");t.forEach((t=>this.sink(t)))}source(){if(this.actions.isEmpty())throw new Error("No actions to source.");return this.actions.dequeue()}sourceAll(){if(this.actions.isEmpty())throw new Error("No actions to source.");{const t=[];for(;!this.actions.isEmpty();)t.push(this.actions.dequeue());return t}}hasPendingActions(){return!this.actions.isEmpty()}}class V extends M{}class P extends V{sink(t){if(null==t)throw new Error("The action cannot be null or undefined.");if(t instanceof s)throw new Error("A cleaning agent cannot drop dirt.");super.sink(t)}}class U extends M{}class F{perceptions;constructor(){this.perceptions=new N}sink(t){if(null==t)throw new Error("The perception cannot be null or undefined.");this.perceptions.enqueue(t)}sinkAll(t){if(null==t)throw new Error("The perceptions cannot be null or undefined.");t.forEach((t=>this.sink(t)))}source(){return this.perceptions.isEmpty()?d.empty():d.of(this.perceptions.dequeue())}sourceAll(){if(this.perceptions.isEmpty())return d.empty();{let t=[];for(;!this.perceptions.isEmpty();)t.push(this.perceptions.dequeue());return d.of(t)}}}class G extends F{}class H extends F{}class j extends V{sink(t){if(null==t)throw new Error("The action cannot be null or undefined.");if(t instanceof n)throw new Error("A user cannot clean dirt.");super.sink(t)}}class J{core;nextActions;constructor(t){this.core=J.validateCore(t),this.nextActions=[]}static validateCore(t){if(null==t)throw new Error("The mind core cannot be null or undefined.");return t}perceive(t,e){this.core.perceive(t,e)}revise(){this.core.revise()}decide(){this.nextActions=this.core.decide()}execute(){return this.nextActions}getMindCore(){return this.core}}class z extends J{constructor(t){super(t)}}!function(t){t[t.BASIC=0]="BASIC",t[t.ADVANCED=1]="ADVANCED"}(B||(B={}));class q{observation;messages;cumulativeEffort=0n;mindCoreFilePath;reviseMethod;decideMethod;getLatestObservation(){return this.observation}getLatestMessages(){return this.messages}getMindCoreFilePath(){return this.mindCoreFilePath}setMindCoreFilePath(t){this.mindCoreFilePath=t}getOwnID(){return this.observation.getOwnID()}getOwnColour(){return this.observation.getOwnColour()}getOwnOrientation(){return this.observation.getOwnOrientation()}getOwnCoordinates(){return this.observation.getOwnCoordinates()}perceive(t,e){this.observation=q.validateObservation(t),this.messages=q.validateMessages(e)}static validateObservation(t){if(null==t)throw new Error("The observation cannot be null or undefined.");return t}static validateMessages(t){if(null==t)throw new Error("The messages cannot be null or undefined.");return t}revise(){if(null===this.reviseMethod||void 0===this.reviseMethod)throw new Error("The revise method cannot be null or undefined.");this.reviseMethod()}decide(){if(null===this.decideMethod||void 0===this.decideMethod)throw new Error("The decide method cannot be null or undefined.");return this.decideMethod()}getCumulativeEffort(){return this.cumulativeEffort}incrementEffort(t){if(null==t)throw new Error("The effort cannot be null or undefined.");this.cumulativeEffort+=t}static loadFromFile(t){throw new Error("Not yet implemented.")}construct(t,e,i){this.mindCoreFilePath=t,this.reviseMethod=e,this.decideMethod=i}}class K extends q{difficultyLevel;constructor(t){super(),this.difficultyLevel=null==t?B.BASIC:t,this.setMindCoreFilePath("/index.js")}getDifficultyLevel(){return this.difficultyLevel}switchDifficultyLevel(){this.difficultyLevel===B.BASIC?this.difficultyLevel=B.ADVANCED:this.difficultyLevel=B.BASIC}revise(){}decide(){if(this.difficultyLevel===B.BASIC)return this.decideBasic();if(this.difficultyLevel===B.ADVANCED)return this.decideAdvanced();throw new Error("Unknown difficulty level.")}decideBasic(){return this.getLatestObservation().isWallImmediatelyAhead()?this.decideIfWallAheadAndBasic():this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.decideIfOnDirtAndBasic():this.actRandomly(.2,.2,.45,.075,.075)}decideIfWallAheadAndBasic(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?[new h(this.getOwnID(),L.RIGHT)]:this.getLatestObservation().isWallImmediatelyToTheRight()?[new h(this.getOwnID(),L.LEFT)]:this.turnRandomly()}decideIfOnDirtAndBasic(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?this.moveOrTurnRandomly(.6,0,.4):this.getLatestObservation().isWallImmediatelyToTheRight()?this.moveOrTurnRandomly(.6,.4,0):this.moveOrTurnRandomly(.5,.25,.25)}decideAdvanced(){return this.getLatestObservation().isWallImmediatelyAhead()?this.decideIfWallAheadAndAdvanced():this.isActorImmediatelyAhead()?this.decideIfActorAheadAndAdvanced():this.isActorImmediatelyToTheLeft()&&this.isActorImmediatelyToTheRight()?this.dropOrMoveRandomly(.1,.1,.8):this.isActorImmediatelyToTheLeft()&&!this.getLatestObservation().isWallImmediatelyToTheRight()?this.moveOrTurnRandomly(.5,0,.5):this.isActorImmediatelyToTheRight()&&!this.getLatestObservation().isWallImmediatelyToTheLeft()?this.moveOrTurnRandomly(.5,.5,0):this.getLatestObservation().isWallImmediatelyToTheLeft()?this.decideIfWallToTheLeftAndAdvanced():this.getLatestObservation().isWallImmediatelyToTheRight()?this.decideIfWallToTheRightAndAdvanced():this.actRandomly(.15,.15,.6,.05,.05)}decideIfWallAheadAndAdvanced(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?[new h(this.getOwnID(),L.RIGHT)]:this.getLatestObservation().isWallImmediatelyToTheRight()?[new h(this.getOwnID(),L.LEFT)]:this.isActorImmediatelyToTheLeft()&&this.isActorImmediatelyToTheRight()?this.turnRandomly():this.isActorImmediatelyToTheLeft()?[new h(this.getOwnID(),L.RIGHT)]:this.isActorImmediatelyToTheRight()?[new h(this.getOwnID(),L.LEFT)]:this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.turnRandomly():this.actRandomly(.075,.075,.6,0,.25)}decideIfWallToTheLeftAndAdvanced(){return this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.moveOrTurnRandomly(.9,0,.1):this.actRandomly(.075,.075,.6,0,.25)}decideIfWallToTheRightAndAdvanced(){return this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.moveOrTurnRandomly(.9,.1,0):this.actRandomly(.075,.075,.6,.25,0)}decideIfActorAheadAndAdvanced(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?[new h(this.getOwnID(),L.RIGHT)]:this.getLatestObservation().isWallImmediatelyToTheRight()?[new h(this.getOwnID(),L.LEFT)]:this.isActorImmediatelyToTheLeft()&&this.isActorImmediatelyToTheRight()?this.dropRandomDirt():this.isActorImmediatelyToTheLeft()?[new h(this.getOwnID(),L.RIGHT)]:this.isActorImmediatelyToTheRight()?[new h(this.getOwnID(),L.LEFT)]:this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.turnRandomly():this.actRandomly(.25,.25,0,.25,.25)}isActorImmediatelyAhead(){return!this.getLatestObservation().isWallImmediatelyAhead()&&this.getLatestObservation().getCenter().orElseThrow().hasActor()}isActorImmediatelyToTheLeft(){return!this.getLatestObservation().isWallImmediatelyToTheLeft()&&this.getLatestObservation().getLeft().orElseThrow().hasActor()}isActorImmediatelyToTheRight(){return!this.getLatestObservation().isWallImmediatelyToTheRight()&&this.getLatestObservation().getRight().orElseThrow().hasActor()}actRandomly(t,e,i,o,r){K.validateWeights([t,e,i,o,r]);const n=Math.random(),a=(c=0,t=>c+=t);var c;const d=[t,e,i,o,r].map(a);if(n<d[0])return[new s(this.getOwnID(),v.GREEN)];if(n<d[1])return[new s(this.getOwnID(),v.ORANGE)];if(n<d[2])return[new l(this.getOwnID())];if(n<d[3])return[new h(this.getOwnID(),L.LEFT)];if(n<d[4])return[new h(this.getOwnID(),L.RIGHT)];throw new Error("This should never happen.")}static validateWeights(t){if(null==t)throw new Error("Weights cannot be null or undefined.");if(t.some((t=>null==t)))throw new Error("Weights cannot contain null or undefined values.");if(t.some((t=>t<0)))throw new Error("Weights cannot be negative.");if(t.some((t=>t>1)))throw new Error("Weights cannot be greater than 1.0.");K.validateWeightsSum(t.reduce(((t,e)=>t+e),0))}static validateWeightsSum(t){if(t<1)throw new Error("Weights cannot sum to less than 1.0.");if(t>1)throw new Error("Weights cannot sum to more than 1.0.")}turnRandomly(){return this.actRandomly(0,0,0,.5,.5)}moveOrTurnRandomly(t,e,i){return this.actRandomly(0,0,t,e,i)}dropOrMoveRandomly(t,e,i){return this.actRandomly(t,e,i,0,0)}dropRandomDirt(){return this.actRandomly(.5,.5,0,0,0)}}class $ extends J{constructor(){super(new K)}}class X extends q{constructor(){super(),this.construct("/index.js",this.revise,this.decide)}revise(){}decide(){return[new a(this.getOwnID())]}}class Y{constructor(){}static createVWActorFromJSONObject(t){if(null==t)throw new Error("The JSON representation of a `VWActor` cannot be null or undefined.");if(null===t.colour||void 0===t.colour)throw new Error("The colour of a `VWActor` cannot be null or undefined.");if(t.colour===v.USER)return this.createVWUserFromJSONObject(t);if(Object.values(v).includes(t.colour))return this.createVWCleaningAgentFromJSONObject(t);throw new Error(`The colour of a \`VWActor\` cannot be "${t.colour}".`)}static createVWCleaningAgentFromJSONObject(t){if(null==t)throw new Error("The JSON representation of a `VWCleaningAgent` cannot be null or undefined.");if(null===t.colour||void 0===t.colour)throw new Error("The colour of a `VWCleaningAgent` cannot be null or undefined.");if(t.colour===v.USER)throw new Error(`The colour of a \`VWCleaningAgent\` cannot be "${v.USER}".`);if(Object.values(v).includes(t.colour)){if(null===t.orientation||void 0===t.orientation)throw new Error("The orientation of a `VWCleaningAgent` cannot be null or undefined.");if(Object.values(f).includes(t.orientation)){if(null===t.mind||void 0===t.mind)throw new Error("The path of the mind of a `VWCleaningAgent` cannot be null or undefined.");{const e=v[t.colour],i=f[t.orientation],o="hysteretic"==t.mind?new X:q.loadFromFile(t.mind),r=new z(o),n=new H,s=new G,a=new P,l=new U;return new R(e,i,r,n,s,a,l)}}throw new Error(`The orientation of a \`VWCleaningAgent\` cannot be "${t.orientation}".`)}throw new Error(`The colour of a \`VWCleaningAgent\` cannot be "${t.colour}".`)}static createVWUserFromJSONObject(t){if(null==t)throw new Error("The JSON representation of a `VWUser` cannot be null or undefined.");if(null===t.colour||void 0===t.colour)throw new Error("The colour of a `VWUser` cannot be null or undefined.");if(t.colour!==v.USER)throw new Error(`The colour of a \`VWUser\` must be "${v.USER}".`);if(null===t.orientation||void 0===t.orientation)throw new Error("The orientation of a `VWUser` cannot be null or undefined.");if(Object.values(f).includes(t.orientation)){const e=f[t.orientation],i=new $,o=new H,r=new j;return new x(e,i,o,r)}throw new Error(`The orientation of a \`VWUser\` cannot be "${t.orientation}".`)}}class Q{coord;actorAppearance;dirtAppearance;wall;constructor(t,e,i,o){this.coord=Q.validateCoord(t),this.wall=Q.validateWall(e),this.actorAppearance=d.ofNullable(i),this.dirtAppearance=d.ofNullable(o)}static validateCoord(t){if(null==t)throw new Error("The coordinates cannot be null or undefined.");return t}static validateWall(t){if(null==t)throw new Error("The wall cannot be null or undefined.");if(4!==t.size)throw new Error("The wall must have 4 sides.");if(t.has(f.NORTH)&&t.has(f.EAST)&&t.has(f.SOUTH)&&t.has(f.WEST))return t;throw new Error("The wall must have 4 sides.")}getID(){return this.coord.toString()}getCoord(){return this.coord}hasActor(){return this.actorAppearance.isPresent()}hasCleaningAgent(){return this.actorAppearance.isPresent()&&this.actorAppearance.orElseThrow().getColour()!==v.USER}hasUser(){return this.actorAppearance.isPresent()&&this.actorAppearance.orElseThrow().getColour()===v.USER}getActorAppearance(){return this.actorAppearance}hasDirt(){return this.dirtAppearance.isPresent()}getDirtAppearance(){return this.dirtAppearance}getWall(){return this.wall}hasWallOn(t){return this.wall.get(t)}hasWallOnNorth(){return this.hasWallOn(f.NORTH)}hasWallOnEast(){return this.hasWallOn(f.EAST)}hasWallOnSouth(){return this.hasWallOn(f.SOUTH)}hasWallOnWest(){return this.hasWallOn(f.WEST)}}class Z{coord;actor;dirt;wall;constructor(t,e,i,o){this.coord=Z.validateCoord(t),this.wall=Z.validateWall(e),this.actor=d.ofNullable(i),this.dirt=d.ofNullable(o)}static validateCoord(t){if(null==t)throw new Error("The coordinates cannot be null or undefined.");return t}static validateWall(t){if(null==t)throw new Error("The wall cannot be null or undefined.");if(4!==t.size)throw new Error("The wall must have 4 sides.");if(t.has(f.NORTH)&&t.has(f.EAST)&&t.has(f.SOUTH)&&t.has(f.WEST))return t;throw new Error("The wall must have 4 sides.")}hasActor(){return this.actor.isPresent()}hasCleaningAgent(){return this.actor.isPresent()&&this.actor.orElseThrow().getAppearance().getColour()!==v.USER}hasUser(){return this.actor.isPresent()&&this.actor.orElseThrow().getAppearance().getColour()===v.USER}getActor(){return this.actor}addActor(t){if(this.hasActor())throw new Error("There is already an actor in this location.");if(null==t)throw new Error("The actor cannot be null or undefined.");this.actor=d.of(t)}removeActor(){if(!this.hasActor())throw new Error("There is no actor in this location.");this.actor=d.empty()}popActor(){const t=this.getActor();return t.isPresent()&&this.removeActor(),t}hasDirt(){return this.dirt.isPresent()}getDirt(){return this.dirt}addDirt(t){if(this.hasDirt())throw new Error("There is already a dirt in this location.");if(null==t)throw new Error("The dirt cannot be null or undefined.");this.dirt=d.of(t)}removeDirt(){if(!this.hasDirt())throw new Error("There is no dirt in this location.");this.dirt=d.empty()}getCoord(){return this.coord}getWall(){return this.wall}hasWallOn(t){return this.wall.get(t)}hasWallOnNorth(){return this.hasWallOn(f.NORTH)}hasWallOnEast(){return this.hasWallOn(f.EAST)}hasWallOnSouth(){return this.hasWallOn(f.SOUTH)}hasWallOnWest(){return this.hasWallOn(f.WEST)}getAppearance(){return this.hasActor()&&this.hasDirt()?new Q(this.coord,this.wall,this.getActor().orElseThrow().getAppearance(),this.getDirt().orElseThrow().getAppearance()):this.hasActor()?new Q(this.coord,this.wall,this.getActor().orElseThrow().getAppearance(),void 0):this.hasDirt()?new Q(this.coord,this.wall,void 0,this.getDirt().orElseThrow().getAppearance()):new Q(this.coord,this.wall)}toJsonObject(t){const e={coord:this.coord.toJsonObject(),wall:{north:this.hasWallOnNorth(),east:this.hasWallOnEast(),south:this.hasWallOnSouth(),west:this.hasWallOnWest()}};return this.hasActor()&&(e.actor=this.getActor().orElseThrow().toJsonObject(t)),this.hasDirt()&&(e.dirt=this.getDirt().orElseThrow().toJsonObject()),e}static fromJsonObject(t){if(null==t)throw new Error("The JSON representation of a `VWLocation` cannot be null or undefined.");if(null===t.wall||void 0===t.wall)throw new Error("The JSON representation of a `VWLocation` must have a `wall` property.");if(null===t.coord||void 0===t.coord)throw new Error("The JSON representation of a `VWLocation` must have a `coord` property.");return Z.fromJsonObjectHelper(p.fromJsonObject(t.coord),t.wall,t.actor,t.dirt)}static fromJsonObjectHelper(t,e,i,o){const r=Z.constructWallFromData(e),n=null==i?d.empty():d.of(Y.createVWActorFromJSONObject(i)),s=null==o?d.empty():d.of(S.fromJsonObject(o));return n.isPresent()&&s.isPresent()?new Z(t,r,n.orElseThrow(),s.orElseThrow()):n.isPresent()?new Z(t,r,n.orElseThrow(),void 0):s.isPresent()?new Z(t,r,void 0,s.orElseThrow()):new Z(t,r)}static constructWallFromData(t){const e=new Map;if(null==t)throw new Error("The wall cannot be null or undefined.");if(null===t.north||void 0===t.north)throw new Error("The wall must have a `north` property.");if(null===t.east||void 0===t.east)throw new Error("The wall must have an `east` property.");if(null===t.south||void 0===t.south)throw new Error("The wall must have a `south` property.");if(null===t.west||void 0===t.west)throw new Error("The wall must have a `west` property.");return e.set(f.NORTH,t.north),e.set(f.EAST,t.east),e.set(f.SOUTH,t.south),e.set(f.WEST,t.west),e}static generateWallFromCoordAndGridSize(t,e){const i=new Map;return i.set(f.NORTH,0n===t.getY()),i.set(f.EAST,t.getX()===BigInt(e)-1n),i.set(f.SOUTH,t.getY()===BigInt(e)-1n),i.set(f.WEST,0n===t.getX()),i}}class tt{actorColourBeforeAction;actorOrientationBeforeAction;actorCoordBeforeAction;dirtBeforeAction;getActorColourBeforeAction(){return this.actorColourBeforeAction}setActorColourBeforeAction(t){if(null==t)throw new Error("The actor colour cannot be null or undefined.");this.actorColourBeforeAction=t}getActorOrientationBeforeAction(){return this.actorOrientationBeforeAction}setActorOrientationBeforeAction(t){if(null==t)throw new Error("The actor orientation cannot be null or undefined.");this.actorOrientationBeforeAction=t}getActorCoordBeforeAction(){return this.actorCoordBeforeAction}setActorCoordBeforeAction(t){if(null==t)throw new Error("The actor coord cannot be null or undefined.");this.actorCoordBeforeAction=t}getDirtBeforeAction(){return this.dirtBeforeAction}setDirtBeforeAction(t){if(null==t)throw new Error("The dirt cannot be null or undefined.");this.dirtBeforeAction=t}attempt(t,e){if(null==t)throw new Error("The action cannot be null or undefined.");if(null==e)throw new Error("The environment cannot be null or undefined.");if(this.isPossible(t,e)){this.setActorColourBeforeAction(e.getActorByID(t.getActorID()).orElseThrow().getColour()),this.setActorOrientationBeforeAction(e.getActorByID(t.getActorID()).orElseThrow().getOrientation()),this.setActorCoordBeforeAction(e.getActorCoordByID(t.getActorID()).orElseThrow()),this.setDirtBeforeAction(e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getDirt());const i=this.perform(t,e);return this.succeeded(t,e)?i:new w(u.FAILURE,t)}return new w(u.IMPOSSIBLE,t)}static isActorInEnv(t,e){return e.getActorByID(t).isPresent()}checkAllInvariants(t,e){return tt.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkOrientationAfterAction(t,e)&&this.checkCoordAfterAction(t,e)&&this.checkDirtAfterAction(e)}checkColourAfterAction(t,e){return this.getActorColourBeforeAction()===e.getActorByID(t.getActorID()).orElseThrow().getColour()}checkOrientationAfterAction(t,e){return this.getActorOrientationBeforeAction()===e.getActorByID(t.getActorID()).orElseThrow().getOrientation()}checkCoordAfterAction(t,e){return this.getActorCoordBeforeAction().equals(e.getActorCoordByID(t.getActorID()).orElseThrow())}checkDirtAfterAction(t){return this.getDirtBeforeAction().equals(t.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getDirt())}}class et extends tt{isPossible(t,e){try{return tt.isActorInEnv(t.getActorID(),e)&&e.getActorByID(t.getActorID()).orElseThrow().getCommunicativeActuator().isPresent()}catch(t){return!1}}perform(t,e){try{return e.sendMessageToRecipients(t)?new w(u.SUCCESS,t):new w(u.FAILURE,t)}catch(e){return new w(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)}catch(t){return!1}}checkInvariants(t,e){return this.checkAllInvariants(t,e)}}class it extends tt{isPossible(t,e){try{return tt.isActorInEnv(t.getActorID(),e)&&it.isActorCleaningAgent(t,e)&&it.actorLocationHasCompatibleDirt(t,e)}catch(t){return!1}}static isActorCleaningAgent(t,e){const i=e.getActorByID(t.getActorID()).orElseThrow().getColour();return Object.values(v).includes(i)&&i!==v.USER}static actorLocationHasCompatibleDirt(t,e){const i=e.getActorCoordByID(t.getActorID()),o=e.getActorByID(t.getActorID()).orElseThrow().getColour();return i.isPresent()&&e.getLocation(i.orElseThrow()).orElseThrow().hasDirt()&&it.canClean(o,i,e)}static canClean(t,e,i){return t===v.WHITE||t===i.getLocation(e.orElseThrow()).orElseThrow().getDirt().orElseThrow().getColour()}perform(t,e){try{return e.cleanDirtByCoord(this.getActorCoordBeforeAction()),new w(u.SUCCESS,t)}catch(t){return new w(u.FAILURE,t.message)}}succeeded(t,e){try{return this.checkInvariants(t,e)&&this.checkDirtRemoved(e)}catch(t){return!1}}checkInvariants(t,e){return tt.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkOrientationAfterAction(t,e)&&this.checkCoordAfterAction(t,e)}checkDirtRemoved(t){return!t.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasDirt()}}class ot extends tt{isPossible(t,e){try{return tt.isActorInEnv(t.getActorID(),e)&&ot.isActorUser(t,e)&&ot.actorLocationHasNoDirt(t,e)}catch(t){return!1}}static isActorUser(t,e){return e.getActorByID(t.getActorID()).orElseThrow().getColour()===v.USER}static actorLocationHasNoDirt(t,e){const i=e.getActorCoordByID(t.getActorID());return i.isPresent()&&!e.getLocation(i.orElseThrow()).orElseThrow().hasDirt()}perform(t,e){try{return e.addDirtToLocation(this.getActorCoordBeforeAction(),new S(t.getColour())),new w(u.SUCCESS,t)}catch(e){return new w(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)&&this.checkDirtAdded(t,e)}catch(t){return!1}}checkInvariants(t,e){return tt.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkOrientationAfterAction(t,e)&&this.checkCoordAfterAction(t,e)}checkDirtAdded(t,e){return e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasDirt()&&e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getDirt().orElseThrow().getColour()===t.getColour()}}class rt extends tt{isPossible(t,e){try{return tt.isActorInEnv(t.getActorID(),e)}catch(t){return!1}}perform(t,e){try{return new w(u.SUCCESS,t)}catch(e){return new w(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)}catch(t){return!1}}checkInvariants(t,e){return this.checkAllInvariants(t,e)}}class nt extends tt{isPossible(t,e){try{return tt.isActorInEnv(t.getActorID(),e)&&nt.targetExists(t,e)&&nt.targetHasNoActor(t,e)}catch(t){return!1}}static targetExists(t,e){const i=e.getActorCoordByID(t.getActorID()),o=e.getActorByID(t.getActorID()).orElseThrow().getOrientation();return i.isPresent()&&!e.getLocation(i.orElseThrow()).orElseThrow().hasWallOn(o)}static targetHasNoActor(t,e){try{const i=e.getActorCoordByID(t.getActorID()).orElseThrow(),o=e.getActorByID(t.getActorID()).orElseThrow().getOrientation();if(e.getLocation(i).orElseThrow().hasWallOn(o))return!1;{const t=i.getForwardCoord(o);return e.getLocation(t).isPresent()&&!e.getLocation(t).orElseThrow().hasActor()}}catch(t){return!1}}perform(t,e){try{const i=this.getActorCoordBeforeAction().getForwardCoord(this.getActorOrientationBeforeAction());return e.getLocation(i).isPresent()?(e.moveActor(this.getActorCoordBeforeAction(),i),new w(u.SUCCESS,t)):new w(u.FAILURE,t)}catch(e){return new w(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)&&this.checkOriginalLocation(t,e)&&nt.checkTargetLocation(t,e)}catch(t){return!1}}checkInvariants(t,e){return tt.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkOrientationAfterAction(t,e)&&this.checkDirtAfterAction(e)}checkOriginalLocation(t,e){return this.noActorInOriginalLocation(e)||this.differentActorInOriginalLocation(t.getActorID(),e)}noActorInOriginalLocation(t){return!t.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasActor()}differentActorInOriginalLocation(t,e){return e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasActor()&&e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getActor().orElseThrow().getID()!==t}static checkTargetLocation(t,e){const i=e.getActorCoordByID(t.getActorID());return i.isPresent()&&e.getLocation(i.orElseThrow()).orElseThrow().hasActor()&&e.getLocation(i.orElseThrow()).orElseThrow().getActor().orElseThrow().getID()===t.getActorID()}}class st extends tt{isPossible(t,e){try{return tt.isActorInEnv(t.getActorID(),e)&&e.getActorByID(t.getActorID()).orElseThrow().getCommunicativeActuator().isPresent()}catch(t){return!1}}perform(t,e){try{return e.sendMessageToRecipients(t)?new w(u.SUCCESS,t):new w(u.FAILURE,t)}catch(e){return new w(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)}catch(t){return!1}}checkInvariants(t,e){return this.checkAllInvariants(t,e)}}class at extends tt{isPossible(t,e){try{return tt.isActorInEnv(t.getActorID(),e)}catch(t){return!1}}perform(t,e){try{return e.turnActor(this.getActorCoordBeforeAction(),t.getTurningDirection()),new w(u.SUCCESS,t)}catch(e){return new w(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)&&this.checkOrientationAfterTurn(t,e)}catch(t){return!1}}checkInvariants(t,e){return tt.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkCoordAfterAction(t,e)&&this.checkDirtAfterAction(e)}checkOrientationAfterTurn(t,e){const i=e.getActorByID(t.getActorID()).orElseThrow().getOrientation();return t.getTurningDirection()===L.LEFT?i===b.getLeft(this.getActorOrientationBeforeAction()):t.getTurningDirection()===L.RIGHT&&i===b.getRight(this.getActorOrientationBeforeAction())}}class lt{ambient;cycleNumber;constructor(t){this.ambient=lt.validateAmbient(t),this.cycleNumber=0}static validateAmbient(t){if(null==t)throw new Error("The ambient cannot be null or undefined.");return t}getAmbient(){return this.ambient}getCycleNumber(){return this.cycleNumber}resetCycleNumber(){this.cycleNumber=0}getGridSize(){return this.ambient.getGridSize()}getLocation(t){return this.ambient.getLocation(t)}getActorsIDs(){return this.ambient.getActorsIDs()}getActorsIDsExcept(t){return this.ambient.getActorsIDsExcept(t)}getActorByID(t){return this.ambient.getActorByID(t)}getActorByCoord(t){return this.ambient.getActorByCoord(t)}getActorCoordByID(t){return this.ambient.getActorCoordByID(t)}addActorToLocation(t,e){this.ambient.addActorToLocation(t,e)}moveActor(t,e){this.ambient.moveActor(t,e)}turnActor(t,e){this.ambient.turnActor(t,e)}getDirtsIDs(){return this.ambient.getDirtsIDs()}getDirtByID(t){return this.ambient.getDirtByID(t)}getDirtByCoord(t){return this.ambient.getDirtByCoord(t)}getDirtCoordByID(t){return this.ambient.getDirtCoordByID(t)}cleanDirtByCoord(t){this.ambient.cleanDirtByCoord(t)}addDirtToLocation(t,e){this.ambient.addDirtToLocation(t,e)}cycle(){console.log("Start of cycle #"+this.cycleNumber+"..."),0===this.cycleNumber&&this.forceInitialPerceptionToActors(),this.ambient.getActors().forEach((t=>this.cycleActor(t))),console.log("Environment after the actions: "),console.log(JSON.stringify(this.toJsonObject(),null,4)),console.log("End of cycle #"+this.cycleNumber+"..."),this.cycleNumber++}forceInitialPerceptionToActors(){this.ambient.getActors().forEach((t=>this.forceInitialPerceptionToActor(t)))}forceInitialPerceptionToActor(t){const e=new w(u.IMPOSSIBLE,new a(t.getID()));this.sendResultToActor(e,!1)}cycleActor(t){t.cycle(),this.executeActorActions(t)}executeActorActions(t){const e=[];t.getPhysicalActuator().orElseThrow().hasPendingActions()&&t.getPhysicalActuator().orElseThrow().sourceAll().forEach((t=>e.push(t))),t.getCommunicativeActuator().isPresent()&&t.getCommunicativeActuator().orElseThrow().hasPendingActions()&&t.getCommunicativeActuator().orElseThrow().sourceAll().forEach((t=>e.push(t))),y.validateActions(e),e.forEach((t=>this.executeAction(t)))}executeAction(t){lt.getExecutorFor(t).ifPresentOrElse((e=>{const i=e.attempt(t,this);this.sendResultToActor(i,!0)}),(()=>{throw new Error("No executor found for the action "+t+".")}))}static getExecutorFor(t){return t instanceof a?d.of(new rt):t instanceof l?d.of(new nt):t instanceof h?d.of(new at):t instanceof n?d.of(new it):t instanceof s?d.of(new ot):t instanceof c?d.of(new st):t instanceof o?d.of(new et):d.empty()}sendResultToActor(t,e){const i=new Map,o=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow(),r=this.getActorByCoord(o).orElseThrow().getOrientation(),n=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getForwardCoord(r),s=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getLeftCoord(r),a=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getRightCoord(r),l=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getForwardLeftCoord(r),c=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getForwardRightCoord(r);this.ambient.getGrid().containsKey(o)&&i.set(g.CENTER,this.ambient.getGrid().get(o).getAppearance()),this.ambient.getGrid().containsKey(n)&&i.set(g.FORWARD,this.ambient.getGrid().get(n).getAppearance()),this.ambient.getGrid().containsKey(s)&&i.set(g.LEFT,this.ambient.getGrid().get(s).getAppearance()),this.ambient.getGrid().containsKey(a)&&i.set(g.RIGHT,this.ambient.getGrid().get(a).getAppearance()),this.ambient.getGrid().containsKey(l)&&i.set(g.FORWARDLEFT,this.ambient.getGrid().get(l).getAppearance()),this.ambient.getGrid().containsKey(c)&&i.set(g.FORWARDRIGHT,this.ambient.getGrid().get(c).getAppearance());const h=new D(i,[t]);this.getActorByCoord(o).orElseThrow().getObservationSensor().ifPresent((t=>t.sink(h))),this.getActorByCoord(o).orElseThrow().getMind().getMindCore().incrementEffort(e?t.getAction().getEffort():0n)}sendMessageToRecipients(t){try{return(t.getRecipientsIDs().length>0?t.getRecipientsIDs():this.getActorsIDsExcept(t.getActorID())).forEach((e=>this.sendMessageToRecipient(t,e))),!0}catch(t){return!1}}sendMessageToRecipient(t,e){this.getActorByID(e).ifPresent((i=>i.getListeningSensor().ifPresent((i=>i.sink(new T(t.getContent(),t.getActorID(),e))))))}toJsonObject(){return{locations:this.serialiseLocations()}}serialiseLocations(){let t=[];for(let e of this.ambient.getGrid().getValues())t.push(this.serialiseLocation(e));return t}serialiseLocation(t){if(null==t)throw new Error("The location cannot be null or undefined.");if(t.hasActor()){const e=this.getActorMindCorePath(t.getActor().orElseThrow().getMind().getMindCore());return t.toJsonObject(e)}return t.toJsonObject()}getActorMindCorePath(t){return t.getMindCoreFilePath()}static fromJsonObject(t,e){if(null==t)throw new Error("The state to load cannot be null or undefined.");if(null===t.locations||void 0===t.locations)throw new Error("The state to load must contain a 'locations' property.");if(Array.isArray(t.locations)){if(t.locations.some((t=>null==t)))throw new Error("The 'locations' array cannot contain null or undefined values.");if(null==e)throw new Error("The config cannot be null or undefined.");return lt.fromJsonObjectHelper(t,e)}throw new Error("The 'locations' property must be an array.")}static fromJsonObjectHelper(t,e){const i=lt.loadLocations(t.locations);return lt.validateGrid(i,e),new lt(new C(i))}static loadLocations(t){const e=new E;for(const i of t){if(null===i.coord||void 0===i.coord)throw new Error("The location coordinates cannot be null or undefined.");e.put(p.fromJsonObject(i.coord),Z.fromJsonObject(i))}return e}static validateGrid(t,e){if(null==t)throw new Error("The grid cannot be null or undefined.");if(null==e)throw new Error("The config cannot be null or undefined.");if(null===e.min_environment_dim||void 0===e.min_environment_dim)throw new Error("The config must contain a 'min_environment_dim' property.");if(null===e.max_environment_dim||void 0===e.max_environment_dim)throw new Error("The config must contain a 'max_environment_dim' property.");lt.validateGridHelper(t,e)}static validateGridHelper(t,e){const i=Math.sqrt(t.size());lt.validateGridSize(i,e)}static validateGridSize(t,e){if(t!==Math.floor(t))throw new Error("The grid must be a square.");if(t<e.min_environment_dim)throw new Error(`The grid size is too small (min: "${e.min_environment_dim}").`);if(t>e.max_environment_dim)throw new Error(`The grid size is too big (max: "${e.max_environment_dim}").`)}static newEmptyVWEnvironment(t,e){if(null==t)throw new Error("The config cannot be null or undefined.");return lt.newEmptyVWEnvironmentHelper(t,e)}static newEmptyVWEnvironmentHelper(t,e){const i=null==e?BigInt(t.initial_environment_dim):e;lt.validateGridSize(Number(i),t);const o=new E;for(let t=0n;t<i;t++)for(let e=0n;e<i;e++){const r=new p(t,e);o.put(r,new Z(r,Z.generateWallFromCoordAndGridSize(r,i)))}return new lt(new C(o))}}class ct{constructor(){}static exists(...t){return null!=t&&Array.from(t).every((t=>null!=t))}}class ht{constructor(){}static displayError(t){document.getElementById("error_div").innerText=t,document.getElementById("error_div").removeAttribute("hidden"),document.getElementById("error_div").addEventListener("click",(()=>ht.hideError()))}static hideError(){document.getElementById("error_div").innerText="",document.getElementById("error_div").hidden=!0}}class dt{speed;autoplay;stateToLoad;tooltipsActive;maxNumberOfCycles;efforts;teleora;constructor(){this.setDefaultOptions()}setDefaultOptions(){this.speed=0,this.autoplay=!1,this.stateToLoad=void 0,this.tooltipsActive=!0,this.maxNumberOfCycles=void 0,this.efforts=new Map,this.teleora=void 0}getSpeed(){return this.speed}setSpeed(t){this.speed=t}isAutoplayActive(){return this.autoplay}activateAutoplay(){this.autoplay=!0}deactivateAutoplay(){this.autoplay=!1}getStateToLoad(){return this.stateToLoad}setStateToLoad(t){this.stateToLoad=t}areTooltipsActive(){return this.tooltipsActive}activateTooltips(){this.tooltipsActive=!0}deactivateTooltips(){this.tooltipsActive=!1}getMaxNumberOfCycles(){return this.maxNumberOfCycles}setMaxNumberOfCycles(t){this.maxNumberOfCycles=t}getEfforts(){return this.efforts}setEfforts(t){this.efforts=t}setEffort(t,e){this.efforts.set(t,e)}getTeleora(){return this.teleora}setTeleora(t){this.teleora=t}}class ut{div;img;packed;constructor(t){if(null==t)throw new Error("The path of the initial view image cannot be null or undefined.");this.div=document.createElement("div"),this.div.id="initial_view_div",this.div.hidden=!0,this.img=document.createElement("img"),this.img.id="initial_view_img",this.img.src=t,this.packed=!1}pack(){if(this.packed)console.log("The initial view div is already packed.");else{if(null===this.div||void 0===this.div)throw new Error("Cannot pack: the div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot pack: the initial view div is not hidden (it must be before packing it).");if(null===this.img||void 0===this.img)throw new Error("Cannot pack: the image is null or undefined.");this.div.appendChild(this.img),this.packed=!0}}unpack(){if(this.packed){if(null===this.div||void 0===this.div)throw new Error("Cannot unpack: the div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot unpack: the initial view div is not hidden (it must be before unpacking it).");if(null===this.img||void 0===this.img)throw new Error("Cannot unpack: the image is null or undefined.");this.div.removeChild(this.img),this.packed=!1}else console.log("The initial view div is already unpacked.")}show(){if(null===this.div||void 0===this.div)throw new Error("Cannot show: the div is null or undefined.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the initial view div is not packed.");this.div.hidden=!1}else console.log("The initial view div is already shown.")}hide(){if(null===this.div||void 0===this.div)throw new Error("Cannot hide: the div is null or undefined.");if(this.div.hidden)console.log("The initial view div is already hidden.");else{if(!this.packed)throw new Error("Cannot hide: the initial view div is not packed.");this.div.hidden=!0}}getDiv(){if(null===this.div||void 0===this.div)throw new Error("Cannot get the initial view div: the div is null or undefined.");return this.div}}class ft{callback;button;constructor(t,e,i,o){if(null==t)throw new Error("The text of the button cannot be null or undefined.");if(null==e)throw new Error("The id of the button cannot be null or undefined.");if(null==i)throw new Error("The callback of the button cannot be null or undefined.");this.callback=i,this.button=document.createElement("button"),this.button.id=e,this.button.innerHTML=t,this.button.addEventListener("click",this.callback),this.addClasses(o)}addClasses(t){null!=t&&t.forEach((t=>this.button.classList.add(t)))}getButton(){return this.button}}class gt{div;startButton;optionsButton;guideButton;packed;constructor(t,e,i){if(null==t)throw new Error("The start callback cannot be null or undefined.");if(null==e)throw new Error("The options callback cannot be null or undefined.");if(null==i)throw new Error("The guide callback cannot be null or undefined.");this.div=document.createElement("div"),this.div.id="initial_view_buttons_div",this.div.hidden=!0,this.startButton=new ft("Start","start_button",t.bind(this),["initial_buttons"]),this.optionsButton=new ft("Options","options_button",e.bind(this),["initial_buttons"]),this.guideButton=new ft("Guide","guide_button",i.bind(this),["initial_buttons"]),this.packed=!1}pack(){if(this.packed)console.log("The initial view buttons div is already packed.");else{if(null===this.div||void 0===this.div)throw new Error("Cannot pack: the div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot pack: the initial view buttons div is not hidden (it must be before packing it).");if(null===this.startButton||void 0===this.startButton)throw new Error("Cannot pack: the start button is null or undefined.");if(null===this.guideButton||void 0===this.guideButton)throw new Error("Cannot pack: the guide button is null or undefined.");if(null===this.optionsButton||void 0===this.optionsButton)throw new Error("Cannot pack: the options button is null or undefined.");this.div.appendChild(this.startButton.getButton()),this.div.appendChild(this.optionsButton.getButton()),this.div.appendChild(this.guideButton.getButton()),this.packed=!0}}unpack(){if(this.packed){if(null===this.div||void 0===this.div)throw new Error("Cannot unpack: the div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot unpack: the initial view buttons div is not hidden (it must be before unpacking it).");if(null===this.startButton||void 0===this.startButton)throw new Error("Cannot unpack: the start button is null or undefined.");if(null===this.guideButton||void 0===this.guideButton)throw new Error("Cannot unpack: the guide button is null or undefined.");if(null===this.optionsButton||void 0===this.optionsButton)throw new Error("Cannot unpack: the options button is null or undefined.");this.div.removeChild(this.startButton.getButton()),this.div.removeChild(this.guideButton.getButton()),this.div.removeChild(this.optionsButton.getButton()),this.packed=!1}else console.log("The initial view buttons div is already unpacked.")}show(){if(null===this.div||void 0===this.div)throw new Error("Cannot show: the div is null or undefined.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the initial view buttons div is not packed.");this.div.hidden=!1}else console.log("The initial view buttons div is already shown.")}hide(){if(null===this.div||void 0===this.div)throw new Error("Cannot hide: the div is null or undefined.");if(this.div.hidden)console.log("The initial view buttons div is already hidden.");else{if(!this.packed)throw new Error("Cannot hide: the initial buttons view div is not packed.");this.div.hidden=!0}}getDiv(){if(null===this.div||void 0===this.div)throw new Error("Cannot get the div: the div is null or undefined.");return this.div}}class vt{constructor(){}static createDivWithLabel(t,e,i){let o=document.createElement("div");o.id=t;let r=vt.createLabel(e,i);return o.appendChild(r),o}static createLabel(t,e){let i=document.createElement("label");return i.htmlFor=t,i.innerText=e,i}static createCheckbox(t,e){let i=document.createElement("input");return i.type="checkbox",i.id=t,i.checked=null!=e&&e,i}static createFileInput(t,e){let i=document.createElement("input");return i.type="file",i.id=t,i.accept=null!=e?e:"",i}static createNumberInputsDivs(t,e,i){let o=[];return t.forEach((t=>{const r=t.toLowerCase()+i,n=t.toLowerCase()+e;let s=vt.createNumberInput(r),a=vt.createDivWithLabel(n,r,t);a.appendChild(s),o.push(a)})),o}static createNumberInput(t,e,i,o,r){let n=document.createElement("input");return n.type="number",n.id=t,n.min=null!=e?e.toString():"",n.max=null!=i?i.toString():"",n.step=null!=o?o.toString():"",n.value=null!=r?r.toString():"",n}static createOptionElement(t,e,i){let o=document.createElement("option");return o.id=t,o.value=e,o.textContent=i,o}static createSelectElement(t,e,i){let o=document.createElement("select");return o.id=t,e.forEach((t=>{const e=null!=i?i+t:t;let r=vt.createOptionElement(e,t,t);o.appendChild(r)})),o}}class wt{dialog;speedSelectorDiv;autoplaySelectorDiv;stateToLoadSelectorDiv;stateToLoadInputCallback;tooltipsSelectorDiv;maxNumberOfCyclesSelectorDiv;effortsSelectorDiv;teleoraSelectorDiv;teleoraInputCallback;okButton;okButtonCallback;cancelButton;cancelButtonCallback;packed;constructor(t,e,i,o){this.dialog=document.createElement("dialog"),this.dialog.id="options_dialog",this.okButtonCallback=t,this.cancelButtonCallback=e,this.stateToLoadInputCallback=i,this.teleoraInputCallback=o,this.constructOptionsDialog(),this.packed=!1}constructSpeedSelectorDiv(){this.speedSelectorDiv=vt.createDivWithLabel("speed_selector_div","speed_selector","Speed:");let t=vt.createSelectElement("speed_values",this.generateSpeedValues(),"speed_value_");this.speedSelectorDiv.appendChild(t)}generateSpeedValues(){let t=[];for(let e=0;e<1e3;e++){const i=e/1e3;t.push(i.toString())}return t}constructAutoplayCheckboxDiv(){this.autoplaySelectorDiv=vt.createDivWithLabel("autoplay_checkbox_div","autoplay_checkbox","Autoplay:");let t=vt.createCheckbox("autoplay_checkbox");this.autoplaySelectorDiv.appendChild(t)}constructStateToLoadSelectorDiv(){this.stateToLoadSelectorDiv=vt.createDivWithLabel("state_to_load_input_div","state_to_load_upload_input","State:");let t=vt.createFileInput("state_to_load_upload_input",".json");t.addEventListener("change",this.stateToLoadInputCallback),this.stateToLoadSelectorDiv.appendChild(t)}constructTooltipsCheckboxDiv(){this.tooltipsSelectorDiv=vt.createDivWithLabel("tooltips_checkbox_div","tooltips_checkbox","Tooltips:");let t=vt.createCheckbox("tooltips_checkbox");this.tooltipsSelectorDiv.appendChild(t)}constructMaxNumberOfCyclesSelectorDiv(){this.maxNumberOfCyclesSelectorDiv=vt.createDivWithLabel("max_number_of_cycles_input_div","max_number_of_cycles_input","Cycles:");let t=vt.createNumberInput("max_number_of_cycles_input");this.maxNumberOfCyclesSelectorDiv.appendChild(t)}constructEffortsSelectorDiv(){this.effortsSelectorDiv=vt.createDivWithLabel("efforts_inputs_div","efforts_selector","Efforts:"),vt.createNumberInputsDivs(wt.getActionNames(),"_effort_div","_effort_input").forEach((t=>this.effortsSelectorDiv.appendChild(t)))}static getActionNames(){return["VWIdleAction","VWMoveAction","VWTurnAction","VWCleanAction","VWDropDirtAction","VWSpeakAction","VWBroadcastAction"]}constructTeleoraSelectorDiv(){this.teleoraSelectorDiv=vt.createDivWithLabel("teleora_input_div","teleora_selector","Teleora mind core:");let t=vt.createFileInput("teleora_upload_input",".tel");t.addEventListener("change",this.teleoraInputCallback),this.teleoraSelectorDiv.appendChild(t)}constructOkButton(){this.okButton=new ft("OK","options_dialog_ok_button",this.okButtonCallback.bind(this))}constructCancelButton(){this.cancelButton=new ft("Cancel","options_dialog_cancel_button",this.cancelButtonCallback.bind(this))}pack(){if(this.packed)console.log("The options dialog is already packed.");else{if(null===this.dialog||void 0===this.dialog)throw new Error("Cannot pack the options dialog: the dialog is null or undefined.");if(!ct.exists(this.speedSelectorDiv))throw new Error("Cannot pack the options dialog: the speed selector div is null or undefined.");if(!ct.exists(this.autoplaySelectorDiv))throw new Error("Cannot pack the options dialog: the autoplay selector div is null or undefined.");if(!ct.exists(this.stateToLoadSelectorDiv))throw new Error("Cannot pack the options dialog: the state to load selector div is null or undefined.");if(!ct.exists(this.tooltipsSelectorDiv))throw new Error("Cannot pack the options dialog: the tooltips selector div is null or undefined.");if(!ct.exists(this.maxNumberOfCyclesSelectorDiv))throw new Error("Cannot pack the options dialog: the max number of cycles selector div is null or undefined.");if(!ct.exists(this.effortsSelectorDiv))throw new Error("Cannot pack the options dialog: the efforts selector div is null or undefined.");if(!ct.exists(this.teleoraSelectorDiv))throw new Error("Cannot pack the options dialog: the teleora selector div is null or undefined.");if(!ct.exists(this.okButton))throw new Error("Cannot pack the options dialog: the ok button is null or undefined.");if(!ct.exists(this.cancelButton))throw new Error("Cannot pack the options dialog: the cancel button is null or undefined.");this.dialog.appendChild(this.speedSelectorDiv),this.dialog.appendChild(this.autoplaySelectorDiv),this.dialog.appendChild(this.stateToLoadSelectorDiv),this.dialog.appendChild(this.tooltipsSelectorDiv),this.dialog.appendChild(this.maxNumberOfCyclesSelectorDiv),this.dialog.appendChild(this.effortsSelectorDiv),this.dialog.appendChild(this.teleoraSelectorDiv),this.dialog.appendChild(this.okButton.getButton()),this.dialog.appendChild(this.cancelButton.getButton()),this.packed=!0}}unpack(){this.dialog.close()}constructOptionsDialog(){this.constructSpeedSelectorDiv(),this.constructAutoplayCheckboxDiv(),this.constructStateToLoadSelectorDiv(),this.constructTooltipsCheckboxDiv(),this.constructMaxNumberOfCyclesSelectorDiv(),this.constructEffortsSelectorDiv(),this.constructTeleoraSelectorDiv(),this.constructOkButton(),this.constructCancelButton()}getDialog(){if(null===this.dialog||void 0===this.dialog)throw new Error("Cannot get the options dialog: the dialog is null or undefined.");return this.dialog}}class pt{div;optionsDialog;okButtonCallback;cancelButtonCallback;stateToLoadInputCallback;teleoraInputCallback;packed;constructor(t,e,i,o){this.div=document.createElement("div"),this.div.id="options_dialog_div",this.div.hidden=!0,this.okButtonCallback=t,this.cancelButtonCallback=e,this.stateToLoadInputCallback=i,this.teleoraInputCallback=o,this.optionsDialog=new wt(this.okButtonCallback,this.cancelButtonCallback,this.stateToLoadInputCallback,this.teleoraInputCallback),this.packed=!1}pack(){if(this.packed)console.log("The options dialog div is already packed.");else{if(null===this.div||void 0===this.div)throw new Error("Cannot pack: the div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot pack: the options dialog div is not hidden (it must be before packing it).");if(null===this.optionsDialog||void 0===this.optionsDialog)throw new Error("Cannot pack: the options dialog is null or undefined.");this.optionsDialog.pack(),this.div.appendChild(this.optionsDialog.getDialog()),this.packed=!0}}unpack(){if(this.packed){if(null===this.div||void 0===this.div)throw new Error("Cannot unpack: the div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot unpack: the options dialog div is not hidden (it must be before unpacking it).");if(null===this.optionsDialog||void 0===this.optionsDialog)throw new Error("Cannot unpack: the options dialog is null or undefined.");this.div.removeChild(this.optionsDialog.getDialog()),this.optionsDialog.unpack(),this.packed=!1}else console.log("The options dialog div is already unpacked.")}show(){if(null===this.div||void 0===this.div)throw new Error("Cannot show: the div is null or undefined.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the options dialog div is not packed.");if(!this.optionsDialog.getDialog().isConnected)throw new Error("Cannot show: the options dialog is not connected.");this.optionsDialog.getDialog().showModal(),this.div.hidden=!1}else console.log("The options dialog div is already shown.")}hide(){if(null===this.div||void 0===this.div)throw new Error("Cannot hide: the div is null or undefined.");if(this.div.hidden)console.log("The options dialog div is already hidden.");else{if(!this.packed)throw new Error("Cannot hide: the options dialog div is not packed.");this.div.hidden=!0}}getDiv(){if(null===this.div||void 0===this.div)throw new Error("Cannot get the options dialog div: the div is null or undefined.");return this.div}}class mt{div;packed;constructor(){this.div=document.createElement("div"),this.div.id="draggable_bodies_div",this.div.hidden=!0,this.packed=!1}pack(){}unpack(){}show(){}hide(){}getDiv(){if(null===this.div||void 0===this.div)throw new Error("Cannot get the draggable bodies div: it is null or undefined.");return this.div}}class Et{div;gridSize;gridMap;packed;constructor(){this.div=document.createElement("div"),this.div.id="grid_div",this.div.classList.add("grid","center-aligned"),this.div.hidden=!0,this.packed=!1}static validateGridSize(t){if(null==t||t<=0)throw new Error("Cannot create a grid with no size.");return t}static validateGrid(t){if(null==t)throw new Error("Cannot create a grid without cells.");if([...t.getKeys()].some((t=>null==t)))throw new Error("Cannot create a grid with null or undefined coordinates.");if([...t.getValues()].some((t=>null==t)))throw new Error("Cannot create a grid with null or undefined cells.");return t}createTableForGrid(){let t=document.createElement("table");t.classList.add("grid-table");for(let e=0;e<this.gridSize;e++){let i=document.createElement("tr");i.classList.add("grid-row");for(let t=0;t<this.gridSize;t++){let o=document.createElement("td");o.classList.add("grid-cell");const r=new p(BigInt(t),BigInt(e));o.appendChild(this.gridMap.get(r).getCell()),i.appendChild(o)}t.appendChild(i)}return t}updateGrid(t,e){this.gridSize=Et.validateGridSize(t),this.gridMap=Et.validateGrid(e)}pack(){if(null===this.gridSize||void 0===this.gridSize||this.gridSize<=0)throw new Error("Cannot pack a grid that has no size.");if(null===this.div||void 0===this.div)throw new Error("Cannot pack a grid that has no div.");if(null===this.gridMap||void 0===this.gridMap)throw new Error("Cannot pack a grid that has no cells.");if(!this.packed){this.gridMap.forEach((t=>t.pack()));let t=this.createTableForGrid();this.div.appendChild(t),this.packed=!0}}unpack(){if(this.packed){if(!ct.exists(this.div))throw new Error("Cannot unpack: the grid div is null or undefined.");if(!ct.exists(this.gridMap))throw new Error("Cannot unpack: the grid map is null or undefined.");if(0===this.div.childElementCount)throw new Error("Cannot unpack: the grid div has no children.");this.div.removeChild(this.div.firstChild),this.gridMap.forEach((t=>t.unpack())),this.gridMap=null,this.packed=!1}else console.log("The initial view div is already unpacked.")}show(){if(null===this.div||void 0===this.div)throw new Error("Cannot show a grid that has no div.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the grid div is not packed.");this.div.hidden=!1}else console.log("The grid div is already shown.")}hide(){if(null===this.div||void 0===this.div)throw new Error("Cannot hide: the grid div is null or undefined.");if(this.div.hidden)console.log("The grid div is already hidden.");else{if(!this.packed)throw new Error("Cannot hide: the grid div is not packed.");this.div.hidden=!0}}getDiv(){if(null===this.div||void 0===this.div)throw new Error("Cannot get the grid div: it is null or undefined.");return this.div}}class At{div;packed;constructor(){this.div=document.createElement("div"),this.div.id="simulation_controls_div",this.div.hidden=!0,this.packed=!1}pack(){}unpack(){}show(){}hide(){}getDiv(){if(null===this.div||void 0===this.div)throw new Error("Cannot get the simulation controls div: it is null or undefined.");return this.div}}class Tt{cell;locationAppearance;displayedImage;packed;constructor(t){this.locationAppearance=Tt.validateLocationAppearance(t),this.createLocationImage(),this.packed=!1,this.cell=document.createElement("div"),this.cell.classList.add("cell"),this.cell.id=`cell-${t.getCoord().getX()}-${t.getCoord().getY()}`}static validateLocationAppearance(t){if(null==t)throw new Error("Cannot create a cell without a location appearance.");return t}createLocationImage(){this.displayedImage=document.createElement("img"),this.displayedImage.src=this.getCellImageSrc(),this.displayedImage.classList.add("location-image")}getCellImageSrc(){if(null===this.locationAppearance||void 0===this.locationAppearance)throw new Error("Cannot get the image src for a cell for which no location appearance is available.");return this.locationAppearance.hasActor()?this.getCellImageSrcIfActorIsPresent():this.locationAppearance.hasDirt()?this.getCellImageSrcIfDirtIsPresent():"envs/vacuumworld-ts/res/images/locations/empty.png"}getCellImageSrcIfActorIsPresent(){const t=this.locationAppearance.getActorAppearance().orElseThrow().getOrientation(),e=this.locationAppearance.getActorAppearance().orElseThrow().getColour(),i=t.toString().toLowerCase();return`envs/vacuumworld-ts/res/images/locations/actor/${e.toString().toLowerCase()}_${i}.png`}getCellImageSrcIfDirtIsPresent(){return`envs/vacuumworld-ts/res/images/locations/dirt/${this.locationAppearance.getDirtAppearance().orElseThrow().getColour().toString().toLowerCase()}_dirt.png`}pack(){if(null===this.displayedImage||void 0===this.displayedImage)throw new Error("Cannot pack a cell that has no image");if(null===this.locationAppearance||void 0===this.locationAppearance)throw new Error("Cannot pack a cell for which no location appearance is available.");if(null===this.cell||void 0===this.cell)throw new Error("Cannot pack a non-existent cell.");this.packed||(this.cell.appendChild(this.displayedImage),this.packed=!0)}unpack(){this.packed&&(this.cell.removeChild(this.displayedImage),this.locationAppearance=null,this.displayedImage=null,this.packed=!1)}isPacked(){return this.packed}getCell(){return this.cell}}class bt{gridSize;config;gridDiv;environment;options;gridDivReplacementCallback;constructor(t,e,i,o){this.config=bt.validateConfig(i),this.gridSize=bt.validateGridSize(t,i),this.environment=bt.validateEnvironment(t),this.gridDiv=this.createGrid(),this.options=bt.validateOptions(e),this.gridDivReplacementCallback=o}getGridDiv(){return this.gridDiv}static validateConfig(t){if(null==t)throw new Error("Cannot create a simulation without a config.");return t}static validateGridSize(t,e){if(bt.validateEnvironment(t),bt.validateConfig(e),null===e.min_environment_dim||void 0===e.min_environment_dim||e.min_environment_dim<=0)throw new Error("Invalid config.");if(null===e.max_environment_dim||void 0===e.max_environment_dim||e.max_environment_dim<=0)throw new Error("Invalid config.");if(e.min_environment_dim>e.max_environment_dim)throw new Error("Invalid config.");if(t.getGridSize()<e.min_environment_dim||t.getGridSize()>e.max_environment_dim)throw new Error("Invalid environment.");return t.getGridSize()}static validateEnvironment(t){if(null==t)throw new Error("Cannot create a simulation without an environment.");return t}static validateOptions(t){if(null==t)throw new Error("Cannot create a simulation without options.");return t}createGrid(){let t=new E;this.environment.getAmbient().getGrid().forEach(((e,i)=>{t.put(i,new Tt(e.getAppearance()))}));let e=new Et;return e.updateGrid(this.gridSize,t),e}cycleSimulation(){console.log("Initial environment: "),console.log(console.log(JSON.stringify(this.environment.toJsonObject(),null,4))),this.mainLoop()}async mainLoop(){void 0===this.options.getMaxNumberOfCycles()?await this.loopForever():await this.loopNumberOfTimes()}async loopForever(){for(;;)await this.doOneCycle()}async loopNumberOfTimes(){for(let t=0;t<this.options.getMaxNumberOfCycles();t++)await this.doOneCycle()}async doOneCycle(){this.environment.cycle(),this.gridDiv.hide(),this.gridDiv.unpack(),this.gridDiv=this.createGrid(),this.gridDivReplacementCallback(),this.gridDiv.pack(),this.gridDiv.show(),await this.delay(1e3-1e3*this.options.getSpeed())}delay(t){return new Promise((e=>setTimeout(e,t)))}}class Dt{div;initialViewDiv;initialViewButtonsDiv;optionsDialogDiv;gridDiv;draggableBodiesDiv;simulationControlsDiv;options;packed;constructor(t){if(null==t)throw new Error("The path of the initial view image cannot be null or undefined.");this.div=document.createElement("div"),this.div.id="platform_div",this.div.classList.add("center-aligned"),this.div.hidden=!0,this.initialViewDiv=new ut(t),this.initialViewButtonsDiv=new gt(this.start.bind(this),this.showOptionsDialog.bind(this),this.guide),this.optionsDialogDiv=new pt(this.saveNewOptions.bind(this),this.discardNewOptions.bind(this),this.loadState.bind(this),this.loadTeleora.bind(this)),this.gridDiv=new Et,this.draggableBodiesDiv=new mt,this.simulationControlsDiv=new At,this.options=new dt,this.packed=!1}showOptionsDialog(){if(null===this.optionsDialogDiv||void 0===this.optionsDialogDiv)throw new Error("Cannot show the options dialog div: it is null or undefined.");this.optionsDialogDiv.pack(),this.optionsDialogDiv.show()}loadState(){const t=document.getElementById("state_to_load_upload_input").files[0],e=new FileReader;e.onload=t=>{this.options.setStateToLoad(JSON.parse(t.target.result))},e.readAsText(t)}loadTeleora(){const t=document.getElementById("teleora_upload_input").files[0],e=new FileReader;e.onload=t=>{this.options.setTeleora(t.target.result)},e.readAsText(t)}start(){try{console.log("Start simulation."),this.setActionEfforts();const t={initial_environment_dim:3,min_environment_dim:3,max_environment_dim:13};let e=lt.fromJsonObject(this.options.getStateToLoad(),t),i=new bt(e,this.options,t,(()=>{this.div.replaceChild(i.getGridDiv().getDiv(),this.gridDiv.getDiv()),this.gridDiv=i.getGridDiv()}));this.initialViewDiv.hide(),this.initialViewButtonsDiv.hide(),this.initialViewDiv.unpack(),this.initialViewButtonsDiv.unpack(),i.cycleSimulation()}catch(t){ht.displayError(t)}}setActionEfforts(){a.overrideDefaultEffort(this.options.getEfforts().get("VWIdleAction")),l.overrideDefaultEffort(this.options.getEfforts().get("VWMoveAction")),h.overrideDefaultEffort(this.options.getEfforts().get("VWTurnAction")),n.overrideDefaultEffort(this.options.getEfforts().get("VWCleanAction")),s.overrideDefaultEffort(this.options.getEfforts().get("VWDropDirtAction")),c.overrideDefaultEffort(this.options.getEfforts().get("VWSpeakAction")),o.overrideDefaultEffort(this.options.getEfforts().get("VWBroadcastAction"))}saveNewOptions(){if(null===this.optionsDialogDiv||void 0===this.optionsDialogDiv)throw new Error("Cannot hide the options dialog div: it is null or undefined.");this.saveOptions(),this.closeAndDestroyOptionsDialog(),this.printOptions("Options saved:")}saveOptions(){this.parseSimulationSpeed(),this.parseAutoplayFlag(),this.parseTooltipsFlag(),this.parseMaxNumberOfCycles(),this.parseEfforts()}parseSimulationSpeed(){const t=parseFloat(document.getElementById("speed_values").value);isNaN(t)?this.options.setSpeed(0):this.options.setSpeed(t)}parseAutoplayFlag(){document.getElementById("autoplay_checkbox").checked?this.options.activateAutoplay():this.options.deactivateAutoplay()}parseTooltipsFlag(){document.getElementById("tooltips_checkbox").checked?this.options.activateTooltips():this.options.deactivateTooltips()}parseMaxNumberOfCycles(){const t=document.getElementById("max_number_of_cycles_input").value;""===t||null==t?this.options.setMaxNumberOfCycles(void 0):this.options.setMaxNumberOfCycles(parseInt(t))}parseEfforts(){let t=new Map;for(const e of Dt.getActionNames()){const i=document.getElementById(e.toLowerCase()+"_effort_input").value;""===i||null==i?t.set(e,void 0):t.set(e,BigInt(parseInt(i)))}this.options.setEfforts(t)}static getActionNames(){return["VWIdleAction","VWMoveAction","VWTurnAction","VWCleanAction","VWDropDirtAction","VWSpeakAction","VWBroadcastAction"]}discardNewOptions(){if(null===this.optionsDialogDiv||void 0===this.optionsDialogDiv)throw new Error("Cannot hide the options dialog div: it is null or undefined.");this.closeAndDestroyOptionsDialog(),this.printOptions("Options discarded. The current options are:")}closeAndDestroyOptionsDialog(){this.optionsDialogDiv.hide(),this.optionsDialogDiv.unpack()}printOptions(t){console.log(t),console.log("Speed: "+this.options.getSpeed()),console.log("Autoplay active: "+this.options.isAutoplayActive()),console.log("Saved state to load: "+this.options.getStateToLoad()),console.log("Tooltips active: "+this.options.areTooltipsActive()),console.log("Max number of cycles: "+this.options.getMaxNumberOfCycles()),console.log("Efforts:"),Dt.getActionNames().forEach((t=>console.log("- "+t+": "+this.options.getEfforts().get(t)))),console.log("Teleora file to load: "+this.options.getTeleora())}guide(){window.open("https://github.com/dicelab-rhul/web-agent/")}pack(){if(this.packed)console.log("The platform view div is already packed.");else{if(!ct.exists(this.div))throw new Error("Cannot pack: the platform div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot pack: the platform view div is not hidden (it must be before packing it).");if(!ct.exists(this.initialViewDiv))throw new Error("Cannot pack: the initial view div is null or undefined.");if(!ct.exists(this.initialViewButtonsDiv))throw new Error("Cannot pack: the initial view buttons div is null or undefined.");if(!ct.exists(this.optionsDialogDiv))throw new Error("Cannot pack: the options dialog div is null or undefined.");if(!ct.exists(this.gridDiv))throw new Error("Cannot pack: the grid div is null or undefined.");if(!ct.exists(this.draggableBodiesDiv))throw new Error("Cannot pack: the draggable bodies div is null or undefined.");if(!ct.exists(this.simulationControlsDiv))throw new Error("Cannot pack: the simulation controls div is null or undefined.");this.initialViewDiv.pack(),this.initialViewButtonsDiv.pack(),this.optionsDialogDiv.pack(),this.div.appendChild(this.initialViewDiv.getDiv()),this.div.appendChild(this.initialViewButtonsDiv.getDiv()),this.div.appendChild(this.optionsDialogDiv.getDiv()),this.div.appendChild(this.gridDiv.getDiv()),this.div.appendChild(this.draggableBodiesDiv.getDiv()),this.div.appendChild(this.simulationControlsDiv.getDiv()),this.packed=!0}}unpack(){if(this.packed){if(!ct.exists(this.div))throw new Error("Cannot pack: the platform div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot unpack: the initial view div is not hidden (it must be before unpacking it).");if(!ct.exists(this.initialViewDiv))throw new Error("Cannot pack: the initial view div is null or undefined.");if(!ct.exists(this.initialViewButtonsDiv))throw new Error("Cannot pack: the initial view buttons div is null or undefined.");if(!ct.exists(this.optionsDialogDiv))throw new Error("Cannot pack: the options dialog div is null or undefined.");if(!ct.exists(this.gridDiv))throw new Error("Cannot pack: the grid div is null or undefined.");if(!ct.exists(this.draggableBodiesDiv))throw new Error("Cannot pack: the draggable bodies div is null or undefined.");if(!ct.exists(this.simulationControlsDiv))throw new Error("Cannot pack: the simulation controls div is null or undefined.");this.div.removeChild(this.initialViewDiv.getDiv()),this.div.removeChild(this.initialViewButtonsDiv.getDiv()),this.div.removeChild(this.optionsDialogDiv.getDiv()),this.div.removeChild(this.gridDiv.getDiv()),this.div.removeChild(this.draggableBodiesDiv.getDiv()),this.div.removeChild(this.simulationControlsDiv.getDiv()),this.packed=!1}else console.log("The initial view div is already unpacked.")}show(){if(null===this.div||void 0===this.div)throw new Error("Cannot show: the platform div is null or undefined.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the platform div is not packed.");this.initialViewDiv.show(),this.initialViewButtonsDiv.show(),this.div.hidden=!1}else console.log("The platform div is already shown.")}hide(){if(null===this.div||void 0===this.div)throw new Error("Cannot hide: the platform div is null or undefined.");if(this.div.hidden)console.log("The platform div is already hidden.");else{if(!this.packed)throw new Error("Cannot hide: the platform div is not packed.");this.initialViewDiv.hide(),this.initialViewButtonsDiv.hide(),this.optionsDialogDiv.hide(),this.gridDiv.hide(),this.draggableBodiesDiv.hide(),this.simulationControlsDiv.hide(),this.div.hidden=!0}}getDiv(){if(null===this.div||void 0===this.div)throw new Error("Cannot get the platform div: it is null or undefined.");return this.div}}(new class{run(){this.setTitle("VacuumWorld");let t=new Dt("/envs/vacuumworld-ts/res/images/start_menu.png");t.pack(),document.getElementById("container_div").appendChild(t.getDiv()),t.show()}setTitle(t){null!=t&&""!==t&&(document.title=t)}}).run()})()})();