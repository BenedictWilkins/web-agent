(()=>{"use strict";var e={429:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"version",{enumerable:!0,get:function(){return l.default}});var o=u(r(990)),n=u(r(237)),i=u(r(355)),s=u(r(764)),a=u(r(314)),l=u(r(464)),c=u(r(435)),h=u(r(8)),d=u(r(222));function u(e){return e&&e.__esModule?e:{default:e}}},163:(e,t)=>{function r(e){return 14+(e+64>>>9<<4)+1}function o(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function n(e,t,r,n,i,s){return o((a=o(o(t,e),o(n,s)))<<(l=i)|a>>>32-l,r);var a,l}function i(e,t,r,o,i,s,a){return n(t&r|~t&o,e,t,i,s,a)}function s(e,t,r,o,i,s,a){return n(t&o|r&~o,e,t,i,s,a)}function a(e,t,r,o,i,s,a){return n(t^r^o,e,t,i,s,a)}function l(e,t,r,o,i,s,a){return n(r^(t|~o),e,t,i,s,a)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){const t=[],r=32*e.length,o="0123456789abcdef";for(let n=0;n<r;n+=8){const r=e[n>>5]>>>n%32&255,i=parseInt(o.charAt(r>>>4&15)+o.charAt(15&r),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[r(t)-1]=t;let n=1732584193,c=-271733879,h=-1732584194,d=271733878;for(let t=0;t<e.length;t+=16){const r=n,u=c,f=h,g=d;n=i(n,c,h,d,e[t],7,-680876936),d=i(d,n,c,h,e[t+1],12,-389564586),h=i(h,d,n,c,e[t+2],17,606105819),c=i(c,h,d,n,e[t+3],22,-1044525330),n=i(n,c,h,d,e[t+4],7,-176418897),d=i(d,n,c,h,e[t+5],12,1200080426),h=i(h,d,n,c,e[t+6],17,-1473231341),c=i(c,h,d,n,e[t+7],22,-45705983),n=i(n,c,h,d,e[t+8],7,1770035416),d=i(d,n,c,h,e[t+9],12,-1958414417),h=i(h,d,n,c,e[t+10],17,-42063),c=i(c,h,d,n,e[t+11],22,-1990404162),n=i(n,c,h,d,e[t+12],7,1804603682),d=i(d,n,c,h,e[t+13],12,-40341101),h=i(h,d,n,c,e[t+14],17,-1502002290),c=i(c,h,d,n,e[t+15],22,1236535329),n=s(n,c,h,d,e[t+1],5,-165796510),d=s(d,n,c,h,e[t+6],9,-1069501632),h=s(h,d,n,c,e[t+11],14,643717713),c=s(c,h,d,n,e[t],20,-373897302),n=s(n,c,h,d,e[t+5],5,-701558691),d=s(d,n,c,h,e[t+10],9,38016083),h=s(h,d,n,c,e[t+15],14,-660478335),c=s(c,h,d,n,e[t+4],20,-405537848),n=s(n,c,h,d,e[t+9],5,568446438),d=s(d,n,c,h,e[t+14],9,-1019803690),h=s(h,d,n,c,e[t+3],14,-187363961),c=s(c,h,d,n,e[t+8],20,1163531501),n=s(n,c,h,d,e[t+13],5,-1444681467),d=s(d,n,c,h,e[t+2],9,-51403784),h=s(h,d,n,c,e[t+7],14,1735328473),c=s(c,h,d,n,e[t+12],20,-1926607734),n=a(n,c,h,d,e[t+5],4,-378558),d=a(d,n,c,h,e[t+8],11,-2022574463),h=a(h,d,n,c,e[t+11],16,1839030562),c=a(c,h,d,n,e[t+14],23,-35309556),n=a(n,c,h,d,e[t+1],4,-1530992060),d=a(d,n,c,h,e[t+4],11,1272893353),h=a(h,d,n,c,e[t+7],16,-155497632),c=a(c,h,d,n,e[t+10],23,-1094730640),n=a(n,c,h,d,e[t+13],4,681279174),d=a(d,n,c,h,e[t],11,-358537222),h=a(h,d,n,c,e[t+3],16,-722521979),c=a(c,h,d,n,e[t+6],23,76029189),n=a(n,c,h,d,e[t+9],4,-640364487),d=a(d,n,c,h,e[t+12],11,-421815835),h=a(h,d,n,c,e[t+15],16,530742520),c=a(c,h,d,n,e[t+2],23,-995338651),n=l(n,c,h,d,e[t],6,-198630844),d=l(d,n,c,h,e[t+7],10,1126891415),h=l(h,d,n,c,e[t+14],15,-1416354905),c=l(c,h,d,n,e[t+5],21,-57434055),n=l(n,c,h,d,e[t+12],6,1700485571),d=l(d,n,c,h,e[t+3],10,-1894986606),h=l(h,d,n,c,e[t+10],15,-1051523),c=l(c,h,d,n,e[t+1],21,-2054922799),n=l(n,c,h,d,e[t+8],6,1873313359),d=l(d,n,c,h,e[t+15],10,-30611744),h=l(h,d,n,c,e[t+6],15,-1560198380),c=l(c,h,d,n,e[t+13],21,1309151649),n=l(n,c,h,d,e[t+4],6,-145523070),d=l(d,n,c,h,e[t+11],10,-1120210379),h=l(h,d,n,c,e[t+2],15,718787259),c=l(c,h,d,n,e[t+9],21,-343485551),n=o(n,r),c=o(c,u),h=o(h,f),d=o(d,g)}return[n,c,h,d]}(function(e){if(0===e.length)return[];const t=8*e.length,o=new Uint32Array(r(t));for(let r=0;r<t;r+=8)o[r>>5]|=(255&e[r/8])<<r%32;return o}(e),8*e.length))}},790:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};t.default=r},314:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default="00000000-0000-0000-0000-000000000000"},222:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,n=(o=r(435))&&o.__esModule?o:{default:o};t.default=function(e){if(!(0,n.default)(e))throw TypeError("Invalid UUID");let t;const r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r}},58:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},319:(e,t)=>{let r;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(!r&&(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(o)};const o=new Uint8Array(16)},757:(e,t)=>{function r(e,t,r,o){switch(e){case 0:return t&r^~t&o;case 1:case 3:return t^r^o;case 2:return t&r^t&o^r&o}}function o(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){const t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const i=e.length/4+2,s=Math.ceil(i/16),a=new Array(s);for(let t=0;t<s;++t){const r=new Uint32Array(16);for(let o=0;o<16;++o)r[o]=e[64*t+4*o]<<24|e[64*t+4*o+1]<<16|e[64*t+4*o+2]<<8|e[64*t+4*o+3];a[t]=r}a[s-1][14]=8*(e.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<s;++e){const i=new Uint32Array(80);for(let t=0;t<16;++t)i[t]=a[e][t];for(let e=16;e<80;++e)i[e]=o(i[e-3]^i[e-8]^i[e-14]^i[e-16],1);let s=n[0],l=n[1],c=n[2],h=n[3],d=n[4];for(let e=0;e<80;++e){const n=Math.floor(e/20),a=o(s,5)+r(n,l,c,h)+d+t[n]+i[e]>>>0;d=h,h=c,c=o(l,30)>>>0,l=s,s=a}n[0]=n[0]+s>>>0,n[1]=n[1]+l>>>0,n[2]=n[2]+c>>>0,n[3]=n[3]+h>>>0,n[4]=n[4]+d>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]}},8:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.unsafeStringify=s;var o,n=(o=r(435))&&o.__esModule?o:{default:o};const i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));function s(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}t.default=function(e,t=0){const r=s(e,t);if(!(0,n.default)(r))throw TypeError("Stringified UUID is invalid");return r}},990:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,n=(o=r(319))&&o.__esModule?o:{default:o},i=r(8);let s,a,l=0,c=0;t.default=function(e,t,r){let o=t&&r||0;const h=t||new Array(16);let d=(e=e||{}).node||s,u=void 0!==e.clockseq?e.clockseq:a;if(null==d||null==u){const t=e.random||(e.rng||n.default)();null==d&&(d=s=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==u&&(u=a=16383&(t[6]<<8|t[7]))}let f=void 0!==e.msecs?e.msecs:Date.now(),g=void 0!==e.nsecs?e.nsecs:c+1;const w=f-l+(g-c)/1e4;if(w<0&&void 0===e.clockseq&&(u=u+1&16383),(w<0||f>l)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=f,c=g,a=u,f+=122192928e5;const m=(1e4*(268435455&f)+g)%4294967296;h[o++]=m>>>24&255,h[o++]=m>>>16&255,h[o++]=m>>>8&255,h[o++]=255&m;const p=f/4294967296*1e4&268435455;h[o++]=p>>>8&255,h[o++]=255&p,h[o++]=p>>>24&15|16,h[o++]=p>>>16&255,h[o++]=u>>>8|128,h[o++]=255&u;for(let e=0;e<6;++e)h[o+e]=d[e];return t||(0,i.unsafeStringify)(h)}},237:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(r(925)),n=i(r(163));function i(e){return e&&e.__esModule?e:{default:e}}var s=(0,o.default)("v3",48,n.default);t.default=s},925:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0,t.default=function(e,t,r){function o(e,o,s,a){var l;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof o&&(o=(0,i.default)(o)),16!==(null===(l=o)||void 0===l?void 0:l.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+e.length);if(c.set(o),c.set(e,o.length),c=r(c),c[6]=15&c[6]|t,c[8]=63&c[8]|128,s){a=a||0;for(let e=0;e<16;++e)s[a+e]=c[e];return s}return(0,n.unsafeStringify)(c)}try{o.name=e}catch(e){}return o.DNS=s,o.URL=a,o};var o,n=r(8),i=(o=r(222))&&o.__esModule?o:{default:o};const s="6ba7b810-9dad-11d1-80b4-00c04fd430c8";t.DNS=s;const a="6ba7b811-9dad-11d1-80b4-00c04fd430c8";t.URL=a},355:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(r(790)),n=s(r(319)),i=r(8);function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t,r){if(o.default.randomUUID&&!t&&!e)return o.default.randomUUID();const s=(e=e||{}).random||(e.rng||n.default)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=s[e];return t}return(0,i.unsafeStringify)(s)}},764:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(r(925)),n=i(r(757));function i(e){return e&&e.__esModule?e:{default:e}}var s=(0,o.default)("v5",80,n.default);t.default=s},435:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,n=(o=r(58))&&o.__esModule?o:{default:o};t.default=function(e){return"string"==typeof e&&n.default.test(e)}},464:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,n=(o=r(435))&&o.__esModule?o:{default:o};t.default=function(e){if(!(0,n.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,r),i.exports}(()=>{class e{actorID;constructor(t){this.actorID=e.validateActorID(t)}static validateActorID(e){if(null==e)throw new Error("The actor ID cannot be null or undefined.");return e}getActorID(){return this.actorID}}class t extends e{content;recipientsIDs;constructor(e,r,o){super(e),this.content=t.validateContent(r),this.recipientsIDs=null==o?[]:o}static validateContent(e){if(null==e)throw new Error("The content cannot be null or undefined.");return e}getContent(){return this.content}getRecipientsIDs(){return this.recipientsIDs}}class o extends t{static effort=1n;constructor(e,t){super(e,t)}getEffort(){return o.effort}static getEffort(){return o.effort}static overrideDefaultEffort(e){null==e?console.log("The new effort for VWBroadcastAction cannot be null or undefined. The default effort will be used instead."):(o.effort=e,console.log("The effort of VWBroadcastAction has been changed to "+e+"."))}}class n extends e{constructor(e){super(e)}}class i extends n{static effort=1n;constructor(e){super(e)}getEffort(){return i.effort}static overrideDefaultEffort(e){null==e?console.log("The new effort for VWCleanAction cannot be null or undefined. The default effort will be used instead."):(i.effort=e,console.log("The effort of VWCleanAction has been changed to "+e+"."))}}class s extends n{colour;static effort=1n;constructor(e,t){super(e),this.colour=s.validateColour(t)}getColour(){return this.colour}static validateColour(e){if(null==e)throw new Error("The dirt colour cannot be null or undefined.");return e}getEffort(){return s.effort}static overrideDefaultEffort(e){null==e?console.log("The new effort for VWDropDirtAction cannot be null or undefined. The default effort will be used instead."):(s.effort=e,console.log("The effort of VWDropDirtAction has been changed to "+e+"."))}}class a extends n{static effort=1n;constructor(e){super(e)}getEffort(){return a.effort}static overrideDefaultEffort(e){null==e?console.log("The new effort for VWIdleAction cannot be null or undefined. The default effort will be used instead."):(a.effort=e,console.log("The effort of VWIdleAction has been changed to "+e+"."))}}class l extends n{static effort=1n;constructor(e){super(e)}getEffort(){return l.effort}static overrideDefaultEffort(e){null==e?console.log("The new effort for VWMoveAction cannot be null or undefined. The default effort will be used instead."):(l.effort=e,console.log("The effort of VWMoveAction has been changed to "+e+"."))}}class c extends t{static effort=1n;constructor(e,t,r){super(e,t,r)}getEffort(){return 0===this.getRecipientsIDs().length?o.getEffort():c.effort}static overrideDefaultEffort(e){null==e?console.log("The new effort for VWSpeakAction cannot be null or undefined. The default effort will be used instead."):(c.effort=e,console.log("The effort of VWSpeakAction has been changed to "+e+"."))}}class h extends n{turningDirection;static effort=1n;constructor(e,t){super(e),this.turningDirection=h.validateTurningDirection(t)}static validateTurningDirection(e){if(null==e)throw new Error("The turning direction cannot be null or undefined.");return e}getTurningDirection(){return this.turningDirection}getEffort(){return h.effort}static overrideDefaultEffort(e){null==e?console.log("The new effort for VWTurnAction cannot be null or undefined. The default effort will be used instead."):(h.effort=e,console.log("The effort of VWTurnAction has been changed to "+e+"."))}}class d{value;constructor(e){this.value=e}static of(e){if(null==e)throw new Error("The value cannot be null or undefined.");return new d(e)}static ofNullable(e){return null==e?d.empty():new d(e)}static empty(){return new d(null)}isPresent(){return null!==this.value}isEmpty(){return null===this.value}get(){if(null===this.value||void 0===this.value)throw new Error("The value is null.");return this.value}orElse(e){return null===this.value||void 0===this.value?e:this.value}orElseGet(e){return null===this.value||void 0===this.value?e():this.value}orElseThrow(e){const t=null==e?new Error("The value is null or undefined."):e;if(null===this.value||void 0===this.value)throw t;return this.value}ifPresent(e){null!==this.value&&void 0!==this.value&&e(this.value)}ifPresentOrElse(e,t){null!==this.value&&void 0!==this.value?e(this.value):t()}filter(e){return null===this.value||void 0===this.value?d.empty():e(this.value)?this:d.empty()}map(e){return null===this.value||void 0===this.value?d.empty():d.of(e(this.value))}flatMap(e){return null===this.value||void 0===this.value?d.empty():e(this.value)}equals(e){return null!=e&&(this===e||e instanceof d&&(null===this.value?null===e.value:void 0===this.value?void 0===e.value:this.value===e.value))}}var u,f,g,w;!function(e){e.IMPOSSIBLE="IMPOSSIBLE",e.SUCCESS="SUCCESS",e.FAILURE="FAILURE"}(u||(u={}));class m{actionOutcome;action;constructor(e,t){this.actionOutcome=m.validateActionOutcome(e),this.action=m.validateAction(t)}static validateActionOutcome(e){if(null==e)throw new Error("The action outcome cannot be null or undefined.");return e}static validateAction(e){if(null==e)throw new Error("The action cannot be null or undefined.");return e}getActionOutcome(){return this.actionOutcome}getAction(){return this.action}}!function(e){e.NORTH="NORTH",e.EAST="EAST",e.SOUTH="SOUTH",e.WEST="WEST"}(f||(f={}));class p{x;y;constructor(e,t){this.x=p.validateX(e),this.y=p.validateY(t)}static validateX(e){if(null==e)throw new Error("The x coordinate cannot be null or undefined.");return e}static validateY(e){if(null==e)throw new Error("The y coordinate cannot be null or undefined.");return e}getX(){return this.x}getY(){return this.y}clone(){return new p(this.x,this.y)}getForwardCoord(e){if(null==e)throw new Error("The orientation cannot be null or undefined.");if(e===f.NORTH)return new p(this.x,this.y-1n);if(e===f.EAST)return new p(this.x+1n,this.y);if(e===f.SOUTH)return new p(this.x,this.y+1n);if(e===f.WEST)return new p(this.x-1n,this.y);throw new Error("The orientation is invalid.")}getLeftCoord(e){if(null==e)throw new Error("The orientation cannot be null or undefined.");if(e===f.NORTH)return new p(this.x-1n,this.y);if(e===f.EAST)return new p(this.x,this.y-1n);if(e===f.SOUTH)return new p(this.x+1n,this.y);if(e===f.WEST)return new p(this.x,this.y+1n);throw new Error("The orientation is invalid.")}getRightCoord(e){if(null==e)throw new Error("The orientation cannot be null or undefined.");if(e===f.NORTH)return new p(this.x+1n,this.y);if(e===f.EAST)return new p(this.x,this.y+1n);if(e===f.SOUTH)return new p(this.x-1n,this.y);if(e===f.WEST)return new p(this.x,this.y-1n);throw new Error("The orientation is invalid.")}getForwardLeftCoord(e){if(null==e)throw new Error("The orientation cannot be null or undefined.");if(e===f.NORTH)return new p(this.x-1n,this.y-1n);if(e===f.EAST)return new p(this.x+1n,this.y-1n);if(e===f.SOUTH)return new p(this.x+1n,this.y+1n);if(e===f.WEST)return new p(this.x-1n,this.y+1n);throw new Error("The orientation is invalid.")}getForwardRightCoord(e){if(null==e)throw new Error("The orientation cannot be null or undefined.");if(e===f.NORTH)return new p(this.x+1n,this.y-1n);if(e===f.EAST)return new p(this.x+1n,this.y+1n);if(e===f.SOUTH)return new p(this.x-1n,this.y+1n);if(e===f.WEST)return new p(this.x-1n,this.y-1n);throw new Error("The orientation is invalid.")}sum(e){return new p(this.x+e.x,this.y+e.y)}increment(e){return new p(this.x+e,this.y+e)}sub(e){return new p(this.x-e.x,this.y-e.y)}decrement(e){return new p(this.x-e,this.y-e)}toJsonObject(){return{x:this.x.toString(),y:this.y.toString()}}static fromJsonObject(e){if(null==e)throw new Error("The JSON representation cannot be null or undefined.");if(null===e.x||void 0===e.x)throw new Error("The x coordinate cannot be null or undefined.");if(null===e.y||void 0===e.y)throw new Error("The y coordinate cannot be null or undefined.");return new p(BigInt(e.x),BigInt(e.y))}toString(){return`(${this.x}, ${this.y})`}equals(e){return null!=e&&(this===e||e instanceof p&&this.x===e.x&&this.y===e.y)}static fromString(e){if(null==e)throw new Error("The coordinate string cannot be null or undefined.");if(e.length<5)throw new Error("The coordinate string is invalid.");{const t=e.substring(1,e.indexOf(",")),r=e.substring(e.indexOf(",")+2,e.length-1);return new p(BigInt(t),BigInt(r))}}}class v{key;value;constructor(e,t){this.key=e,this.value=t}getKey(){return this.key}getValue(){return this.value}setValue(e){this.value=e}}class A{entries;constructor(){this.entries=[]}put(e,t){let r=this.getEntry(e);null==r?this.entries.push(new v(e,t)):r.setValue(t)}get(e){const t=this.getEntry(e);return null==t?null:t.getValue()}remove(e){const t=this.getEntry(e);null!=t&&this.entries.splice(this.entries.indexOf(t),1)}containsKey(e){return null!==this.getEntry(e)&&void 0!==this.getEntry(e)}containsValue(e){for(let t of this.entries)if(t.getValue()===e)return!0;return!1}size(){return this.entries.length}isEmpty(){return 0===this.entries.length}clear(){this.entries=[]}getKeys(){return this.entries.map((e=>e.getKey()))}getValues(){return this.entries.map((e=>e.getValue()))}getEntry(e){return this.entries.find((t=>t.getKey().equals(e)))}toString(){let e="";for(let t of this.entries)e+=t.getKey()+" : "+t.getValue()+"\n";return e}equals(e){if(this.size()!==e.size())return!1;for(let t of this.entries)if(!e.containsKey(t.getKey())||e.get(t.getKey())!==t.getValue())return!1;return!0}clone(){const e=new A;for(let t of this.entries)e.put(t.getKey(),t.getValue());return e}static fromMap(e){const t=new A;for(let[r,o]of e)t.put(r,o);return t}toMap(){const e=new Map;for(let t of this.entries)e.set(t.getKey(),t.getValue());return e}static fromObject(e){const t=new A;for(let r in e)t.put(r,e[r]);return t}[Symbol.iterator](){let e=0,t=this.entries;return{next:()=>{if(e<t.length){const r=t[e];return e++,{value:[r.getKey(),r.getValue()],done:!1}}return{value:void 0,done:!0}}}}forEach(e){for(let t of this.entries)e(t.getValue(),t.getKey(),this)}}class E{}class T extends E{content;senderID;recipientID;constructor(e,t,r){super(),this.content=T.validateContent(e),this.senderID=T.validateSenderID(t),this.recipientID=T.validateRecipientID(r)}static validateContent(e){if(null==e)throw new Error("The content cannot be null or undefined.");return e}static validateSenderID(e){if(null==e)throw new Error("The sender ID cannot be null or undefined.");return e}static validateRecipientID(e){if(null==e)throw new Error("The recipient ID cannot be null or undefined.");return e}getContent(){return this.content}getSenderID(){return this.senderID}getRecipientID(){return this.recipientID}}class y{constructor(){}static getLeft(e){switch(e){case f.NORTH:return f.WEST;case f.SOUTH:return f.EAST;case f.EAST:return f.NORTH;case f.WEST:return f.SOUTH;default:throw new Error("Invalid orientation.")}}static getRight(e){switch(e){case f.NORTH:return f.EAST;case f.SOUTH:return f.WEST;case f.EAST:return f.SOUTH;case f.WEST:return f.NORTH;default:throw new Error("Invalid orientation.")}}static getOpposite(e){switch(e){case f.NORTH:return f.SOUTH;case f.SOUTH:return f.NORTH;case f.EAST:return f.WEST;case f.WEST:return f.EAST;default:throw new Error("Invalid orientation.")}}}!function(e){e.CENTER="CENTER",e.FORWARD="FORWARD",e.LEFT="LEFT",e.RIGHT="RIGHT",e.FORWARDLEFT="FORWARDLEFT",e.FORWARDRIGHT="FORWARDRIGHT"}(g||(g={}));class b extends E{locations;actionResults;constructor(e,t){super(),this.locations=new Map,this.actionResults=b.validateActionResults(t);for(const t of e.keys()){if(null==t)throw new Error("The position cannot be null or undefined.");if(null===e.get(t)||void 0===e.get(t))throw new Error("The location appearance cannot be null or undefined.");this.locations.set(t,e.get(t))}}static validateActionResults(e){if(null==e)throw new Error("The action results cannot be null or undefined.");if(e.some((e=>null==e)))throw new Error("The action results array cannot contain null or undefined elements.");if(0===e.length)throw new Error("The action results array cannot be empty.");return e}getLocations(){return this.locations}getLocationAt(e){return this.locations.has(e)&&null!==this.locations.get(e)&&void 0!==this.locations.get(e)?d.of(this.locations.get(e)):d.empty()}getCenter(){return this.getLocationAt(g.CENTER)}getLeft(){return this.getLocationAt(g.LEFT)}getRight(){return this.getLocationAt(g.RIGHT)}getForward(){return this.getLocationAt(g.FORWARD)}getForwardLeft(){return this.getLocationAt(g.FORWARDLEFT)}getForwardRight(){return this.getLocationAt(g.FORWARDRIGHT)}getOwnID(){return this.getCenter().orElseThrow().getActorAppearance().orElseThrow().getID()}getOwnColour(){return this.getCenter().orElseThrow().getActorAppearance().orElseThrow().getColour()}getOwnOrientation(){return this.getCenter().orElseThrow().getActorAppearance().orElseThrow().getOrientation()}getOwnCoordinates(){return this.getCenter().orElseThrow().getCoord()}getActionResults(){return this.actionResults}isWallImmediatelyAhead(){return this.getCenter().orElseThrow().hasWallOn(this.getOwnOrientation())}isWallOneStepAhead(){return!this.isWallImmediatelyAhead()&&this.getForward().orElseThrow().hasWallOn(this.getOwnOrientation())}isWallVisibleSomewhereAhead(){return this.isWallImmediatelyAhead()||this.isWallOneStepAhead()}isWallImmediatelyToTheLeft(){return this.getCenter().orElseThrow().hasWallOn(y.getLeft(this.getOwnOrientation()))}isWallOneStepToTheLeft(){return!this.isWallImmediatelyToTheLeft()&&this.getLeft().orElseThrow().hasWallOn(y.getLeft(this.getOwnOrientation()))}isWallVisibleSomewhereToTheLeft(){return this.isWallImmediatelyToTheLeft()||this.isWallOneStepToTheLeft()}isWallImmediatelyToTheRight(){return this.getCenter().orElseThrow().hasWallOn(y.getRight(this.getOwnOrientation()))}isWallOneStepToTheRight(){return!this.isWallImmediatelyToTheRight()&&this.getRight().orElseThrow().hasWallOn(y.getRight(this.getOwnOrientation()))}isWallVisibleSomewhereToTheRight(){return this.isWallImmediatelyToTheRight()||this.isWallOneStepToTheRight()}}class I{static validateActions(e){if(null==e)throw new Error("The actions array cannot be null or undefined.");if(e.some((e=>null==e)))throw new Error("The actions array cannot contain null or undefined actions.");if(0===e.length)throw new Error("At least one action per cycle must by attempted by each actor.");if(e.length>2)throw new Error("At most two actions per cycle can be attempted by each actor.");if(2===e.length&&e[0]instanceof n&&e[1]instanceof n)throw new Error("At most one physical action per cycle can be attempted by each actor.");if(2===e.length&&e[0]instanceof t&&e[1]instanceof t)throw new Error("At most one communicative action per cycle can be attempted by each actor.")}}class C{grid;constructor(e){this.grid=C.validateGrid(e)}static validateGrid(e){if(null==e)throw new Error("The grid cannot be null or undefined.");return e}getGridSize(){return Math.sqrt(this.grid.size())}getGrid(){return this.grid}getLocation(e){return d.ofNullable(this.grid.get(e))}getActors(){const e=[];for(const[t,r]of this.grid){const t=r.getActor();t.isPresent()&&e.push(t.orElseThrow())}return e}getActorsIDs(){const e=[];for(let[t,r]of this.grid){const t=r.getActor();t.isPresent()&&e.push(t.orElseThrow().getID())}return e}getActorsIDsExcept(e){const t=[];for(let[r,o]of this.grid){const r=o.getActor();r.isPresent()&&r.orElseThrow().getID()!==e&&t.push(r.orElseThrow().getID())}return t}getActorByID(e){for(let[t,r]of this.grid){const t=r.getActor();if(t.isPresent()&&t.orElseThrow().getID()===e)return t}return d.empty()}getActorByCoord(e){return this.getLocation(e).flatMap((e=>e.getActor()))}getActorCoordByID(e){for(let[t,r]of this.grid){const o=r.getActor();if(o.isPresent()&&o.orElseThrow().getID()===e)return d.of(t)}return d.empty()}addActorToLocation(e,t){if(null==e)throw new Error("The coordinates of the location cannot be null or undefined.");if(null==t)throw new Error("The actor cannot be null or undefined.");if(this.getActorByCoord(e).isPresent())throw new Error("There is already an actor at the location.");this.getLocation(e).ifPresent((e=>e.addActor(t)))}popActorByCoord(e){return this.getLocation(e).flatMap((e=>e.popActor()))}moveActor(e,t){if(null==e)throw new Error("The coordinates of the origin location cannot be null or undefined.");if(null==t)throw new Error("The coordinates of the destination location cannot be null or undefined.");if(e.equals(t))throw new Error("The destination location cannot be the same as the origin location.");if(!this.getActorByCoord(e).isPresent())throw new Error("There is no actor at the origin location.");if(this.getActorByCoord(t).isPresent())throw new Error("There is already an actor at the destination location.");{const r=this.popActorByCoord(e).orElseThrow();this.getLocation(t).orElseThrow().addActor(r)}}turnActor(e,t){if(null==e)throw new Error("The coordinates of the actor location cannot be null or undefined.");if(!this.getActorByCoord(e).isPresent())throw new Error("There is no actor at the origin location.");this.getActorByCoord(e).orElseThrow().turn(t)}getDirtsIDs(){const e=[];for(let[t,r]of this.grid){const t=r.getDirt();t.isPresent()&&e.push(t.orElseThrow().getID())}return e}getDirtByID(e){for(let[t,r]of this.grid){const t=r.getDirt();if(t.isPresent()&&t.orElseThrow().getID()===e)return t}return d.empty()}getDirtByCoord(e){return this.getLocation(e).flatMap((e=>e.getDirt()))}getDirtCoordByID(e){for(let[t,r]of this.grid){const o=r.getDirt();if(o.isPresent()&&o.orElseThrow().getID()===e)return d.of(t)}return d.empty()}cleanDirtByCoord(e){if(null==e)throw new Error("The coordinates of the dirt location cannot be null or undefined.");if(!this.getDirtByCoord(e).isPresent())throw new Error("There is no dirt at the location.");this.getLocation(e).orElseThrow().removeDirt()}addDirtToLocation(e,t){if(null==e)throw new Error("The coordinates of the location cannot be null or undefined.");if(null==t)throw new Error("The dirt cannot be null or undefined.");if(this.getDirtByCoord(e).isPresent())throw new Error("There is already a dirt at the location.");this.getLocation(e).ifPresent((e=>e.addDirt(t)))}}!function(e){e.GREEN="GREEN",e.ORANGE="ORANGE",e.WHITE="WHITE",e.USER="USER"}(w||(w={}));const D=r(429);class O{id;constructor(){this.id=D.v4()}getID(){return this.id}equals(e){return null!=e&&(this===e||e instanceof O&&this.id===e.id)}}class _{dirtID;colour;constructor(e,t){this.dirtID=_.validateDirtID(e),this.colour=_.validateColour(t)}static validateDirtID(e){if(null==e)throw new Error("The dirt ID cannot be null or undefined.");return e}static validateColour(e){if(null==e)throw new Error("The dirt colour cannot be null or undefined.");return e}getID(){return this.dirtID}getColour(){return this.colour}equals(e){return null!=e&&(this===e||e instanceof _&&this.dirtID===e.dirtID&&this.colour===e.colour)}}class S extends O{colour;constructor(e){super(),this.colour=S.validateColour(e)}static validateColour(e){if(null==e)throw new Error("The dirt colour cannot be null or undefined.");return e}getColour(){return this.colour}equals(e){return null!=e&&(this===e||e instanceof S&&super.equals(e)&&this.colour===e.colour)}getAppearance(){return new _(this.getID(),this.colour)}toJsonObject(){return{colour:this.getColour()}}static fromJsonObject(e){if(null==e)throw new Error("The dirt JSON object cannot be null or undefined.");if(null===e.colour||void 0===e.colour)throw new Error("The colour of a `VWDirt` cannot be null or undefined.");const t=e.colour;return new S(t)}}var L,W;!function(e){e.LEFT="left",e.RIGHT="right"}(L||(L={}));class R{actorID;colour;orientation;constructor(e,t,r){this.actorID=R.validateActorID(e),this.colour=R.validateColour(t),this.orientation=R.validateOrientation(r)}static validateActorID(e){if(null==e)throw new Error("The actor ID cannot be null or undefined.");return e}static validateColour(e){if(null==e)throw new Error("The actor colour cannot be null or undefined.");return e}static validateOrientation(e){if(null==e)throw new Error("The actor orientation cannot be null or undefined.");return e}getID(){return this.actorID}getColour(){return this.colour}getOrientation(){return this.orientation}}class B extends O{colour;orientation;mind;observationSensor;listeningSensor;physicalActuator;CommunicativeActuator;constructor(e,t,r,o,n,i,s){super(),this.colour=B.validateColour(e),this.orientation=B.validateOrientation(t),this.mind=B.validateMind(r),this.observationSensor=null==o?d.empty():d.of(o),this.listeningSensor=null==n?d.empty():d.of(n),this.physicalActuator=null==i?d.empty():d.of(i),this.CommunicativeActuator=null==s?d.empty():d.of(s)}static validateColour(e){if(null==e)throw new Error("The colour cannot be null or undefined.");return e}static validateOrientation(e){if(null==e)throw new Error("The orientation cannot be null or undefined.");return e}static validateMind(e){if(null==e)throw new Error("The mind cannot be null or undefined.");return e}getColour(){return this.colour}getOrientation(){return this.orientation}getMind(){return this.mind}getObservationSensor(){return this.observationSensor}getListeningSensor(){return this.listeningSensor}getPhysicalActuator(){return this.physicalActuator}getCommunicativeActuator(){return this.CommunicativeActuator}getAppearance(){return new R(this.getID(),this.getColour(),this.getOrientation())}turn(e){if(null==e)throw new Error("The turning direction cannot be null or undefined.");if(e===L.LEFT)this.orientation=y.getLeft(this.orientation);else{if(e!==L.RIGHT)throw new Error("The turning direction is invalid.");this.orientation=y.getRight(this.orientation)}}cycle(){const e=this.getObservationSensor().orElseThrow().sourceAll().orElseThrow(),t=B.mergeObservations(e),r=this.sourceMessages();this.getMind().perceive(t,r),this.getMind().revise(),this.getMind().decide();const o=this.getMind().execute();I.validateActions(o),this.executeActions(o)}sourceMessages(){const e=[];return this.getListeningSensor().ifPresent((t=>t.sourceAll().ifPresent((t=>e.push(...t))))),e}static mergeObservations(e){if(null==e)throw new Error("The observations array cannot be null or undefined.");if(e.some((e=>null==e)))throw new Error("The observations array cannot contain null or undefined observations.");if(0===e.length)throw new Error("At least one observation must be present.");if(1===e.length)return e[0];if(2===e.length){const t=e[0].getActionResults().concat(e[1].getActionResults());return new b(e[1].getLocations(),t)}throw new Error("At most two observations can be present.")}executeActions(e){for(const r of e)if(r instanceof n)this.getPhysicalActuator().orElseThrow().sink(r);else{if(!(r instanceof t))throw new Error("The action is not supported.");this.getCommunicativeActuator().orElseThrow().sink(r)}}toJsonObject(e){if(null==e)throw new Error("The actor mind core path cannot be null or undefined.");return{colour:this.getColour(),orientation:this.getOrientation(),mind:e}}}class x extends B{constructor(e,t,r,o,n,i,s){super(x.validateColourForCleaningAgent(e),t,r,o,n,i,s)}static validateColourForCleaningAgent(e){if(null==e)throw new Error("The colour cannot be null or undefined.");if(e===w.USER)throw new Error("The colour of a cleaning agent cannot be USER.");return e}}class k extends B{constructor(e,t,r,o){super(w.USER,e,t,r,void 0,o)}}class P{queue;constructor(){this.queue=[]}enqueue(e){if(null==e)throw new Error("The perception cannot be null or undefined.");this.queue.push(e)}dequeue(){const e=this.queue.shift();if(null==e)throw new Error("No perceptions to dequeue.");return e}peek(){const e=this.queue[0];if(null==e)throw new Error("No perceptions to peek.");return e}isEmpty(){return 0===this.queue.length}}class M{actions;constructor(){this.actions=new P}sink(e){if(null==e)throw new Error("The action cannot be null or undefined.");this.actions.enqueue(e)}sinkAll(e){if(null==e)throw new Error("The actions cannot be null or undefined.");e.forEach((e=>this.sink(e)))}source(){if(this.actions.isEmpty())throw new Error("No actions to source.");return this.actions.dequeue()}sourceAll(){if(this.actions.isEmpty())throw new Error("No actions to source.");{const e=[];for(;!this.actions.isEmpty();)e.push(this.actions.dequeue());return e}}hasPendingActions(){return!this.actions.isEmpty()}}class U extends M{}class N extends U{sink(e){if(null==e)throw new Error("The action cannot be null or undefined.");if(e instanceof s)throw new Error("A cleaning agent cannot drop dirt.");super.sink(e)}}class F extends M{}class V{perceptions;constructor(){this.perceptions=new P}sink(e){if(null==e)throw new Error("The perception cannot be null or undefined.");this.perceptions.enqueue(e)}sinkAll(e){if(null==e)throw new Error("The perceptions cannot be null or undefined.");e.forEach((e=>this.sink(e)))}source(){return this.perceptions.isEmpty()?d.empty():d.of(this.perceptions.dequeue())}sourceAll(){if(this.perceptions.isEmpty())return d.empty();{let e=[];for(;!this.perceptions.isEmpty();)e.push(this.perceptions.dequeue());return d.of(e)}}}class H extends V{}class G extends V{}class j extends U{sink(e){if(null==e)throw new Error("The action cannot be null or undefined.");if(e instanceof i)throw new Error("A user cannot clean dirt.");super.sink(e)}}class J{core;nextActions;constructor(e){this.core=J.validateCore(e),this.nextActions=[]}static validateCore(e){if(null==e)throw new Error("The mind core cannot be null or undefined.");return e}perceive(e,t){this.core.perceive(e,t)}revise(){this.core.revise()}decide(){this.nextActions=this.core.decide()}execute(){return this.nextActions}getMindCore(){return this.core}}class z extends J{constructor(e){super(e)}}!function(e){e[e.BASIC=0]="BASIC",e[e.ADVANCED=1]="ADVANCED"}(W||(W={}));class q{observation;messages;cumulativeEffort=0n;mindCoreFilePath;reviseMethod;decideMethod;getLatestObservation(){return this.observation}getLatestMessages(){return this.messages}getMindCoreFilePath(){return this.mindCoreFilePath}setMindCoreFilePath(e){this.mindCoreFilePath=e}getOwnID(){return this.observation.getOwnID()}getOwnColour(){return this.observation.getOwnColour()}getOwnOrientation(){return this.observation.getOwnOrientation()}getOwnCoordinates(){return this.observation.getOwnCoordinates()}perceive(e,t){this.observation=q.validateObservation(e),this.messages=q.validateMessages(t)}static validateObservation(e){if(null==e)throw new Error("The observation cannot be null or undefined.");return e}static validateMessages(e){if(null==e)throw new Error("The messages cannot be null or undefined.");return e}revise(){if(null===this.reviseMethod||void 0===this.reviseMethod)throw new Error("The revise method cannot be null or undefined.");this.reviseMethod()}decide(){if(null===this.decideMethod||void 0===this.decideMethod)throw new Error("The decide method cannot be null or undefined.");return this.decideMethod()}getCumulativeEffort(){return this.cumulativeEffort}incrementEffort(e){if(null==e)throw new Error("The effort cannot be null or undefined.");this.cumulativeEffort+=e}static loadFromFile(e){throw new Error("Not yet implemented.")}construct(e,t,r){this.mindCoreFilePath=e,this.reviseMethod=t,this.decideMethod=r}}class K extends q{difficultyLevel;constructor(e){super(),this.difficultyLevel=null==e?W.BASIC:e,this.setMindCoreFilePath("/index.js")}getDifficultyLevel(){return this.difficultyLevel}switchDifficultyLevel(){this.difficultyLevel===W.BASIC?this.difficultyLevel=W.ADVANCED:this.difficultyLevel=W.BASIC}revise(){}decide(){if(this.difficultyLevel===W.BASIC)return this.decideBasic();if(this.difficultyLevel===W.ADVANCED)return this.decideAdvanced();throw new Error("Unknown difficulty level.")}decideBasic(){return this.getLatestObservation().isWallImmediatelyAhead()?this.decideIfWallAheadAndBasic():this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.decideIfOnDirtAndBasic():this.actRandomly(.2,.2,.45,.075,.075)}decideIfWallAheadAndBasic(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?[new h(this.getOwnID(),L.RIGHT)]:this.getLatestObservation().isWallImmediatelyToTheRight()?[new h(this.getOwnID(),L.LEFT)]:this.turnRandomly()}decideIfOnDirtAndBasic(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?this.moveOrTurnRandomly(.6,0,.4):this.getLatestObservation().isWallImmediatelyToTheRight()?this.moveOrTurnRandomly(.6,.4,0):this.moveOrTurnRandomly(.5,.25,.25)}decideAdvanced(){return this.getLatestObservation().isWallImmediatelyAhead()?this.decideIfWallAheadAndAdvanced():this.isActorImmediatelyAhead()?this.decideIfActorAheadAndAdvanced():this.isActorImmediatelyToTheLeft()&&this.isActorImmediatelyToTheRight()?this.dropOrMoveRandomly(.1,.1,.8):this.isActorImmediatelyToTheLeft()&&!this.getLatestObservation().isWallImmediatelyToTheRight()?this.moveOrTurnRandomly(.5,0,.5):this.isActorImmediatelyToTheRight()&&!this.getLatestObservation().isWallImmediatelyToTheLeft()?this.moveOrTurnRandomly(.5,.5,0):this.getLatestObservation().isWallImmediatelyToTheLeft()?this.decideIfWallToTheLeftAndAdvanced():this.getLatestObservation().isWallImmediatelyToTheRight()?this.decideIfWallToTheRightAndAdvanced():this.actRandomly(.15,.15,.6,.05,.05)}decideIfWallAheadAndAdvanced(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?[new h(this.getOwnID(),L.RIGHT)]:this.getLatestObservation().isWallImmediatelyToTheRight()?[new h(this.getOwnID(),L.LEFT)]:this.isActorImmediatelyToTheLeft()&&this.isActorImmediatelyToTheRight()?this.turnRandomly():this.isActorImmediatelyToTheLeft()?[new h(this.getOwnID(),L.RIGHT)]:this.isActorImmediatelyToTheRight()?[new h(this.getOwnID(),L.LEFT)]:this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.turnRandomly():this.actRandomly(.075,.075,.6,0,.25)}decideIfWallToTheLeftAndAdvanced(){return this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.moveOrTurnRandomly(.9,0,.1):this.actRandomly(.075,.075,.6,0,.25)}decideIfWallToTheRightAndAdvanced(){return this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.moveOrTurnRandomly(.9,.1,0):this.actRandomly(.075,.075,.6,.25,0)}decideIfActorAheadAndAdvanced(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?[new h(this.getOwnID(),L.RIGHT)]:this.getLatestObservation().isWallImmediatelyToTheRight()?[new h(this.getOwnID(),L.LEFT)]:this.isActorImmediatelyToTheLeft()&&this.isActorImmediatelyToTheRight()?this.dropRandomDirt():this.isActorImmediatelyToTheLeft()?[new h(this.getOwnID(),L.RIGHT)]:this.isActorImmediatelyToTheRight()?[new h(this.getOwnID(),L.LEFT)]:this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.turnRandomly():this.actRandomly(.25,.25,0,.25,.25)}isActorImmediatelyAhead(){return!this.getLatestObservation().isWallImmediatelyAhead()&&this.getLatestObservation().getCenter().orElseThrow().hasActor()}isActorImmediatelyToTheLeft(){return!this.getLatestObservation().isWallImmediatelyToTheLeft()&&this.getLatestObservation().getLeft().orElseThrow().hasActor()}isActorImmediatelyToTheRight(){return!this.getLatestObservation().isWallImmediatelyToTheRight()&&this.getLatestObservation().getRight().orElseThrow().hasActor()}actRandomly(e,t,r,o,n){K.validateWeights([e,t,r,o,n]);const i=Math.random(),a=(c=0,e=>c+=e);var c;const d=[e,t,r,o,n].map(a);if(i<d[0])return[new s(this.getOwnID(),w.GREEN)];if(i<d[1])return[new s(this.getOwnID(),w.ORANGE)];if(i<d[2])return[new l(this.getOwnID())];if(i<d[3])return[new h(this.getOwnID(),L.LEFT)];if(i<d[4])return[new h(this.getOwnID(),L.RIGHT)];throw new Error("This should never happen.")}static validateWeights(e){if(null==e)throw new Error("Weights cannot be null or undefined.");if(e.some((e=>null==e)))throw new Error("Weights cannot contain null or undefined values.");if(e.some((e=>e<0)))throw new Error("Weights cannot be negative.");if(e.some((e=>e>1)))throw new Error("Weights cannot be greater than 1.0.");K.validateWeightsSum(e.reduce(((e,t)=>e+t),0))}static validateWeightsSum(e){if(e<1)throw new Error("Weights cannot sum to less than 1.0.");if(e>1)throw new Error("Weights cannot sum to more than 1.0.")}turnRandomly(){return this.actRandomly(0,0,0,.5,.5)}moveOrTurnRandomly(e,t,r){return this.actRandomly(0,0,e,t,r)}dropOrMoveRandomly(e,t,r){return this.actRandomly(e,t,r,0,0)}dropRandomDirt(){return this.actRandomly(.5,.5,0,0,0)}}class $ extends J{constructor(){super(new K)}}class X extends q{constructor(){super(),this.construct("/index.js",this.revise,this.decide)}revise(){}decide(){return[new a(this.getOwnID())]}}class Y{constructor(){}static createVWActorFromJSONObject(e){if(null==e)throw new Error("The JSON representation of a `VWActor` cannot be null or undefined.");if(null===e.colour||void 0===e.colour)throw new Error("The colour of a `VWActor` cannot be null or undefined.");if(e.colour===w.USER)return this.createVWUserFromJSONObject(e);if(Object.values(w).includes(e.colour))return this.createVWCleaningAgentFromJSONObject(e);throw new Error(`The colour of a \`VWActor\` cannot be "${e.colour}".`)}static createVWCleaningAgentFromJSONObject(e){if(null==e)throw new Error("The JSON representation of a `VWCleaningAgent` cannot be null or undefined.");if(null===e.colour||void 0===e.colour)throw new Error("The colour of a `VWCleaningAgent` cannot be null or undefined.");if(e.colour===w.USER)throw new Error(`The colour of a \`VWCleaningAgent\` cannot be "${w.USER}".`);if(Object.values(w).includes(e.colour)){if(null===e.orientation||void 0===e.orientation)throw new Error("The orientation of a `VWCleaningAgent` cannot be null or undefined.");if(Object.values(f).includes(e.orientation)){if(null===e.mind||void 0===e.mind)throw new Error("The path of the mind of a `VWCleaningAgent` cannot be null or undefined.");{const t=w[e.colour],r=f[e.orientation],o="hysteretic"==e.mind?new X:q.loadFromFile(e.mind),n=new z(o),i=new G,s=new H,a=new N,l=new F;return new x(t,r,n,i,s,a,l)}}throw new Error(`The orientation of a \`VWCleaningAgent\` cannot be "${e.orientation}".`)}throw new Error(`The colour of a \`VWCleaningAgent\` cannot be "${e.colour}".`)}static createVWUserFromJSONObject(e){if(null==e)throw new Error("The JSON representation of a `VWUser` cannot be null or undefined.");if(null===e.colour||void 0===e.colour)throw new Error("The colour of a `VWUser` cannot be null or undefined.");if(e.colour!==w.USER)throw new Error(`The colour of a \`VWUser\` must be "${w.USER}".`);if(null===e.orientation||void 0===e.orientation)throw new Error("The orientation of a `VWUser` cannot be null or undefined.");if(Object.values(f).includes(e.orientation)){const t=f[e.orientation],r=new $,o=new G,n=new j;return new k(t,r,o,n)}throw new Error(`The orientation of a \`VWUser\` cannot be "${e.orientation}".`)}}class Q{coord;actorAppearance;dirtAppearance;wall;constructor(e,t,r,o){this.coord=Q.validateCoord(e),this.wall=Q.validateWall(t),this.actorAppearance=d.ofNullable(r),this.dirtAppearance=d.ofNullable(o)}static validateCoord(e){if(null==e)throw new Error("The coordinates cannot be null or undefined.");return e}static validateWall(e){if(null==e)throw new Error("The wall cannot be null or undefined.");if(4!==e.size)throw new Error("The wall must have 4 sides.");if(e.has(f.NORTH)&&e.has(f.EAST)&&e.has(f.SOUTH)&&e.has(f.WEST))return e;throw new Error("The wall must have 4 sides.")}getID(){return this.coord.toString()}getCoord(){return this.coord}hasActor(){return this.actorAppearance.isPresent()}hasCleaningAgent(){return this.actorAppearance.isPresent()&&this.actorAppearance.orElseThrow().getColour()!==w.USER}hasUser(){return this.actorAppearance.isPresent()&&this.actorAppearance.orElseThrow().getColour()===w.USER}getActorAppearance(){return this.actorAppearance}hasDirt(){return this.dirtAppearance.isPresent()}getDirtAppearance(){return this.dirtAppearance}getWall(){return this.wall}hasWallOn(e){return this.wall.get(e)}hasWallOnNorth(){return this.hasWallOn(f.NORTH)}hasWallOnEast(){return this.hasWallOn(f.EAST)}hasWallOnSouth(){return this.hasWallOn(f.SOUTH)}hasWallOnWest(){return this.hasWallOn(f.WEST)}}class Z{coord;actor;dirt;wall;constructor(e,t,r,o){this.coord=Z.validateCoord(e),this.wall=Z.validateWall(t),this.actor=d.ofNullable(r),this.dirt=d.ofNullable(o)}static validateCoord(e){if(null==e)throw new Error("The coordinates cannot be null or undefined.");return e}static validateWall(e){if(null==e)throw new Error("The wall cannot be null or undefined.");if(4!==e.size)throw new Error("The wall must have 4 sides.");if(e.has(f.NORTH)&&e.has(f.EAST)&&e.has(f.SOUTH)&&e.has(f.WEST))return e;throw new Error("The wall must have 4 sides.")}hasActor(){return this.actor.isPresent()}hasCleaningAgent(){return this.actor.isPresent()&&this.actor.orElseThrow().getAppearance().getColour()!==w.USER}hasUser(){return this.actor.isPresent()&&this.actor.orElseThrow().getAppearance().getColour()===w.USER}getActor(){return this.actor}addActor(e){if(this.hasActor())throw new Error("There is already an actor in this location.");if(null==e)throw new Error("The actor cannot be null or undefined.");this.actor=d.of(e)}removeActor(){if(!this.hasActor())throw new Error("There is no actor in this location.");this.actor=d.empty()}popActor(){const e=this.getActor();return e.isPresent()&&this.removeActor(),e}hasDirt(){return this.dirt.isPresent()}getDirt(){return this.dirt}addDirt(e){if(this.hasDirt())throw new Error("There is already a dirt in this location.");if(null==e)throw new Error("The dirt cannot be null or undefined.");this.dirt=d.of(e)}removeDirt(){if(!this.hasDirt())throw new Error("There is no dirt in this location.");this.dirt=d.empty()}getCoord(){return this.coord}getWall(){return this.wall}hasWallOn(e){return this.wall.get(e)}hasWallOnNorth(){return this.hasWallOn(f.NORTH)}hasWallOnEast(){return this.hasWallOn(f.EAST)}hasWallOnSouth(){return this.hasWallOn(f.SOUTH)}hasWallOnWest(){return this.hasWallOn(f.WEST)}getAppearance(){return this.hasActor()&&this.hasDirt()?new Q(this.coord,this.wall,this.getActor().orElseThrow().getAppearance(),this.getDirt().orElseThrow().getAppearance()):this.hasActor()?new Q(this.coord,this.wall,this.getActor().orElseThrow().getAppearance(),void 0):this.hasDirt()?new Q(this.coord,this.wall,void 0,this.getDirt().orElseThrow().getAppearance()):new Q(this.coord,this.wall)}toJsonObject(e){const t={coord:this.coord.toJsonObject(),wall:{north:this.hasWallOnNorth(),east:this.hasWallOnEast(),south:this.hasWallOnSouth(),west:this.hasWallOnWest()}};return this.hasActor()&&(t.actor=this.getActor().orElseThrow().toJsonObject(e)),this.hasDirt()&&(t.dirt=this.getDirt().orElseThrow().toJsonObject()),t}static fromJsonObject(e){if(null==e)throw new Error("The JSON representation of a `VWLocation` cannot be null or undefined.");if(null===e.wall||void 0===e.wall)throw new Error("The JSON representation of a `VWLocation` must have a `wall` property.");if(null===e.coord||void 0===e.coord)throw new Error("The JSON representation of a `VWLocation` must have a `coord` property.");return Z.fromJsonObjectHelper(p.fromJsonObject(e.coord),e.wall,e.actor,e.dirt)}static fromJsonObjectHelper(e,t,r,o){const n=Z.constructWallFromData(t),i=null==r?d.empty():d.of(Y.createVWActorFromJSONObject(r)),s=null==o?d.empty():d.of(S.fromJsonObject(o));return i.isPresent()&&s.isPresent()?new Z(e,n,i.orElseThrow(),s.orElseThrow()):i.isPresent()?new Z(e,n,i.orElseThrow(),void 0):s.isPresent()?new Z(e,n,void 0,s.orElseThrow()):new Z(e,n)}static constructWallFromData(e){const t=new Map;if(null==e)throw new Error("The wall cannot be null or undefined.");if(null===e.north||void 0===e.north)throw new Error("The wall must have a `north` property.");if(null===e.east||void 0===e.east)throw new Error("The wall must have an `east` property.");if(null===e.south||void 0===e.south)throw new Error("The wall must have a `south` property.");if(null===e.west||void 0===e.west)throw new Error("The wall must have a `west` property.");return t.set(f.NORTH,e.north),t.set(f.EAST,e.east),t.set(f.SOUTH,e.south),t.set(f.WEST,e.west),t}static generateWallFromCoordAndGridSize(e,t){const r=new Map;return r.set(f.NORTH,0n===e.getY()),r.set(f.EAST,e.getX()===BigInt(t)-1n),r.set(f.SOUTH,e.getY()===BigInt(t)-1n),r.set(f.WEST,0n===e.getX()),r}}class ee{actorColourBeforeAction;actorOrientationBeforeAction;actorCoordBeforeAction;dirtBeforeAction;getActorColourBeforeAction(){return this.actorColourBeforeAction}setActorColourBeforeAction(e){if(null==e)throw new Error("The actor colour cannot be null or undefined.");this.actorColourBeforeAction=e}getActorOrientationBeforeAction(){return this.actorOrientationBeforeAction}setActorOrientationBeforeAction(e){if(null==e)throw new Error("The actor orientation cannot be null or undefined.");this.actorOrientationBeforeAction=e}getActorCoordBeforeAction(){return this.actorCoordBeforeAction}setActorCoordBeforeAction(e){if(null==e)throw new Error("The actor coord cannot be null or undefined.");this.actorCoordBeforeAction=e}getDirtBeforeAction(){return this.dirtBeforeAction}setDirtBeforeAction(e){if(null==e)throw new Error("The dirt cannot be null or undefined.");this.dirtBeforeAction=e}attempt(e,t){if(null==e)throw new Error("The action cannot be null or undefined.");if(null==t)throw new Error("The environment cannot be null or undefined.");if(this.isPossible(e,t)){this.setActorColourBeforeAction(t.getActorByID(e.getActorID()).orElseThrow().getColour()),this.setActorOrientationBeforeAction(t.getActorByID(e.getActorID()).orElseThrow().getOrientation()),this.setActorCoordBeforeAction(t.getActorCoordByID(e.getActorID()).orElseThrow()),this.setDirtBeforeAction(t.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getDirt());const r=this.perform(e,t);return this.succeeded(e,t)?r:new m(u.FAILURE,e)}return new m(u.IMPOSSIBLE,e)}static isActorInEnv(e,t){return t.getActorByID(e).isPresent()}checkAllInvariants(e,t){return ee.isActorInEnv(e.getActorID(),t)&&this.checkColourAfterAction(e,t)&&this.checkOrientationAfterAction(e,t)&&this.checkCoordAfterAction(e,t)&&this.checkDirtAfterAction(t)}checkColourAfterAction(e,t){return this.getActorColourBeforeAction()===t.getActorByID(e.getActorID()).orElseThrow().getColour()}checkOrientationAfterAction(e,t){return this.getActorOrientationBeforeAction()===t.getActorByID(e.getActorID()).orElseThrow().getOrientation()}checkCoordAfterAction(e,t){return this.getActorCoordBeforeAction().equals(t.getActorCoordByID(e.getActorID()).orElseThrow())}checkDirtAfterAction(e){return this.getDirtBeforeAction().equals(e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getDirt())}}class te extends ee{isPossible(e,t){try{return ee.isActorInEnv(e.getActorID(),t)&&t.getActorByID(e.getActorID()).orElseThrow().getCommunicativeActuator().isPresent()}catch(e){return!1}}perform(e,t){try{return t.sendMessageToRecipients(e)?new m(u.SUCCESS,e):new m(u.FAILURE,e)}catch(t){return new m(u.FAILURE,e)}}succeeded(e,t){try{return this.checkInvariants(e,t)}catch(e){return!1}}checkInvariants(e,t){return this.checkAllInvariants(e,t)}}class re extends ee{isPossible(e,t){try{return ee.isActorInEnv(e.getActorID(),t)&&re.isActorCleaningAgent(e,t)&&re.actorLocationHasCompatibleDirt(e,t)}catch(e){return!1}}static isActorCleaningAgent(e,t){const r=t.getActorByID(e.getActorID()).orElseThrow().getColour();return Object.values(w).includes(r)&&r!==w.USER}static actorLocationHasCompatibleDirt(e,t){const r=t.getActorCoordByID(e.getActorID()),o=t.getActorByID(e.getActorID()).orElseThrow().getColour();return r.isPresent()&&t.getLocation(r.orElseThrow()).orElseThrow().hasDirt()&&re.canClean(o,r,t)}static canClean(e,t,r){return e===w.WHITE||e===r.getLocation(t.orElseThrow()).orElseThrow().getDirt().orElseThrow().getColour()}perform(e,t){try{return t.cleanDirtByCoord(this.getActorCoordBeforeAction()),new m(u.SUCCESS,e)}catch(e){return new m(u.FAILURE,e.message)}}succeeded(e,t){try{return this.checkInvariants(e,t)&&this.checkDirtRemoved(t)}catch(e){return!1}}checkInvariants(e,t){return ee.isActorInEnv(e.getActorID(),t)&&this.checkColourAfterAction(e,t)&&this.checkOrientationAfterAction(e,t)&&this.checkCoordAfterAction(e,t)}checkDirtRemoved(e){return!e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasDirt()}}class oe extends ee{isPossible(e,t){try{return ee.isActorInEnv(e.getActorID(),t)&&oe.isActorUser(e,t)&&oe.actorLocationHasNoDirt(e,t)}catch(e){return!1}}static isActorUser(e,t){return t.getActorByID(e.getActorID()).orElseThrow().getColour()===w.USER}static actorLocationHasNoDirt(e,t){const r=t.getActorCoordByID(e.getActorID());return r.isPresent()&&!t.getLocation(r.orElseThrow()).orElseThrow().hasDirt()}perform(e,t){try{return t.addDirtToLocation(this.getActorCoordBeforeAction(),new S(e.getColour())),new m(u.SUCCESS,e)}catch(t){return new m(u.FAILURE,e)}}succeeded(e,t){try{return this.checkInvariants(e,t)&&this.checkDirtAdded(e,t)}catch(e){return!1}}checkInvariants(e,t){return ee.isActorInEnv(e.getActorID(),t)&&this.checkColourAfterAction(e,t)&&this.checkOrientationAfterAction(e,t)&&this.checkCoordAfterAction(e,t)}checkDirtAdded(e,t){return t.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasDirt()&&t.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getDirt().orElseThrow().getColour()===e.getColour()}}class ne extends ee{isPossible(e,t){try{return ee.isActorInEnv(e.getActorID(),t)}catch(e){return!1}}perform(e,t){try{return new m(u.SUCCESS,e)}catch(t){return new m(u.FAILURE,e)}}succeeded(e,t){try{return this.checkInvariants(e,t)}catch(e){return!1}}checkInvariants(e,t){return this.checkAllInvariants(e,t)}}class ie extends ee{isPossible(e,t){try{return ee.isActorInEnv(e.getActorID(),t)&&ie.targetExists(e,t)&&ie.targetHasNoActor(e,t)}catch(e){return!1}}static targetExists(e,t){const r=t.getActorCoordByID(e.getActorID()),o=t.getActorByID(e.getActorID()).orElseThrow().getOrientation();return r.isPresent()&&!t.getLocation(r.orElseThrow()).orElseThrow().hasWallOn(o)}static targetHasNoActor(e,t){try{const r=t.getActorCoordByID(e.getActorID());return r.isPresent()&&!t.getLocation(r.orElseThrow()).orElseThrow().hasActor()}catch(e){return!1}}perform(e,t){try{const r=this.getActorCoordBeforeAction().getForwardCoord(this.getActorOrientationBeforeAction());return t.getLocation(r).isPresent()?(t.moveActor(this.getActorCoordBeforeAction(),r),new m(u.SUCCESS,e)):new m(u.FAILURE,e)}catch(t){return new m(u.FAILURE,e)}}succeeded(e,t){try{return this.checkInvariants(e,t)&&this.checkOriginalLocation(e,t)&&ie.checkTargetLocation(e,t)}catch(e){return!1}}checkInvariants(e,t){return ee.isActorInEnv(e.getActorID(),t)&&this.checkColourAfterAction(e,t)&&this.checkOrientationAfterAction(e,t)&&this.checkDirtAfterAction(t)}checkOriginalLocation(e,t){return this.noActorInOriginalLocation(t)||this.differentActorInOriginalLocation(e.getActorID(),t)}noActorInOriginalLocation(e){return!e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasActor()}differentActorInOriginalLocation(e,t){return t.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasActor()&&t.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getActor().orElseThrow().getID()!==e}static checkTargetLocation(e,t){const r=t.getActorCoordByID(e.getActorID());return r.isPresent()&&t.getLocation(r.orElseThrow()).orElseThrow().hasActor()&&t.getLocation(r.orElseThrow()).orElseThrow().getActor().orElseThrow().getID()===e.getActorID()}}class se extends ee{isPossible(e,t){try{return ee.isActorInEnv(e.getActorID(),t)&&t.getActorByID(e.getActorID()).orElseThrow().getCommunicativeActuator().isPresent()}catch(e){return!1}}perform(e,t){try{return t.sendMessageToRecipients(e)?new m(u.SUCCESS,e):new m(u.FAILURE,e)}catch(t){return new m(u.FAILURE,e)}}succeeded(e,t){try{return this.checkInvariants(e,t)}catch(e){return!1}}checkInvariants(e,t){return this.checkAllInvariants(e,t)}}class ae extends ee{isPossible(e,t){try{return ee.isActorInEnv(e.getActorID(),t)}catch(e){return!1}}perform(e,t){try{return t.turnActor(this.getActorCoordBeforeAction(),e.getTurningDirection()),new m(u.SUCCESS,e)}catch(t){return new m(u.FAILURE,e)}}succeeded(e,t){try{return this.checkInvariants(e,t)&&this.checkOrientationAfterTurn(e,t)}catch(e){return!1}}checkInvariants(e,t){return ee.isActorInEnv(e.getActorID(),t)&&this.checkColourAfterAction(e,t)&&this.checkCoordAfterAction(e,t)&&this.checkDirtAfterAction(t)}checkOrientationAfterTurn(e,t){const r=t.getActorByID(e.getActorID()).orElseThrow().getOrientation();return e.getTurningDirection()===L.LEFT?r===y.getLeft(this.getActorOrientationBeforeAction()):e.getTurningDirection()===L.RIGHT&&r===y.getRight(this.getActorOrientationBeforeAction())}}class le{ambient;cycleNumber;constructor(e){this.ambient=le.validateAmbient(e),this.cycleNumber=0}static validateAmbient(e){if(null==e)throw new Error("The ambient cannot be null or undefined.");return e}getAmbient(){return this.ambient}getCycleNumber(){return this.cycleNumber}resetCycleNumber(){this.cycleNumber=0}getGridSize(){return this.ambient.getGridSize()}getLocation(e){return this.ambient.getLocation(e)}getActorsIDs(){return this.ambient.getActorsIDs()}getActorsIDsExcept(e){return this.ambient.getActorsIDsExcept(e)}getActorByID(e){return this.ambient.getActorByID(e)}getActorByCoord(e){return this.ambient.getActorByCoord(e)}getActorCoordByID(e){return this.ambient.getActorCoordByID(e)}addActorToLocation(e,t){this.ambient.addActorToLocation(e,t)}moveActor(e,t){this.ambient.moveActor(e,t)}turnActor(e,t){this.ambient.turnActor(e,t)}getDirtsIDs(){return this.ambient.getDirtsIDs()}getDirtByID(e){return this.ambient.getDirtByID(e)}getDirtByCoord(e){return this.ambient.getDirtByCoord(e)}getDirtCoordByID(e){return this.ambient.getDirtCoordByID(e)}cleanDirtByCoord(e){this.ambient.cleanDirtByCoord(e)}addDirtToLocation(e,t){this.ambient.addDirtToLocation(e,t)}cycle(){console.log("Start of cycle #"+this.cycleNumber+"..."),0===this.cycleNumber&&this.forceInitialPerceptionToActors(),this.ambient.getActors().forEach((e=>this.cycleActor(e))),console.log("Environment after the actions: "),console.log(JSON.stringify(this.toJsonObject(),null,4)),console.log("End of cycle #"+this.cycleNumber+"..."),this.cycleNumber++}forceInitialPerceptionToActors(){this.ambient.getActors().forEach((e=>this.forceInitialPerceptionToActor(e)))}forceInitialPerceptionToActor(e){const t=new m(u.IMPOSSIBLE,new a(e.getID()));this.sendResultToActor(t,!1)}cycleActor(e){e.cycle(),this.executeActorActions(e)}executeActorActions(e){const t=[];e.getPhysicalActuator().orElseThrow().hasPendingActions()&&e.getPhysicalActuator().orElseThrow().sourceAll().forEach((e=>t.push(e))),e.getCommunicativeActuator().isPresent()&&e.getCommunicativeActuator().orElseThrow().hasPendingActions()&&e.getCommunicativeActuator().orElseThrow().sourceAll().forEach((e=>t.push(e))),I.validateActions(t),t.forEach((e=>this.executeAction(e)))}executeAction(e){le.getExecutorFor(e).ifPresentOrElse((t=>{const r=t.attempt(e,this);this.sendResultToActor(r,!0)}),(()=>{throw new Error("No executor found for the action "+e+".")}))}static getExecutorFor(e){return e instanceof a?d.of(new ne):e instanceof l?d.of(new ie):e instanceof h?d.of(new ae):e instanceof i?d.of(new re):e instanceof s?d.of(new oe):e instanceof c?d.of(new se):e instanceof o?d.of(new te):d.empty()}sendResultToActor(e,t){const r=new Map,o=this.getActorCoordByID(e.getAction().getActorID()).orElseThrow(),n=this.getActorByCoord(o).orElseThrow().getOrientation(),i=this.getActorCoordByID(e.getAction().getActorID()).orElseThrow().getForwardCoord(n),s=this.getActorCoordByID(e.getAction().getActorID()).orElseThrow().getLeftCoord(n),a=this.getActorCoordByID(e.getAction().getActorID()).orElseThrow().getRightCoord(n),l=this.getActorCoordByID(e.getAction().getActorID()).orElseThrow().getForwardLeftCoord(n),c=this.getActorCoordByID(e.getAction().getActorID()).orElseThrow().getForwardRightCoord(n);this.ambient.getGrid().containsKey(o)&&r.set(g.CENTER,this.ambient.getGrid().get(o).getAppearance()),this.ambient.getGrid().containsKey(i)&&r.set(g.FORWARD,this.ambient.getGrid().get(i).getAppearance()),this.ambient.getGrid().containsKey(s)&&r.set(g.LEFT,this.ambient.getGrid().get(s).getAppearance()),this.ambient.getGrid().containsKey(a)&&r.set(g.RIGHT,this.ambient.getGrid().get(a).getAppearance()),this.ambient.getGrid().containsKey(l)&&r.set(g.FORWARDLEFT,this.ambient.getGrid().get(l).getAppearance()),this.ambient.getGrid().containsKey(c)&&r.set(g.FORWARDRIGHT,this.ambient.getGrid().get(c).getAppearance());const h=new b(r,[e]);this.getActorByCoord(o).orElseThrow().getObservationSensor().ifPresent((e=>e.sink(h))),this.getActorByCoord(o).orElseThrow().getMind().getMindCore().incrementEffort(t?e.getAction().getEffort():0n)}sendMessageToRecipients(e){try{return(e.getRecipientsIDs().length>0?e.getRecipientsIDs():this.getActorsIDsExcept(e.getActorID())).forEach((t=>this.sendMessageToRecipient(e,t))),!0}catch(e){return!1}}sendMessageToRecipient(e,t){this.getActorByID(t).ifPresent((r=>r.getListeningSensor().ifPresent((r=>r.sink(new T(e.getContent(),e.getActorID(),t))))))}toJsonObject(){return{locations:this.serialiseLocations()}}serialiseLocations(){let e=[];for(let t of this.ambient.getGrid().getValues())e.push(this.serialiseLocation(t));return e}serialiseLocation(e){if(null==e)throw new Error("The location cannot be null or undefined.");if(e.hasActor()){const t=this.getActorMindCorePath(e.getActor().orElseThrow().getMind().getMindCore());return e.toJsonObject(t)}return e.toJsonObject()}getActorMindCorePath(e){return e.getMindCoreFilePath()}static fromJsonObject(e,t){if(null==e)throw new Error("The state to load cannot be null or undefined.");if(null===e.locations||void 0===e.locations)throw new Error("The state to load must contain a 'locations' property.");if(Array.isArray(e.locations)){if(e.locations.some((e=>null==e)))throw new Error("The 'locations' array cannot contain null or undefined values.");if(null==t)throw new Error("The config cannot be null or undefined.");return le.fromJsonObjectHelper(e,t)}throw new Error("The 'locations' property must be an array.")}static fromJsonObjectHelper(e,t){const r=le.loadLocations(e.locations);return le.validateGrid(r,t),new le(new C(r))}static loadLocations(e){const t=new A;for(const r of e){if(null===r.coord||void 0===r.coord)throw new Error("The location coordinates cannot be null or undefined.");t.put(p.fromJsonObject(r.coord),Z.fromJsonObject(r))}return t}static validateGrid(e,t){if(null==e)throw new Error("The grid cannot be null or undefined.");if(null==t)throw new Error("The config cannot be null or undefined.");if(null===t.min_environment_dim||void 0===t.min_environment_dim)throw new Error("The config must contain a 'min_environment_dim' property.");if(null===t.max_environment_dim||void 0===t.max_environment_dim)throw new Error("The config must contain a 'max_environment_dim' property.");le.validateGridHelper(e,t)}static validateGridHelper(e,t){const r=Math.sqrt(e.size());le.validateGridSize(r,t)}static validateGridSize(e,t){if(e!==Math.floor(e))throw new Error("The grid must be a square.");if(e<t.min_environment_dim)throw new Error(`The grid size is too small (min: "${t.min_environment_dim}").`);if(e>t.max_environment_dim)throw new Error(`The grid size is too big (max: "${t.max_environment_dim}").`)}static newEmptyVWEnvironment(e,t){if(null==e)throw new Error("The config cannot be null or undefined.");return le.newEmptyVWEnvironmentHelper(e,t)}static newEmptyVWEnvironmentHelper(e,t){const r=null==t?BigInt(e.initial_environment_dim):t;le.validateGridSize(Number(r),e);const o=new A;for(let e=0n;e<r;e++)for(let t=0n;t<r;t++){const n=new p(e,t);o.put(n,new Z(n,Z.generateWallFromCoordAndGridSize(n,r)))}return new le(new C(o))}}class ce{constructor(){}static displayError(e){document.getElementById("error_div").innerText=e,document.getElementById("error_div").removeAttribute("hidden"),document.getElementById("error_div").addEventListener("click",(()=>ce.hideError()))}static hideError(){document.getElementById("error_div").innerText="",document.getElementById("error_div").hidden=!0}}class he{cell;locationAppearance;displayedImage;packed;constructor(e){this.locationAppearance=he.validateLocationAppearance(e),this.createLocationImage(),this.packed=!1,this.cell=document.createElement("div"),this.cell.classList.add("cell"),this.cell.id=`cell-${e.getCoord().getX()}-${e.getCoord().getY()}`}static validateLocationAppearance(e){if(null==e)throw new Error("Cannot create a cell without a location appearance.");return e}createLocationImage(){this.displayedImage=document.createElement("img"),this.displayedImage.src=this.getCellImageSrc(),this.displayedImage.classList.add("location-image")}getCellImageSrc(){if(null===this.locationAppearance||void 0===this.locationAppearance)throw new Error("Cannot get the image src for a cell for which no location appearance is available.");return this.locationAppearance.hasActor()?this.getCellImageSrcIfActorIsPresent():this.locationAppearance.hasDirt()?this.getCellImageSrcIfDirtIsPresent():"envs/vacuumworld-ts/res/images/locations/empty.png"}getCellImageSrcIfActorIsPresent(){const e=this.locationAppearance.getActorAppearance().orElseThrow().getOrientation(),t=this.locationAppearance.getActorAppearance().orElseThrow().getColour(),r=e.toString().toLowerCase();return`envs/vacuumworld-ts/res/images/locations/actor/${t.toString().toLowerCase()}_${r}.png`}getCellImageSrcIfDirtIsPresent(){return`envs/vacuumworld-ts/res/images/locations/dirt/${this.locationAppearance.getDirtAppearance().orElseThrow().getColour().toString().toLowerCase()}_dirt.png`}pack(){if(null===this.displayedImage||void 0===this.displayedImage)throw new Error("Cannot pack a cell that has no image");if(null===this.locationAppearance||void 0===this.locationAppearance)throw new Error("Cannot pack a cell for which no location appearance is available.");if(null===this.cell||void 0===this.cell)throw new Error("Cannot pack a non-existent cell.");this.packed||(this.cell.appendChild(this.displayedImage),this.packed=!0)}unpack(){this.packed&&(this.cell.removeChild(this.displayedImage),this.locationAppearance=null,this.displayedImage=null,this.packed=!1)}isPacked(){return this.packed}getCell(){return this.cell}}class de{gridSize;gridDiv;grid;packed;constructor(e,t){this.gridSize=de.validateGridSize(e),this.gridDiv=document.createElement("div"),this.gridDiv.classList.add("grid","center-aligned"),this.grid=de.validateGrid(t),this.packed=!1}static validateGridSize(e){if(null==e||e<=0)throw new Error("Cannot create a grid with no size.");return e}static validateGrid(e){if(null==e)throw new Error("Cannot create a grid without cells.");if([...e.getKeys()].some((e=>null==e)))throw new Error("Cannot create a grid with null or undefined coordinates.");if([...e.getValues()].some((e=>null==e)))throw new Error("Cannot create a grid with null or undefined cells.");return e}pack(){if(null===this.gridSize||void 0===this.gridSize||this.gridSize<=0)throw new Error("Cannot pack a grid that has no size.");if(null===this.gridDiv||void 0===this.gridDiv)throw new Error("Cannot pack a grid that has no div.");if(null===this.grid||void 0===this.grid)throw new Error("Cannot pack a grid that has no cells.");if(!this.packed){this.grid.forEach((e=>e.pack()));let e=this.createTableForGrid();this.gridDiv.appendChild(e),this.packed=!0}}show(){if(null===this.gridDiv||void 0===this.gridDiv)throw new Error("Cannot show a grid that has no div.");document.getElementById("grid_div").appendChild(this.gridDiv),document.getElementById("grid_div").removeAttribute("hidden")}createTableForGrid(){let e=document.createElement("table");e.classList.add("grid-table");for(let t=0;t<this.gridSize;t++){let r=document.createElement("tr");r.classList.add("grid-row");for(let e=0;e<this.gridSize;e++){let o=document.createElement("td");o.classList.add("grid-cell");const n=new p(BigInt(e),BigInt(t));o.appendChild(this.grid.get(n).getCell()),r.appendChild(o)}e.appendChild(r)}return e}unpack(){this.packed&&(this.gridDiv.removeChild(this.gridDiv.firstChild),this.grid.forEach((e=>e.unpack())),this.grid=null,this.packed=!1)}}class ue{gridSize;config;grid;environment;numberOfCycles;constructor(e,t,r){this.config=ue.validateConfig(r),this.gridSize=ue.validateGridSize(e,r),this.environment=ue.validateEnvironment(e),this.grid=this.createGrid(),this.numberOfCycles=ue.validateNumberOfCycles(t)}pack(){this.grid.pack()}show(){null!==document.getElementById("initial_view_div").firstChild&&(document.getElementById("initial_view_div").removeChild(document.getElementById("initial_view_div").firstChild),document.getElementById("initial_view_div").hidden=!0),null!==document.getElementById("start_button")&&document.getElementById("initial_view_buttons_div").removeChild(document.getElementById("start_button")),null!==document.getElementById("options_button")&&document.getElementById("initial_view_buttons_div").removeChild(document.getElementById("options_button")),null!==document.getElementById("guide_button")&&document.getElementById("initial_view_buttons_div").removeChild(document.getElementById("guide_button")),document.getElementById("initial_view_buttons_div").hidden=!0,this.grid.show()}unpack(){this.grid.unpack(),document.getElementById("grid_div").removeChild(document.getElementById("grid_div").firstChild)}static validateConfig(e){if(null==e)throw new Error("Cannot create a simulation GUI without a config.");return e}static validateGridSize(e,t){if(ue.validateEnvironment(e),ue.validateConfig(t),null===t.min_environment_dim||void 0===t.min_environment_dim||t.min_environment_dim<=0)throw new Error("Invalid config.");if(null===t.max_environment_dim||void 0===t.max_environment_dim||t.max_environment_dim<=0)throw new Error("Invalid config.");if(t.min_environment_dim>t.max_environment_dim)throw new Error("Invalid config.");if(e.getGridSize()<t.min_environment_dim||e.getGridSize()>t.max_environment_dim)throw new Error("Invalid environment.");return e.getGridSize()}static validateEnvironment(e){if(null==e)throw new Error("Cannot create a simulation GUI without an environment.");return e}static validateNumberOfCycles(e){return null==e||e<=0?void 0:e}createGrid(){let e=new A;return this.environment.getAmbient().getGrid().forEach(((t,r)=>{e.put(r,new he(t.getAppearance()))})),new de(this.gridSize,e)}reset(e,t){throw new Error("Not yet implemented.")}cycleSimulation(){console.log("Initial environment: "),console.log(this.environment.getAmbient().getGrid()),this.mainLoop()}async mainLoop(){void 0===this.numberOfCycles?await this.loopForever():await this.loopNumberOfTimes()}async loopForever(){for(;;)await this.doOneCycle()}async loopNumberOfTimes(){for(let e=0;e<this.numberOfCycles;e++)await this.doOneCycle()}async doOneCycle(){this.environment.cycle(),this.unpack(),this.grid=this.createGrid(),this.pack(),this.show(),await this.delay(1e3)}delay(e){return new Promise((t=>setTimeout(t,e)))}}(new class{speed;autoplay;stateToLoad;tooltipsActive;maxNumberOfCycles;efforts;teleora;constructor(){this.setDefaultOptions()}setDefaultOptions(){this.speed=0,this.autoplay=!1,this.stateToLoad=void 0,this.tooltipsActive=!0,this.maxNumberOfCycles=void 0,this.efforts=new Map,this.teleora=void 0}run(){this.createSkeletonView(),document.getElementById("initial_view_div").appendChild(this.loadStartMenu()),document.getElementById("initial_view_div").removeAttribute("hidden"),document.getElementById("initial_view_buttons_div").appendChild(this.createButton("Start","start_button",["initial_buttons"],this.startSimulation.bind(this))),document.getElementById("initial_view_buttons_div").appendChild(this.createButton("Options","options_button",["initial_buttons"],this.setOptions.bind(this))),document.getElementById("initial_view_buttons_div").appendChild(this.createButton("Guide","guide_button",["initial_buttons"],this.openWiki.bind(this))),document.getElementById("initial_view_buttons_div").removeAttribute("hidden")}createSkeletonView(){this.setTitle("VacuumWorld"),this.createPlatformDiv()}setTitle(e){null!=e&&""!==e&&(document.title=e)}createPlatformDiv(){let e=document.createElement("div");e.id="platform_div",e.classList.add("center-aligned"),document.getElementById("container_div").appendChild(e),this.createHiddenCenterAlignedDiv("platform_div","initial_view_div"),this.createHiddenCenterAlignedDiv("platform_div","initial_view_buttons_div"),this.createHiddenCenterAlignedDiv("platform_div","options_dialog_div"),this.createHiddenCenterAlignedDiv("platform_div","grid_div"),this.createHiddenCenterAlignedDiv("platform_div","draggable_bodies_div"),this.createHiddenCenterAlignedDiv("platform_div","simulation_controls_div")}createHiddenCenterAlignedDiv(e,t){let r=document.createElement("div");r.id=t,r.classList.add("center-aligned"),r.hidden=!0,document.getElementById(e).appendChild(r)}createOptionsDialog(){let e=document.createElement("dialog");e.id="options_dialog",document.getElementById("options_dialog_div").appendChild(e),this.createDivWithLabel("options_dialog","speed_selector_div","speed_selector","Speed"),this.createDivWithLabel("options_dialog","autoplay_selector_div","autoplay_selector","Autoplay"),this.createDivWithLabel("options_dialog","state_to_load_selector_div","state_to_load_selector","State"),this.createDivWithLabel("options_dialog","tooltips_selector_div","tooltips_selector","Tooltips"),this.createDivWithLabel("options_dialog","max_number_of_cycles_selector_div","max_number_of_cycles_selector","Cycles"),this.createDivWithLabel("options_dialog","efforts_selector_div","efforts_selector","Efforts"),this.createDivWithLabel("options_dialog","teleora_selector_div","teleora_selector","Teleora mind core"),this.createSpeedSelectorSelectElement(),this.createButtonWithoutCallback("options_dialog","options_dialog_ok_button","OK"),this.createButtonWithoutCallback("options_dialog","options_dialog_cancel_button","Cancel")}createDivWithLabel(e,t,r,o){let n=document.createElement("div");n.id=t,document.getElementById(e).appendChild(n),this.createAndAppendLabel(t,r,o)}createAndAppendLabel(e,t,r){let o=document.createElement("label");o.htmlFor=t,o.innerText=r,document.getElementById(e).appendChild(o)}createSpeedSelectorSelectElement(){let e=document.createElement("select");e.id="speed_values",document.getElementById("speed_selector_div").appendChild(e)}createButtonWithoutCallback(e,t,r){let o=document.createElement("button");o.id=t,o.textContent=r,document.getElementById(e).appendChild(o)}loadStartMenu(){let e=document.createElement("img");return e.src="envs/vacuumworld-ts/res/images/start_menu.png",e.alt="Start menu",e}createButton(e,t,r,o){let n=document.createElement("button");return n.textContent=e,n.id=t,r.forEach((e=>n.classList.add(e))),n.addEventListener("click",o),n}startSimulation(){try{console.log("Start simulation."),this.setActionEfforts();const e={initial_environment_dim:3,min_environment_dim:3,max_environment_dim:13};let t=le.fromJsonObject(this.stateToLoad,e),r=new ue(t,this.maxNumberOfCycles,e);r.pack(),r.show(),r.cycleSimulation()}catch(e){ce.displayError(e)}}openWiki(){window.open("https://github.com/dicelab-rhul/web-agent/")}setOptions(){this.createOptionsDialog(),this.createSpeedSelector(),this.createAutoplayCheckbox(),this.createStateToLoadUploadInput(),this.createTooltipsCheckbox(),this.createMaxNumberOfCyclesInput(),this.createEffortsSelector(),this.createTeleoraUploadInput();let e=document.getElementById("options_dialog");document.getElementById("options_dialog_ok_button").addEventListener("click",(()=>this.saveOptionsAndCloseDialog(e))),document.getElementById("options_dialog_cancel_button").addEventListener("click",(()=>this.discardOptionsAndCloseDialog(e))),e.showModal(),document.getElementById("options_dialog_div").removeAttribute("hidden")}createSpeedSelector(){this.generateSpeedValues().forEach((e=>{let t=document.createElement("option");t.id="speed_value_"+e.toString(),t.value=e.toString(),t.textContent=e.toString(),document.getElementById("speed_values").appendChild(t)}))}generateSpeedValues(){let e=[];for(let t=0;t<1e3;t++)e.push(t/1e3);return e}createAutoplayCheckbox(){let e=document.createElement("input");e.type="checkbox",e.id="autoplay_checkbox",e.checked=!1,document.getElementById("autoplay_selector_div").appendChild(e)}createStateToLoadUploadInput(){let e=document.createElement("input");e.type="file",e.accept=".json",e.id="state_to_load_upload_input",document.getElementById("state_to_load_selector_div").appendChild(e),e.addEventListener("change",(()=>{const t=e.files[0],r=new FileReader;r.onload=e=>{this.stateToLoad=JSON.parse(e.target.result)},r.readAsText(t)}))}createTooltipsCheckbox(){let e=document.createElement("input");e.type="checkbox",e.id="tooltips_checkbox",e.checked=!0,document.getElementById("tooltips_selector_div").appendChild(e)}createMaxNumberOfCyclesInput(){let e=document.createElement("input");e.type="number",e.id="max_number_of_cycles_input",document.getElementById("max_number_of_cycles_selector_div").appendChild(e)}createEffortsSelector(){this.getActionNames().forEach((e=>this.createEffortSelector(e)))}getActionNames(){return["VWIdleAction","VWMoveAction","VWTurnAction","VWCleanAction","VWDropDirtAction","VWSpeakAction","VWBroadcastAction"]}createEffortSelector(e){let t=document.createElement("div");t.id=e.toLowerCase()+"_effort_div";let r=document.createElement("label");r.textContent=e;let o=document.createElement("input");o.type="number",o.id=e.toLowerCase()+"_effort_input",t.appendChild(r),t.appendChild(o),document.getElementById("efforts_selector_div").appendChild(t)}createTeleoraUploadInput(){let e=document.createElement("input");e.type="file",e.accept=".tel",e.id="teleora_upload_input",document.getElementById("teleora_selector_div").appendChild(e),e.addEventListener("change",(()=>{const t=e.files[0],r=new FileReader;r.onload=e=>{this.teleora=e.target.result},r.readAsText(t)}))}saveOptionsAndCloseDialog(e){this.saveOptions(),e.close(),this.resetOptionsDialog(),console.log("Options saved:"),console.log("Speed: "+this.speed),console.log("Autoplay active: "+this.autoplay),console.log("Saved state to load: "+this.stateToLoad),console.log("Tooltips active: "+this.tooltipsActive),console.log("Max number of cycles: "+this.maxNumberOfCycles),console.log("Efforts:"),this.getActionNames().forEach((e=>console.log("- "+e+": "+this.efforts.get(e)))),console.log("Teleora file to load: "+this.teleora)}discardOptionsAndCloseDialog(e){e.close(),this.resetOptionsDialog()}resetOptionsDialog(){document.getElementById("options_dialog_div").removeChild(document.getElementById("options_dialog")),document.getElementById("options_dialog_div").hidden=!0}saveOptions(){this.speed=parseFloat(document.getElementById("speed_values").value),this.autoplay=document.getElementById("autoplay_checkbox").checked,this.tooltipsActive=document.getElementById("tooltips_checkbox").checked,this.maxNumberOfCycles=this.parseMaxNumberOfCycles(),this.efforts=this.loadEfforts(),this.teleora=document.getElementById("teleora_upload_input").files[0]}parseMaxNumberOfCycles(){const e=document.getElementById("max_number_of_cycles_input").value;return""===e||null==e?void 0:parseInt(e)}loadEfforts(){let e=new Map;for(const t of this.getActionNames()){const r=document.getElementById(t.toLowerCase()+"_effort_input").value;""===r||null==r?e.set(t,void 0):e.set(t,BigInt(parseInt(r)))}return e}setActionEfforts(){a.overrideDefaultEffort(this.efforts.get("VWIdleAction")),l.overrideDefaultEffort(this.efforts.get("VWMoveAction")),h.overrideDefaultEffort(this.efforts.get("VWTurnAction")),i.overrideDefaultEffort(this.efforts.get("VWCleanAction")),s.overrideDefaultEffort(this.efforts.get("VWDropDirtAction")),c.overrideDefaultEffort(this.efforts.get("VWSpeakAction")),o.overrideDefaultEffort(this.efforts.get("VWBroadcastAction"))}}).run()})()})();