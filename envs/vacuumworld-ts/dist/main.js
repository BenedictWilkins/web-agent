(()=>{"use strict";var t={429:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"NIL",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"v1",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"v3",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"v4",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"v5",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"validate",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return l.default}});var o=u(i(990)),n=u(i(237)),r=u(i(355)),s=u(i(764)),a=u(i(314)),l=u(i(464)),d=u(i(435)),c=u(i(8)),h=u(i(222));function u(t){return t&&t.__esModule?t:{default:t}}},163:(t,e)=>{function i(t){return 14+(t+64>>>9<<4)+1}function o(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function n(t,e,i,n,r,s){return o((a=o(o(e,t),o(n,s)))<<(l=r)|a>>>32-l,i);var a,l}function r(t,e,i,o,r,s,a){return n(e&i|~e&o,t,e,r,s,a)}function s(t,e,i,o,r,s,a){return n(e&o|i&~o,t,e,r,s,a)}function a(t,e,i,o,r,s,a){return n(e^i^o,t,e,r,s,a)}function l(t,e,i,o,r,s,a){return n(i^(e|~o),t,e,r,s,a)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=function(t){if("string"==typeof t){const e=unescape(encodeURIComponent(t));t=new Uint8Array(e.length);for(let i=0;i<e.length;++i)t[i]=e.charCodeAt(i)}return function(t){const e=[],i=32*t.length,o="0123456789abcdef";for(let n=0;n<i;n+=8){const i=t[n>>5]>>>n%32&255,r=parseInt(o.charAt(i>>>4&15)+o.charAt(15&i),16);e.push(r)}return e}(function(t,e){t[e>>5]|=128<<e%32,t[i(e)-1]=e;let n=1732584193,d=-271733879,c=-1732584194,h=271733878;for(let e=0;e<t.length;e+=16){const i=n,u=d,g=c,f=h;n=r(n,d,c,h,t[e],7,-680876936),h=r(h,n,d,c,t[e+1],12,-389564586),c=r(c,h,n,d,t[e+2],17,606105819),d=r(d,c,h,n,t[e+3],22,-1044525330),n=r(n,d,c,h,t[e+4],7,-176418897),h=r(h,n,d,c,t[e+5],12,1200080426),c=r(c,h,n,d,t[e+6],17,-1473231341),d=r(d,c,h,n,t[e+7],22,-45705983),n=r(n,d,c,h,t[e+8],7,1770035416),h=r(h,n,d,c,t[e+9],12,-1958414417),c=r(c,h,n,d,t[e+10],17,-42063),d=r(d,c,h,n,t[e+11],22,-1990404162),n=r(n,d,c,h,t[e+12],7,1804603682),h=r(h,n,d,c,t[e+13],12,-40341101),c=r(c,h,n,d,t[e+14],17,-1502002290),d=r(d,c,h,n,t[e+15],22,1236535329),n=s(n,d,c,h,t[e+1],5,-165796510),h=s(h,n,d,c,t[e+6],9,-1069501632),c=s(c,h,n,d,t[e+11],14,643717713),d=s(d,c,h,n,t[e],20,-373897302),n=s(n,d,c,h,t[e+5],5,-701558691),h=s(h,n,d,c,t[e+10],9,38016083),c=s(c,h,n,d,t[e+15],14,-660478335),d=s(d,c,h,n,t[e+4],20,-405537848),n=s(n,d,c,h,t[e+9],5,568446438),h=s(h,n,d,c,t[e+14],9,-1019803690),c=s(c,h,n,d,t[e+3],14,-187363961),d=s(d,c,h,n,t[e+8],20,1163531501),n=s(n,d,c,h,t[e+13],5,-1444681467),h=s(h,n,d,c,t[e+2],9,-51403784),c=s(c,h,n,d,t[e+7],14,1735328473),d=s(d,c,h,n,t[e+12],20,-1926607734),n=a(n,d,c,h,t[e+5],4,-378558),h=a(h,n,d,c,t[e+8],11,-2022574463),c=a(c,h,n,d,t[e+11],16,1839030562),d=a(d,c,h,n,t[e+14],23,-35309556),n=a(n,d,c,h,t[e+1],4,-1530992060),h=a(h,n,d,c,t[e+4],11,1272893353),c=a(c,h,n,d,t[e+7],16,-155497632),d=a(d,c,h,n,t[e+10],23,-1094730640),n=a(n,d,c,h,t[e+13],4,681279174),h=a(h,n,d,c,t[e],11,-358537222),c=a(c,h,n,d,t[e+3],16,-722521979),d=a(d,c,h,n,t[e+6],23,76029189),n=a(n,d,c,h,t[e+9],4,-640364487),h=a(h,n,d,c,t[e+12],11,-421815835),c=a(c,h,n,d,t[e+15],16,530742520),d=a(d,c,h,n,t[e+2],23,-995338651),n=l(n,d,c,h,t[e],6,-198630844),h=l(h,n,d,c,t[e+7],10,1126891415),c=l(c,h,n,d,t[e+14],15,-1416354905),d=l(d,c,h,n,t[e+5],21,-57434055),n=l(n,d,c,h,t[e+12],6,1700485571),h=l(h,n,d,c,t[e+3],10,-1894986606),c=l(c,h,n,d,t[e+10],15,-1051523),d=l(d,c,h,n,t[e+1],21,-2054922799),n=l(n,d,c,h,t[e+8],6,1873313359),h=l(h,n,d,c,t[e+15],10,-30611744),c=l(c,h,n,d,t[e+6],15,-1560198380),d=l(d,c,h,n,t[e+13],21,1309151649),n=l(n,d,c,h,t[e+4],6,-145523070),h=l(h,n,d,c,t[e+11],10,-1120210379),c=l(c,h,n,d,t[e+2],15,718787259),d=l(d,c,h,n,t[e+9],21,-343485551),n=o(n,i),d=o(d,u),c=o(c,g),h=o(h,f)}return[n,d,c,h]}(function(t){if(0===t.length)return[];const e=8*t.length,o=new Uint32Array(i(e));for(let i=0;i<e;i+=8)o[i>>5]|=(255&t[i/8])<<i%32;return o}(t),8*t.length))}},790:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};e.default=i},314:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default="00000000-0000-0000-0000-000000000000"},222:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o,n=(o=i(435))&&o.__esModule?o:{default:o};e.default=function(t){if(!(0,n.default)(t))throw TypeError("Invalid UUID");let e;const i=new Uint8Array(16);return i[0]=(e=parseInt(t.slice(0,8),16))>>>24,i[1]=e>>>16&255,i[2]=e>>>8&255,i[3]=255&e,i[4]=(e=parseInt(t.slice(9,13),16))>>>8,i[5]=255&e,i[6]=(e=parseInt(t.slice(14,18),16))>>>8,i[7]=255&e,i[8]=(e=parseInt(t.slice(19,23),16))>>>8,i[9]=255&e,i[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,i[11]=e/4294967296&255,i[12]=e>>>24&255,i[13]=e>>>16&255,i[14]=e>>>8&255,i[15]=255&e,i}},58:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},319:(t,e)=>{let i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){if(!i&&(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!i))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(o)};const o=new Uint8Array(16)},757:(t,e)=>{function i(t,e,i,o){switch(t){case 0:return e&i^~e&o;case 1:case 3:return e^i^o;case 2:return e&i^e&o^i&o}}function o(t,e){return t<<e|t>>>32-e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=function(t){const e=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){const e=unescape(encodeURIComponent(t));t=[];for(let i=0;i<e.length;++i)t.push(e.charCodeAt(i))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);const r=t.length/4+2,s=Math.ceil(r/16),a=new Array(s);for(let e=0;e<s;++e){const i=new Uint32Array(16);for(let o=0;o<16;++o)i[o]=t[64*e+4*o]<<24|t[64*e+4*o+1]<<16|t[64*e+4*o+2]<<8|t[64*e+4*o+3];a[e]=i}a[s-1][14]=8*(t.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(t.length-1)&4294967295;for(let t=0;t<s;++t){const r=new Uint32Array(80);for(let e=0;e<16;++e)r[e]=a[t][e];for(let t=16;t<80;++t)r[t]=o(r[t-3]^r[t-8]^r[t-14]^r[t-16],1);let s=n[0],l=n[1],d=n[2],c=n[3],h=n[4];for(let t=0;t<80;++t){const n=Math.floor(t/20),a=o(s,5)+i(n,l,d,c)+h+e[n]+r[t]>>>0;h=c,c=d,d=o(l,30)>>>0,l=s,s=a}n[0]=n[0]+s>>>0,n[1]=n[1]+l>>>0,n[2]=n[2]+d>>>0,n[3]=n[3]+c>>>0,n[4]=n[4]+h>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]}},8:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.unsafeStringify=s;var o,n=(o=i(435))&&o.__esModule?o:{default:o};const r=[];for(let t=0;t<256;++t)r.push((t+256).toString(16).slice(1));function s(t,e=0){return(r[t[e+0]]+r[t[e+1]]+r[t[e+2]]+r[t[e+3]]+"-"+r[t[e+4]]+r[t[e+5]]+"-"+r[t[e+6]]+r[t[e+7]]+"-"+r[t[e+8]]+r[t[e+9]]+"-"+r[t[e+10]]+r[t[e+11]]+r[t[e+12]]+r[t[e+13]]+r[t[e+14]]+r[t[e+15]]).toLowerCase()}e.default=function(t,e=0){const i=s(t,e);if(!(0,n.default)(i))throw TypeError("Stringified UUID is invalid");return i}},990:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o,n=(o=i(319))&&o.__esModule?o:{default:o},r=i(8);let s,a,l=0,d=0;e.default=function(t,e,i){let o=e&&i||0;const c=e||new Array(16);let h=(t=t||{}).node||s,u=void 0!==t.clockseq?t.clockseq:a;if(null==h||null==u){const e=t.random||(t.rng||n.default)();null==h&&(h=s=[1|e[0],e[1],e[2],e[3],e[4],e[5]]),null==u&&(u=a=16383&(e[6]<<8|e[7]))}let g=void 0!==t.msecs?t.msecs:Date.now(),f=void 0!==t.nsecs?t.nsecs:d+1;const p=g-l+(f-d)/1e4;if(p<0&&void 0===t.clockseq&&(u=u+1&16383),(p<0||g>l)&&void 0===t.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=g,d=f,a=u,g+=122192928e5;const v=(1e4*(268435455&g)+f)%4294967296;c[o++]=v>>>24&255,c[o++]=v>>>16&255,c[o++]=v>>>8&255,c[o++]=255&v;const w=g/4294967296*1e4&268435455;c[o++]=w>>>8&255,c[o++]=255&w,c[o++]=w>>>24&15|16,c[o++]=w>>>16&255,c[o++]=u>>>8|128,c[o++]=255&u;for(let t=0;t<6;++t)c[o+t]=h[t];return e||(0,r.unsafeStringify)(c)}},237:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=r(i(925)),n=r(i(163));function r(t){return t&&t.__esModule?t:{default:t}}var s=(0,o.default)("v3",48,n.default);e.default=s},925:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.URL=e.DNS=void 0,e.default=function(t,e,i){function o(t,o,s,a){var l;if("string"==typeof t&&(t=function(t){t=unescape(encodeURIComponent(t));const e=[];for(let i=0;i<t.length;++i)e.push(t.charCodeAt(i));return e}(t)),"string"==typeof o&&(o=(0,r.default)(o)),16!==(null===(l=o)||void 0===l?void 0:l.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let d=new Uint8Array(16+t.length);if(d.set(o),d.set(t,o.length),d=i(d),d[6]=15&d[6]|e,d[8]=63&d[8]|128,s){a=a||0;for(let t=0;t<16;++t)s[a+t]=d[t];return s}return(0,n.unsafeStringify)(d)}try{o.name=t}catch(t){}return o.DNS=s,o.URL=a,o};var o,n=i(8),r=(o=i(222))&&o.__esModule?o:{default:o};const s="6ba7b810-9dad-11d1-80b4-00c04fd430c8";e.DNS=s;const a="6ba7b811-9dad-11d1-80b4-00c04fd430c8";e.URL=a},355:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=s(i(790)),n=s(i(319)),r=i(8);function s(t){return t&&t.__esModule?t:{default:t}}e.default=function(t,e,i){if(o.default.randomUUID&&!e&&!t)return o.default.randomUUID();const s=(t=t||{}).random||(t.rng||n.default)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){i=i||0;for(let t=0;t<16;++t)e[i+t]=s[t];return e}return(0,r.unsafeStringify)(s)}},764:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=r(i(925)),n=r(i(757));function r(t){return t&&t.__esModule?t:{default:t}}var s=(0,o.default)("v5",80,n.default);e.default=s},435:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o,n=(o=i(58))&&o.__esModule?o:{default:o};e.default=function(t){return"string"==typeof t&&n.default.test(t)}},464:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o,n=(o=i(435))&&o.__esModule?o:{default:o};e.default=function(t){if(!(0,n.default)(t))throw TypeError("Invalid UUID");return parseInt(t.slice(14,15),16)}}},e={};function i(o){var n=e[o];if(void 0!==n)return n.exports;var r=e[o]={exports:{}};return t[o](r,r.exports,i),r.exports}(()=>{class t{constructor(){}static exists(...t){return null!=t&&Array.from(t).every((t=>null!=t))}static allExist(e){return t.exists(e)&&Array.from(e).every((e=>t.exists(e)))}static validateExistence(e,i){if(t.exists(e))return e;throw new Error(i||"The object is null or undefined.")}static validateAllExistence(e,i){if(t.allExist(e))return e;throw new Error(i||"The object is null or undefined.")}}class e{actorID;constructor(e){this.actorID=t.validateExistence(e,"The actor ID cannot be null or undefined.")}getActorID(){return this.actorID}}class o extends e{content;recipientsIDs;constructor(e,i,o){super(e),this.content=t.validateExistence(i,"The content cannot be null or undefined."),this.recipientsIDs=null==o?[]:o}getContent(){return this.content}getRecipientsIDs(){return this.recipientsIDs}}class n extends o{static effort=1n;constructor(t,e){super(t,e)}getEffort(){return n.effort}static getEffort(){return n.effort}static overrideDefaultEffort(e){t.exists(e)?(n.effort=e,console.log("The effort of VWBroadcastAction has been changed to "+e+".")):console.log("The new effort for VWBroadcastAction cannot be null or undefined. The default effort will be used instead.")}}class r extends e{constructor(t){super(t)}}class s extends r{static effort=1n;constructor(t){super(t)}getEffort(){return s.effort}static overrideDefaultEffort(e){t.exists(e)?(s.effort=e,console.log("The effort of VWCleanAction has been changed to "+e+".")):console.log("The new effort for VWCleanAction cannot be null or undefined. The default effort will be used instead.")}}class a extends r{colour;static effort=1n;constructor(e,i){super(e),this.colour=t.validateExistence(i,"The dirt colour cannot be null or undefined.")}getColour(){return this.colour}getEffort(){return a.effort}static overrideDefaultEffort(e){t.exists(e)?(a.effort=e,console.log("The effort of VWDropDirtAction has been changed to "+e+".")):console.log("The new effort for VWDropDirtAction cannot be null or undefined. The default effort will be used instead.")}}class l extends r{static effort=1n;constructor(t){super(t)}getEffort(){return l.effort}static overrideDefaultEffort(e){t.exists(e)?(l.effort=e,console.log("The effort of VWIdleAction has been changed to "+e+".")):console.log("The new effort for VWIdleAction cannot be null or undefined. The default effort will be used instead.")}}class d extends r{static effort=1n;constructor(t){super(t)}getEffort(){return d.effort}static overrideDefaultEffort(e){t.exists(e)?(d.effort=e,console.log("The effort of VWMoveAction has been changed to "+e+".")):console.log("The new effort for VWMoveAction cannot be null or undefined. The default effort will be used instead.")}}class c extends o{static effort=1n;constructor(t,e,i){super(t,e,i)}getEffort(){return 0===this.getRecipientsIDs().length?n.getEffort():c.effort}static overrideDefaultEffort(e){t.exists(e)?(c.effort=e,console.log("The effort of VWSpeakAction has been changed to "+e+".")):console.log("The new effort for VWSpeakAction cannot be null or undefined. The default effort will be used instead.")}}class h extends r{turningDirection;static effort=1n;constructor(e,i){super(e),this.turningDirection=t.validateExistence(i,"The turning direction cannot be null or undefined.")}getTurningDirection(){return this.turningDirection}getEffort(){return h.effort}static overrideDefaultEffort(e){t.exists(e)?(h.effort=e,console.log("The effort of VWTurnAction has been changed to "+e+".")):console.log("The new effort for VWTurnAction cannot be null or undefined. The default effort will be used instead.")}}class u{value;constructor(t){this.value=t}static of(e){if(t.exists(e))return new u(e);throw new Error("The value cannot be null or undefined.")}static ofNullable(e){return t.exists(e)?new u(e):u.empty()}static empty(){return new u(null)}isPresent(){return null!==this.value}isEmpty(){return null===this.value}get(){return t.validateExistence(this.value,"The value is null or undefined.")}orElse(e){return t.exists(this.value)?this.value:e}orElseGet(e){return t.exists(this.value)?this.value:e()}orElseThrow(e){if(t.exists(this.value))return this.value;throw e||new Error("The value is null or undefined.")}ifPresent(e){t.exists(this.value)&&e(this.value)}ifPresentOrElse(e,i){t.exists(this.value)?e(this.value):i()}filter(e){return t.exists(this.value)&&e(this.value)?this:u.empty()}map(e){return t.exists(this.value)?u.of(e(this.value)):u.empty()}flatMap(e){return t.exists(this.value)?e(this.value):u.empty()}equals(e){return!!t.exists(e)&&(this===e||e instanceof u&&(null===this.value?null===e.value:void 0===this.value?void 0===e.value:this.value===e.value))}}var g,f,p,v;!function(t){t.IMPOSSIBLE="IMPOSSIBLE",t.SUCCESS="SUCCESS",t.FAILURE="FAILURE"}(g||(g={}));class w{actionOutcome;action;constructor(e,i){this.actionOutcome=t.validateExistence(e,"The action outcome cannot be null or undefined."),this.action=t.validateExistence(i,"The action cannot be null or undefined.")}getActionOutcome(){return this.actionOutcome}getAction(){return this.action}}!function(t){t.NORTH="NORTH",t.EAST="EAST",t.SOUTH="SOUTH",t.WEST="WEST"}(f||(f={}));class m{x;y;constructor(e,i){this.x=t.validateExistence(e,"The x coordinate cannot be null or undefined."),this.y=t.validateExistence(i,"The y coordinate cannot be null or undefined.")}getX(){return this.x}getY(){return this.y}clone(){return new m(this.x,this.y)}getForwardCoord(e){if(t.exists(e)){if(e===f.NORTH)return new m(this.x,this.y-1n);if(e===f.EAST)return new m(this.x+1n,this.y);if(e===f.SOUTH)return new m(this.x,this.y+1n);if(e===f.WEST)return new m(this.x-1n,this.y);throw new Error("The orientation is invalid.")}throw new Error("The orientation cannot be null or undefined.")}getLeftCoord(e){if(t.exists(e)){if(e===f.NORTH)return new m(this.x-1n,this.y);if(e===f.EAST)return new m(this.x,this.y-1n);if(e===f.SOUTH)return new m(this.x+1n,this.y);if(e===f.WEST)return new m(this.x,this.y+1n);throw new Error("The orientation is invalid.")}throw new Error("The orientation cannot be null or undefined.")}getRightCoord(e){if(t.exists(e)){if(e===f.NORTH)return new m(this.x+1n,this.y);if(e===f.EAST)return new m(this.x,this.y+1n);if(e===f.SOUTH)return new m(this.x-1n,this.y);if(e===f.WEST)return new m(this.x,this.y-1n);throw new Error("The orientation is invalid.")}throw new Error("The orientation cannot be null or undefined.")}getForwardLeftCoord(e){if(t.exists(e)){if(e===f.NORTH)return new m(this.x-1n,this.y-1n);if(e===f.EAST)return new m(this.x+1n,this.y-1n);if(e===f.SOUTH)return new m(this.x+1n,this.y+1n);if(e===f.WEST)return new m(this.x-1n,this.y+1n);throw new Error("The orientation is invalid.")}throw new Error("The orientation cannot be null or undefined.")}getForwardRightCoord(e){if(t.exists(e)){if(e===f.NORTH)return new m(this.x+1n,this.y-1n);if(e===f.EAST)return new m(this.x+1n,this.y+1n);if(e===f.SOUTH)return new m(this.x-1n,this.y+1n);if(e===f.WEST)return new m(this.x-1n,this.y-1n);throw new Error("The orientation is invalid.")}throw new Error("The orientation cannot be null or undefined.")}sum(t){return new m(this.x+t.x,this.y+t.y)}increment(t){return new m(this.x+t,this.y+t)}sub(t){return new m(this.x-t.x,this.y-t.y)}decrement(t){return new m(this.x-t,this.y-t)}toJsonObject(){return{x:this.x.toString(),y:this.y.toString()}}static fromJsonObject(e){if(t.exists(e)){if(t.exists(e.x)){if(t.exists(e.y))return new m(BigInt(e.x),BigInt(e.y));throw new Error("The y coordinate cannot be null or undefined.")}throw new Error("The x coordinate cannot be null or undefined.")}throw new Error("The JSON representation cannot be null or undefined.")}toString(){return`(${this.x}, ${this.y})`}equals(e){return!!t.exists(e)&&(this===e||e instanceof m&&this.x===e.x&&this.y===e.y)}static fromString(e){if(t.exists(e)){if(e.length<5)throw new Error("The coordinate string is invalid.");{const t=e.substring(1,e.indexOf(",")),i=e.substring(e.indexOf(",")+2,e.length-1);return new m(BigInt(t),BigInt(i))}}throw new Error("The coordinate string cannot be null or undefined.")}}class E{key;value;constructor(t,e){this.key=t,this.value=e}getKey(){return this.key}getValue(){return this.value}setValue(t){this.value=t}}class b{entries;constructor(){this.entries=[]}put(e,i){let o=this.getEntry(e);t.exists(o)?o.setValue(i):this.entries.push(new E(e,i))}get(e){const i=this.getEntry(e);return t.exists(i)?i.getValue():null}remove(e){const i=this.getEntry(e);t.exists(i)&&this.entries.splice(this.entries.indexOf(i),1)}containsKey(e){return t.exists(this.getEntry(e))}containsValue(t){for(let e of this.entries)if(e.getValue()===t)return!0;return!1}size(){return this.entries.length}isEmpty(){return 0===this.entries.length}clear(){this.entries=[]}getKeys(){return this.entries.map((t=>t.getKey()))}getValues(){return this.entries.map((t=>t.getValue()))}getEntry(t){return this.entries.find((e=>e.getKey().equals(t)))}toString(){let t="";for(let e of this.entries)t+=e.getKey()+" : "+e.getValue()+"\n";return t}equals(t){if(this.size()!==t.size())return!1;for(let e of this.entries)if(!t.containsKey(e.getKey())||t.get(e.getKey())!==e.getValue())return!1;return!0}clone(){const t=new b;for(let e of this.entries)t.put(e.getKey(),e.getValue());return t}static fromMap(t){const e=new b;for(let[i,o]of t)e.put(i,o);return e}toMap(){const t=new Map;for(let e of this.entries)t.set(e.getKey(),e.getValue());return t}static fromObject(t){const e=new b;for(let i in t)e.put(i,t[i]);return e}[Symbol.iterator](){let t=0,e=this.entries;return{next:()=>{if(t<e.length){const i=e[t];return t++,{value:[i.getKey(),i.getValue()],done:!1}}return{value:void 0,done:!0}}}}forEach(t){for(let e of this.entries)t(e.getValue(),e.getKey(),this)}}class A{}class T extends A{content;senderID;recipientID;constructor(e,i,o){super(),this.content=t.validateExistence(e,"The content cannot be null or undefined."),this.senderID=t.validateExistence(i,"The sender ID cannot be null or undefined."),this.recipientID=t.validateExistence(o,"The recipient ID cannot be null or undefined.")}getContent(){return this.content}getSenderID(){return this.senderID}getRecipientID(){return this.recipientID}}class y{constructor(){}static getLeft(t){switch(t){case f.NORTH:return f.WEST;case f.SOUTH:return f.EAST;case f.EAST:return f.NORTH;case f.WEST:return f.SOUTH;default:throw new Error("Invalid orientation.")}}static getRight(t){switch(t){case f.NORTH:return f.EAST;case f.SOUTH:return f.WEST;case f.EAST:return f.SOUTH;case f.WEST:return f.NORTH;default:throw new Error("Invalid orientation.")}}static getOpposite(t){switch(t){case f.NORTH:return f.SOUTH;case f.SOUTH:return f.NORTH;case f.EAST:return f.WEST;case f.WEST:return f.EAST;default:throw new Error("Invalid orientation.")}}}!function(t){t.CENTER="CENTER",t.FORWARD="FORWARD",t.LEFT="LEFT",t.RIGHT="RIGHT",t.FORWARDLEFT="FORWARDLEFT",t.FORWARDRIGHT="FORWARDRIGHT"}(p||(p={}));class C extends A{locations;actionResults;constructor(e,i){super(),this.locations=new Map,this.actionResults=C.validateActionResults(i);for(const i of e.keys()){if(!t.exists(i))throw new Error("The position cannot be null or undefined.");if(!t.exists(e.get(i)))throw new Error("The location appearance cannot be null or undefined.");this.locations.set(i,e.get(i))}}static validateActionResults(e){if(t.allExist(e)){if(0===e.length)throw new Error("The action results array cannot be empty.");return e}throw new Error("The action results cannot be null or undefined, or contain null or undefined elements.")}getLocations(){return this.locations}getLocationAt(e){return this.locations.has(e)&&t.exists(this.locations.get(e))?u.of(this.locations.get(e)):u.empty()}getCenter(){return this.getLocationAt(p.CENTER)}getLeft(){return this.getLocationAt(p.LEFT)}getRight(){return this.getLocationAt(p.RIGHT)}getForward(){return this.getLocationAt(p.FORWARD)}getForwardLeft(){return this.getLocationAt(p.FORWARDLEFT)}getForwardRight(){return this.getLocationAt(p.FORWARDRIGHT)}getOwnID(){return this.getCenter().orElseThrow().getActorAppearance().orElseThrow().getID()}getOwnColour(){return this.getCenter().orElseThrow().getActorAppearance().orElseThrow().getColour()}getOwnOrientation(){return this.getCenter().orElseThrow().getActorAppearance().orElseThrow().getOrientation()}getOwnCoordinates(){return this.getCenter().orElseThrow().getCoord()}getActionResults(){return this.actionResults}isWallImmediatelyAhead(){return this.getCenter().orElseThrow().hasWallOn(this.getOwnOrientation())}isWallOneStepAhead(){return!this.isWallImmediatelyAhead()&&this.getForward().orElseThrow().hasWallOn(this.getOwnOrientation())}isWallVisibleSomewhereAhead(){return this.isWallImmediatelyAhead()||this.isWallOneStepAhead()}isWallImmediatelyToTheLeft(){return this.getCenter().orElseThrow().hasWallOn(y.getLeft(this.getOwnOrientation()))}isWallOneStepToTheLeft(){return!this.isWallImmediatelyToTheLeft()&&this.getLeft().orElseThrow().hasWallOn(y.getLeft(this.getOwnOrientation()))}isWallVisibleSomewhereToTheLeft(){return this.isWallImmediatelyToTheLeft()||this.isWallOneStepToTheLeft()}isWallImmediatelyToTheRight(){return this.getCenter().orElseThrow().hasWallOn(y.getRight(this.getOwnOrientation()))}isWallOneStepToTheRight(){return!this.isWallImmediatelyToTheRight()&&this.getRight().orElseThrow().hasWallOn(y.getRight(this.getOwnOrientation()))}isWallVisibleSomewhereToTheRight(){return this.isWallImmediatelyToTheRight()||this.isWallOneStepToTheRight()}}class D{static validateActions(e){if(!t.allExist(e))throw new Error("The actions array cannot be null or undefined, or contain null or undefined elements.");if(0===e.length)throw new Error("At least one action per cycle must by attempted by each actor.");if(e.length>2)throw new Error("At most two actions per cycle can be attempted by each actor.");if(2===e.length&&e[0]instanceof r&&e[1]instanceof r)throw new Error("At most one physical action per cycle can be attempted by each actor.");if(2===e.length&&e[0]instanceof o&&e[1]instanceof o)throw new Error("At most one communicative action per cycle can be attempted by each actor.")}}class x{grid;constructor(e){this.grid=t.validateExistence(e,"The grid cannot be null or undefined.")}getGridSize(){return Math.sqrt(this.grid.size())}getGrid(){return this.grid}getLocation(t){return u.ofNullable(this.grid.get(t))}getActors(){const t=[];for(const[e,i]of this.grid){const e=i.getActor();e.isPresent()&&t.push(e.orElseThrow())}return t}getActorsIDs(){const t=[];for(let[e,i]of this.grid){const e=i.getActor();e.isPresent()&&t.push(e.orElseThrow().getID())}return t}getActorsIDsExcept(t){const e=[];for(let[i,o]of this.grid){const i=o.getActor();i.isPresent()&&i.orElseThrow().getID()!==t&&e.push(i.orElseThrow().getID())}return e}getActorByID(t){for(let[e,i]of this.grid){const e=i.getActor();if(e.isPresent()&&e.orElseThrow().getID()===t)return e}return u.empty()}getActorByCoord(t){return this.getLocation(t).flatMap((t=>t.getActor()))}getActorCoordByID(t){for(let[e,i]of this.grid){const o=i.getActor();if(o.isPresent()&&o.orElseThrow().getID()===t)return u.of(e)}return u.empty()}addActorToLocation(e,i){if(!t.exists(e))throw new Error("The coordinates of the location cannot be null or undefined.");if(!t.exists(i))throw new Error("The actor cannot be null or undefined.");if(this.getActorByCoord(e).isPresent())throw new Error("There is already an actor at the location.");this.getLocation(e).ifPresent((t=>t.addActor(i)))}popActorByCoord(t){return this.getLocation(t).flatMap((t=>t.popActor()))}moveActor(e,i){if(!t.exists(e))throw new Error("The coordinates of the origin location cannot be null or undefined.");if(!t.exists(i))throw new Error("The coordinates of the destination location cannot be null or undefined.");if(e.equals(i))throw new Error("The destination location cannot be the same as the origin location.");if(!this.getActorByCoord(e).isPresent())throw new Error("There is no actor at the origin location.");if(this.getActorByCoord(i).isPresent())throw new Error("There is already an actor at the destination location.");{const t=this.popActorByCoord(e).orElseThrow();this.getLocation(i).orElseThrow().addActor(t)}}turnActor(e,i){if(!t.exists(e))throw new Error("The coordinates of the actor location cannot be null or undefined.");if(!this.getActorByCoord(e).isPresent())throw new Error("There is no actor at the origin location.");this.getActorByCoord(e).orElseThrow().turn(i)}getDirtsIDs(){const t=[];for(let[e,i]of this.grid){const e=i.getDirt();e.isPresent()&&t.push(e.orElseThrow().getID())}return t}getDirtByID(t){for(let[e,i]of this.grid){const e=i.getDirt();if(e.isPresent()&&e.orElseThrow().getID()===t)return e}return u.empty()}getDirtByCoord(t){return this.getLocation(t).flatMap((t=>t.getDirt()))}getDirtCoordByID(t){for(let[e,i]of this.grid){const o=i.getDirt();if(o.isPresent()&&o.orElseThrow().getID()===t)return u.of(e)}return u.empty()}cleanDirtByCoord(e){if(!t.exists(e))throw new Error("The coordinates of the dirt location cannot be null or undefined.");if(!this.getDirtByCoord(e).isPresent())throw new Error("There is no dirt at the location.");this.getLocation(e).orElseThrow().removeDirt()}addDirtToLocation(e,i){if(!t.exists(e))throw new Error("The coordinates of the location cannot be null or undefined.");if(!t.exists(i))throw new Error("The dirt cannot be null or undefined.");if(this.getDirtByCoord(e).isPresent())throw new Error("There is already a dirt at the location.");this.getLocation(e).ifPresent((t=>t.addDirt(i)))}}!function(t){t.GREEN="GREEN",t.ORANGE="ORANGE",t.WHITE="WHITE",t.USER="USER"}(v||(v={}));const I=i(429);class k{id;constructor(){this.id=I.v4()}getID(){return this.id}equals(e){return!!t.exists(e)&&(this===e||e instanceof k&&this.id===e.id)}}class O{dirtID;colour;constructor(e,i){this.dirtID=t.validateExistence(e,"The dirt ID cannot be null or undefined."),this.colour=t.validateExistence(i,"The dirt colour cannot be null or undefined.")}getID(){return this.dirtID}getColour(){return this.colour}equals(e){return!!t.exists(e)&&(this===e||e instanceof O&&this.dirtID===e.dirtID&&this.colour===e.colour)}}class S extends k{colour;constructor(e){super(),this.colour=t.validateExistence(e,"The dirt colour cannot be null or undefined.")}getColour(){return this.colour}equals(e){return!!t.exists(e)&&(this===e||e instanceof S&&super.equals(e)&&this.colour===e.colour)}getAppearance(){return new O(this.getID(),this.colour)}toJsonObject(){return{colour:this.getColour()}}static fromJsonObject(e){if(!t.exists(e))throw new Error("The dirt JSON object cannot be null or undefined.");if(!t.exists(e.colour))throw new Error("The colour of a `VWDirt` cannot be null or undefined.");const i=e.colour;return new S(i)}}var _,L;!function(t){t.LEFT="left",t.RIGHT="right"}(_||(_={}));class B{actorID;colour;orientation;constructor(e,i,o){this.actorID=t.validateExistence(e,"The actor ID cannot be null or undefined."),this.colour=t.validateExistence(i,"The actor colour cannot be null or undefined."),this.orientation=t.validateExistence(o,"The actor orientation cannot be null or undefined.")}getID(){return this.actorID}getColour(){return this.colour}getOrientation(){return this.orientation}}class R{core;nextActions;constructor(e){this.core=t.validateExistence(e,"The mind core cannot be null or undefined."),this.nextActions=[]}perceive(t,e){this.core.perceive(t,e)}revise(){this.core.revise()}decide(){this.nextActions=this.core.decide()}execute(){return this.nextActions}getMindCore(){return this.core}}class W extends R{constructor(t){super(t)}}class N extends k{colour;orientation;mind;observationSensor;listeningSensor;physicalActuator;CommunicativeActuator;constructor(e,i,o,n,r,s,a){super(),this.colour=t.validateExistence(e,"The colour cannot be null or undefined."),this.orientation=t.validateExistence(i,"The orientation cannot be null or undefined."),this.mind=t.validateExistence(o,"The mind cannot be null or undefined."),this.observationSensor=null==n?u.empty():u.of(n),this.listeningSensor=null==r?u.empty():u.of(r),this.physicalActuator=null==s?u.empty():u.of(s),this.CommunicativeActuator=null==a?u.empty():u.of(a)}getColour(){return this.colour}getOrientation(){return this.orientation}getMind(){return this.mind}getObservationSensor(){return this.observationSensor}getListeningSensor(){return this.listeningSensor}getPhysicalActuator(){return this.physicalActuator}getCommunicativeActuator(){return this.CommunicativeActuator}getAppearance(){return new B(this.getID(),this.getColour(),this.getOrientation())}turn(e){if(!t.exists(e))throw new Error("The turning direction cannot be null or undefined.");if(e===_.LEFT)this.orientation=y.getLeft(this.orientation);else{if(e!==_.RIGHT)throw new Error("The turning direction is invalid.");this.orientation=y.getRight(this.orientation)}}cycle(){const t=this.getObservationSensor().orElseThrow().sourceAll().orElseThrow(),e=N.mergeObservations(t),i=this.sourceMessages();this.getMind().perceive(e,i),this.getMind().revise(),this.getMind().decide();const o=this.getMind().execute();D.validateActions(o),this.executeActions(o)}sourceMessages(){const t=[];return this.getListeningSensor().ifPresent((e=>e.sourceAll().ifPresent((e=>t.push(...e))))),t}static mergeObservations(e){if(t.allExist(e)){if(0===e.length)throw new Error("At least one observation must be present.");if(1===e.length)return e[0];if(2===e.length){const t=e[0].getActionResults().concat(e[1].getActionResults());return new C(e[1].getLocations(),t)}throw new Error("At most two observations can be present.")}throw new Error("The observations array cannot be null or undefined, or contain null or undefined observations.")}executeActions(t){for(const e of t)if(e instanceof r)this.getPhysicalActuator().orElseThrow().sink(e);else{if(!(e instanceof o))throw new Error("The action is not supported.");this.getCommunicativeActuator().orElseThrow().sink(e)}}toJsonObject(e){if(!t.exists(e))throw new Error("The actor mind core path cannot be null or undefined.");return{colour:this.getColour(),orientation:this.getOrientation(),mind:e}}reset(){this.mind=new W(this.mind.getMindCore().newCore())}}class P extends N{constructor(t,e,i,o,n,r,s){super(P.validateColourForCleaningAgent(t),e,i,o,n,r,s)}static validateColourForCleaningAgent(e){if(t.exists(e)){if(e===v.USER)throw new Error("The colour of a cleaning agent cannot be USER.");return e}throw new Error("The colour cannot be null or undefined.")}}class V extends N{constructor(t,e,i,o){super(v.USER,t,e,i,void 0,o)}}class M{queue;constructor(){this.queue=[]}enqueue(e){if(!t.exists(e))throw new Error("The perception cannot be null or undefined.");this.queue.push(e)}dequeue(){const e=this.queue.shift();if(t.exists(e))return e;throw new Error("No perceptions to dequeue.")}peek(){const e=this.queue[0];if(t.exists(e))return e;throw new Error("No perceptions to peek.")}isEmpty(){return 0===this.queue.length}}class F{actions;constructor(){this.actions=new M}sink(e){if(!t.exists(e))throw new Error("The action cannot be null or undefined.");this.actions.enqueue(e)}sinkAll(e){if(!t.allExist(e))throw new Error("The actions cannot be null or undefined.");e.forEach((t=>this.sink(t)))}source(){if(this.actions.isEmpty())throw new Error("No actions to source.");return this.actions.dequeue()}sourceAll(){if(this.actions.isEmpty())throw new Error("No actions to source.");{const t=[];for(;!this.actions.isEmpty();)t.push(this.actions.dequeue());return t}}hasPendingActions(){return!this.actions.isEmpty()}}class U extends F{}class G extends U{sink(e){if(!t.exists(e))throw new Error("The action cannot be null or undefined.");if(e instanceof a)throw new Error("A cleaning agent cannot drop dirt.");super.sink(e)}}class H extends F{}class j{perceptions;constructor(){this.perceptions=new M}sink(e){if(!t.exists(e))throw new Error("The perception cannot be null or undefined.");this.perceptions.enqueue(e)}sinkAll(e){if(!t.allExist(e))throw new Error("The perceptions cannot be null or undefined.");e.forEach((t=>this.sink(t)))}source(){return this.perceptions.isEmpty()?u.empty():u.of(this.perceptions.dequeue())}sourceAll(){if(this.perceptions.isEmpty())return u.empty();{let t=[];for(;!this.perceptions.isEmpty();)t.push(this.perceptions.dequeue());return u.of(t)}}}class z extends j{}class J extends j{}class q extends U{sink(e){if(!t.exists(e))throw new Error("The action cannot be null or undefined.");if(e instanceof s)throw new Error("A user cannot clean dirt.");super.sink(e)}}!function(t){t[t.BASIC=0]="BASIC",t[t.ADVANCED=1]="ADVANCED"}(L||(L={}));class K{observation;messages;cumulativeEffort=0n;mindCoreFilePath;reviseMethod;decideMethod;getLatestObservation(){return this.observation}getLatestMessages(){return this.messages}getMindCoreFilePath(){return this.mindCoreFilePath}setMindCoreFilePath(t){this.mindCoreFilePath=t}getOwnID(){return this.observation.getOwnID()}getOwnColour(){return this.observation.getOwnColour()}getOwnOrientation(){return this.observation.getOwnOrientation()}getOwnCoordinates(){return this.observation.getOwnCoordinates()}perceive(e,i){this.observation=t.validateExistence(e,"The observation cannot be null or undefined."),this.messages=t.validateAllExistence(i,"The messages cannot be null or undefined.")}revise(){t.validateExistence(this.reviseMethod,"The revise method cannot be null or undefined.")()}decide(){return t.validateExistence(this.decideMethod,"The decide method cannot be null or undefined.")()}getCumulativeEffort(){return this.cumulativeEffort}incrementEffort(e){if(!t.exists(e))throw new Error("The effort cannot be null or undefined.");this.cumulativeEffort+=e}static loadFromFile(t){throw new Error("Not yet implemented.")}static import(t){throw new Error("Not yet implemented.")}construct(e,i,o){this.mindCoreFilePath=t.validateExistence(e,"The mind core file path cannot be null or undefined."),this.reviseMethod=t.validateExistence(i,"The revise method cannot be null or undefined."),this.decideMethod=t.validateExistence(o,"The decide method cannot be null or undefined.")}newCore(){let t=new this.constructor;return t.construct(this.mindCoreFilePath,this.reviseMethod,this.decideMethod),t}}class $ extends K{difficultyLevel;constructor(e){super(),this.difficultyLevel=t.exists(e)?e:L.BASIC,this.setMindCoreFilePath("/index.js")}getDifficultyLevel(){return this.difficultyLevel}switchDifficultyLevel(){this.difficultyLevel===L.BASIC?this.difficultyLevel=L.ADVANCED:this.difficultyLevel=L.BASIC}revise(){}decide(){if(this.difficultyLevel===L.BASIC)return this.decideBasic();if(this.difficultyLevel===L.ADVANCED)return this.decideAdvanced();throw new Error("Unknown difficulty level.")}decideBasic(){return this.getLatestObservation().isWallImmediatelyAhead()?this.decideIfWallAheadAndBasic():this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.decideIfOnDirtAndBasic():this.actRandomly(.2,.2,.45,.075,.075)}decideIfWallAheadAndBasic(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?[new h(this.getOwnID(),_.RIGHT)]:this.getLatestObservation().isWallImmediatelyToTheRight()?[new h(this.getOwnID(),_.LEFT)]:this.turnRandomly()}decideIfOnDirtAndBasic(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?this.moveOrTurnRandomly(.6,0,.4):this.getLatestObservation().isWallImmediatelyToTheRight()?this.moveOrTurnRandomly(.6,.4,0):this.moveOrTurnRandomly(.5,.25,.25)}decideAdvanced(){return this.getLatestObservation().isWallImmediatelyAhead()?this.decideIfWallAheadAndAdvanced():this.isActorImmediatelyAhead()?this.decideIfActorAheadAndAdvanced():this.isActorImmediatelyToTheLeft()&&this.isActorImmediatelyToTheRight()?this.dropOrMoveRandomly(.1,.1,.8):this.isActorImmediatelyToTheLeft()&&!this.getLatestObservation().isWallImmediatelyToTheRight()?this.moveOrTurnRandomly(.5,0,.5):this.isActorImmediatelyToTheRight()&&!this.getLatestObservation().isWallImmediatelyToTheLeft()?this.moveOrTurnRandomly(.5,.5,0):this.getLatestObservation().isWallImmediatelyToTheLeft()?this.decideIfWallToTheLeftAndAdvanced():this.getLatestObservation().isWallImmediatelyToTheRight()?this.decideIfWallToTheRightAndAdvanced():this.actRandomly(.15,.15,.6,.05,.05)}decideIfWallAheadAndAdvanced(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?[new h(this.getOwnID(),_.RIGHT)]:this.getLatestObservation().isWallImmediatelyToTheRight()?[new h(this.getOwnID(),_.LEFT)]:this.isActorImmediatelyToTheLeft()&&this.isActorImmediatelyToTheRight()?this.turnRandomly():this.isActorImmediatelyToTheLeft()?[new h(this.getOwnID(),_.RIGHT)]:this.isActorImmediatelyToTheRight()?[new h(this.getOwnID(),_.LEFT)]:this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.turnRandomly():this.actRandomly(.075,.075,.6,0,.25)}decideIfWallToTheLeftAndAdvanced(){return this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.moveOrTurnRandomly(.9,0,.1):this.actRandomly(.075,.075,.6,0,.25)}decideIfWallToTheRightAndAdvanced(){return this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.moveOrTurnRandomly(.9,.1,0):this.actRandomly(.075,.075,.6,.25,0)}decideIfActorAheadAndAdvanced(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?[new h(this.getOwnID(),_.RIGHT)]:this.getLatestObservation().isWallImmediatelyToTheRight()?[new h(this.getOwnID(),_.LEFT)]:this.isActorImmediatelyToTheLeft()&&this.isActorImmediatelyToTheRight()?this.dropRandomDirt():this.isActorImmediatelyToTheLeft()?[new h(this.getOwnID(),_.RIGHT)]:this.isActorImmediatelyToTheRight()?[new h(this.getOwnID(),_.LEFT)]:this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.turnRandomly():this.actRandomly(.25,.25,0,.25,.25)}isActorImmediatelyAhead(){return!this.getLatestObservation().isWallImmediatelyAhead()&&this.getLatestObservation().getCenter().orElseThrow().hasActor()}isActorImmediatelyToTheLeft(){return!this.getLatestObservation().isWallImmediatelyToTheLeft()&&this.getLatestObservation().getLeft().orElseThrow().hasActor()}isActorImmediatelyToTheRight(){return!this.getLatestObservation().isWallImmediatelyToTheRight()&&this.getLatestObservation().getRight().orElseThrow().hasActor()}actRandomly(t,e,i,o,n){$.validateWeights([t,e,i,o,n]);const r=Math.random(),s=(l=0,t=>l+=t);var l;const c=[t,e,i,o,n].map(s);if(r<c[0])return[new a(this.getOwnID(),v.GREEN)];if(r<c[1])return[new a(this.getOwnID(),v.ORANGE)];if(r<c[2])return[new d(this.getOwnID())];if(r<c[3])return[new h(this.getOwnID(),_.LEFT)];if(r<c[4])return[new h(this.getOwnID(),_.RIGHT)];throw new Error("This should never happen.")}static validateWeights(e){if(!t.allExist(e))throw new Error("The weights array cannot be null or undefined, or contain null or undefined values.");if(e.some((t=>t<0)))throw new Error("The weights cannot be negative.");if(e.some((t=>t>1)))throw new Error("The weights cannot be greater than 1.0.");$.validateWeightsSum(e.reduce(((t,e)=>t+e),0))}static validateWeightsSum(t){if(t<1)throw new Error("The weights cannot sum to less than 1.0.");if(t>1)throw new Error("The weights cannot sum to more than 1.0.")}turnRandomly(){return this.actRandomly(0,0,0,.5,.5)}moveOrTurnRandomly(t,e,i){return this.actRandomly(0,0,t,e,i)}dropOrMoveRandomly(t,e,i){return this.actRandomly(t,e,i,0,0)}dropRandomDirt(){return this.actRandomly(.5,.5,0,0,0)}newCore(){return new $(this.difficultyLevel)}}class X extends R{constructor(){super(new $)}}class Y extends K{constructor(){super(),this.construct("/index.js",this.revise,this.decide)}revise(){}decide(){return[new l(this.getOwnID())]}newCore(){return new Y}}class Q{constructor(){}static createVWActorFromJSONObject(e){if(t.exists(e)){if(t.exists(e.colour)){if(e.colour===v.USER)return this.createVWUserFromJSONObject(e);if(Object.values(v).includes(e.colour))return this.createVWCleaningAgentFromJSONObject(e);throw new Error(`The colour of a \`VWActor\` cannot be "${e.colour}".`)}throw new Error("The colour of a `VWActor` cannot be null or undefined.")}throw new Error("The JSON representation of a `VWActor` cannot be null or undefined.")}static createVWCleaningAgentFromJSONObject(e){if(t.exists(e)){if(t.exists(e.colour)){if(e.colour===v.USER)throw new Error(`The colour of a \`VWCleaningAgent\` cannot be "${v.USER}".`);if(Object.values(v).includes(e.colour)){if(t.exists(e.orientation)){if(Object.values(f).includes(e.orientation)){if(t.exists(e.mind)){const t=v[e.colour],i=f[e.orientation],o="hysteretic"===e.mind?new Y:K.loadFromFile(e.mind),n=new W(o),r=new J,s=new z,a=new G,l=new H;return new P(t,i,n,r,s,a,l)}throw new Error("The path of the mind of a `VWCleaningAgent` cannot be null or undefined.")}throw new Error(`The orientation of a \`VWCleaningAgent\` cannot be "${e.orientation}".`)}throw new Error("The orientation of a `VWCleaningAgent` cannot be null or undefined.")}throw new Error(`The colour of a \`VWCleaningAgent\` cannot be "${e.colour}".`)}throw new Error("The colour of a `VWCleaningAgent` cannot be null or undefined.")}throw new Error("The JSON representation of a `VWCleaningAgent` cannot be null or undefined.")}static createVWUserFromJSONObject(e){if(t.exists(e)){if(t.exists(e.colour)){if(e.colour!==v.USER)throw new Error(`The colour of a \`VWUser\` must be "${v.USER}".`);if(t.exists(e.orientation)){if(Object.values(f).includes(e.orientation)){const t=f[e.orientation],i=new X,o=new J,n=new q;return new V(t,i,o,n)}throw new Error(`The orientation of a \`VWUser\` cannot be "${e.orientation}".`)}throw new Error("The orientation of a `VWUser` cannot be null or undefined.")}throw new Error("The colour of a `VWUser` cannot be null or undefined.")}throw new Error("The JSON representation of a `VWUser` cannot be null or undefined.")}static createVWActorFacingNorth(e,i){if(t.exists(e)){if(e===v.USER)return this.createVWUserFacingNorth();if(Object.values(v).includes(e))return this.createVWCleaningAgentFacingNorth(e,i);throw new Error(`The colour of a \`VWActor\` cannot be "${e}".`)}throw new Error("The colour of a `VWActor` cannot be null or undefined.")}static createVWCleaningAgentFacingNorth(e,i){if(t.exists(e)){if(e===v.USER)throw new Error(`The colour of a \`VWCleaningAgent\` cannot be "${v.USER}".`);if(Object.values(v).includes(e)){if(null==i)throw new Error("The simulation options cannot be null or undefined.");{const o=f.NORTH,n=t.exists(i.getTeleora())?K.import(i.getTeleora()):new Y,r=new W(n),s=new J,a=new z,l=new G,d=new H;return new P(e,o,r,s,a,l,d)}}throw new Error(`The colour of a \`VWCleaningAgent\` cannot be "${e}".`)}throw new Error("The colour of a `VWCleaningAgent` cannot be null or undefined.")}static createVWUserFacingNorth(){const t=f.NORTH,e=new X,i=new J,o=new q;return new V(t,e,i,o)}}class Z{coord;actorAppearance;dirtAppearance;wall;constructor(e,i,o,n){this.coord=t.validateExistence(e,"The coordinates cannot be null or undefined."),this.wall=Z.validateWall(i),this.actorAppearance=u.ofNullable(o),this.dirtAppearance=u.ofNullable(n)}static validateWall(e){if(t.exists(e)){if(4!==e.size)throw new Error("The wall must have 4 sides.");if(e.has(f.NORTH)&&e.has(f.EAST)&&e.has(f.SOUTH)&&e.has(f.WEST))return e;throw new Error("The wall must have 4 sides.")}throw new Error("The wall cannot be null or undefined.")}getID(){return this.coord.toString()}getCoord(){return this.coord}hasActor(){return this.actorAppearance.isPresent()}hasCleaningAgent(){return this.actorAppearance.isPresent()&&this.actorAppearance.orElseThrow().getColour()!==v.USER}hasUser(){return this.actorAppearance.isPresent()&&this.actorAppearance.orElseThrow().getColour()===v.USER}getActorAppearance(){return this.actorAppearance}hasDirt(){return this.dirtAppearance.isPresent()}getDirtAppearance(){return this.dirtAppearance}getWall(){return this.wall}hasWallOn(t){return this.wall.get(t)}hasWallOnNorth(){return this.hasWallOn(f.NORTH)}hasWallOnEast(){return this.hasWallOn(f.EAST)}hasWallOnSouth(){return this.hasWallOn(f.SOUTH)}hasWallOnWest(){return this.hasWallOn(f.WEST)}}class tt{coord;actor;dirt;wall;constructor(e,i,o,n){this.coord=t.validateExistence(e,"The coordinates cannot be null or undefined."),this.wall=tt.validateWall(i),this.actor=u.ofNullable(o),this.dirt=u.ofNullable(n)}static validateWall(e){if(t.exists(e)){if(4!==e.size)throw new Error("The wall must have 4 sides.");if(e.has(f.NORTH)&&e.has(f.EAST)&&e.has(f.SOUTH)&&e.has(f.WEST))return e;throw new Error("The wall must have 4 sides.")}throw new Error("The wall cannot be null or undefined.")}hasActor(){return this.actor.isPresent()}hasCleaningAgent(){return this.actor.isPresent()&&this.actor.orElseThrow().getAppearance().getColour()!==v.USER}hasUser(){return this.actor.isPresent()&&this.actor.orElseThrow().getAppearance().getColour()===v.USER}getActor(){return this.actor}addActor(e){if(this.hasActor())throw new Error("There is already an actor in this location.");if(!t.exists(e))throw new Error("The actor cannot be null or undefined.");this.actor=u.of(e)}removeActor(){if(!this.hasActor())throw new Error("There is no actor in this location.");this.actor=u.empty()}removeActorIfPresent(){this.hasActor()&&this.removeActor()}popActor(){const t=this.getActor();return t.isPresent()&&this.removeActor(),t}hasDirt(){return this.dirt.isPresent()}getDirt(){return this.dirt}addDirt(e){if(this.hasDirt())throw new Error("There is already a dirt in this location.");if(!t.exists(e))throw new Error("The dirt cannot be null or undefined.");this.dirt=u.of(e)}removeDirt(){if(!this.hasDirt())throw new Error("There is no dirt in this location.");this.dirt=u.empty()}removeDirtIfPresent(){this.hasDirt()&&this.removeDirt()}getCoord(){return this.coord}getWall(){return this.wall}hasWallOn(t){return this.wall.get(t)}hasWallOnNorth(){return this.hasWallOn(f.NORTH)}hasWallOnEast(){return this.hasWallOn(f.EAST)}hasWallOnSouth(){return this.hasWallOn(f.SOUTH)}hasWallOnWest(){return this.hasWallOn(f.WEST)}getAppearance(){return this.hasActor()&&this.hasDirt()?new Z(this.coord,this.wall,this.getActor().orElseThrow().getAppearance(),this.getDirt().orElseThrow().getAppearance()):this.hasActor()?new Z(this.coord,this.wall,this.getActor().orElseThrow().getAppearance(),void 0):this.hasDirt()?new Z(this.coord,this.wall,void 0,this.getDirt().orElseThrow().getAppearance()):new Z(this.coord,this.wall)}toJsonObject(t){const e={coord:this.coord.toJsonObject(),wall:{north:this.hasWallOnNorth(),east:this.hasWallOnEast(),south:this.hasWallOnSouth(),west:this.hasWallOnWest()}};return this.hasActor()&&(e.actor=this.getActor().orElseThrow().toJsonObject(t)),this.hasDirt()&&(e.dirt=this.getDirt().orElseThrow().toJsonObject()),e}static fromJsonObject(e){if(t.exists(e)){if(t.exists(e.wall)){if(t.exists(e.coord))return tt.fromJsonObjectHelper(m.fromJsonObject(e.coord),e.wall,e.actor,e.dirt);throw new Error("The JSON representation of a `VWLocation` must have a `coord` property.")}throw new Error("The JSON representation of a `VWLocation` must have a `wall` property.")}throw new Error("The JSON representation of a `VWLocation` cannot be null or undefined.")}static fromJsonObjectHelper(e,i,o,n){const r=tt.constructWallFromData(i),s=t.exists(o)?u.of(Q.createVWActorFromJSONObject(o)):u.empty(),a=t.exists(n)?u.of(S.fromJsonObject(n)):u.empty();return s.isPresent()&&a.isPresent()?new tt(e,r,s.orElseThrow(),a.orElseThrow()):s.isPresent()?new tt(e,r,s.orElseThrow(),void 0):a.isPresent()?new tt(e,r,void 0,a.orElseThrow()):new tt(e,r)}static constructWallFromData(e){const i=new Map;if(t.exists(e)){if(t.exists(e.north)){if(t.exists(e.east)){if(t.exists(e.south)){if(t.exists(e.west))return i.set(f.NORTH,e.north),i.set(f.EAST,e.east),i.set(f.SOUTH,e.south),i.set(f.WEST,e.west),i;throw new Error("The wall must have a `west` property.")}throw new Error("The wall must have a `south` property.")}throw new Error("The wall must have an `east` property.")}throw new Error("The wall must have a `north` property.")}throw new Error("The wall cannot be null or undefined.")}static generateWallFromCoordAndGridSize(t,e){const i=new Map;return i.set(f.NORTH,0n===t.getY()),i.set(f.EAST,t.getX()===BigInt(e)-1n),i.set(f.SOUTH,t.getY()===BigInt(e)-1n),i.set(f.WEST,0n===t.getX()),i}}class et{actorColourBeforeAction;actorOrientationBeforeAction;actorCoordBeforeAction;dirtBeforeAction;getActorColourBeforeAction(){return this.actorColourBeforeAction}setActorColourBeforeAction(e){if(!t.exists(e))throw new Error("The actor colour cannot be null or undefined.");this.actorColourBeforeAction=e}getActorOrientationBeforeAction(){return this.actorOrientationBeforeAction}setActorOrientationBeforeAction(e){if(!t.exists(e))throw new Error("The actor orientation cannot be null or undefined.");this.actorOrientationBeforeAction=e}getActorCoordBeforeAction(){return this.actorCoordBeforeAction}setActorCoordBeforeAction(e){if(!t.exists(e))throw new Error("The actor coord cannot be null or undefined.");this.actorCoordBeforeAction=e}getDirtBeforeAction(){return this.dirtBeforeAction}setDirtBeforeAction(e){if(!t.exists(e))throw new Error("The dirt cannot be null or undefined.");this.dirtBeforeAction=e}attempt(e,i){if(t.exists(e)){if(t.exists(i)){if(this.isPossible(e,i)){this.setActorColourBeforeAction(i.getActorByID(e.getActorID()).orElseThrow().getColour()),this.setActorOrientationBeforeAction(i.getActorByID(e.getActorID()).orElseThrow().getOrientation()),this.setActorCoordBeforeAction(i.getActorCoordByID(e.getActorID()).orElseThrow()),this.setDirtBeforeAction(i.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getDirt());const t=this.perform(e,i);return this.succeeded(e,i)?t:new w(g.FAILURE,e)}return new w(g.IMPOSSIBLE,e)}throw new Error("The environment cannot be null or undefined.")}throw new Error("The action cannot be null or undefined.")}static isActorInEnv(t,e){return e.getActorByID(t).isPresent()}checkAllInvariants(t,e){return et.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkOrientationAfterAction(t,e)&&this.checkCoordAfterAction(t,e)&&this.checkDirtAfterAction(e)}checkColourAfterAction(t,e){return this.getActorColourBeforeAction()===e.getActorByID(t.getActorID()).orElseThrow().getColour()}checkOrientationAfterAction(t,e){return this.getActorOrientationBeforeAction()===e.getActorByID(t.getActorID()).orElseThrow().getOrientation()}checkCoordAfterAction(t,e){return this.getActorCoordBeforeAction().equals(e.getActorCoordByID(t.getActorID()).orElseThrow())}checkDirtAfterAction(t){return this.getDirtBeforeAction().equals(t.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getDirt())}}class it extends et{isPossible(t,e){try{return et.isActorInEnv(t.getActorID(),e)&&e.getActorByID(t.getActorID()).orElseThrow().getCommunicativeActuator().isPresent()}catch(t){return!1}}perform(t,e){try{return e.sendMessageToRecipients(t)?new w(g.SUCCESS,t):new w(g.FAILURE,t)}catch(e){return new w(g.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)}catch(t){return!1}}checkInvariants(t,e){return this.checkAllInvariants(t,e)}}class ot extends et{isPossible(t,e){try{return et.isActorInEnv(t.getActorID(),e)&&ot.isActorCleaningAgent(t,e)&&ot.actorLocationHasCompatibleDirt(t,e)}catch(t){return!1}}static isActorCleaningAgent(t,e){const i=e.getActorByID(t.getActorID()).orElseThrow().getColour();return Object.values(v).includes(i)&&i!==v.USER}static actorLocationHasCompatibleDirt(t,e){const i=e.getActorCoordByID(t.getActorID()),o=e.getActorByID(t.getActorID()).orElseThrow().getColour();return i.isPresent()&&e.getLocation(i.orElseThrow()).orElseThrow().hasDirt()&&ot.canClean(o,i,e)}static canClean(t,e,i){return t===v.WHITE||t===i.getLocation(e.orElseThrow()).orElseThrow().getDirt().orElseThrow().getColour()}perform(t,e){try{return e.cleanDirtByCoord(this.getActorCoordBeforeAction()),new w(g.SUCCESS,t)}catch(t){return new w(g.FAILURE,t.message)}}succeeded(t,e){try{return this.checkInvariants(t,e)&&this.checkDirtRemoved(e)}catch(t){return!1}}checkInvariants(t,e){return et.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkOrientationAfterAction(t,e)&&this.checkCoordAfterAction(t,e)}checkDirtRemoved(t){return!t.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasDirt()}}class nt extends et{isPossible(t,e){try{return et.isActorInEnv(t.getActorID(),e)&&nt.isActorUser(t,e)&&nt.actorLocationHasNoDirt(t,e)}catch(t){return!1}}static isActorUser(t,e){return e.getActorByID(t.getActorID()).orElseThrow().getColour()===v.USER}static actorLocationHasNoDirt(t,e){const i=e.getActorCoordByID(t.getActorID());return i.isPresent()&&!e.getLocation(i.orElseThrow()).orElseThrow().hasDirt()}perform(t,e){try{return e.addDirtToLocation(this.getActorCoordBeforeAction(),new S(t.getColour())),new w(g.SUCCESS,t)}catch(e){return new w(g.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)&&this.checkDirtAdded(t,e)}catch(t){return!1}}checkInvariants(t,e){return et.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkOrientationAfterAction(t,e)&&this.checkCoordAfterAction(t,e)}checkDirtAdded(t,e){return e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasDirt()&&e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getDirt().orElseThrow().getColour()===t.getColour()}}class rt extends et{isPossible(t,e){try{return et.isActorInEnv(t.getActorID(),e)}catch(t){return!1}}perform(t,e){try{return new w(g.SUCCESS,t)}catch(e){return new w(g.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)}catch(t){return!1}}checkInvariants(t,e){return this.checkAllInvariants(t,e)}}class st extends et{isPossible(t,e){try{return et.isActorInEnv(t.getActorID(),e)&&st.targetExists(t,e)&&st.targetHasNoActor(t,e)}catch(t){return!1}}static targetExists(t,e){const i=e.getActorCoordByID(t.getActorID()),o=e.getActorByID(t.getActorID()).orElseThrow().getOrientation();return i.isPresent()&&!e.getLocation(i.orElseThrow()).orElseThrow().hasWallOn(o)}static targetHasNoActor(t,e){try{const i=e.getActorCoordByID(t.getActorID()).orElseThrow(),o=e.getActorByID(t.getActorID()).orElseThrow().getOrientation();if(e.getLocation(i).orElseThrow().hasWallOn(o))return!1;{const t=i.getForwardCoord(o);return e.getLocation(t).isPresent()&&!e.getLocation(t).orElseThrow().hasActor()}}catch(t){return!1}}perform(t,e){try{const i=this.getActorCoordBeforeAction().getForwardCoord(this.getActorOrientationBeforeAction());return e.getLocation(i).isPresent()?(e.moveActor(this.getActorCoordBeforeAction(),i),new w(g.SUCCESS,t)):new w(g.FAILURE,t)}catch(e){return new w(g.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)&&this.checkOriginalLocation(t,e)&&st.checkTargetLocation(t,e)}catch(t){return!1}}checkInvariants(t,e){return et.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkOrientationAfterAction(t,e)&&this.checkDirtAfterAction(e)}checkOriginalLocation(t,e){return this.noActorInOriginalLocation(e)||this.differentActorInOriginalLocation(t.getActorID(),e)}noActorInOriginalLocation(t){return!t.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasActor()}differentActorInOriginalLocation(t,e){return e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasActor()&&e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getActor().orElseThrow().getID()!==t}static checkTargetLocation(t,e){const i=e.getActorCoordByID(t.getActorID());return i.isPresent()&&e.getLocation(i.orElseThrow()).orElseThrow().hasActor()&&e.getLocation(i.orElseThrow()).orElseThrow().getActor().orElseThrow().getID()===t.getActorID()}}class at extends et{isPossible(t,e){try{return et.isActorInEnv(t.getActorID(),e)&&e.getActorByID(t.getActorID()).orElseThrow().getCommunicativeActuator().isPresent()}catch(t){return!1}}perform(t,e){try{return e.sendMessageToRecipients(t)?new w(g.SUCCESS,t):new w(g.FAILURE,t)}catch(e){return new w(g.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)}catch(t){return!1}}checkInvariants(t,e){return this.checkAllInvariants(t,e)}}class lt extends et{isPossible(t,e){try{return et.isActorInEnv(t.getActorID(),e)}catch(t){return!1}}perform(t,e){try{return e.turnActor(this.getActorCoordBeforeAction(),t.getTurningDirection()),new w(g.SUCCESS,t)}catch(e){return new w(g.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)&&this.checkOrientationAfterTurn(t,e)}catch(t){return!1}}checkInvariants(t,e){return et.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkCoordAfterAction(t,e)&&this.checkDirtAfterAction(e)}checkOrientationAfterTurn(t,e){const i=e.getActorByID(t.getActorID()).orElseThrow().getOrientation();return t.getTurningDirection()===_.LEFT?i===y.getLeft(this.getActorOrientationBeforeAction()):t.getTurningDirection()===_.RIGHT&&i===y.getRight(this.getActorOrientationBeforeAction())}}class dt{ambient;cycleNumber;constructor(e){this.ambient=t.validateExistence(e,"The ambient cannot be null or undefined."),this.cycleNumber=0}getAmbient(){return this.ambient}getCycleNumber(){return this.cycleNumber}resetCycleNumber(){this.cycleNumber=0}getGridSize(){return this.ambient.getGridSize()}getLocation(t){return this.ambient.getLocation(t)}getActorsIDs(){return this.ambient.getActorsIDs()}getActorsIDsExcept(t){return this.ambient.getActorsIDsExcept(t)}getActorByID(t){return this.ambient.getActorByID(t)}getActorByCoord(t){return this.ambient.getActorByCoord(t)}getActorCoordByID(t){return this.ambient.getActorCoordByID(t)}addActorToLocation(t,e){this.ambient.addActorToLocation(t,e)}moveActor(t,e){this.ambient.moveActor(t,e)}turnActor(t,e){this.ambient.turnActor(t,e)}getDirtsIDs(){return this.ambient.getDirtsIDs()}getDirtByID(t){return this.ambient.getDirtByID(t)}getDirtByCoord(t){return this.ambient.getDirtByCoord(t)}getDirtCoordByID(t){return this.ambient.getDirtCoordByID(t)}cleanDirtByCoord(t){this.ambient.cleanDirtByCoord(t)}addDirtToLocation(t,e){this.ambient.addDirtToLocation(t,e)}cycle(){console.log("Start of cycle #"+this.cycleNumber+"..."),0===this.cycleNumber&&this.forceInitialPerceptionToActors(),this.ambient.getActors().forEach((t=>this.cycleActor(t))),console.log("Environment after the actions: "),console.log(this.toJsonObject()),console.log(JSON.stringify(this.toJsonObject(),null,4)),console.log("End of cycle #"+this.cycleNumber+"..."),this.cycleNumber++}forceInitialPerceptionToActors(){this.ambient.getActors().forEach((t=>this.forceInitialPerceptionToActor(t)))}forceInitialPerceptionToActor(t){const e=new w(g.IMPOSSIBLE,new l(t.getID()));this.sendResultToActor(e,!1)}cycleActor(t){t.cycle(),this.executeActorActions(t)}executeActorActions(t){const e=[];t.getPhysicalActuator().orElseThrow().hasPendingActions()&&t.getPhysicalActuator().orElseThrow().sourceAll().forEach((t=>e.push(t))),t.getCommunicativeActuator().isPresent()&&t.getCommunicativeActuator().orElseThrow().hasPendingActions()&&t.getCommunicativeActuator().orElseThrow().sourceAll().forEach((t=>e.push(t))),D.validateActions(e),e.forEach((t=>this.executeAction(t)))}executeAction(t){dt.getExecutorFor(t).ifPresentOrElse((e=>{const i=e.attempt(t,this);this.sendResultToActor(i,!0)}),(()=>{throw new Error("No executor found for the action "+t+".")}))}static getExecutorFor(t){return t instanceof l?u.of(new rt):t instanceof d?u.of(new st):t instanceof h?u.of(new lt):t instanceof s?u.of(new ot):t instanceof a?u.of(new nt):t instanceof c?u.of(new at):t instanceof n?u.of(new it):u.empty()}sendResultToActor(t,e){const i=new Map,o=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow(),n=this.getActorByCoord(o).orElseThrow().getOrientation(),r=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getForwardCoord(n),s=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getLeftCoord(n),a=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getRightCoord(n),l=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getForwardLeftCoord(n),d=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getForwardRightCoord(n);this.ambient.getGrid().containsKey(o)&&i.set(p.CENTER,this.ambient.getGrid().get(o).getAppearance()),this.ambient.getGrid().containsKey(r)&&i.set(p.FORWARD,this.ambient.getGrid().get(r).getAppearance()),this.ambient.getGrid().containsKey(s)&&i.set(p.LEFT,this.ambient.getGrid().get(s).getAppearance()),this.ambient.getGrid().containsKey(a)&&i.set(p.RIGHT,this.ambient.getGrid().get(a).getAppearance()),this.ambient.getGrid().containsKey(l)&&i.set(p.FORWARDLEFT,this.ambient.getGrid().get(l).getAppearance()),this.ambient.getGrid().containsKey(d)&&i.set(p.FORWARDRIGHT,this.ambient.getGrid().get(d).getAppearance());const c=new C(i,[t]);this.getActorByCoord(o).orElseThrow().getObservationSensor().ifPresent((t=>t.sink(c))),this.getActorByCoord(o).orElseThrow().getMind().getMindCore().incrementEffort(e?t.getAction().getEffort():0n)}sendMessageToRecipients(t){try{return(t.getRecipientsIDs().length>0?t.getRecipientsIDs():this.getActorsIDsExcept(t.getActorID())).forEach((e=>this.sendMessageToRecipient(t,e))),!0}catch(t){return!1}}sendMessageToRecipient(t,e){this.getActorByID(e).ifPresent((i=>i.getListeningSensor().ifPresent((i=>i.sink(new T(t.getContent(),t.getActorID(),e))))))}toJsonObject(){return{locations:this.serialiseLocations()}}serialiseLocations(){let t=[];for(let e of this.ambient.getGrid().getValues())t.push(this.serialiseLocation(e));return t}serialiseLocation(e){if(t.exists(e)){if(e.hasActor()){const t=this.getActorMindCorePath(e.getActor().orElseThrow().getMind().getMindCore());return e.toJsonObject(t)}return e.toJsonObject()}throw new Error("The location cannot be null or undefined.")}getActorMindCorePath(t){return t.getMindCoreFilePath()}static newEnvironment(e,i,o){return t.validateExistence(e,"The options cannot be null or undefined."),t.exists(e.getStateToLoad())?dt.fromJsonObject(o,i):dt.newEmptyVWEnvironment(i)}static fromJsonObject(e,i){if(t.exists(e)){if(t.exists(e.locations)){if(Array.isArray(e.locations)){if(t.allExist(e.locations)){if(t.exists(i))return dt.fromJsonObjectHelper(e,i);throw new Error("The config cannot be null or undefined.")}throw new Error("The 'locations' array cannot contain null or undefined values.")}throw new Error("The 'locations' property must be an array.")}throw new Error("The state to load must contain a 'locations' property.")}throw new Error("The state to load cannot be null or undefined.")}static fromJsonObjectHelper(t,e){const i=dt.loadLocations(t.locations);return dt.validateGrid(i,e),new dt(new x(i))}static loadLocations(e){const i=new b;for(const o of e){if(!t.exists(o.coord))throw new Error("The location coordinates cannot be null or undefined.");i.put(m.fromJsonObject(o.coord),tt.fromJsonObject(o))}return i}static validateGrid(e,i){if(!t.exists(e))throw new Error("The grid cannot be null or undefined.");if(!t.exists(i))throw new Error("The config cannot be null or undefined.");if(!t.exists(i.min_environment_dim))throw new Error("The config must contain a 'min_environment_dim' property.");if(!t.exists(i.max_environment_dim))throw new Error("The config must contain a 'max_environment_dim' property.");dt.validateGridHelper(e,i)}static validateGridHelper(t,e){const i=Math.sqrt(t.size());dt.validateGridSize(i,e)}static validateGridSize(t,e){if(t!==Math.floor(t))throw new Error("The grid must be a square.");if(t<e.min_environment_dim)throw new Error(`The grid size is too small (min: "${e.min_environment_dim}").`);if(t>e.max_environment_dim)throw new Error(`The grid size is too big (max: "${e.max_environment_dim}").`)}static newEmptyVWEnvironment(e,i){if(t.exists(e))return dt.newEmptyVWEnvironmentHelper(e,i);throw new Error("The config cannot be null or undefined.")}static newEmptyVWEnvironmentHelper(e,i){const o=t.exists(i)?i:BigInt(e.initial_environment_dim);dt.validateGridSize(Number(o),e);const n=new b;for(let t=0n;t<o;t++)for(let e=0n;e<o;e++){const i=new m(t,e);n.put(i,new tt(i,tt.generateWallFromCoordAndGridSize(i,o)))}return new dt(new x(n))}resetAndMaintainElements(){this.ambient.getActors().forEach((t=>t.reset())),this.cycleNumber=0}}class ct{constructor(){}static displayError(t){document.getElementById("error_div").innerText=t,document.getElementById("error_div").removeAttribute("hidden"),document.getElementById("error_div").addEventListener("click",(()=>ct.hideError()))}static hideError(){document.getElementById("error_div").innerText="",document.getElementById("error_div").hidden=!0}}class ht{speed;autoplay;stateToLoad;tooltipsActive;maxNumberOfCycles;efforts;teleora;constructor(){this.setDefaultOptions()}setDefaultOptions(){this.speed=0,this.autoplay=!1,this.stateToLoad=void 0,this.tooltipsActive=!0,this.maxNumberOfCycles=void 0,this.efforts=new Map,this.teleora=void 0}getSpeed(){return this.speed}setSpeed(t){this.speed=t}isAutoplayActive(){return this.autoplay}activateAutoplay(){this.autoplay=!0}deactivateAutoplay(){this.autoplay=!1}getStateToLoad(){return this.stateToLoad}setStateToLoad(t){this.stateToLoad=t}areTooltipsActive(){return this.tooltipsActive}activateTooltips(){this.tooltipsActive=!0}deactivateTooltips(){this.tooltipsActive=!1}getMaxNumberOfCycles(){return this.maxNumberOfCycles}setMaxNumberOfCycles(t){this.maxNumberOfCycles=t}getEfforts(){return this.efforts}setEfforts(e){this.efforts=t.validateExistence(e)}setEffort(t,e){this.efforts.set(t,e)}getTeleora(){return this.teleora}setTeleora(t){this.teleora=t}}class ut{div;img;packed;constructor(e){if(!t.exists(e))throw new Error("The path of the initial view image cannot be null or undefined.");this.div=document.createElement("div"),this.div.id="initial_view_div",this.div.hidden=!0,this.img=document.createElement("img"),this.img.id="initial_view_img",this.img.src=e,this.packed=!1}pack(){if(this.packed)console.log("The initial view div is already packed.");else{if(!t.exists(this.div))throw new Error("Cannot pack: the initial view div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot pack: the initial view div is not hidden (it must be before packing it).");if(!t.exists(this.img))throw new Error("Cannot pack: the image is null or undefined.");this.div.appendChild(this.img),this.packed=!0}}unpack(){if(this.packed){if(!t.exists(this.div))throw new Error("Cannot unpack: the initial view div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot unpack: the initial view div is not hidden (it must be before unpacking it).");if(!t.exists(this.img))throw new Error("Cannot unpack: the image is null or undefined.");this.div.removeChild(this.img),this.packed=!1}else console.log("The initial view div is already unpacked.")}show(){if(!t.exists(this.div))throw new Error("Cannot show: the initial view div is null or undefined.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the initial view div is not packed.");this.div.hidden=!1}else console.log("The initial view div is already shown.")}hide(){if(!t.exists(this.div))throw new Error("Cannot hide: the initial view div is null or undefined.");if(this.div.hidden)console.log("The initial view div is already hidden.");else{if(!this.packed)throw new Error("Cannot hide: the initial view div is not packed.");this.div.hidden=!0}}getDiv(){return t.validateExistence(this.div,"Cannot get the initial view div: the div is null or undefined.")}}class gt{callback;button;constructor(e,i,o,n){if(!t.exists(e))throw new Error("The text of the button cannot be null or undefined.");if(!t.exists(i))throw new Error("The id of the button cannot be null or undefined.");if(!t.exists(o))throw new Error("The callback of the button cannot be null or undefined.");this.callback=o,this.button=document.createElement("button"),this.button.id=i,this.button.innerHTML=e,this.button.addEventListener("click",this.callback),this.addClasses(n)}addClasses(e){t.allExist(e)&&e.forEach((t=>this.button.classList.add(t)))}getButton(){return this.button}}class ft{div;startButton;optionsButton;guideButton;packed;constructor(e,i,o){if(!t.exists(e))throw new Error("The start callback cannot be null or undefined.");if(!t.exists(i))throw new Error("The options callback cannot be null or undefined.");if(!t.exists(o))throw new Error("The guide callback cannot be null or undefined.");this.div=document.createElement("div"),this.div.id="initial_view_buttons_div",this.div.hidden=!0,this.startButton=new gt("Start","start_button",e.bind(this),["initial_buttons"]),this.optionsButton=new gt("Options","options_button",i.bind(this),["initial_buttons"]),this.guideButton=new gt("Guide","guide_button",o.bind(this),["initial_buttons"]),this.packed=!1}pack(){if(this.packed)console.log("The initial view buttons div is already packed.");else{if(!t.exists(this.div))throw new Error("Cannot pack: the initial view buttons div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot pack: the initial view buttons div is not hidden (it must be before packing it).");if(!t.exists(this.startButton))throw new Error("Cannot pack: the start button is null or undefined.");if(!t.exists(this.guideButton))throw new Error("Cannot pack: the guide button is null or undefined.");if(!t.exists(this.optionsButton))throw new Error("Cannot pack: the options button is null or undefined.");this.div.appendChild(this.startButton.getButton()),this.div.appendChild(this.optionsButton.getButton()),this.div.appendChild(this.guideButton.getButton()),this.packed=!0}}unpack(){if(this.packed){if(!t.exists(this.div))throw new Error("Cannot unpack: the initial view buttons div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot unpack: the initial view buttons div is not hidden (it must be before unpacking it).");if(!t.exists(this.startButton))throw new Error("Cannot unpack: the start button is null or undefined.");if(!t.exists(this.guideButton))throw new Error("Cannot unpack: the guide button is null or undefined.");if(!t.exists(this.optionsButton))throw new Error("Cannot unpack: the options button is null or undefined.");this.div.removeChild(this.startButton.getButton()),this.div.removeChild(this.guideButton.getButton()),this.div.removeChild(this.optionsButton.getButton()),this.packed=!1}else console.log("The initial view buttons div is already unpacked.")}show(){if(!t.exists(this.div))throw new Error("Cannot show: the initial view buttons div is null or undefined.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the initial view buttons div is not packed.");this.div.hidden=!1}else console.log("The initial view buttons div is already shown.")}hide(){if(!t.exists(this.div))throw new Error("Cannot hide: the initial view buttons div is null or undefined.");if(this.div.hidden)console.log("The initial view buttons div is already hidden.");else{if(!this.packed)throw new Error("Cannot hide: the initial buttons view div is not packed.");this.div.hidden=!0}}getDiv(){return t.validateExistence(this.div,"Cannot get the initial view buttons div: the div is null or undefined.")}}class pt{constructor(){}static createDivWithLabel(t,e,i){let o=document.createElement("div");o.id=t;let n=pt.createLabel(e,i);return o.appendChild(n),o}static createLabel(t,e){let i=document.createElement("label");return i.htmlFor=t,i.innerText=e,i}static createCheckbox(e,i){let o=document.createElement("input");return o.type="checkbox",o.id=e,o.checked=!!t.exists(i)&&i,o}static createFileInput(e,i){let o=document.createElement("input");return o.type="file",o.id=e,o.accept=t.exists(i)?i:"",o}static createNumberInputsDivs(t,e,i){let o=[];return t.forEach((t=>{const n=t.toLowerCase()+i,r=t.toLowerCase()+e;let s=pt.createNumberInput(n),a=pt.createDivWithLabel(r,n,t);a.appendChild(s),o.push(a)})),o}static createNumberInput(e,i,o,n,r){let s=document.createElement("input");return s.type="number",s.id=e,s.min=t.exists(i)?i.toString():"",s.max=t.exists(o)?o.toString():"",s.step=t.exists(n)?n.toString():"",s.value=t.exists(r)?r.toString():"",s}static createOptionElement(t,e,i){let o=document.createElement("option");return o.id=t,o.value=e,o.textContent=i,o}static createSelectElement(e,i,o){let n=document.createElement("select");return n.id=e,i.forEach((e=>{const i=t.exists(o)?o+e:e;let r=pt.createOptionElement(i,e,e);n.appendChild(r)})),n}}class vt{dialog;speedSelectorDiv;autoplaySelectorDiv;stateToLoadSelectorDiv;stateToLoadInputCallback;tooltipsSelectorDiv;maxNumberOfCyclesSelectorDiv;effortsSelectorDiv;teleoraSelectorDiv;teleoraInputCallback;okButton;okButtonCallback;cancelButton;cancelButtonCallback;packed;constructor(t,e,i,o){this.dialog=document.createElement("dialog"),this.dialog.id="options_dialog",this.okButtonCallback=t,this.cancelButtonCallback=e,this.stateToLoadInputCallback=i,this.teleoraInputCallback=o,this.constructOptionsDialog(),this.packed=!1}constructSpeedSelectorDiv(){this.speedSelectorDiv=pt.createDivWithLabel("speed_selector_div","speed_selector","Speed:");let t=pt.createSelectElement("speed_values",this.generateSpeedValues(),"speed_value_");this.speedSelectorDiv.appendChild(t)}generateSpeedValues(){let t=[];for(let e=0;e<1e3;e++){const i=e/1e3;t.push(i.toString())}return t}constructAutoplayCheckboxDiv(){this.autoplaySelectorDiv=pt.createDivWithLabel("autoplay_checkbox_div","autoplay_checkbox","Autoplay:");let t=pt.createCheckbox("autoplay_checkbox");this.autoplaySelectorDiv.appendChild(t)}constructStateToLoadSelectorDiv(){this.stateToLoadSelectorDiv=pt.createDivWithLabel("state_to_load_input_div","state_to_load_upload_input","State:");let t=pt.createFileInput("state_to_load_upload_input",".json");t.addEventListener("change",this.stateToLoadInputCallback),this.stateToLoadSelectorDiv.appendChild(t)}constructTooltipsCheckboxDiv(){this.tooltipsSelectorDiv=pt.createDivWithLabel("tooltips_checkbox_div","tooltips_checkbox","Tooltips:");let t=pt.createCheckbox("tooltips_checkbox");this.tooltipsSelectorDiv.appendChild(t)}constructMaxNumberOfCyclesSelectorDiv(){this.maxNumberOfCyclesSelectorDiv=pt.createDivWithLabel("max_number_of_cycles_input_div","max_number_of_cycles_input","Cycles:");let t=pt.createNumberInput("max_number_of_cycles_input");this.maxNumberOfCyclesSelectorDiv.appendChild(t)}constructEffortsSelectorDiv(){this.effortsSelectorDiv=pt.createDivWithLabel("efforts_inputs_div","efforts_selector","Efforts:"),pt.createNumberInputsDivs(vt.getActionNames(),"_effort_div","_effort_input").forEach((t=>this.effortsSelectorDiv.appendChild(t)))}static getActionNames(){return["VWIdleAction","VWMoveAction","VWTurnAction","VWCleanAction","VWDropDirtAction","VWSpeakAction","VWBroadcastAction"]}constructTeleoraSelectorDiv(){this.teleoraSelectorDiv=pt.createDivWithLabel("teleora_input_div","teleora_selector","Teleora mind core:");let t=pt.createFileInput("teleora_upload_input",".tel");t.addEventListener("change",this.teleoraInputCallback),this.teleoraSelectorDiv.appendChild(t)}constructOkButton(){this.okButton=new gt("OK","options_dialog_ok_button",this.okButtonCallback.bind(this))}constructCancelButton(){this.cancelButton=new gt("Cancel","options_dialog_cancel_button",this.cancelButtonCallback.bind(this))}pack(){if(this.packed)console.log("The options dialog is already packed.");else{if(!t.exists(this.dialog))throw new Error("Cannot pack the options dialog: the dialog is null or undefined.");if(!t.exists(this.speedSelectorDiv))throw new Error("Cannot pack the options dialog: the speed selector div is null or undefined.");if(!t.exists(this.autoplaySelectorDiv))throw new Error("Cannot pack the options dialog: the autoplay selector div is null or undefined.");if(!t.exists(this.stateToLoadSelectorDiv))throw new Error("Cannot pack the options dialog: the state to load selector div is null or undefined.");if(!t.exists(this.tooltipsSelectorDiv))throw new Error("Cannot pack the options dialog: the tooltips selector div is null or undefined.");if(!t.exists(this.maxNumberOfCyclesSelectorDiv))throw new Error("Cannot pack the options dialog: the max number of cycles selector div is null or undefined.");if(!t.exists(this.effortsSelectorDiv))throw new Error("Cannot pack the options dialog: the efforts selector div is null or undefined.");if(!t.exists(this.teleoraSelectorDiv))throw new Error("Cannot pack the options dialog: the teleora selector div is null or undefined.");if(!t.exists(this.okButton))throw new Error("Cannot pack the options dialog: the ok button is null or undefined.");if(!t.exists(this.cancelButton))throw new Error("Cannot pack the options dialog: the cancel button is null or undefined.");this.dialog.appendChild(this.speedSelectorDiv),this.dialog.appendChild(this.autoplaySelectorDiv),this.dialog.appendChild(this.stateToLoadSelectorDiv),this.dialog.appendChild(this.tooltipsSelectorDiv),this.dialog.appendChild(this.maxNumberOfCyclesSelectorDiv),this.dialog.appendChild(this.effortsSelectorDiv),this.dialog.appendChild(this.teleoraSelectorDiv),this.dialog.appendChild(this.okButton.getButton()),this.dialog.appendChild(this.cancelButton.getButton()),this.packed=!0}}unpack(){this.dialog.close()}constructOptionsDialog(){this.constructSpeedSelectorDiv(),this.constructAutoplayCheckboxDiv(),this.constructStateToLoadSelectorDiv(),this.constructTooltipsCheckboxDiv(),this.constructMaxNumberOfCyclesSelectorDiv(),this.constructEffortsSelectorDiv(),this.constructTeleoraSelectorDiv(),this.constructOkButton(),this.constructCancelButton()}getDialog(){return t.validateExistence(this.dialog,"Cannot get the options dialog: the dialog is null or undefined.")}}class wt{div;optionsDialog;okButtonCallback;cancelButtonCallback;stateToLoadInputCallback;teleoraInputCallback;packed;constructor(t,e,i,o){this.div=document.createElement("div"),this.div.id="options_dialog_div",this.div.hidden=!0,this.okButtonCallback=t,this.cancelButtonCallback=e,this.stateToLoadInputCallback=i,this.teleoraInputCallback=o,this.optionsDialog=new vt(this.okButtonCallback,this.cancelButtonCallback,this.stateToLoadInputCallback,this.teleoraInputCallback),this.packed=!1}pack(){if(this.packed)console.log("The options dialog div is already packed.");else{if(!t.exists(this.div))throw new Error("Cannot pack: the options dialog div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot pack: the options dialog div is not hidden (it must be before packing it).");if(!t.exists(this.optionsDialog))throw new Error("Cannot pack: the options dialog is null or undefined.");this.optionsDialog.pack(),this.div.appendChild(this.optionsDialog.getDialog()),this.packed=!0}}unpack(){if(this.packed){if(!t.exists(this.div))throw new Error("Cannot unpack: the options dialog div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot unpack: the options dialog div is not hidden (it must be before unpacking it).");if(!t.exists(this.optionsDialog))throw new Error("Cannot unpack: the options dialog is null or undefined.");this.div.removeChild(this.optionsDialog.getDialog()),this.optionsDialog.unpack(),this.packed=!1}else console.log("The options dialog div is already unpacked.")}show(){if(!t.exists(this.div))throw new Error("Cannot show: the options dialog div is null or undefined.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the options dialog div is not packed.");if(!this.optionsDialog.getDialog().isConnected)throw new Error("Cannot show: the options dialog is not connected.");this.optionsDialog.getDialog().showModal(),this.div.hidden=!1}else console.log("The options dialog div is already shown.")}hide(){if(!t.exists(this.div))throw new Error("Cannot hide: the options dialog div is null or undefined.");if(this.div.hidden)console.log("The options dialog div is already hidden.");else{if(!this.packed)throw new Error("Cannot hide: the options dialog div is not packed.");this.div.hidden=!0}}getDiv(){return t.validateExistence(this.div,"Cannot get the options dialog div: the div is null or undefined.")}}class mt{div;displayedImage;packed;constructor(t){this.div=document.createElement("div"),this.div.classList.add("draggable-body-div"),this.div.hidden=!0,this.addDragEventsListeners(),this.displayedImage=document.createElement("img"),this.displayedImage.src=t,this.displayedImage.classList.add("draggable-image"),this.packed=!1}addDragEventsListeners(){this.div.addEventListener("dragstart",(t=>{t.target.classList.add("dragging"),t.dataTransfer.setData("source","draggable-image")})),this.div.addEventListener("dragend",(t=>{t.target.classList.remove("dragging")}))}pack(){if(this.packed)console.log("The draggable body is already packed.");else{if(!t.exists(this.div))throw new Error("Cannot pack: the draggable body's div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot pack: the draggable body's div is not hidden (it must be before packing it).");if(!t.exists(this.displayedImage))throw new Error("Cannot pack: the draggable body's div is null or undefined.");this.div.appendChild(this.displayedImage),this.packed=!0}}unpack(){if(this.packed){if(!t.exists(this.div))throw new Error("Cannot unpack: the draggable body's div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot unpack: the draggable body's div is not hidden (it must be before packing it).");if(!t.exists(this.displayedImage))throw new Error("Cannot unpack: the draggable body's image is null or undefined.");this.div.removeChild(this.displayedImage),this.packed=!1}else console.log("The draggable body's div is already unpacked.")}show(){if(!t.exists(this.div))throw new Error("Cannot show: the draggable body's div is null or undefined.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the draggable body's div is not packed.");this.div.hidden=!1}else console.log("The draggable body's div is already shown.")}hide(){if(!t.exists(this.div))throw new Error("Cannot hide: the draggable body's div is null or undefined.");if(this.div.hidden)console.log("The draggable body's div is already shown.");else{if(!this.packed)throw new Error("Cannot hide: the draggable body's div is not packed.");this.div.hidden=!1}}getDiv(){return t.validateExistence(this.div,"Cannot get the draggable body's div: it is null or undefined.")}}class Et{div;draggableBodies;packed;gridSize;constructor(t){this.div=document.createElement("div"),this.div.id="draggable_bodies_div",this.div.hidden=!0,this.createDraggableBodies(),this.gridSize=t,this.packed=!1}createDraggableBodies(){this.draggableBodies=[],Et.createAllImagesPaths(["green_north","orange_north","white_north","user_north"],["green_dirt","orange_dirt"],".png","/envs/vacuumworld-ts/res/images/locations/","actor/","dirt/").forEach((t=>this.draggableBodies.push(new mt(t))))}static createAllImagesPaths(t,e,i,o,n,r){const s=[];return t.forEach((t=>{s.push(o+n+t+i)})),e.forEach((t=>{s.push(o+r+t+i)})),s}updateGridSize(e){this.gridSize=t.validateExistence(e,"The grid size is null or undefined.")}pack(){if(this.packed)console.log("The draggable bodies div is already packed.");else{if(!t.exists(this.div))throw new Error("Cannot pack the draggable bodies div: it is null or undefined.");if(!this.div.hidden)throw new Error("Cannot pack: the draggable bodies div is not hidden (it must be before packing it).");if(!t.exists(this.gridSize))throw new Error("Cannot pack the draggable bodies div: the grid size is null or undefined.");if(!t.allExist(this.draggableBodies))throw new Error("Cannot pack the draggable bodies div: the draggable bodies array is null or undefined, or contains null or undefined elements.");this.draggableBodies.forEach((t=>{t.pack(),this.div.appendChild(t.getDiv())})),this.packed=!0}}unpack(){if(this.packed){if(!t.exists(this.div))throw new Error("Cannot unpack the draggable bodies div: it is null or undefined.");if(!this.div.hidden)throw new Error("Cannot unpack: the draggable bodies div is not hidden (it must be before packing it).");if(!t.exists(this.gridSize))throw new Error("Cannot unpack the draggable bodies div: the grid size is null or undefined.");if(!t.allExist(this.draggableBodies))throw new Error("Cannot unpack the draggable bodies div: the draggable bodies array is null or undefined, or contains null or undefined elements.");this.draggableBodies.forEach((t=>{this.div.removeChild(t.getDiv()),t.unpack()})),this.packed=!0}else console.log("The draggable bodies div is already unpacked.")}show(){if(!t.exists(this.div))throw new Error("Cannot show: the draggable bodies div is null or undefined.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the draggable bodies div is not packed.");this.draggableBodies.forEach((t=>t.show())),this.div.hidden=!1}else console.log("The draggable bodies div is already shown.")}hide(){if(!t.exists(this.div))throw new Error("Cannot hide: the draggable bodies div is null or undefined.");if(this.div.hidden)console.log("The draggable bodies div is already shown.");else{if(!this.packed)throw new Error("Cannot hide: the draggable bodies div is not packed.");this.draggableBodies.forEach((t=>t.hide())),this.div.hidden=!1}}getDiv(){return this.div}}class bt{div;gridSize;gridMap;draggableBodiesDiv;packed;constructor(){this.div=document.createElement("div"),this.div.id="grid_div",this.div.classList.add("grid","center-aligned"),this.div.hidden=!0,this.draggableBodiesDiv=new Et,this.packed=!1}static validateGridSize(e){if(!t.exists(e)||e<=0)throw new Error("Cannot create a grid with no size.");return e}static validateGrid(e){if(t.exists(e)){if([...e.getKeys()].some((t=>null==t)))throw new Error("Cannot create a grid with null or undefined coordinates.");if([...e.getValues()].some((t=>null==t)))throw new Error("Cannot create a grid with null or undefined cells.");return e}throw new Error("Cannot create a grid without cells.")}createTableForGrid(){let t=document.createElement("table");t.classList.add("grid-table");for(let e=0;e<this.gridSize;e++){let i=document.createElement("tr");i.classList.add("grid-row");for(let t=0;t<this.gridSize;t++){let o=document.createElement("td");o.classList.add("grid-cell");const n=new m(BigInt(t),BigInt(e));o.appendChild(this.gridMap.get(n).getCell()),i.appendChild(o)}t.appendChild(i)}return t}updateGrid(t,e){this.gridSize=bt.validateGridSize(t),this.gridMap=bt.validateGrid(e)}pack(){if(!t.exists(this.gridSize)||this.gridSize<=0)throw new Error("Cannot pack a grid that has no size.");if(!t.exists(this.div))throw new Error("Cannot pack a grid that has no div.");if(!t.exists(this.gridMap))throw new Error("Cannot pack a grid that has no cells.");if(!t.exists(this.draggableBodiesDiv))throw new Error("Cannot pack a grid that has not got a draggable bodies div.");if(!this.packed){this.gridMap.forEach((t=>t.pack()));let t=this.createTableForGrid();this.div.appendChild(t),this.div.appendChild(this.draggableBodiesDiv.getDiv()),this.packed=!0}}unpack(){if(this.packed){if(!t.exists(this.div))throw new Error("Cannot unpack: the grid div is null or undefined.");if(!t.exists(this.gridMap))throw new Error("Cannot unpack: the grid map is null or undefined.");if(0===this.div.childElementCount)throw new Error("Cannot unpack: the grid div has no children.");if(!t.exists(this.draggableBodiesDiv))throw new Error("Cannot pack a grid that has not got a draggable bodies div.");this.div.removeChild(this.div.firstChild),this.gridMap.forEach((t=>t.unpack())),this.div.removeChild(this.draggableBodiesDiv.getDiv()),this.gridMap=null,this.packed=!1}else console.log("The initial view div is already unpacked.")}show(){if(!t.exists(this.div))throw new Error("Cannot show a grid that has no div.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the grid div is not packed.");this.div.hidden=!1}else console.log("The grid div is already shown.")}hide(){if(!t.exists(this.div))throw new Error("Cannot hide: the grid div is null or undefined.");if(this.div.hidden)console.log("The grid div is already hidden.");else{if(!this.packed)throw new Error("Cannot hide: the grid div is not packed.");this.div.hidden=!0}}getDiv(){return t.validateExistence(this.div,"Cannot get the grid div: the div is null or undefined.")}getDraggableBodiesDiv(){return t.validateExistence(this.draggableBodiesDiv,"Cannot get the draggable bodies div: the div is null or undefined.")}setDraggableBodiesDiv(e){if(!t.exists(e))throw new Error("Cannot set the draggable bodies div: it is null or undefined.");this.draggableBodiesDiv=e}}class At{div;packed;constructor(){this.div=document.createElement("div"),this.div.id="simulation_controls_div",this.div.hidden=!0,this.packed=!1}pack(){}unpack(){}show(){}hide(){}getDiv(){if(null===this.div||void 0===this.div)throw new Error("Cannot get the simulation controls div: it is null or undefined.");return this.div}}class Tt{cell;locationAppearance;displayedImage;dropCallback;rotateCallback;doubleClickCallback;packed;constructor(e){this.locationAppearance=t.validateExistence(e,"Cannot create a cell without a location appearance."),this.createLocationImage(),this.cell=document.createElement("div"),this.cell.classList.add("cell"),this.cell.id=`cell-${e.getCoord().getX()}-${e.getCoord().getY()}`,this.packed=!1}addCallbacks(t,e,i){this.dropCallback=t,this.rotateCallback=e,this.doubleClickCallback=i,this.addListeners()}createLocationImage(){this.displayedImage=document.createElement("img"),this.displayedImage.src=this.getCellImageSrc(),this.displayedImage.classList.add("location-image","dropzone")}addListeners(){this.addDropListeners(),this.addClickListener(),this.addDoubleClickListener(),this.addRotateListener()}addDropListeners(){this.displayedImage.addEventListener("dragover",(t=>t.preventDefault())),this.displayedImage.addEventListener("dragenter",(t=>{if("draggable-image"===t.dataTransfer.getData("source")&&t.target.classList.contains("dropzone")){t.target.classList.add("dragover");for(const t of document.getElementsByClassName("selected"))t.classList.remove("selected")}})),this.displayedImage.addEventListener("dragleave",(t=>{t.target.classList.contains("dropzone")&&t.target.classList.remove("dragover")})),this.displayedImage.addEventListener("drop",(e=>{if(e.preventDefault(),e.target.classList.contains("dropzone")){e.target.classList.remove("dragover");const i=document.getElementsByClassName("dragging")[0];t.exists(i)&&(this.locationAppearance=this.dropCallback(i.src,this.locationAppearance),e.target.src=this.getCellImageSrc(),console.log("Dropped."))}}))}addClickListener(){this.displayedImage.addEventListener("click",(t=>{if(t.target.classList.contains("dropzone")){const t=!this.displayedImage.classList.contains("selected");for(const t of document.getElementsByClassName("selected"))t.classList.remove("selected");t&&this.displayedImage.classList.add("selected")}}))}addDoubleClickListener(){this.displayedImage.addEventListener("dblclick",(t=>{t.target.classList.contains("dropzone")&&(this.locationAppearance=this.doubleClickCallback(this.locationAppearance),t.target.src=this.getCellImageSrc(),console.log("Removed."))}))}addRotateListener(){document.addEventListener("keydown",this.rotate.bind(this))}rotate(e){t.exists(this.displayedImage)&&this.displayedImage.classList.contains("selected")&&this.locationAppearance.hasActor()&&("ArrowRight"===e.code?(this.locationAppearance=this.rotateCallback(_.RIGHT,this.locationAppearance),this.displayedImage.src=this.getCellImageSrc(),console.log("Rotated the actor clockwise.")):"ArrowLeft"===e.code&&(this.locationAppearance=this.rotateCallback(_.LEFT,this.locationAppearance),this.displayedImage.src=this.getCellImageSrc(),console.log("Rotated the actor counter-clockwise.")))}getCellImageSrc(){if(t.exists(this.locationAppearance))return this.locationAppearance.hasActor()?this.getCellImageSrcIfActorIsPresent():this.locationAppearance.hasDirt()?this.getCellImageSrcIfDirtIsPresent():"envs/vacuumworld-ts/res/images/locations/empty.png";throw new Error("Cannot get the image src for a cell for which no location appearance is available.")}getCellImageSrcIfActorIsPresent(){const t=this.locationAppearance.getActorAppearance().orElseThrow().getOrientation(),e=this.locationAppearance.getActorAppearance().orElseThrow().getColour(),i=t.toString().toLowerCase();return`envs/vacuumworld-ts/res/images/locations/actor/${e.toString().toLowerCase()}_${i}.png`}getCellImageSrcIfDirtIsPresent(){return`envs/vacuumworld-ts/res/images/locations/dirt/${this.locationAppearance.getDirtAppearance().orElseThrow().getColour().toString().toLowerCase()}_dirt.png`}pack(){if(!t.exists(this.displayedImage))throw new Error("Cannot pack a cell that has no image.");if(!t.exists(this.locationAppearance))throw new Error("Cannot pack a cell for which no location appearance is available.");if(!t.exists(this.cell))throw new Error("Cannot pack a non-existent cell.");this.packed||(this.cell.appendChild(this.displayedImage),this.packed=!0)}unpack(){this.packed&&(this.cell.removeChild(this.displayedImage),this.locationAppearance=null,this.displayedImage=null,this.packed=!1)}isPacked(){return this.packed}getCell(){return t.validateExistence(this.cell,"Cannot get the cell: the cell is null or undefined.")}}class yt{gridSize;config;gridDiv;environment;options;canRun;paused;replaceGridDivCallback;hideDraggableBodiesDivCallback;replaceDraggableBodiesDivCallback;hideSimulationControlsDivCallback;replaceSimulationControlsDivCallback;constructor(e,i,o){this.config=t.validateExistence(o,"Cannot create a simulation without a config."),this.gridSize=yt.validateGridSize(e,o),this.environment=t.validateExistence(e,"Cannot create a simulation without an environment."),this.gridDiv=this.createGrid(!0),this.options=t.validateExistence(i,"Cannot create a simulation without options."),this.canRun=!0,this.paused=!1}setCallbacks(t,e,i,o,n){this.replaceGridDivCallback=t,this.replaceDraggableBodiesDivCallback=i,this.hideDraggableBodiesDivCallback=e,this.hideSimulationControlsDivCallback=o,this.replaceSimulationControlsDivCallback=n}getGridDiv(){return this.gridDiv}getEnvironment(){return this.environment}getConfig(){return this.config}static validateGridSize(e,i){if(t.validateExistence(e,"Cannot create a simulation without an environment."),t.validateExistence(i,"Cannot create a simulation without a config."),!t.exists(i.min_environment_dim)||i.min_environment_dim<=0)throw new Error("The config must have a `min_environment_dim` key.");if(!t.exists(i.max_environment_dim)||i.max_environment_dim<=0)throw new Error("The config must have a `max_environment_dim` key.");if(i.min_environment_dim>i.max_environment_dim)throw new Error("Invalid config: the value of `max_environment_dim` must be greater or equal to the value of `min_environment_dim`.");if(e.getGridSize()<i.min_environment_dim||e.getGridSize()>i.max_environment_dim)throw new Error(`The grid size must be between ${i.min_environment_dim} and ${i.max_environment_dim} (inclusive).`);return e.getGridSize()}createGrid(t){let e=new b;this.environment.getAmbient().getGrid().forEach(((i,o)=>{let n=new Tt(i.getAppearance());t&&n.addCallbacks(this.dropCallback.bind(this),this.rotateCallback.bind(this),this.doubleClickCallback.bind(this)),e.put(o,n)}));let i=new bt;return i.updateGrid(this.gridSize,e),i}dropCallback(t,e){const i=e.getCoord();if(t.endsWith("green_north.png"))this.environment.getLocation(i).ifPresent((t=>t.removeActorIfPresent())),this.environment.getLocation(i).ifPresent((t=>t.addActor(Q.createVWActorFacingNorth(v.GREEN,this.options))));else if(t.endsWith("orange_north.png"))this.environment.getLocation(i).ifPresent((t=>t.removeActorIfPresent())),this.environment.getLocation(i).ifPresent((t=>t.addActor(Q.createVWActorFacingNorth(v.ORANGE,this.options))));else if(t.endsWith("white_north.png"))this.environment.getLocation(i).ifPresent((t=>t.removeActorIfPresent())),this.environment.getLocation(i).ifPresent((t=>t.addActor(Q.createVWActorFacingNorth(v.WHITE,this.options))));else if(t.endsWith("user_north.png"))this.environment.getLocation(i).ifPresent((t=>t.removeActorIfPresent())),this.environment.getLocation(i).ifPresent((t=>t.addActor(Q.createVWActorFacingNorth(v.USER,this.options))));else if(t.endsWith("green_dirt.png"))this.environment.getLocation(i).ifPresent((t=>t.removeDirtIfPresent())),this.environment.getLocation(i).ifPresent((t=>t.addDirt(new S(v.GREEN))));else{if(!t.endsWith("orange_dirt.png"))throw new Error("Invalid image src.");this.environment.getLocation(i).ifPresent((t=>t.removeDirtIfPresent())),this.environment.getLocation(i).ifPresent((t=>t.addDirt(new S(v.ORANGE))))}return this.environment.getLocation(i).orElseThrow().getAppearance()}doubleClickCallback(t){const e=t.getCoord();return this.environment.getLocation(e).ifPresent((t=>{t.hasActor()?t.removeActor():t.hasDirt()&&t.removeDirt()})),this.environment.getLocation(e).orElseThrow().getAppearance()}rotateCallback(t,e){const i=e.getCoord();return this.environment.getLocation(i).ifPresent((e=>{e.hasActor()&&this.environment.turnActor(i,t)})),this.environment.getLocation(i).orElseThrow().getAppearance()}showSimulation(){this.gridDiv=this.createGrid(!0),this.replaceGridDivCallback(this.gridDiv),this.gridDiv.pack(),this.replaceDraggableBodiesDivCallback(new Et(this.gridSize)),this.gridDiv.show()}cycleSimulation(){this.validateCallbacks(),this.paused=!1,this.canRun=!0,console.log("Simulation starting..."),console.log("Initial environment: "),console.log(this.environment.toJsonObject()),console.log(console.log(JSON.stringify(this.environment.toJsonObject(),null,4))),this.mainLoop()}validateCallbacks(){if(!t.exists(this.replaceGridDivCallback))throw new Error("Cannot cycle the simulation without a callback to replace the grid div.");if(!t.exists(this.hideDraggableBodiesDivCallback))throw new Error("Cannot cycle the simulation without a callback to hide the draggable bodies div.");if(!t.exists(this.replaceDraggableBodiesDivCallback))throw new Error("Cannot cycle the simulation without a callback to replace the draggable bodies div.");if(!t.exists(this.hideSimulationControlsDivCallback))throw new Error("Cannot cycle the simulation without a callback to hide the simulation controls div.");if(!t.exists(this.replaceSimulationControlsDivCallback))throw new Error("Cannot cycle the simulation without a callback to replace the simulation controls div.")}async mainLoop(){void 0===this.options.getMaxNumberOfCycles()?await this.loopForever():await this.loopNumberOfTimes(),this.paused=!1,this.canRun=!1,this.showStoppedSimulationControls(),this.environment.resetAndMaintainElements(),this.showSimulation()}showStoppedSimulationControls(){document.getElementById("external_run_button").hidden=!1,document.getElementById("external_pause_button").hidden=!0,document.getElementById("external_resume_button").hidden=!0,document.getElementById("external_stop_button").hidden=!0,document.getElementById("external_reset_button").hidden=!1,document.getElementById("external_speed_button").hidden=!0,document.getElementById("external_save_button").hidden=!1,document.getElementById("external_load_button").hidden=!1,document.getElementById("external_guide_button").hidden=!1}async loopForever(){for(;this.canRun;)await this.stayPausedIfNeeded(),this.canRun&&await this.doOneCycle()}async loopNumberOfTimes(){for(let t=0;t<this.options.getMaxNumberOfCycles();t++)this.canRun&&(await this.stayPausedIfNeeded(),this.canRun&&await this.doOneCycle())}async doOneCycle(){this.environment.cycle(),this.gridDiv.hide(),this.gridDiv.unpack(),this.gridDiv=this.createGrid(!1),this.replaceGridDivCallback(this.gridDiv),this.gridDiv.pack(),this.gridDiv.show(),await this.delay(1e3-1e3*this.options.getSpeed())}delay(t){return new Promise((e=>setTimeout(e,t)))}async stayPausedIfNeeded(){for(;this.paused;)await this.delay(100)}stop(){this.canRun=!1,this.paused=!1}pause(){this.paused=!0}resume(){this.paused=!1}}class Ct{div;initialViewDiv;initialViewButtonsDiv;optionsDialogDiv;gridDiv;simulationControlsDiv;options;simulation;packed;constructor(e){if(!t.exists(e))throw new Error("The path of the initial view image cannot be null or undefined.");this.div=document.createElement("div"),this.div.id="platform_div",this.div.classList.add("center-aligned"),this.div.hidden=!0,this.initialViewDiv=new ut(e),this.initialViewButtonsDiv=new ft(this.start.bind(this),this.showOptionsDialog.bind(this),this.guide),this.optionsDialogDiv=new wt(this.saveNewOptions.bind(this),this.discardNewOptions.bind(this),this.loadState.bind(this),this.loadTeleora.bind(this)),this.gridDiv=new bt,this.simulationControlsDiv=new At,this.options=new ht,this.packed=!1}showOptionsDialog(){if(!t.exists(this.optionsDialogDiv))throw new Error("Cannot show the options dialog div: it is null or undefined.");this.optionsDialogDiv.pack(),this.optionsDialogDiv.show()}loadState(){const t=document.getElementById("state_to_load_upload_input").files[0],e=new FileReader;e.onload=t=>{this.options.setStateToLoad(JSON.parse(t.target.result))},e.readAsText(t)}loadTeleora(){const t=document.getElementById("teleora_upload_input").files[0],e=new FileReader;e.onload=t=>{this.options.setTeleora(t.target.result)},e.readAsText(t)}start(){try{this.setActionEfforts();const t={initial_environment_dim:8,min_environment_dim:3,max_environment_dim:13};this.options.isAutoplayActive()?this.run(t,!0):this.run(t,!1)}catch(t){ct.displayError(t),console.error(t)}}run(t,e){let i=dt.newEnvironment(this.options,t,this.options.getStateToLoad());this.simulation=new yt(i,this.options,t),this.simulation.setCallbacks(this.replaceGridDiv.bind(this),this.hideDraggableBodiesDiv.bind(this),this.replaceDraggableBodiesDiv.bind(this),this.hideSimulationControlsDiv.bind(this),this.replaceSimulationControlsDiv.bind(this)),this.initialViewDiv.hide(),this.initialViewButtonsDiv.hide(),this.initialViewDiv.unpack(),this.initialViewButtonsDiv.unpack(),this.showExternalSimulationControls(),e?this.simulation.cycleSimulation():this.simulation.showSimulation()}showExternalSimulationControls(){document.getElementById("external_simulation_controls_div").hidden=!1,this.showStoppedSimulationControls(),document.getElementById("external_run_button").addEventListener("click",(()=>{this.showRunningSimulationControls(),this.simulation.cycleSimulation()})),document.getElementById("external_stop_button").addEventListener("click",(()=>{this.showStoppedSimulationControls(),this.simulation.stop(),this.simulation.getEnvironment().resetAndMaintainElements(),this.simulation=new yt(this.simulation.getEnvironment(),this.options,this.simulation.getConfig()),this.simulation.setCallbacks(this.replaceGridDiv.bind(this),this.hideDraggableBodiesDiv.bind(this),this.replaceDraggableBodiesDiv.bind(this),this.hideSimulationControlsDiv.bind(this),this.replaceSimulationControlsDiv.bind(this)),this.simulation.showSimulation()})),document.getElementById("external_pause_button").addEventListener("click",(()=>{this.showPausedSimulationControls(),this.simulation.pause()})),document.getElementById("external_resume_button").addEventListener("click",(()=>{this.showRunningSimulationControls(),this.simulation.resume()})),document.getElementById("external_speed_button").addEventListener("click",(()=>{this.options.setSpeed(Math.max(.999,this.options.getSpeed()+.1))})),document.getElementById("external_reset_button").addEventListener("click",(()=>{this.showStoppedSimulationControls(),this.simulation.stop(),this.simulation=new yt(dt.newEmptyVWEnvironment(this.simulation.getConfig()),this.options,this.simulation.getConfig()),this.simulation.setCallbacks(this.replaceGridDiv.bind(this),this.hideDraggableBodiesDiv.bind(this),this.replaceDraggableBodiesDiv.bind(this),this.hideSimulationControlsDiv.bind(this),this.replaceSimulationControlsDiv.bind(this)),this.simulation.showSimulation()})),document.getElementById("external_guide_button").addEventListener("click",this.guide)}showRunningSimulationControls(){document.getElementById("external_run_button").hidden=!0,document.getElementById("external_pause_button").hidden=!1,document.getElementById("external_resume_button").hidden=!0,document.getElementById("external_stop_button").hidden=!1,document.getElementById("external_reset_button").hidden=!0,document.getElementById("external_speed_button").hidden=!1,document.getElementById("external_save_button").hidden=!0,document.getElementById("external_load_button").hidden=!0,document.getElementById("external_guide_button").hidden=!0}showStoppedSimulationControls(){document.getElementById("external_run_button").hidden=!1,document.getElementById("external_pause_button").hidden=!0,document.getElementById("external_resume_button").hidden=!0,document.getElementById("external_stop_button").hidden=!0,document.getElementById("external_reset_button").hidden=!1,document.getElementById("external_speed_button").hidden=!0,document.getElementById("external_save_button").hidden=!1,document.getElementById("external_load_button").hidden=!1,document.getElementById("external_guide_button").hidden=!1}showPausedSimulationControls(){document.getElementById("external_run_button").hidden=!0,document.getElementById("external_pause_button").hidden=!0,document.getElementById("external_resume_button").hidden=!1,document.getElementById("external_stop_button").hidden=!1,document.getElementById("external_reset_button").hidden=!0,document.getElementById("external_speed_button").hidden=!0,document.getElementById("external_save_button").hidden=!0,document.getElementById("external_load_button").hidden=!0,document.getElementById("external_guide_button").hidden=!0}replaceGridDiv(e){if(!t.exists(e))throw new Error("Cannot replace the grid div: the new grid div is null or undefined.");this.div.replaceChild(e.getDiv(),this.gridDiv.getDiv()),this.gridDiv=e}hideDraggableBodiesDiv(){t.validateExistence(this.gridDiv,"The grid div cannot be null or undefined."),t.validateExistence(this.gridDiv.getDraggableBodiesDiv(),"The draggable bodies div cannot be null or undefined."),this.gridDiv.getDraggableBodiesDiv().hide()}replaceDraggableBodiesDiv(e){t.validateExistence(e,"The grid size cannot be null or undefined."),t.validateExistence(this.gridDiv,"The grid div cannot be null or undefined."),t.validateExistence(this.gridDiv.getDraggableBodiesDiv(),"The draggable bodies div cannot be null or undefined.");let i=new Et(e);i.pack(),this.gridDiv.getDiv().replaceChild(i.getDiv(),this.gridDiv.getDraggableBodiesDiv().getDiv()),this.gridDiv.setDraggableBodiesDiv(i),this.gridDiv.getDraggableBodiesDiv().show()}hideSimulationControlsDiv(){if(!t.exists(this.simulationControlsDiv))throw new Error("Cannot hide the simulation controls div: it is null or undefined.");this.simulationControlsDiv.hide()}replaceSimulationControlsDiv(e){if(!t.exists(e))throw new Error("Cannot replace the simulation controls div: the new simulation controls div is null or undefined.");this.div.replaceChild(e.getDiv(),this.simulationControlsDiv.getDiv()),this.simulationControlsDiv=e}setActionEfforts(){l.overrideDefaultEffort(this.options.getEfforts().get("VWIdleAction")),d.overrideDefaultEffort(this.options.getEfforts().get("VWMoveAction")),h.overrideDefaultEffort(this.options.getEfforts().get("VWTurnAction")),s.overrideDefaultEffort(this.options.getEfforts().get("VWCleanAction")),a.overrideDefaultEffort(this.options.getEfforts().get("VWDropDirtAction")),c.overrideDefaultEffort(this.options.getEfforts().get("VWSpeakAction")),n.overrideDefaultEffort(this.options.getEfforts().get("VWBroadcastAction"))}saveNewOptions(){if(!t.exists(this.optionsDialogDiv))throw new Error("Cannot hide the options dialog div: it is null or undefined.");this.saveOptions(),this.closeAndDestroyOptionsDialog(),this.printOptions("Options saved:")}saveOptions(){this.parseSimulationSpeed(),this.parseAutoplayFlag(),this.parseTooltipsFlag(),this.parseMaxNumberOfCycles(),this.parseEfforts()}parseSimulationSpeed(){const t=parseFloat(document.getElementById("speed_values").value);isNaN(t)?this.options.setSpeed(0):this.options.setSpeed(t)}parseAutoplayFlag(){document.getElementById("autoplay_checkbox").checked?this.options.activateAutoplay():this.options.deactivateAutoplay()}parseTooltipsFlag(){document.getElementById("tooltips_checkbox").checked?this.options.activateTooltips():this.options.deactivateTooltips()}parseMaxNumberOfCycles(){const e=document.getElementById("max_number_of_cycles_input").value;t.exists(e)&&""!==e?this.options.setMaxNumberOfCycles(parseInt(e)):this.options.setMaxNumberOfCycles(void 0)}parseEfforts(){let e=new Map;for(const i of Ct.getActionNames()){const o=document.getElementById(i.toLowerCase()+"_effort_input").value;t.exists(o)&&""!==o?e.set(i,BigInt(parseInt(o))):e.set(i,void 0)}this.options.setEfforts(e)}static getActionNames(){return["VWIdleAction","VWMoveAction","VWTurnAction","VWCleanAction","VWDropDirtAction","VWSpeakAction","VWBroadcastAction"]}discardNewOptions(){if(!t.exists(this.optionsDialogDiv))throw new Error("Cannot hide the options dialog div: it is null or undefined.");this.closeAndDestroyOptionsDialog(),this.printOptions("Options discarded. The current options are:")}closeAndDestroyOptionsDialog(){this.optionsDialogDiv.hide(),this.optionsDialogDiv.unpack()}printOptions(t){console.log(t),console.log("Speed: "+this.options.getSpeed()),console.log("Autoplay active: "+this.options.isAutoplayActive()),console.log("Saved state to load: "+this.options.getStateToLoad()),console.log("Tooltips active: "+this.options.areTooltipsActive()),console.log("Max number of cycles: "+this.options.getMaxNumberOfCycles()),console.log("Efforts:"),Ct.getActionNames().forEach((t=>console.log("- "+t+": "+this.options.getEfforts().get(t)))),console.log("Teleora file to load: "+this.options.getTeleora())}guide(){window.open("https://github.com/dicelab-rhul/web-agent/")}pack(){if(this.packed)console.log("The platform div is already packed.");else{if(!t.exists(this.div))throw new Error("Cannot pack: the platform div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot pack: the platform div is not hidden (it must be before packing it).");if(!t.exists(this.initialViewDiv))throw new Error("Cannot pack: the initial view div is null or undefined.");if(!t.exists(this.initialViewButtonsDiv))throw new Error("Cannot pack: the initial view buttons div is null or undefined.");if(!t.exists(this.optionsDialogDiv))throw new Error("Cannot pack: the options dialog div is null or undefined.");if(!t.exists(this.gridDiv))throw new Error("Cannot pack: the grid div is null or undefined.");if(!t.exists(this.simulationControlsDiv))throw new Error("Cannot pack: the simulation controls div is null or undefined.");this.initialViewDiv.pack(),this.initialViewButtonsDiv.pack(),this.optionsDialogDiv.pack(),this.div.appendChild(this.initialViewDiv.getDiv()),this.div.appendChild(this.initialViewButtonsDiv.getDiv()),this.div.appendChild(this.optionsDialogDiv.getDiv()),this.div.appendChild(this.gridDiv.getDiv()),this.div.appendChild(this.simulationControlsDiv.getDiv()),this.packed=!0}}unpack(){if(this.packed){if(!t.exists(this.div))throw new Error("Cannot unpack: the platform div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot unpack: the platform div is not hidden (it must be before unpacking it).");if(!t.exists(this.initialViewDiv))throw new Error("Cannot unpack: the initial view div is null or undefined.");if(!t.exists(this.initialViewButtonsDiv))throw new Error("Cannot unpack: the initial view buttons div is null or undefined.");if(!t.exists(this.optionsDialogDiv))throw new Error("Cannot unpack: the options dialog div is null or undefined.");if(!t.exists(this.gridDiv))throw new Error("Cannot unpack: the grid div is null or undefined.");if(!t.exists(this.simulationControlsDiv))throw new Error("Cannot unpack: the simulation controls div is null or undefined.");this.div.removeChild(this.initialViewDiv.getDiv()),this.div.removeChild(this.initialViewButtonsDiv.getDiv()),this.div.removeChild(this.optionsDialogDiv.getDiv()),this.div.removeChild(this.gridDiv.getDiv()),this.div.removeChild(this.simulationControlsDiv.getDiv()),this.packed=!1}else console.log("The platform div is already unpacked.")}show(){if(!t.exists(this.div))throw new Error("Cannot show: the platform div is null or undefined.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the platform div is not packed.");this.initialViewDiv.show(),this.initialViewButtonsDiv.show(),this.div.hidden=!1}else console.log("The platform div is already shown.")}hide(){if(!t.exists(this.div))throw new Error("Cannot hide: the platform div is null or undefined.");if(this.div.hidden)console.log("The platform div is already hidden.");else{if(!this.packed)throw new Error("Cannot hide: the platform div is not packed.");this.initialViewDiv.hide(),this.initialViewButtonsDiv.hide(),this.optionsDialogDiv.hide(),this.gridDiv.hide(),this.simulationControlsDiv.hide(),this.div.hidden=!0}}getDiv(){return t.validateExistence(this.div,"Cannot get the platform div: the div is null or undefined.")}}(new class{run(){this.setTitle("VacuumWorld");let t=new Ct("/envs/vacuumworld-ts/res/images/start_menu.png");t.pack(),document.getElementById("container_div").appendChild(t.getDiv()),t.show()}setTitle(e){t.exists(e)&&""!==e&&(document.title=e)}}).run()})()})();