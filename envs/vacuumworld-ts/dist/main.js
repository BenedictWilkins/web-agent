(()=>{"use strict";var t={429:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"NIL",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(e,"v1",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"v3",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"v4",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"v5",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"validate",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return l.default}});var n=u(r(990)),o=u(r(237)),i=u(r(355)),s=u(r(764)),a=u(r(314)),l=u(r(464)),c=u(r(435)),d=u(r(8)),h=u(r(222));function u(t){return t&&t.__esModule?t:{default:t}}},163:(t,e)=>{function r(t){return 14+(t+64>>>9<<4)+1}function n(t,e){const r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}function o(t,e,r,o,i,s){return n((a=n(n(e,t),n(o,s)))<<(l=i)|a>>>32-l,r);var a,l}function i(t,e,r,n,i,s,a){return o(e&r|~e&n,t,e,i,s,a)}function s(t,e,r,n,i,s,a){return o(e&n|r&~n,t,e,i,s,a)}function a(t,e,r,n,i,s,a){return o(e^r^n,t,e,i,s,a)}function l(t,e,r,n,i,s,a){return o(r^(e|~n),t,e,i,s,a)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=function(t){if("string"==typeof t){const e=unescape(encodeURIComponent(t));t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t[r]=e.charCodeAt(r)}return function(t){const e=[],r=32*t.length,n="0123456789abcdef";for(let o=0;o<r;o+=8){const r=t[o>>5]>>>o%32&255,i=parseInt(n.charAt(r>>>4&15)+n.charAt(15&r),16);e.push(i)}return e}(function(t,e){t[e>>5]|=128<<e%32,t[r(e)-1]=e;let o=1732584193,c=-271733879,d=-1732584194,h=271733878;for(let e=0;e<t.length;e+=16){const r=o,u=c,f=d,g=h;o=i(o,c,d,h,t[e],7,-680876936),h=i(h,o,c,d,t[e+1],12,-389564586),d=i(d,h,o,c,t[e+2],17,606105819),c=i(c,d,h,o,t[e+3],22,-1044525330),o=i(o,c,d,h,t[e+4],7,-176418897),h=i(h,o,c,d,t[e+5],12,1200080426),d=i(d,h,o,c,t[e+6],17,-1473231341),c=i(c,d,h,o,t[e+7],22,-45705983),o=i(o,c,d,h,t[e+8],7,1770035416),h=i(h,o,c,d,t[e+9],12,-1958414417),d=i(d,h,o,c,t[e+10],17,-42063),c=i(c,d,h,o,t[e+11],22,-1990404162),o=i(o,c,d,h,t[e+12],7,1804603682),h=i(h,o,c,d,t[e+13],12,-40341101),d=i(d,h,o,c,t[e+14],17,-1502002290),c=i(c,d,h,o,t[e+15],22,1236535329),o=s(o,c,d,h,t[e+1],5,-165796510),h=s(h,o,c,d,t[e+6],9,-1069501632),d=s(d,h,o,c,t[e+11],14,643717713),c=s(c,d,h,o,t[e],20,-373897302),o=s(o,c,d,h,t[e+5],5,-701558691),h=s(h,o,c,d,t[e+10],9,38016083),d=s(d,h,o,c,t[e+15],14,-660478335),c=s(c,d,h,o,t[e+4],20,-405537848),o=s(o,c,d,h,t[e+9],5,568446438),h=s(h,o,c,d,t[e+14],9,-1019803690),d=s(d,h,o,c,t[e+3],14,-187363961),c=s(c,d,h,o,t[e+8],20,1163531501),o=s(o,c,d,h,t[e+13],5,-1444681467),h=s(h,o,c,d,t[e+2],9,-51403784),d=s(d,h,o,c,t[e+7],14,1735328473),c=s(c,d,h,o,t[e+12],20,-1926607734),o=a(o,c,d,h,t[e+5],4,-378558),h=a(h,o,c,d,t[e+8],11,-2022574463),d=a(d,h,o,c,t[e+11],16,1839030562),c=a(c,d,h,o,t[e+14],23,-35309556),o=a(o,c,d,h,t[e+1],4,-1530992060),h=a(h,o,c,d,t[e+4],11,1272893353),d=a(d,h,o,c,t[e+7],16,-155497632),c=a(c,d,h,o,t[e+10],23,-1094730640),o=a(o,c,d,h,t[e+13],4,681279174),h=a(h,o,c,d,t[e],11,-358537222),d=a(d,h,o,c,t[e+3],16,-722521979),c=a(c,d,h,o,t[e+6],23,76029189),o=a(o,c,d,h,t[e+9],4,-640364487),h=a(h,o,c,d,t[e+12],11,-421815835),d=a(d,h,o,c,t[e+15],16,530742520),c=a(c,d,h,o,t[e+2],23,-995338651),o=l(o,c,d,h,t[e],6,-198630844),h=l(h,o,c,d,t[e+7],10,1126891415),d=l(d,h,o,c,t[e+14],15,-1416354905),c=l(c,d,h,o,t[e+5],21,-57434055),o=l(o,c,d,h,t[e+12],6,1700485571),h=l(h,o,c,d,t[e+3],10,-1894986606),d=l(d,h,o,c,t[e+10],15,-1051523),c=l(c,d,h,o,t[e+1],21,-2054922799),o=l(o,c,d,h,t[e+8],6,1873313359),h=l(h,o,c,d,t[e+15],10,-30611744),d=l(d,h,o,c,t[e+6],15,-1560198380),c=l(c,d,h,o,t[e+13],21,1309151649),o=l(o,c,d,h,t[e+4],6,-145523070),h=l(h,o,c,d,t[e+11],10,-1120210379),d=l(d,h,o,c,t[e+2],15,718787259),c=l(c,d,h,o,t[e+9],21,-343485551),o=n(o,r),c=n(c,u),d=n(d,f),h=n(h,g)}return[o,c,d,h]}(function(t){if(0===t.length)return[];const e=8*t.length,n=new Uint32Array(r(e));for(let r=0;r<e;r+=8)n[r>>5]|=(255&t[r/8])<<r%32;return n}(t),8*t.length))}},790:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};e.default=r},314:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default="00000000-0000-0000-0000-000000000000"},222:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,o=(n=r(435))&&n.__esModule?n:{default:n};e.default=function(t){if(!(0,o.default)(t))throw TypeError("Invalid UUID");let e;const r=new Uint8Array(16);return r[0]=(e=parseInt(t.slice(0,8),16))>>>24,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=255&e,r[4]=(e=parseInt(t.slice(9,13),16))>>>8,r[5]=255&e,r[6]=(e=parseInt(t.slice(14,18),16))>>>8,r[7]=255&e,r[8]=(e=parseInt(t.slice(19,23),16))>>>8,r[9]=255&e,r[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,r[11]=e/4294967296&255,r[12]=e>>>24&255,r[13]=e>>>16&255,r[14]=e>>>8&255,r[15]=255&e,r}},58:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},319:(t,e)=>{let r;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){if(!r&&(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(n)};const n=new Uint8Array(16)},757:(t,e)=>{function r(t,e,r,n){switch(t){case 0:return e&r^~e&n;case 1:case 3:return e^r^n;case 2:return e&r^e&n^r&n}}function n(t,e){return t<<e|t>>>32-e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=function(t){const e=[1518500249,1859775393,2400959708,3395469782],o=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){const e=unescape(encodeURIComponent(t));t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);const i=t.length/4+2,s=Math.ceil(i/16),a=new Array(s);for(let e=0;e<s;++e){const r=new Uint32Array(16);for(let n=0;n<16;++n)r[n]=t[64*e+4*n]<<24|t[64*e+4*n+1]<<16|t[64*e+4*n+2]<<8|t[64*e+4*n+3];a[e]=r}a[s-1][14]=8*(t.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(t.length-1)&4294967295;for(let t=0;t<s;++t){const i=new Uint32Array(80);for(let e=0;e<16;++e)i[e]=a[t][e];for(let t=16;t<80;++t)i[t]=n(i[t-3]^i[t-8]^i[t-14]^i[t-16],1);let s=o[0],l=o[1],c=o[2],d=o[3],h=o[4];for(let t=0;t<80;++t){const o=Math.floor(t/20),a=n(s,5)+r(o,l,c,d)+h+e[o]+i[t]>>>0;h=d,d=c,c=n(l,30)>>>0,l=s,s=a}o[0]=o[0]+s>>>0,o[1]=o[1]+l>>>0,o[2]=o[2]+c>>>0,o[3]=o[3]+d>>>0,o[4]=o[4]+h>>>0}return[o[0]>>24&255,o[0]>>16&255,o[0]>>8&255,255&o[0],o[1]>>24&255,o[1]>>16&255,o[1]>>8&255,255&o[1],o[2]>>24&255,o[2]>>16&255,o[2]>>8&255,255&o[2],o[3]>>24&255,o[3]>>16&255,o[3]>>8&255,255&o[3],o[4]>>24&255,o[4]>>16&255,o[4]>>8&255,255&o[4]]}},8:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.unsafeStringify=s;var n,o=(n=r(435))&&n.__esModule?n:{default:n};const i=[];for(let t=0;t<256;++t)i.push((t+256).toString(16).slice(1));function s(t,e=0){return(i[t[e+0]]+i[t[e+1]]+i[t[e+2]]+i[t[e+3]]+"-"+i[t[e+4]]+i[t[e+5]]+"-"+i[t[e+6]]+i[t[e+7]]+"-"+i[t[e+8]]+i[t[e+9]]+"-"+i[t[e+10]]+i[t[e+11]]+i[t[e+12]]+i[t[e+13]]+i[t[e+14]]+i[t[e+15]]).toLowerCase()}e.default=function(t,e=0){const r=s(t,e);if(!(0,o.default)(r))throw TypeError("Stringified UUID is invalid");return r}},990:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,o=(n=r(319))&&n.__esModule?n:{default:n},i=r(8);let s,a,l=0,c=0;e.default=function(t,e,r){let n=e&&r||0;const d=e||new Array(16);let h=(t=t||{}).node||s,u=void 0!==t.clockseq?t.clockseq:a;if(null==h||null==u){const e=t.random||(t.rng||o.default)();null==h&&(h=s=[1|e[0],e[1],e[2],e[3],e[4],e[5]]),null==u&&(u=a=16383&(e[6]<<8|e[7]))}let f=void 0!==t.msecs?t.msecs:Date.now(),g=void 0!==t.nsecs?t.nsecs:c+1;const w=f-l+(g-c)/1e4;if(w<0&&void 0===t.clockseq&&(u=u+1&16383),(w<0||f>l)&&void 0===t.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=f,c=g,a=u,f+=122192928e5;const m=(1e4*(268435455&f)+g)%4294967296;d[n++]=m>>>24&255,d[n++]=m>>>16&255,d[n++]=m>>>8&255,d[n++]=255&m;const p=f/4294967296*1e4&268435455;d[n++]=p>>>8&255,d[n++]=255&p,d[n++]=p>>>24&15|16,d[n++]=p>>>16&255,d[n++]=u>>>8|128,d[n++]=255&u;for(let t=0;t<6;++t)d[n+t]=h[t];return e||(0,i.unsafeStringify)(d)}},237:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(r(925)),o=i(r(163));function i(t){return t&&t.__esModule?t:{default:t}}var s=(0,n.default)("v3",48,o.default);e.default=s},925:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.URL=e.DNS=void 0,e.default=function(t,e,r){function n(t,n,s,a){var l;if("string"==typeof t&&(t=function(t){t=unescape(encodeURIComponent(t));const e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e}(t)),"string"==typeof n&&(n=(0,i.default)(n)),16!==(null===(l=n)||void 0===l?void 0:l.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+t.length);if(c.set(n),c.set(t,n.length),c=r(c),c[6]=15&c[6]|e,c[8]=63&c[8]|128,s){a=a||0;for(let t=0;t<16;++t)s[a+t]=c[t];return s}return(0,o.unsafeStringify)(c)}try{n.name=t}catch(t){}return n.DNS=s,n.URL=a,n};var n,o=r(8),i=(n=r(222))&&n.__esModule?n:{default:n};const s="6ba7b810-9dad-11d1-80b4-00c04fd430c8";e.DNS=s;const a="6ba7b811-9dad-11d1-80b4-00c04fd430c8";e.URL=a},355:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(r(790)),o=s(r(319)),i=r(8);function s(t){return t&&t.__esModule?t:{default:t}}e.default=function(t,e,r){if(n.default.randomUUID&&!e&&!t)return n.default.randomUUID();const s=(t=t||{}).random||(t.rng||o.default)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){r=r||0;for(let t=0;t<16;++t)e[r+t]=s[t];return e}return(0,i.unsafeStringify)(s)}},764:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(r(925)),o=i(r(757));function i(t){return t&&t.__esModule?t:{default:t}}var s=(0,n.default)("v5",80,o.default);e.default=s},435:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,o=(n=r(58))&&n.__esModule?n:{default:n};e.default=function(t){return"string"==typeof t&&o.default.test(t)}},464:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,o=(n=r(435))&&n.__esModule?n:{default:n};e.default=function(t){if(!(0,o.default)(t))throw TypeError("Invalid UUID");return parseInt(t.slice(14,15),16)}}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}(()=>{class t{actorID;constructor(e){this.actorID=t.validateActorID(e)}static validateActorID(t){if(null==t)throw new Error("The actor ID cannot be null or undefined.");return t}getActorID(){return this.actorID}}class e extends t{content;recipientsIDs;constructor(t,r,n){super(t),this.content=e.validateContent(r),this.recipientsIDs=null==n?[]:n}static validateContent(t){if(null==t)throw new Error("The content cannot be null or undefined.");return t}getContent(){return this.content}getRecipientsIDs(){return this.recipientsIDs}}class n extends e{static effort=1n;constructor(t,e){super(t,e)}getEffort(){return n.effort}static getEffort(){return n.effort}static overrideDefaultEffort(t){null==t?console.log("The new effort for VWBroadcastAction cannot be null or undefined. The default effort will be used instead."):(n.effort=t,console.log("The effort of VWBroadcastAction has been changed to "+t+"."))}}class o extends t{constructor(t){super(t)}}class i extends o{static effort=1n;constructor(t){super(t)}getEffort(){return i.effort}static overrideDefaultEffort(t){null==t?console.log("The new effort for VWCleanAction cannot be null or undefined. The default effort will be used instead."):(i.effort=t,console.log("The effort of VWCleanAction has been changed to "+t+"."))}}class s extends o{colour;static effort=1n;constructor(t,e){super(t),this.colour=s.validateColour(e)}getColour(){return this.colour}static validateColour(t){if(null==t)throw new Error("The dirt colour cannot be null or undefined.");return t}getEffort(){return s.effort}static overrideDefaultEffort(t){null==t?console.log("The new effort for VWDropDirtAction cannot be null or undefined. The default effort will be used instead."):(s.effort=t,console.log("The effort of VWDropDirtAction has been changed to "+t+"."))}}class a extends o{static effort=1n;constructor(t){super(t)}getEffort(){return a.effort}static overrideDefaultEffort(t){null==t?console.log("The new effort for VWIdleAction cannot be null or undefined. The default effort will be used instead."):(a.effort=t,console.log("The effort of VWIdleAction has been changed to "+t+"."))}}class l extends o{static effort=1n;constructor(t){super(t)}getEffort(){return l.effort}static overrideDefaultEffort(t){null==t?console.log("The new effort for VWMoveAction cannot be null or undefined. The default effort will be used instead."):(l.effort=t,console.log("The effort of VWMoveAction has been changed to "+t+"."))}}class c extends e{static effort=1n;constructor(t,e,r){super(t,e,r)}getEffort(){return 0===this.getRecipientsIDs().length?n.getEffort():c.effort}static overrideDefaultEffort(t){null==t?console.log("The new effort for VWSpeakAction cannot be null or undefined. The default effort will be used instead."):(c.effort=t,console.log("The effort of VWSpeakAction has been changed to "+t+"."))}}class d extends o{turningDirection;static effort=1n;constructor(t,e){super(t),this.turningDirection=d.validateTurningDirection(e)}static validateTurningDirection(t){if(null==t)throw new Error("The turning direction cannot be null or undefined.");return t}getTurningDirection(){return this.turningDirection}getEffort(){return d.effort}static overrideDefaultEffort(t){null==t?console.log("The new effort for VWTurnAction cannot be null or undefined. The default effort will be used instead."):(d.effort=t,console.log("The effort of VWTurnAction has been changed to "+t+"."))}}class h{value;constructor(t){this.value=t}static of(t){if(null==t)throw new Error("The value cannot be null or undefined.");return new h(t)}static ofNullable(t){return null==t?h.empty():new h(t)}static empty(){return new h(null)}isPresent(){return null!==this.value}isEmpty(){return null===this.value}get(){if(null===this.value||void 0===this.value)throw new Error("The value is null.");return this.value}orElse(t){return null===this.value||void 0===this.value?t:this.value}orElseGet(t){return null===this.value||void 0===this.value?t():this.value}orElseThrow(t){const e=null==t?new Error("The value is null or undefined."):t;if(null===this.value||void 0===this.value)throw e;return this.value}ifPresent(t){null!==this.value&&void 0!==this.value&&t(this.value)}ifPresentOrElse(t,e){null!==this.value&&void 0!==this.value?t(this.value):e()}filter(t){return null===this.value||void 0===this.value?h.empty():t(this.value)?this:h.empty()}map(t){return null===this.value||void 0===this.value?h.empty():h.of(t(this.value))}flatMap(t){return null===this.value||void 0===this.value?h.empty():t(this.value)}equals(t){return null!=t&&(this===t||t instanceof h&&(null===this.value?null===t.value:void 0===this.value?void 0===t.value:this.value===t.value))}}var u,f,g,w;!function(t){t.IMPOSSIBLE="IMPOSSIBLE",t.SUCCESS="SUCCESS",t.FAILURE="FAILURE"}(u||(u={}));class m{actionOutcome;action;constructor(t,e){this.actionOutcome=m.validateActionOutcome(t),this.action=m.validateAction(e)}static validateActionOutcome(t){if(null==t)throw new Error("The action outcome cannot be null or undefined.");return t}static validateAction(t){if(null==t)throw new Error("The action cannot be null or undefined.");return t}getActionOutcome(){return this.actionOutcome}getAction(){return this.action}}!function(t){t.NORTH="NORTH",t.EAST="EAST",t.SOUTH="SOUTH",t.WEST="WEST"}(f||(f={}));class p{x;y;constructor(t,e){this.x=p.validateX(t),this.y=p.validateY(e)}static validateX(t){if(null==t)throw new Error("The x coordinate cannot be null or undefined.");return t}static validateY(t){if(null==t)throw new Error("The y coordinate cannot be null or undefined.");return t}getX(){return this.x}getY(){return this.y}clone(){return new p(this.x,this.y)}getForwardCoord(t){if(null==t)throw new Error("The orientation cannot be null or undefined.");if(t===f.NORTH)return new p(this.x,this.y-1n);if(t===f.EAST)return new p(this.x+1n,this.y);if(t===f.SOUTH)return new p(this.x,this.y+1n);if(t===f.WEST)return new p(this.x-1n,this.y);throw new Error("The orientation is invalid.")}getLeftCoord(t){if(null==t)throw new Error("The orientation cannot be null or undefined.");if(t===f.NORTH)return new p(this.x-1n,this.y);if(t===f.EAST)return new p(this.x,this.y-1n);if(t===f.SOUTH)return new p(this.x+1n,this.y);if(t===f.WEST)return new p(this.x,this.y+1n);throw new Error("The orientation is invalid.")}getRightCoord(t){if(null==t)throw new Error("The orientation cannot be null or undefined.");if(t===f.NORTH)return new p(this.x+1n,this.y);if(t===f.EAST)return new p(this.x,this.y+1n);if(t===f.SOUTH)return new p(this.x-1n,this.y);if(t===f.WEST)return new p(this.x,this.y-1n);throw new Error("The orientation is invalid.")}getForwardLeftCoord(t){if(null==t)throw new Error("The orientation cannot be null or undefined.");if(t===f.NORTH)return new p(this.x-1n,this.y-1n);if(t===f.EAST)return new p(this.x+1n,this.y-1n);if(t===f.SOUTH)return new p(this.x+1n,this.y+1n);if(t===f.WEST)return new p(this.x-1n,this.y+1n);throw new Error("The orientation is invalid.")}getForwardRightCoord(t){if(null==t)throw new Error("The orientation cannot be null or undefined.");if(t===f.NORTH)return new p(this.x+1n,this.y-1n);if(t===f.EAST)return new p(this.x+1n,this.y+1n);if(t===f.SOUTH)return new p(this.x-1n,this.y+1n);if(t===f.WEST)return new p(this.x-1n,this.y-1n);throw new Error("The orientation is invalid.")}sum(t){return new p(this.x+t.x,this.y+t.y)}increment(t){return new p(this.x+t,this.y+t)}sub(t){return new p(this.x-t.x,this.y-t.y)}decrement(t){return new p(this.x-t,this.y-t)}toJsonObject(){return{x:this.x.toString(),y:this.y.toString()}}static fromJsonObject(t){if(null==t)throw new Error("The JSON representation cannot be null or undefined.");if(null===t.x||void 0===t.x)throw new Error("The x coordinate cannot be null or undefined.");if(null===t.y||void 0===t.y)throw new Error("The y coordinate cannot be null or undefined.");return new p(BigInt(t.x),BigInt(t.y))}toString(){return`(${this.x}, ${this.y})`}equals(t){return null!=t&&(this===t||t instanceof p&&this.x===t.x&&this.y===t.y)}static fromString(t){if(null==t)throw new Error("The coordinate string cannot be null or undefined.");if(t.length<5)throw new Error("The coordinate string is invalid.");{const e=t.substring(1,t.indexOf(",")),r=t.substring(t.indexOf(",")+2,t.length-1);return new p(BigInt(e),BigInt(r))}}}class v{key;value;constructor(t,e){this.key=t,this.value=e}getKey(){return this.key}getValue(){return this.value}setValue(t){this.value=t}}class A{entries;constructor(){this.entries=[]}put(t,e){let r=this.getEntry(t);null==r?this.entries.push(new v(t,e)):r.setValue(e)}get(t){const e=this.getEntry(t);return null==e?null:e.getValue()}remove(t){const e=this.getEntry(t);null!=e&&this.entries.splice(this.entries.indexOf(e),1)}containsKey(t){return null!==this.getEntry(t)&&void 0!==this.getEntry(t)}containsValue(t){for(let e of this.entries)if(e.getValue()===t)return!0;return!1}size(){return this.entries.length}isEmpty(){return 0===this.entries.length}clear(){this.entries=[]}getKeys(){return this.entries.map((t=>t.getKey()))}getValues(){return this.entries.map((t=>t.getValue()))}getEntry(t){return this.entries.find((e=>e.getKey().equals(t)))}toString(){let t="";for(let e of this.entries)t+=e.getKey()+" : "+e.getValue()+"\n";return t}equals(t){if(this.size()!==t.size())return!1;for(let e of this.entries)if(!t.containsKey(e.getKey())||t.get(e.getKey())!==e.getValue())return!1;return!0}clone(){const t=new A;for(let e of this.entries)t.put(e.getKey(),e.getValue());return t}static fromMap(t){const e=new A;for(let[r,n]of t)e.put(r,n);return e}toMap(){const t=new Map;for(let e of this.entries)t.set(e.getKey(),e.getValue());return t}static fromObject(t){const e=new A;for(let r in t)e.put(r,t[r]);return e}[Symbol.iterator](){let t=0,e=this.entries;return{next:()=>{if(t<e.length){const r=e[t];return t++,{value:[r.getKey(),r.getValue()],done:!1}}return{value:void 0,done:!0}}}}forEach(t){for(let e of this.entries)t(e.getValue(),e.getKey(),this)}}class E{}class T extends E{content;senderID;recipientID;constructor(t,e,r){super(),this.content=T.validateContent(t),this.senderID=T.validateSenderID(e),this.recipientID=T.validateRecipientID(r)}static validateContent(t){if(null==t)throw new Error("The content cannot be null or undefined.");return t}static validateSenderID(t){if(null==t)throw new Error("The sender ID cannot be null or undefined.");return t}static validateRecipientID(t){if(null==t)throw new Error("The recipient ID cannot be null or undefined.");return t}getContent(){return this.content}getSenderID(){return this.senderID}getRecipientID(){return this.recipientID}}class y{constructor(){}static getLeft(t){switch(t){case f.NORTH:return f.WEST;case f.SOUTH:return f.EAST;case f.EAST:return f.NORTH;case f.WEST:return f.SOUTH;default:throw new Error("Invalid orientation.")}}static getRight(t){switch(t){case f.NORTH:return f.EAST;case f.SOUTH:return f.WEST;case f.EAST:return f.SOUTH;case f.WEST:return f.NORTH;default:throw new Error("Invalid orientation.")}}static getOpposite(t){switch(t){case f.NORTH:return f.SOUTH;case f.SOUTH:return f.NORTH;case f.EAST:return f.WEST;case f.WEST:return f.EAST;default:throw new Error("Invalid orientation.")}}}!function(t){t.CENTER="CENTER",t.FORWARD="FORWARD",t.LEFT="LEFT",t.RIGHT="RIGHT",t.FORWARDLEFT="FORWARDLEFT",t.FORWARDRIGHT="FORWARDRIGHT"}(g||(g={}));class I extends E{locations;actionResults;constructor(t,e){super(),this.locations=new Map,this.actionResults=I.validateActionResults(e);for(const e of t.keys()){if(null==e)throw new Error("The position cannot be null or undefined.");if(null===t.get(e)||void 0===t.get(e))throw new Error("The location appearance cannot be null or undefined.");this.locations.set(e,t.get(e))}}static validateActionResults(t){if(null==t)throw new Error("The action results cannot be null or undefined.");if(t.some((t=>null==t)))throw new Error("The action results array cannot contain null or undefined elements.");if(0===t.length)throw new Error("The action results array cannot be empty.");return t}getLocations(){return this.locations}getLocationAt(t){return this.locations.has(t)&&null!==this.locations.get(t)&&void 0!==this.locations.get(t)?h.of(this.locations.get(t)):h.empty()}getCenter(){return this.getLocationAt(g.CENTER)}getLeft(){return this.getLocationAt(g.LEFT)}getRight(){return this.getLocationAt(g.RIGHT)}getForward(){return this.getLocationAt(g.FORWARD)}getForwardLeft(){return this.getLocationAt(g.FORWARDLEFT)}getForwardRight(){return this.getLocationAt(g.FORWARDRIGHT)}getOwnID(){return this.getCenter().orElseThrow().getActorAppearance().orElseThrow().getID()}getOwnColour(){return this.getCenter().orElseThrow().getActorAppearance().orElseThrow().getColour()}getOwnOrientation(){return this.getCenter().orElseThrow().getActorAppearance().orElseThrow().getOrientation()}getOwnCoordinates(){return this.getCenter().orElseThrow().getCoord()}getActionResults(){return this.actionResults}isWallImmediatelyAhead(){return this.getCenter().orElseThrow().hasWallOn(this.getOwnOrientation())}isWallOneStepAhead(){return!this.isWallImmediatelyAhead()&&this.getForward().orElseThrow().hasWallOn(this.getOwnOrientation())}isWallVisibleSomewhereAhead(){return this.isWallImmediatelyAhead()||this.isWallOneStepAhead()}isWallImmediatelyToTheLeft(){return this.getCenter().orElseThrow().hasWallOn(y.getLeft(this.getOwnOrientation()))}isWallOneStepToTheLeft(){return!this.isWallImmediatelyToTheLeft()&&this.getLeft().orElseThrow().hasWallOn(y.getLeft(this.getOwnOrientation()))}isWallVisibleSomewhereToTheLeft(){return this.isWallImmediatelyToTheLeft()||this.isWallOneStepToTheLeft()}isWallImmediatelyToTheRight(){return this.getCenter().orElseThrow().hasWallOn(y.getRight(this.getOwnOrientation()))}isWallOneStepToTheRight(){return!this.isWallImmediatelyToTheRight()&&this.getRight().orElseThrow().hasWallOn(y.getRight(this.getOwnOrientation()))}isWallVisibleSomewhereToTheRight(){return this.isWallImmediatelyToTheRight()||this.isWallOneStepToTheRight()}}class b{static validateActions(t){if(null==t)throw new Error("The actions array cannot be null or undefined.");if(t.some((t=>null==t)))throw new Error("The actions array cannot contain null or undefined actions.");if(0===t.length)throw new Error("At least one action per cycle must by attempted by each actor.");if(t.length>2)throw new Error("At most two actions per cycle can be attempted by each actor.");if(2===t.length&&t[0]instanceof o&&t[1]instanceof o)throw new Error("At most one physical action per cycle can be attempted by each actor.");if(2===t.length&&t[0]instanceof e&&t[1]instanceof e)throw new Error("At most one communicative action per cycle can be attempted by each actor.")}}class C{grid;constructor(t){this.grid=C.validateGrid(t)}static validateGrid(t){if(null==t)throw new Error("The grid cannot be null or undefined.");return t}getGridSize(){return Math.sqrt(this.grid.size())}getGrid(){return this.grid}getLocation(t){return h.ofNullable(this.grid.get(t))}getActors(){const t=[];for(const[e,r]of this.grid){const e=r.getActor();e.isPresent()&&t.push(e.orElseThrow())}return t}getActorsIDs(){const t=[];for(let[e,r]of this.grid){const e=r.getActor();e.isPresent()&&t.push(e.orElseThrow().getID())}return t}getActorsIDsExcept(t){const e=[];for(let[r,n]of this.grid){const r=n.getActor();r.isPresent()&&r.orElseThrow().getID()!==t&&e.push(r.orElseThrow().getID())}return e}getActorByID(t){for(let[e,r]of this.grid){const e=r.getActor();if(e.isPresent()&&e.orElseThrow().getID()===t)return e}return h.empty()}getActorByCoord(t){return this.getLocation(t).flatMap((t=>t.getActor()))}getActorCoordByID(t){for(let[e,r]of this.grid){const n=r.getActor();if(n.isPresent()&&n.orElseThrow().getID()===t)return h.of(e)}return h.empty()}addActorToLocation(t,e){if(null==t)throw new Error("The coordinates of the location cannot be null or undefined.");if(null==e)throw new Error("The actor cannot be null or undefined.");if(this.getActorByCoord(t).isPresent())throw new Error("There is already an actor at the location.");this.getLocation(t).ifPresent((t=>t.addActor(e)))}popActorByCoord(t){return this.getLocation(t).flatMap((t=>t.popActor()))}moveActor(t,e){if(null==t)throw new Error("The coordinates of the origin location cannot be null or undefined.");if(null==e)throw new Error("The coordinates of the destination location cannot be null or undefined.");if(t.equals(e))throw new Error("The destination location cannot be the same as the origin location.");if(!this.getActorByCoord(t).isPresent())throw new Error("There is no actor at the origin location.");if(this.getActorByCoord(e).isPresent())throw new Error("There is already an actor at the destination location.");{const r=this.popActorByCoord(t).orElseThrow();this.getLocation(e).orElseThrow().addActor(r)}}turnActor(t,e){if(null==t)throw new Error("The coordinates of the actor location cannot be null or undefined.");if(!this.getActorByCoord(t).isPresent())throw new Error("There is no actor at the origin location.");this.getActorByCoord(t).orElseThrow().turn(e)}getDirtsIDs(){const t=[];for(let[e,r]of this.grid){const e=r.getDirt();e.isPresent()&&t.push(e.orElseThrow().getID())}return t}getDirtByID(t){for(let[e,r]of this.grid){const e=r.getDirt();if(e.isPresent()&&e.orElseThrow().getID()===t)return e}return h.empty()}getDirtByCoord(t){return this.getLocation(t).flatMap((t=>t.getDirt()))}getDirtCoordByID(t){for(let[e,r]of this.grid){const n=r.getDirt();if(n.isPresent()&&n.orElseThrow().getID()===t)return h.of(e)}return h.empty()}cleanDirtByCoord(t){if(null==t)throw new Error("The coordinates of the dirt location cannot be null or undefined.");if(!this.getDirtByCoord(t).isPresent())throw new Error("There is no dirt at the location.");this.getLocation(t).orElseThrow().removeDirt()}addDirtToLocation(t,e){if(null==t)throw new Error("The coordinates of the location cannot be null or undefined.");if(null==e)throw new Error("The dirt cannot be null or undefined.");if(this.getDirtByCoord(t).isPresent())throw new Error("There is already a dirt at the location.");this.getLocation(t).ifPresent((t=>t.addDirt(e)))}}!function(t){t.GREEN="GREEN",t.ORANGE="ORANGE",t.WHITE="WHITE",t.USER="USER"}(w||(w={}));const D=r(429);class O{id;constructor(){this.id=D.v4()}getID(){return this.id}equals(t){return null!=t&&(this===t||t instanceof O&&this.id===t.id)}}class _{dirtID;colour;constructor(t,e){this.dirtID=_.validateDirtID(t),this.colour=_.validateColour(e)}static validateDirtID(t){if(null==t)throw new Error("The dirt ID cannot be null or undefined.");return t}static validateColour(t){if(null==t)throw new Error("The dirt colour cannot be null or undefined.");return t}getID(){return this.dirtID}getColour(){return this.colour}equals(t){return null!=t&&(this===t||t instanceof _&&this.dirtID===t.dirtID&&this.colour===t.colour)}}class S extends O{colour;constructor(t){super(),this.colour=S.validateColour(t)}static validateColour(t){if(null==t)throw new Error("The dirt colour cannot be null or undefined.");return t}getColour(){return this.colour}equals(t){return null!=t&&(this===t||t instanceof S&&super.equals(t)&&this.colour===t.colour)}getAppearance(){return new _(this.getID(),this.colour)}toJsonObject(){return{colour:this.getColour()}}static fromJsonObject(t){if(null==t)throw new Error("The dirt JSON object cannot be null or undefined.");if(null===t.colour||void 0===t.colour)throw new Error("The colour of a `VWDirt` cannot be null or undefined.");const e=t.colour;return new S(e)}}var L,W;!function(t){t.LEFT="left",t.RIGHT="right"}(L||(L={}));class B{actorID;colour;orientation;constructor(t,e,r){this.actorID=B.validateActorID(t),this.colour=B.validateColour(e),this.orientation=B.validateOrientation(r)}static validateActorID(t){if(null==t)throw new Error("The actor ID cannot be null or undefined.");return t}static validateColour(t){if(null==t)throw new Error("The actor colour cannot be null or undefined.");return t}static validateOrientation(t){if(null==t)throw new Error("The actor orientation cannot be null or undefined.");return t}getID(){return this.actorID}getColour(){return this.colour}getOrientation(){return this.orientation}}class R extends O{colour;orientation;mind;observationSensor;listeningSensor;physicalActuator;CommunicativeActuator;constructor(t,e,r,n,o,i,s){super(),this.colour=R.validateColour(t),this.orientation=R.validateOrientation(e),this.mind=R.validateMind(r),this.observationSensor=null==n?h.empty():h.of(n),this.listeningSensor=null==o?h.empty():h.of(o),this.physicalActuator=null==i?h.empty():h.of(i),this.CommunicativeActuator=null==s?h.empty():h.of(s)}static validateColour(t){if(null==t)throw new Error("The colour cannot be null or undefined.");return t}static validateOrientation(t){if(null==t)throw new Error("The orientation cannot be null or undefined.");return t}static validateMind(t){if(null==t)throw new Error("The mind cannot be null or undefined.");return t}getColour(){return this.colour}getOrientation(){return this.orientation}getMind(){return this.mind}getObservationSensor(){return this.observationSensor}getListeningSensor(){return this.listeningSensor}getPhysicalActuator(){return this.physicalActuator}getCommunicativeActuator(){return this.CommunicativeActuator}getAppearance(){return new B(this.getID(),this.getColour(),this.getOrientation())}turn(t){if(null==t)throw new Error("The turning direction cannot be null or undefined.");if(t===L.LEFT)this.orientation=y.getLeft(this.orientation);else{if(t!==L.RIGHT)throw new Error("The turning direction is invalid.");this.orientation=y.getRight(this.orientation)}}cycle(){const t=this.getObservationSensor().orElseThrow().sourceAll().orElseThrow(),e=R.mergeObservations(t),r=this.sourceMessages();this.getMind().perceive(e,r),this.getMind().revise(),this.getMind().decide();const n=this.getMind().execute();b.validateActions(n),this.executeActions(n)}sourceMessages(){const t=[];return this.getListeningSensor().ifPresent((e=>e.sourceAll().ifPresent((e=>t.push(...e))))),t}static mergeObservations(t){if(null==t)throw new Error("The observations array cannot be null or undefined.");if(t.some((t=>null==t)))throw new Error("The observations array cannot contain null or undefined observations.");if(0===t.length)throw new Error("At least one observation must be present.");if(1===t.length)return t[0];if(2===t.length){const e=t[0].getActionResults().concat(t[1].getActionResults());return new I(t[1].getLocations(),e)}throw new Error("At most two observations can be present.")}executeActions(t){for(const r of t)if(r instanceof o)this.getPhysicalActuator().orElseThrow().sink(r);else{if(!(r instanceof e))throw new Error("The action is not supported.");this.getCommunicativeActuator().orElseThrow().sink(r)}}toJsonObject(t){if(null==t)throw new Error("The actor mind core path cannot be null or undefined.");return{colour:this.getColour(),orientation:this.getOrientation(),mind:t}}}class x extends R{constructor(t,e,r,n,o,i,s){super(x.validateColourForCleaningAgent(t),e,r,n,o,i,s)}static validateColourForCleaningAgent(t){if(null==t)throw new Error("The colour cannot be null or undefined.");if(t===w.USER)throw new Error("The colour of a cleaning agent cannot be USER.");return t}}class k extends R{constructor(t,e,r,n){super(w.USER,t,e,r,void 0,n)}}class P{queue;constructor(){this.queue=[]}enqueue(t){if(null==t)throw new Error("The perception cannot be null or undefined.");this.queue.push(t)}dequeue(){const t=this.queue.shift();if(null==t)throw new Error("No perceptions to dequeue.");return t}peek(){const t=this.queue[0];if(null==t)throw new Error("No perceptions to peek.");return t}isEmpty(){return 0===this.queue.length}}class U{actions;constructor(){this.actions=new P}sink(t){if(null==t)throw new Error("The action cannot be null or undefined.");this.actions.enqueue(t)}sinkAll(t){if(null==t)throw new Error("The actions cannot be null or undefined.");t.forEach((t=>this.sink(t)))}source(){if(this.actions.isEmpty())throw new Error("No actions to source.");return this.actions.dequeue()}sourceAll(){if(this.actions.isEmpty())throw new Error("No actions to source.");{const t=[];for(;!this.actions.isEmpty();)t.push(this.actions.dequeue());return t}}hasPendingActions(){return!this.actions.isEmpty()}}class M extends U{}class N extends M{sink(t){if(null==t)throw new Error("The action cannot be null or undefined.");if(t instanceof s)throw new Error("A cleaning agent cannot drop dirt.");super.sink(t)}}class V extends U{}class F{perceptions;constructor(){this.perceptions=new P}sink(t){if(null==t)throw new Error("The perception cannot be null or undefined.");this.perceptions.enqueue(t)}sinkAll(t){if(null==t)throw new Error("The perceptions cannot be null or undefined.");t.forEach((t=>this.sink(t)))}source(){return this.perceptions.isEmpty()?h.empty():h.of(this.perceptions.dequeue())}sourceAll(){if(this.perceptions.isEmpty())return h.empty();{let t=[];for(;!this.perceptions.isEmpty();)t.push(this.perceptions.dequeue());return h.of(t)}}}class H extends F{}class G extends F{}class j extends M{sink(t){if(null==t)throw new Error("The action cannot be null or undefined.");if(t instanceof i)throw new Error("A user cannot clean dirt.");super.sink(t)}}class J{core;nextActions;constructor(t){this.core=J.validateCore(t),this.nextActions=[]}static validateCore(t){if(null==t)throw new Error("The mind core cannot be null or undefined.");return t}perceive(t,e){this.core.perceive(t,e)}revise(){this.core.revise()}decide(){this.nextActions=this.core.decide()}execute(){return this.nextActions}getMindCore(){return this.core}}class z extends J{constructor(t){super(t)}}!function(t){t[t.BASIC=0]="BASIC",t[t.ADVANCED=1]="ADVANCED"}(W||(W={}));class q{observation;messages;cumulativeEffort=0n;mindCoreFilePath;reviseMethod;decideMethod;getLatestObservation(){return this.observation}getLatestMessages(){return this.messages}getMindCoreFilePath(){return this.mindCoreFilePath}getOwnID(){return this.observation.getOwnID()}getOwnColour(){return this.observation.getOwnColour()}getOwnOrientation(){return this.observation.getOwnOrientation()}getOwnCoordinates(){return this.observation.getOwnCoordinates()}perceive(t,e){this.observation=q.validateObservation(t),this.messages=q.validateMessages(e)}static validateObservation(t){if(null==t)throw new Error("The observation cannot be null or undefined.");return t}static validateMessages(t){if(null==t)throw new Error("The messages cannot be null or undefined.");return t}revise(){if(null===this.reviseMethod||void 0===this.reviseMethod)throw new Error("The revise method cannot be null or undefined.");this.reviseMethod()}decide(){if(null===this.decideMethod||void 0===this.decideMethod)throw new Error("The decide method cannot be null or undefined.");return this.decideMethod()}getCumulativeEffort(){return this.cumulativeEffort}incrementEffort(t){if(null==t)throw new Error("The effort cannot be null or undefined.");this.cumulativeEffort+=t}static loadFromFile(t){throw new Error("Not yet implemented.")}construct(t,e,r){this.mindCoreFilePath=t,this.reviseMethod=e,this.decideMethod=r}}class K extends q{difficultyLevel;constructor(t){super(),this.difficultyLevel=null==t?W.BASIC:t}getDifficultyLevel(){return this.difficultyLevel}switchDifficultyLevel(){this.difficultyLevel===W.BASIC?this.difficultyLevel=W.ADVANCED:this.difficultyLevel=W.BASIC}revise(){}decide(){if(this.difficultyLevel===W.BASIC)return this.decideBasic();if(this.difficultyLevel===W.ADVANCED)return this.decideAdvanced();throw new Error("Unknown difficulty level.")}decideBasic(){return this.getLatestObservation().isWallImmediatelyAhead()?this.decideIfWallAheadAndBasic():this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.decideIfOnDirtAndBasic():this.actRandomly(.2,.2,.45,.075,.075)}decideIfWallAheadAndBasic(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?[new d(this.getOwnID(),L.RIGHT)]:this.getLatestObservation().isWallImmediatelyToTheRight()?[new d(this.getOwnID(),L.LEFT)]:this.turnRandomly()}decideIfOnDirtAndBasic(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?this.moveOrTurnRandomly(.6,0,.4):this.getLatestObservation().isWallImmediatelyToTheRight()?this.moveOrTurnRandomly(.6,.4,0):this.moveOrTurnRandomly(.5,.25,.25)}decideAdvanced(){return this.getLatestObservation().isWallImmediatelyAhead()?this.decideIfWallAheadAndAdvanced():this.isActorImmediatelyAhead()?this.decideIfActorAheadAndAdvanced():this.isActorImmediatelyToTheLeft()&&this.isActorImmediatelyToTheRight()?this.dropOrMoveRandomly(.1,.1,.8):this.isActorImmediatelyToTheLeft()&&!this.getLatestObservation().isWallImmediatelyToTheRight()?this.moveOrTurnRandomly(.5,0,.5):this.isActorImmediatelyToTheRight()&&!this.getLatestObservation().isWallImmediatelyToTheLeft()?this.moveOrTurnRandomly(.5,.5,0):this.getLatestObservation().isWallImmediatelyToTheLeft()?this.decideIfWallToTheLeftAndAdvanced():this.getLatestObservation().isWallImmediatelyToTheRight()?this.decideIfWallToTheRightAndAdvanced():this.actRandomly(.15,.15,.6,.05,.05)}decideIfWallAheadAndAdvanced(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?[new d(this.getOwnID(),L.RIGHT)]:this.getLatestObservation().isWallImmediatelyToTheRight()?[new d(this.getOwnID(),L.LEFT)]:this.isActorImmediatelyToTheLeft()&&this.isActorImmediatelyToTheRight()?this.turnRandomly():this.isActorImmediatelyToTheLeft()?[new d(this.getOwnID(),L.RIGHT)]:this.isActorImmediatelyToTheRight()?[new d(this.getOwnID(),L.LEFT)]:this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.turnRandomly():this.actRandomly(.075,.075,.6,0,.25)}decideIfWallToTheLeftAndAdvanced(){return this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.moveOrTurnRandomly(.9,0,.1):this.actRandomly(.075,.075,.6,0,.25)}decideIfWallToTheRightAndAdvanced(){return this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.moveOrTurnRandomly(.9,.1,0):this.actRandomly(.075,.075,.6,.25,0)}decideIfActorAheadAndAdvanced(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?[new d(this.getOwnID(),L.RIGHT)]:this.getLatestObservation().isWallImmediatelyToTheRight()?[new d(this.getOwnID(),L.LEFT)]:this.isActorImmediatelyToTheLeft()&&this.isActorImmediatelyToTheRight()?this.dropRandomDirt():this.isActorImmediatelyToTheLeft()?[new d(this.getOwnID(),L.RIGHT)]:this.isActorImmediatelyToTheRight()?[new d(this.getOwnID(),L.LEFT)]:this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.turnRandomly():this.actRandomly(.25,.25,0,.25,.25)}isActorImmediatelyAhead(){return!this.getLatestObservation().isWallImmediatelyAhead()&&this.getLatestObservation().getCenter().orElseThrow().hasActor()}isActorImmediatelyToTheLeft(){return!this.getLatestObservation().isWallImmediatelyToTheLeft()&&this.getLatestObservation().getLeft().orElseThrow().hasActor()}isActorImmediatelyToTheRight(){return!this.getLatestObservation().isWallImmediatelyToTheRight()&&this.getLatestObservation().getRight().orElseThrow().hasActor()}actRandomly(t,e,r,n,o){K.validateWeights([t,e,r,n,o]);const i=Math.random(),a=(c=0,t=>c+=t);var c;const h=[t,e,r,n,o].map(a);if(i<h[0])return[new s(this.getOwnID(),w.GREEN)];if(i<h[1])return[new s(this.getOwnID(),w.ORANGE)];if(i<h[2])return[new l(this.getOwnID())];if(i<h[3])return[new d(this.getOwnID(),L.LEFT)];if(i<h[4])return[new d(this.getOwnID(),L.RIGHT)];throw new Error("This should never happen.")}static validateWeights(t){if(null==t)throw new Error("Weights cannot be null or undefined.");if(t.some((t=>null==t)))throw new Error("Weights cannot contain null or undefined values.");if(t.some((t=>t<0)))throw new Error("Weights cannot be negative.");if(t.some((t=>t>1)))throw new Error("Weights cannot be greater than 1.0.");K.validateWeightsSum(t.reduce(((t,e)=>t+e),0))}static validateWeightsSum(t){if(t<1)throw new Error("Weights cannot sum to less than 1.0.");if(t>1)throw new Error("Weights cannot sum to more than 1.0.")}turnRandomly(){return this.actRandomly(0,0,0,.5,.5)}moveOrTurnRandomly(t,e,r){return this.actRandomly(0,0,t,e,r)}dropOrMoveRandomly(t,e,r){return this.actRandomly(t,e,r,0,0)}dropRandomDirt(){return this.actRandomly(.5,.5,0,0,0)}}class $ extends J{constructor(){super(new K)}}class X extends q{constructor(){super(),this.construct("/index.js",this.revise,this.decide)}revise(){}decide(){return[new a(this.getOwnID())]}}class Y{constructor(){}static createVWActorFromJSONObject(t){if(null==t)throw new Error("The JSON representation of a `VWActor` cannot be null or undefined.");if(null===t.colour||void 0===t.colour)throw new Error("The colour of a `VWActor` cannot be null or undefined.");if(t.colour===w.USER)return this.createVWUserFromJSONObject(t);if(Object.values(w).includes(t.colour))return this.createVWCleaningAgentFromJSONObject(t);throw new Error(`The colour of a \`VWActor\` cannot be "${t.colour}".`)}static createVWCleaningAgentFromJSONObject(t){if(null==t)throw new Error("The JSON representation of a `VWCleaningAgent` cannot be null or undefined.");if(null===t.colour||void 0===t.colour)throw new Error("The colour of a `VWCleaningAgent` cannot be null or undefined.");if(t.colour===w.USER)throw new Error(`The colour of a \`VWCleaningAgent\` cannot be "${w.USER}".`);if(Object.values(w).includes(t.colour)){if(null===t.orientation||void 0===t.orientation)throw new Error("The orientation of a `VWCleaningAgent` cannot be null or undefined.");if(Object.values(f).includes(t.orientation)){if(null===t.mind||void 0===t.mind)throw new Error("The path of the mind of a `VWCleaningAgent` cannot be null or undefined.");{const e=w[t.colour],r=f[t.orientation],n="hysteretic"==t.mind?new X:q.loadFromFile(t.mind),o=new z(n),i=new G,s=new H,a=new N,l=new V;return new x(e,r,o,i,s,a,l)}}throw new Error(`The orientation of a \`VWCleaningAgent\` cannot be "${t.orientation}".`)}throw new Error(`The colour of a \`VWCleaningAgent\` cannot be "${t.colour}".`)}static createVWUserFromJSONObject(t){if(null==t)throw new Error("The JSON representation of a `VWUser` cannot be null or undefined.");if(null===t.colour||void 0===t.colour)throw new Error("The colour of a `VWUser` cannot be null or undefined.");if(t.colour!==w.USER)throw new Error(`The colour of a \`VWUser\` must be "${w.USER}".`);if(null===t.orientation||void 0===t.orientation)throw new Error("The orientation of a `VWUser` cannot be null or undefined.");if(Object.values(f).includes(t.orientation)){const e=f[t.orientation],r=new $,n=new G,o=new j;return new k(e,r,n,o)}throw new Error(`The orientation of a \`VWUser\` cannot be "${t.orientation}".`)}}class Q{coord;actorAppearance;dirtAppearance;wall;constructor(t,e,r,n){this.coord=Q.validateCoord(t),this.wall=Q.validateWall(e),this.actorAppearance=h.ofNullable(r),this.dirtAppearance=h.ofNullable(n)}static validateCoord(t){if(null==t)throw new Error("The coordinates cannot be null or undefined.");return t}static validateWall(t){if(null==t)throw new Error("The wall cannot be null or undefined.");if(4!==t.size)throw new Error("The wall must have 4 sides.");if(t.has(f.NORTH)&&t.has(f.EAST)&&t.has(f.SOUTH)&&t.has(f.WEST))return t;throw new Error("The wall must have 4 sides.")}getID(){return this.coord.toString()}getCoord(){return this.coord}hasActor(){return this.actorAppearance.isPresent()}hasCleaningAgent(){return this.actorAppearance.isPresent()&&this.actorAppearance.orElseThrow().getColour()!==w.USER}hasUser(){return this.actorAppearance.isPresent()&&this.actorAppearance.orElseThrow().getColour()===w.USER}getActorAppearance(){return this.actorAppearance}hasDirt(){return this.dirtAppearance.isPresent()}getDirtAppearance(){return this.dirtAppearance}getWall(){return this.wall}hasWallOn(t){return this.wall.get(t)}hasWallOnNorth(){return this.hasWallOn(f.NORTH)}hasWallOnEast(){return this.hasWallOn(f.EAST)}hasWallOnSouth(){return this.hasWallOn(f.SOUTH)}hasWallOnWest(){return this.hasWallOn(f.WEST)}}class Z{coord;actor;dirt;wall;constructor(t,e,r,n){this.coord=Z.validateCoord(t),this.wall=Z.validateWall(e),this.actor=h.ofNullable(r),this.dirt=h.ofNullable(n)}static validateCoord(t){if(null==t)throw new Error("The coordinates cannot be null or undefined.");return t}static validateWall(t){if(null==t)throw new Error("The wall cannot be null or undefined.");if(4!==t.size)throw new Error("The wall must have 4 sides.");if(t.has(f.NORTH)&&t.has(f.EAST)&&t.has(f.SOUTH)&&t.has(f.WEST))return t;throw new Error("The wall must have 4 sides.")}hasActor(){return this.actor.isPresent()}hasCleaningAgent(){return this.actor.isPresent()&&this.actor.orElseThrow().getAppearance().getColour()!==w.USER}hasUser(){return this.actor.isPresent()&&this.actor.orElseThrow().getAppearance().getColour()===w.USER}getActor(){return this.actor}addActor(t){if(this.hasActor())throw new Error("There is already an actor in this location.");if(null==t)throw new Error("The actor cannot be null or undefined.");this.actor=h.of(t)}removeActor(){if(!this.hasActor())throw new Error("There is no actor in this location.");this.actor=h.empty()}popActor(){const t=this.getActor();return t.isPresent()&&this.removeActor(),t}hasDirt(){return this.dirt.isPresent()}getDirt(){return this.dirt}addDirt(t){if(this.hasDirt())throw new Error("There is already a dirt in this location.");if(null==t)throw new Error("The dirt cannot be null or undefined.");this.dirt=h.of(t)}removeDirt(){if(!this.hasDirt())throw new Error("There is no dirt in this location.");this.dirt=h.empty()}getCoord(){return this.coord}getWall(){return this.wall}hasWallOn(t){return this.wall.get(t)}hasWallOnNorth(){return this.hasWallOn(f.NORTH)}hasWallOnEast(){return this.hasWallOn(f.EAST)}hasWallOnSouth(){return this.hasWallOn(f.SOUTH)}hasWallOnWest(){return this.hasWallOn(f.WEST)}getAppearance(){return this.hasActor()&&this.hasDirt()?new Q(this.coord,this.wall,this.getActor().orElseThrow().getAppearance(),this.getDirt().orElseThrow().getAppearance()):this.hasActor()?new Q(this.coord,this.wall,this.getActor().orElseThrow().getAppearance(),void 0):this.hasDirt()?new Q(this.coord,this.wall,void 0,this.getDirt().orElseThrow().getAppearance()):new Q(this.coord,this.wall)}toJsonObject(t){const e={coord:this.coord.toJsonObject(),wall:{north:this.hasWallOnNorth(),east:this.hasWallOnEast(),south:this.hasWallOnSouth(),west:this.hasWallOnWest()}};return this.hasActor()&&(e.actor=this.getActor().orElseThrow().toJsonObject(t)),this.hasDirt()&&(e.dirt=this.getDirt().orElseThrow().toJsonObject()),e}static fromJsonObject(t){if(null==t)throw new Error("The JSON representation of a `VWLocation` cannot be null or undefined.");if(null===t.wall||void 0===t.wall)throw new Error("The JSON representation of a `VWLocation` must have a `wall` property.");if(null===t.coord||void 0===t.coord)throw new Error("The JSON representation of a `VWLocation` must have a `coord` property.");return Z.fromJsonObjectHelper(p.fromJsonObject(t.coord),t.wall,t.actor,t.dirt)}static fromJsonObjectHelper(t,e,r,n){const o=Z.constructWallFromData(e),i=null==r?h.empty():h.of(Y.createVWActorFromJSONObject(r)),s=null==n?h.empty():h.of(S.fromJsonObject(n));return i.isPresent()&&s.isPresent()?new Z(t,o,i.orElseThrow(),s.orElseThrow()):i.isPresent()?new Z(t,o,i.orElseThrow(),void 0):s.isPresent()?new Z(t,o,void 0,s.orElseThrow()):new Z(t,o)}static constructWallFromData(t){const e=new Map;if(null==t)throw new Error("The wall cannot be null or undefined.");if(null===t.north||void 0===t.north)throw new Error("The wall must have a `north` property.");if(null===t.east||void 0===t.east)throw new Error("The wall must have an `east` property.");if(null===t.south||void 0===t.south)throw new Error("The wall must have a `south` property.");if(null===t.west||void 0===t.west)throw new Error("The wall must have a `west` property.");return e.set(f.NORTH,t.north),e.set(f.EAST,t.east),e.set(f.SOUTH,t.south),e.set(f.WEST,t.west),e}static generateWallFromCoordAndGridSize(t,e){const r=new Map;return r.set(f.NORTH,0n===t.getY()),r.set(f.EAST,t.getX()===BigInt(e)-1n),r.set(f.SOUTH,t.getY()===BigInt(e)-1n),r.set(f.WEST,0n===t.getX()),r}}class tt{actorColourBeforeAction;actorOrientationBeforeAction;actorCoordBeforeAction;dirtBeforeAction;getActorColourBeforeAction(){return this.actorColourBeforeAction}setActorColourBeforeAction(t){if(null==t)throw new Error("The actor colour cannot be null or undefined.");this.actorColourBeforeAction=t}getActorOrientationBeforeAction(){return this.actorOrientationBeforeAction}setActorOrientationBeforeAction(t){if(null==t)throw new Error("The actor orientation cannot be null or undefined.");this.actorOrientationBeforeAction=t}getActorCoordBeforeAction(){return this.actorCoordBeforeAction}setActorCoordBeforeAction(t){if(null==t)throw new Error("The actor coord cannot be null or undefined.");this.actorCoordBeforeAction=t}getDirtBeforeAction(){return this.dirtBeforeAction}setDirtBeforeAction(t){if(null==t)throw new Error("The dirt cannot be null or undefined.");this.dirtBeforeAction=t}attempt(t,e){if(null==t)throw new Error("The action cannot be null or undefined.");if(null==e)throw new Error("The environment cannot be null or undefined.");if(this.isPossible(t,e)){this.setActorColourBeforeAction(e.getActorByID(t.getActorID()).orElseThrow().getColour()),this.setActorOrientationBeforeAction(e.getActorByID(t.getActorID()).orElseThrow().getOrientation()),this.setActorCoordBeforeAction(e.getActorCoordByID(t.getActorID()).orElseThrow()),this.setDirtBeforeAction(e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getDirt());const r=this.perform(t,e);return this.succeeded(t,e)?r:new m(u.FAILURE,t)}return new m(u.FAILURE,t)}static isActorInEnv(t,e){return e.getActorByID(t).isPresent()}checkAllInvariants(t,e){return tt.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkOrientationAfterAction(t,e)&&this.checkCoordAfterAction(t,e)&&this.checkDirtAfterAction(e)}checkColourAfterAction(t,e){return this.getActorColourBeforeAction()===e.getActorByID(t.getActorID()).orElseThrow().getColour()}checkOrientationAfterAction(t,e){return this.getActorOrientationBeforeAction()===e.getActorByID(t.getActorID()).orElseThrow().getOrientation()}checkCoordAfterAction(t,e){return this.getActorCoordBeforeAction().equals(e.getActorCoordByID(t.getActorID()).orElseThrow())}checkDirtAfterAction(t){return this.getDirtBeforeAction().equals(t.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getDirt())}}class et extends tt{isPossible(t,e){try{return tt.isActorInEnv(t.getActorID(),e)&&e.getActorByID(t.getActorID()).orElseThrow().getCommunicativeActuator().isPresent()}catch(t){return!1}}perform(t,e){try{return e.sendMessageToRecipients(t)?new m(u.SUCCESS,t):new m(u.FAILURE,t)}catch(e){return new m(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)}catch(t){return!1}}checkInvariants(t,e){return this.checkAllInvariants(t,e)}}class rt extends tt{isPossible(t,e){try{return tt.isActorInEnv(t.getActorID(),e)&&rt.isActorCleaningAgent(t,e)&&rt.actorLocationHasCompatibleDirt(t,e)}catch(t){return!1}}static isActorCleaningAgent(t,e){const r=e.getActorByID(t.getActorID()).orElseThrow().getColour();return Object.values(w).includes(r)&&r!==w.USER}static actorLocationHasCompatibleDirt(t,e){const r=e.getActorCoordByID(t.getActorID()),n=e.getActorByID(t.getActorID()).orElseThrow().getColour();return r.isPresent()&&e.getLocation(r.orElseThrow()).orElseThrow().hasDirt()&&rt.canClean(n,r,e)}static canClean(t,e,r){return t===w.WHITE||t===r.getLocation(e.orElseThrow()).orElseThrow().getDirt().orElseThrow().getColour()}perform(t,e){try{return e.cleanDirtByCoord(this.getActorCoordBeforeAction()),new m(u.SUCCESS,t)}catch(t){return new m(u.FAILURE,t.message)}}succeeded(t,e){try{return this.checkInvariants(t,e)&&this.checkDirtRemoved(e)}catch(t){return!1}}checkInvariants(t,e){return tt.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkOrientationAfterAction(t,e)&&this.checkCoordAfterAction(t,e)}checkDirtRemoved(t){return!t.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasDirt()}}class nt extends tt{isPossible(t,e){try{return tt.isActorInEnv(t.getActorID(),e)&&nt.isActorUser(t,e)&&nt.actorLocationHasNoDirt(t,e)}catch(t){return!1}}static isActorUser(t,e){return e.getActorByID(t.getActorID()).orElseThrow().getColour()===w.USER}static actorLocationHasNoDirt(t,e){const r=e.getActorCoordByID(t.getActorID());return r.isPresent()&&!e.getLocation(r.orElseThrow()).orElseThrow().hasDirt()}perform(t,e){try{return e.addDirtToLocation(this.getActorCoordBeforeAction(),new S(t.getColour())),new m(u.SUCCESS,t)}catch(e){return new m(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)&&this.checkDirtAdded(t,e)}catch(t){return!1}}checkInvariants(t,e){return tt.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkOrientationAfterAction(t,e)&&this.checkCoordAfterAction(t,e)}checkDirtAdded(t,e){return e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasDirt()&&e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getDirt().orElseThrow().getColour()===t.getColour()}}class ot extends tt{isPossible(t,e){try{return tt.isActorInEnv(t.getActorID(),e)}catch(t){return!1}}perform(t,e){try{return new m(u.SUCCESS,t)}catch(e){return new m(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)}catch(t){return!1}}checkInvariants(t,e){return this.checkAllInvariants(t,e)}}class it extends tt{isPossible(t,e){try{return tt.isActorInEnv(t.getActorID(),e)&&it.targetExists(t,e)&&it.targetHasNoActor(t,e)}catch(t){return!1}}static targetExists(t,e){const r=e.getActorCoordByID(t.getActorID()),n=e.getActorByID(t.getActorID()).orElseThrow().getOrientation();return r.isPresent()&&!e.getLocation(r.orElseThrow()).orElseThrow().hasWallOn(n)}static targetHasNoActor(t,e){try{const r=e.getActorCoordByID(t.getActorID());return r.isPresent()&&!e.getLocation(r.orElseThrow()).orElseThrow().hasActor()}catch(t){return!1}}perform(t,e){try{const r=this.getActorCoordBeforeAction().getForwardCoord(this.getActorOrientationBeforeAction());return e.getLocation(r).isPresent()?(e.moveActor(this.getActorCoordBeforeAction(),r),new m(u.SUCCESS,t)):new m(u.FAILURE,t)}catch(e){return new m(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)&&this.checkOriginalLocation(t,e)&&it.checkTargetLocation(t,e)}catch(t){return!1}}checkInvariants(t,e){return tt.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkOrientationAfterAction(t,e)&&this.checkDirtAfterAction(e)}checkOriginalLocation(t,e){return this.noActorInOriginalLocation(e)||this.differentActorInOriginalLocation(t.getActorID(),e)}noActorInOriginalLocation(t){return!t.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasActor()}differentActorInOriginalLocation(t,e){return e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasActor()&&e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getActor().orElseThrow().getID()!==t}static checkTargetLocation(t,e){const r=e.getActorCoordByID(t.getActorID());return r.isPresent()&&e.getLocation(r.orElseThrow()).orElseThrow().hasActor()&&e.getLocation(r.orElseThrow()).orElseThrow().getActor().orElseThrow().getID()===t.getActorID()}}class st extends tt{isPossible(t,e){try{return tt.isActorInEnv(t.getActorID(),e)&&e.getActorByID(t.getActorID()).orElseThrow().getCommunicativeActuator().isPresent()}catch(t){return!1}}perform(t,e){try{return e.sendMessageToRecipients(t)?new m(u.SUCCESS,t):new m(u.FAILURE,t)}catch(e){return new m(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)}catch(t){return!1}}checkInvariants(t,e){return this.checkAllInvariants(t,e)}}class at extends tt{isPossible(t,e){try{return tt.isActorInEnv(t.getActorID(),e)}catch(t){return!1}}perform(t,e){try{return e.turnActor(this.getActorCoordBeforeAction(),t.getTurningDirection()),new m(u.SUCCESS,t)}catch(e){return new m(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)&&this.checkOrientationAfterTurn(t,e)}catch(t){return!1}}checkInvariants(t,e){return tt.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkCoordAfterAction(t,e)&&this.checkDirtAfterAction(e)}checkOrientationAfterTurn(t,e){const r=e.getActorByID(t.getActorID()).orElseThrow().getOrientation();return t.getTurningDirection()===L.LEFT?r===y.getLeft(this.getActorOrientationBeforeAction()):t.getTurningDirection()===L.RIGHT&&r===y.getRight(this.getActorOrientationBeforeAction())}}class lt{ambient;cycleNumber;constructor(t){this.ambient=lt.validateAmbient(t),this.cycleNumber=0}static validateAmbient(t){if(null==t)throw new Error("The ambient cannot be null or undefined.");return t}getAmbient(){return this.ambient}getCycleNumber(){return this.cycleNumber}resetCycleNumber(){this.cycleNumber=0}getGridSize(){return this.ambient.getGridSize()}getLocation(t){return this.ambient.getLocation(t)}getActorsIDs(){return this.ambient.getActorsIDs()}getActorsIDsExcept(t){return this.ambient.getActorsIDsExcept(t)}getActorByID(t){return this.ambient.getActorByID(t)}getActorByCoord(t){return this.ambient.getActorByCoord(t)}getActorCoordByID(t){return this.ambient.getActorCoordByID(t)}addActorToLocation(t,e){this.ambient.addActorToLocation(t,e)}moveActor(t,e){this.ambient.moveActor(t,e)}turnActor(t,e){this.ambient.turnActor(t,e)}getDirtsIDs(){return this.ambient.getDirtsIDs()}getDirtByID(t){return this.ambient.getDirtByID(t)}getDirtByCoord(t){return this.ambient.getDirtByCoord(t)}getDirtCoordByID(t){return this.ambient.getDirtCoordByID(t)}cleanDirtByCoord(t){this.ambient.cleanDirtByCoord(t)}addDirtToLocation(t,e){this.ambient.addDirtToLocation(t,e)}cycle(){0===this.cycleNumber&&this.forceInitialPerceptionToActors(),this.ambient.getActors().forEach((t=>this.cycleActor(t))),this.cycleNumber++}forceInitialPerceptionToActors(){this.ambient.getActors().forEach((t=>this.forceInitialPerceptionToActor(t)))}forceInitialPerceptionToActor(t){const e=new m(u.IMPOSSIBLE,new a(t.getID()));this.sendResultToActor(e,!1)}cycleActor(t){t.cycle(),this.executeActorActions(t)}executeActorActions(t){const e=[];t.getPhysicalActuator().orElseThrow().hasPendingActions()&&t.getPhysicalActuator().orElseThrow().sourceAll().forEach((t=>e.push(t))),t.getCommunicativeActuator().isPresent()&&t.getCommunicativeActuator().orElseThrow().hasPendingActions()&&t.getCommunicativeActuator().orElseThrow().sourceAll().forEach((t=>e.push(t))),b.validateActions(e),e.forEach((t=>this.executeAction(t)))}executeAction(t){lt.getExecutorFor(t).ifPresentOrElse((e=>{const r=e.attempt(t,this);this.sendResultToActor(r,!0)}),(()=>{throw new Error("No executor found for the action "+t+".")}))}static getExecutorFor(t){return t instanceof a?h.of(new ot):t instanceof l?h.of(new it):t instanceof d?h.of(new at):t instanceof i?h.of(new rt):t instanceof s?h.of(new nt):t instanceof c?h.of(new st):t instanceof n?h.of(new et):h.empty()}sendResultToActor(t,e){const r=new Map,n=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow(),o=this.getActorByCoord(n).orElseThrow().getOrientation(),i=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getForwardCoord(o),s=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getLeftCoord(o),a=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getRightCoord(o),l=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getForwardLeftCoord(o),c=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getForwardRightCoord(o);this.ambient.getGrid().containsKey(n)&&r.set(g.CENTER,this.ambient.getGrid().get(n).getAppearance()),this.ambient.getGrid().containsKey(i)&&r.set(g.FORWARD,this.ambient.getGrid().get(i).getAppearance()),this.ambient.getGrid().containsKey(s)&&r.set(g.LEFT,this.ambient.getGrid().get(s).getAppearance()),this.ambient.getGrid().containsKey(a)&&r.set(g.RIGHT,this.ambient.getGrid().get(a).getAppearance()),this.ambient.getGrid().containsKey(l)&&r.set(g.FORWARDLEFT,this.ambient.getGrid().get(l).getAppearance()),this.ambient.getGrid().containsKey(c)&&r.set(g.FORWARDRIGHT,this.ambient.getGrid().get(c).getAppearance());const d=new I(r,[t]);this.getActorByCoord(n).orElseThrow().getObservationSensor().ifPresent((t=>t.sink(d))),this.getActorByCoord(n).orElseThrow().getMind().getMindCore().incrementEffort(e?t.getAction().getEffort():0n)}sendMessageToRecipients(t){try{return(t.getRecipientsIDs().length>0?t.getRecipientsIDs():this.getActorsIDsExcept(t.getActorID())).forEach((e=>this.sendMessageToRecipient(t,e))),!0}catch(t){return!1}}sendMessageToRecipient(t,e){this.getActorByID(e).ifPresent((r=>r.getListeningSensor().ifPresent((r=>r.sink(new T(t.getContent(),t.getActorID(),e))))))}toJsonObject(){return{locations:this.serialiseLocations()}}serialiseLocations(){let t=[];for(let e of this.ambient.getGrid().getValues())t.push(this.serialiseLocation(e));return t}serialiseLocation(t){if(null==t)throw new Error("The location cannot be null or undefined.");if(t.hasActor()){const e=this.getActorMindCorePath(t.getActor().orElseThrow().getMind().getMindCore());return t.toJsonObject(e)}return t.toJsonObject()}getActorMindCorePath(t){return t.getMindCoreFilePath()}static fromJsonObject(t,e){if(null==t)throw new Error("The data cannot be null or undefined.");if(null===t.locations||void 0===t.locations)throw new Error("The data must contain a 'locations' property.");if(Array.isArray(t.locations)){if(t.locations.some((t=>null==t)))throw new Error("The 'locations' array cannot contain null or undefined values.");if(null==e)throw new Error("The config cannot be null or undefined.");return lt.fromJsonObjectHelper(t,e)}throw new Error("The 'locations' property must be an array.")}static fromJsonObjectHelper(t,e){const r=lt.loadLocations(t.locations);return lt.validateGrid(r,e),new lt(new C(r))}static loadLocations(t){const e=new A;for(const r of t){if(null===r.coord||void 0===r.coord)throw new Error("The location coordinates cannot be null or undefined.");e.put(p.fromJsonObject(r.coord),Z.fromJsonObject(r))}return e}static validateGrid(t,e){if(null==t)throw new Error("The grid cannot be null or undefined.");if(null==e)throw new Error("The config cannot be null or undefined.");if(null===e.min_environment_dim||void 0===e.min_environment_dim)throw new Error("The config must contain a 'min_environment_dim' property.");if(null===e.max_environment_dim||void 0===e.max_environment_dim)throw new Error("The config must contain a 'max_environment_dim' property.");lt.validateGridHelper(t,e)}static validateGridHelper(t,e){const r=Math.sqrt(t.size());lt.validateGridSize(r,e)}static validateGridSize(t,e){if(t!==Math.floor(t))throw new Error("The grid must be a square.");if(t<e.min_environment_dim)throw new Error(`The grid size is too small (min: "${e.min_environment_dim}").`);if(t>e.max_environment_dim)throw new Error(`The grid size is too big (max: "${e.max_environment_dim}").`)}static newEmptyVWEnvironment(t,e){if(null==t)throw new Error("The config cannot be null or undefined.");return lt.newEmptyVWEnvironmentHelper(t,e)}static newEmptyVWEnvironmentHelper(t,e){const r=null==e?BigInt(t.initial_environment_dim):e;lt.validateGridSize(Number(r),t);const n=new A;for(let t=0n;t<r;t++)for(let e=0n;e<r;e++){const o=new p(t,e);n.put(o,new Z(o,Z.generateWallFromCoordAndGridSize(o,r)))}return new lt(new C(n))}}class ct{constructor(){}static displayError(t){document.getElementById("error_div").innerText=t,document.getElementById("error_div").removeAttribute("hidden"),document.getElementById("error_div").addEventListener("click",(()=>ct.hideError()))}static hideError(){document.getElementById("error_div").innerText="",document.getElementById("error_div").hidden=!0}}class dt{cell;locationAppearance;displayedImage;packed;constructor(t){this.locationAppearance=dt.validateLocationAppearance(t),this.createLocationImage(),this.packed=!1,this.cell=document.createElement("div"),this.cell.classList.add("cell"),this.cell.id=`cell-${t.getCoord().getX()}-${t.getCoord().getY()}`}static validateLocationAppearance(t){if(null==t)throw new Error("Cannot create a cell without a location appearance.");return t}createLocationImage(){this.displayedImage=document.createElement("img"),this.displayedImage.src=this.getCellImageSrc(),this.displayedImage.classList.add("location-image")}getCellImageSrc(){if(null===this.locationAppearance||void 0===this.locationAppearance)throw new Error("Cannot get the image src for a cell for which no location appearance is available.");return this.locationAppearance.hasActor()?this.getCellImageSrcIfActorIsPresent():this.locationAppearance.hasDirt()?this.getCellImageSrcIfDirtIsPresent():"envs/vacuumworld-ts/res/images/locations/empty.png"}getCellImageSrcIfActorIsPresent(){const t=this.locationAppearance.getActorAppearance().orElseThrow().getOrientation(),e=this.locationAppearance.getActorAppearance().orElseThrow().getColour(),r=t.toString().toLowerCase();return`envs/vacuumworld-ts/res/images/locations/actor/${e.toString().toLowerCase()}_${r}.png`}getCellImageSrcIfDirtIsPresent(){return`envs/vacuumworld-ts/res/images/locations/dirt/${this.locationAppearance.getDirtAppearance().orElseThrow().getColour().toString().toLowerCase()}_dirt.png`}pack(){if(null===this.displayedImage||void 0===this.displayedImage)throw new Error("Cannot pack a cell that has no image");if(null===this.locationAppearance||void 0===this.locationAppearance)throw new Error("Cannot pack a cell for which no location appearance is available.");if(null===this.cell||void 0===this.cell)throw new Error("Cannot pack a non-existent cell.");this.packed||(this.cell.appendChild(this.displayedImage),this.packed=!0)}unpack(){this.packed&&(this.cell.removeChild(this.displayedImage),this.locationAppearance=null,this.displayedImage=null,this.packed=!1)}isPacked(){return this.packed}getCell(){return this.cell}}class ht{gridSize;gridDiv;grid;packed;constructor(t,e){this.gridSize=ht.validateGridSize(t),this.gridDiv=document.createElement("div"),this.gridDiv.classList.add("grid","center-aligned"),this.grid=ht.validateGrid(e),this.packed=!1}static validateGridSize(t){if(null==t||t<=0)throw new Error("Cannot create a grid with no size.");return t}static validateGrid(t){if(null==t)throw new Error("Cannot create a grid without cells.");if([...t.getKeys()].some((t=>null==t)))throw new Error("Cannot create a grid with null or undefined coordinates.");if([...t.getValues()].some((t=>null==t)))throw new Error("Cannot create a grid with null or undefined cells.");return t}pack(){if(null===this.gridSize||void 0===this.gridSize||this.gridSize<=0)throw new Error("Cannot pack a grid that has no size.");if(null===this.gridDiv||void 0===this.gridDiv)throw new Error("Cannot pack a grid that has no div.");if(null===this.grid||void 0===this.grid)throw new Error("Cannot pack a grid that has no cells.");if(!this.packed){this.grid.forEach((t=>t.pack()));let t=this.createTableForGrid();this.gridDiv.appendChild(t),this.packed=!0}}show(){if(null===this.gridDiv||void 0===this.gridDiv)throw new Error("Cannot show a grid that has no div.");document.getElementById("grid_div").appendChild(this.gridDiv),document.getElementById("grid_div").removeAttribute("hidden")}createTableForGrid(){let t=document.createElement("table");t.classList.add("grid-table");for(let e=0;e<this.gridSize;e++){let r=document.createElement("tr");r.classList.add("grid-row");for(let t=0;t<this.gridSize;t++){let n=document.createElement("td");n.classList.add("grid-cell");const o=new p(BigInt(t),BigInt(e));n.appendChild(this.grid.get(o).getCell()),r.appendChild(n)}t.appendChild(r)}return t}unpack(){this.packed&&(this.gridDiv.removeChild(this.gridDiv.firstChild),this.grid.forEach((t=>t.unpack())),this.grid=null,this.packed=!1)}}class ut{gridSize;config;grid;environment;constructor(t,e){this.config=ut.validateConfig(e),this.gridSize=ut.validateGridSize(t,e),this.environment=ut.validateEnvironment(t),this.grid=this.createGrid()}pack(){this.grid.pack()}show(){null!==document.getElementById("initial_view_div").firstChild&&(document.getElementById("initial_view_div").removeChild(document.getElementById("initial_view_div").firstChild),document.getElementById("initial_view_div").hidden=!0),null!==document.getElementById("start_button")&&document.getElementById("initial_view_buttons_div").removeChild(document.getElementById("start_button")),null!==document.getElementById("options_button")&&document.getElementById("initial_view_buttons_div").removeChild(document.getElementById("options_button")),null!==document.getElementById("guide_button")&&document.getElementById("initial_view_buttons_div").removeChild(document.getElementById("guide_button")),document.getElementById("initial_view_buttons_div").hidden=!0,this.grid.show()}unpack(){this.grid.unpack(),document.getElementById("grid_div").removeChild(document.getElementById("grid_div").firstChild)}static validateConfig(t){if(null==t)throw new Error("Cannot create a simulation GUI without a config.");return t}static validateGridSize(t,e){if(ut.validateEnvironment(t),ut.validateConfig(e),null===e.min_environment_dim||void 0===e.min_environment_dim||e.min_environment_dim<=0)throw new Error("Invalid config.");if(null===e.max_environment_dim||void 0===e.max_environment_dim||e.max_environment_dim<=0)throw new Error("Invalid config.");if(e.min_environment_dim>e.max_environment_dim)throw new Error("Invalid config.");if(t.getGridSize()<e.min_environment_dim||t.getGridSize()>e.max_environment_dim)throw new Error("Invalid environment.");return t.getGridSize()}static validateEnvironment(t){if(null==t)throw new Error("Cannot create a simulation GUI without an environment.");return t}createEmptyGrid(t){let e=new A;for(let r=0;r<t;r++)for(let n=0;n<t;n++){const o=new p(BigInt(r),BigInt(n)),i=new Q(o,Z.generateWallFromCoordAndGridSize(o,BigInt(t)));e.put(o,new dt(i))}return new ht(t,e)}createGrid(){let t=new A;return this.environment.getAmbient().getGrid().forEach(((e,r)=>{t.put(r,new dt(e.getAppearance()))})),new ht(this.gridSize,t)}reset(t,e){}cycleSimulation(){console.log("Initial environment: "),console.log(this.environment.getAmbient().getGrid());let t=10;for(;t>0;)this.environment.cycle(),this.unpack(),this.grid=this.createGrid(),this.pack(),this.show(),console.log("Cycle: "+this.environment.getCycleNumber()+"."),console.log("Environment: "),console.log(this.environment.getAmbient().getGrid()),t--,(async()=>{await this.delay(1e3)})()}delay(t){return new Promise((e=>setTimeout(e,t)))}}(new class{speed;autoplay;stateToLoad;tooltipsActive;maxNumberOfCycles;efforts;teleora;constructor(){this.setDefaultOptions()}setDefaultOptions(){this.speed=0,this.autoplay=!1,this.stateToLoad=void 0,this.tooltipsActive=!0,this.maxNumberOfCycles=void 0,this.efforts=new Map,this.teleora=void 0}run(){this.createSkeletonView(),document.getElementById("initial_view_div").appendChild(this.loadStartMenu()),document.getElementById("initial_view_div").removeAttribute("hidden"),document.getElementById("initial_view_buttons_div").appendChild(this.createButton("Start","start_button",["initial_buttons"],this.startSimulation.bind(this))),document.getElementById("initial_view_buttons_div").appendChild(this.createButton("Options","options_button",["initial_buttons"],this.setOptions.bind(this))),document.getElementById("initial_view_buttons_div").appendChild(this.createButton("Guide","guide_button",["initial_buttons"],this.openWiki.bind(this))),document.getElementById("initial_view_buttons_div").removeAttribute("hidden")}createSkeletonView(){this.setTitle("VacuumWorld"),this.createPlatformDiv()}setTitle(t){null!=t&&""!==t&&(document.title=t)}createPlatformDiv(){let t=document.createElement("div");t.id="platform_div",t.classList.add("center-aligned"),document.getElementById("container_div").appendChild(t),this.createHiddenCenterAlignedDiv("platform_div","initial_view_div"),this.createHiddenCenterAlignedDiv("platform_div","initial_view_buttons_div"),this.createHiddenCenterAlignedDiv("platform_div","options_dialog_div"),this.createHiddenCenterAlignedDiv("platform_div","grid_div"),this.createHiddenCenterAlignedDiv("platform_div","draggable_bodies_div"),this.createHiddenCenterAlignedDiv("platform_div","simulation_controls_div")}createHiddenCenterAlignedDiv(t,e){let r=document.createElement("div");r.id=e,r.classList.add("center-aligned"),r.hidden=!0,document.getElementById(t).appendChild(r)}createOptionsDialog(){let t=document.createElement("dialog");t.id="options_dialog",document.getElementById("options_dialog_div").appendChild(t),this.createDivWithLabel("options_dialog","speed_selector_div","speed_selector","Speed"),this.createDivWithLabel("options_dialog","autoplay_selector_div","autoplay_selector","Autoplay"),this.createDivWithLabel("options_dialog","state_to_load_selector_div","state_to_load_selector","State"),this.createDivWithLabel("options_dialog","tooltips_selector_div","tooltips_selector","Tooltips"),this.createDivWithLabel("options_dialog","max_number_of_cycles_selector_div","max_number_of_cycles_selector","Cycles"),this.createDivWithLabel("options_dialog","efforts_selector_div","efforts_selector","Efforts"),this.createDivWithLabel("options_dialog","teleora_selector_div","teleora_selector","Teleora mind core"),this.createSpeedSelectorSelectElement(),this.createButtonWithoutCallback("options_dialog","options_dialog_ok_button","OK"),this.createButtonWithoutCallback("options_dialog","options_dialog_cancel_button","Cancel")}createDivWithLabel(t,e,r,n){let o=document.createElement("div");o.id=e,document.getElementById(t).appendChild(o),this.createAndAppendLabel(e,r,n)}createAndAppendLabel(t,e,r){let n=document.createElement("label");n.htmlFor=e,n.innerText=r,document.getElementById(t).appendChild(n)}createSpeedSelectorSelectElement(){let t=document.createElement("select");t.id="speed_values",document.getElementById("speed_selector_div").appendChild(t)}createButtonWithoutCallback(t,e,r){let n=document.createElement("button");n.id=e,n.textContent=r,document.getElementById(t).appendChild(n)}loadStartMenu(){let t=document.createElement("img");return t.src="envs/vacuumworld-ts/res/images/start_menu.png",t.alt="Start menu",t}createButton(t,e,r,n){let o=document.createElement("button");return o.textContent=t,o.id=e,r.forEach((t=>o.classList.add(t))),o.addEventListener("click",n),o}startSimulation(){try{console.log("Start simulation."),this.setActionEfforts();const t={initial_environment_dim:3,min_environment_dim:3,max_environment_dim:13};let e=lt.fromJsonObject(this.stateToLoad,t),r=new ut(e,t);r.pack(),r.show(),r.cycleSimulation()}catch(t){ct.displayError(t)}}openWiki(){window.open("https://github.com/dicelab-rhul/web-agent/")}setOptions(){this.createOptionsDialog(),this.createSpeedSelector(),this.createAutoplayCheckbox(),this.createStateToLoadUploadInput(),this.createTooltipsCheckbox(),this.createMaxNumberOfCyclesInput(),this.createEffortsSelector(),this.createTeleoraUploadInput();let t=document.getElementById("options_dialog");document.getElementById("options_dialog_ok_button").addEventListener("click",(()=>this.saveOptionsAndCloseDialog(t))),document.getElementById("options_dialog_cancel_button").addEventListener("click",(()=>this.discardOptionsAndCloseDialog(t))),t.showModal(),document.getElementById("options_dialog_div").removeAttribute("hidden")}createSpeedSelector(){this.generateSpeedValues().forEach((t=>{let e=document.createElement("option");e.id="speed_value_"+t.toString(),e.value=t.toString(),e.textContent=t.toString(),document.getElementById("speed_values").appendChild(e)}))}generateSpeedValues(){let t=[];for(let e=0;e<1e3;e++)t.push(e/1e3);return t}createAutoplayCheckbox(){let t=document.createElement("input");t.type="checkbox",t.id="autoplay_checkbox",t.checked=!1,document.getElementById("autoplay_selector_div").appendChild(t)}createStateToLoadUploadInput(){let t=document.createElement("input");t.type="file",t.accept=".json",t.id="state_to_load_upload_input",document.getElementById("state_to_load_selector_div").appendChild(t),t.addEventListener("change",(()=>{const e=t.files[0],r=new FileReader;r.onload=t=>{this.stateToLoad=JSON.parse(t.target.result)},r.readAsText(e)}))}createTooltipsCheckbox(){let t=document.createElement("input");t.type="checkbox",t.id="tooltips_checkbox",t.checked=!0,document.getElementById("tooltips_selector_div").appendChild(t)}createMaxNumberOfCyclesInput(){let t=document.createElement("input");t.type="number",t.id="max_number_of_cycles_input",document.getElementById("max_number_of_cycles_selector_div").appendChild(t)}createEffortsSelector(){this.getActionNames().forEach((t=>this.createEffortSelector(t)))}getActionNames(){return["VWIdleAction","VWMoveAction","VWTurnAction","VWCleanAction","VWDropDirtAction","VWSpeakAction","VWBroadcastAction"]}createEffortSelector(t){let e=document.createElement("div");e.id=t.toLowerCase()+"_effort_div";let r=document.createElement("label");r.textContent=t;let n=document.createElement("input");n.type="number",n.id=t.toLowerCase()+"_effort_input",e.appendChild(r),e.appendChild(n),document.getElementById("efforts_selector_div").appendChild(e)}createTeleoraUploadInput(){let t=document.createElement("input");t.type="file",t.accept=".tel",t.id="teleora_upload_input",document.getElementById("teleora_selector_div").appendChild(t),t.addEventListener("change",(()=>{const e=t.files[0],r=new FileReader;r.onload=t=>{this.teleora=t.target.result},r.readAsText(e)}))}saveOptionsAndCloseDialog(t){this.saveOptions(),t.close(),this.resetOptionsDialog(),console.log("Options saved:"),console.log("Speed: "+this.speed),console.log("Autoplay active: "+this.autoplay),console.log("Saved state to load: "+this.stateToLoad),console.log("Tooltips active: "+this.tooltipsActive),console.log("Max number of cycles: "+this.maxNumberOfCycles),console.log("Efforts:"),this.getActionNames().forEach((t=>console.log("- "+t+": "+this.efforts.get(t)))),console.log("Teleora file to load: "+this.teleora)}discardOptionsAndCloseDialog(t){t.close(),this.resetOptionsDialog()}resetOptionsDialog(){document.getElementById("options_dialog_div").removeChild(document.getElementById("options_dialog")),document.getElementById("options_dialog_div").hidden=!0}saveOptions(){this.speed=parseFloat(document.getElementById("speed_values").value),this.autoplay=document.getElementById("autoplay_checkbox").checked,this.tooltipsActive=document.getElementById("tooltips_checkbox").checked,this.maxNumberOfCycles=this.parseMaxNumberOfCycles(),this.efforts=this.loadEfforts(),this.teleora=document.getElementById("teleora_upload_input").files[0]}parseMaxNumberOfCycles(){const t=document.getElementById("max_number_of_cycles_input").value;return""===t||null==t?void 0:parseInt(t)}loadEfforts(){let t=new Map;for(const e of this.getActionNames()){const r=document.getElementById(e.toLowerCase()+"_effort_input").value;""===r||null==r?t.set(e,void 0):t.set(e,BigInt(parseInt(r)))}return t}setActionEfforts(){a.overrideDefaultEffort(this.efforts.get("VWIdleAction")),l.overrideDefaultEffort(this.efforts.get("VWMoveAction")),d.overrideDefaultEffort(this.efforts.get("VWTurnAction")),i.overrideDefaultEffort(this.efforts.get("VWCleanAction")),s.overrideDefaultEffort(this.efforts.get("VWDropDirtAction")),c.overrideDefaultEffort(this.efforts.get("VWSpeakAction")),n.overrideDefaultEffort(this.efforts.get("VWBroadcastAction"))}}).run()})()})();