(()=>{"use strict";class t{constructor(){}static exists(...t){return null!=t&&Array.from(t).every((t=>null!=t))}static allExist(e){return t.exists(e)&&Array.from(e).every((e=>t.exists(e)))}static validateExistence(e,i){if(t.exists(e))return e;throw new Error(i||"The object is null or undefined.")}static validateAllExistence(e,i){if(t.allExist(e))return e;throw new Error(i||"The object is null or undefined.")}}class e{actorID;constructor(e){this.actorID=t.validateExistence(e,"The actor ID cannot be null or undefined.")}getActorID(){return this.actorID}}class i extends e{content;recipientsIDs;constructor(e,i,o){super(e),this.content=t.validateExistence(i,"The content cannot be null or undefined."),this.recipientsIDs=null==o?[]:o}getContent(){return this.content}getRecipientsIDs(){return this.recipientsIDs}}class o extends i{static effort=1n;constructor(t,e){super(t,e)}getEffort(){return o.effort}static getEffort(){return o.effort}static overrideDefaultEffort(e){t.exists(e)?(o.effort=e,console.log("The effort of VWBroadcastAction has been changed to "+e+".")):console.log("The new effort for VWBroadcastAction cannot be null or undefined. The default effort will be used instead.")}}class n extends e{constructor(t){super(t)}}class r extends n{static effort=1n;constructor(t){super(t)}getEffort(){return r.effort}static overrideDefaultEffort(e){t.exists(e)?(r.effort=e,console.log("The effort of VWCleanAction has been changed to "+e+".")):console.log("The new effort for VWCleanAction cannot be null or undefined. The default effort will be used instead.")}}class s extends n{colour;static effort=1n;constructor(e,i){super(e),this.colour=t.validateExistence(i,"The dirt colour cannot be null or undefined.")}getColour(){return this.colour}getEffort(){return s.effort}static overrideDefaultEffort(e){t.exists(e)?(s.effort=e,console.log("The effort of VWDropDirtAction has been changed to "+e+".")):console.log("The new effort for VWDropDirtAction cannot be null or undefined. The default effort will be used instead.")}}class a extends n{static effort=1n;constructor(t){super(t)}getEffort(){return a.effort}static overrideDefaultEffort(e){t.exists(e)?(a.effort=e,console.log("The effort of VWIdleAction has been changed to "+e+".")):console.log("The new effort for VWIdleAction cannot be null or undefined. The default effort will be used instead.")}}class l extends n{static effort=1n;constructor(t){super(t)}getEffort(){return l.effort}static overrideDefaultEffort(e){t.exists(e)?(l.effort=e,console.log("The effort of VWMoveAction has been changed to "+e+".")):console.log("The new effort for VWMoveAction cannot be null or undefined. The default effort will be used instead.")}}class d extends i{static effort=1n;constructor(t,e,i){super(t,e,i)}getEffort(){return 0===this.getRecipientsIDs().length?o.getEffort():d.effort}static overrideDefaultEffort(e){t.exists(e)?(d.effort=e,console.log("The effort of VWSpeakAction has been changed to "+e+".")):console.log("The new effort for VWSpeakAction cannot be null or undefined. The default effort will be used instead.")}}class h extends n{turningDirection;static effort=1n;constructor(e,i){super(e),this.turningDirection=t.validateExistence(i,"The turning direction cannot be null or undefined.")}getTurningDirection(){return this.turningDirection}getEffort(){return h.effort}static overrideDefaultEffort(e){t.exists(e)?(h.effort=e,console.log("The effort of VWTurnAction has been changed to "+e+".")):console.log("The new effort for VWTurnAction cannot be null or undefined. The default effort will be used instead.")}}class c{value;constructor(t){this.value=t}static of(e){if(t.exists(e))return new c(e);throw new Error("The value cannot be null or undefined.")}static ofNullable(e){return t.exists(e)?new c(e):c.empty()}static empty(){return new c(null)}isPresent(){return null!==this.value}isEmpty(){return null===this.value}get(){return t.validateExistence(this.value,"The value is null or undefined.")}orElse(e){return t.exists(this.value)?this.value:e}orElseGet(e){return t.exists(this.value)?this.value:e()}orElseThrow(e){if(t.exists(this.value))return this.value;throw e||new Error("The value is null or undefined.")}ifPresent(e){t.exists(this.value)&&e(this.value)}ifPresentOrElse(e,i){t.exists(this.value)?e(this.value):i()}filter(e){return t.exists(this.value)&&e(this.value)?this:c.empty()}map(e){return t.exists(this.value)?c.of(e(this.value)):c.empty()}flatMap(e){return t.exists(this.value)?e(this.value):c.empty()}equals(e){return!!t.exists(e)&&(this===e||e instanceof c&&(null===this.value?null===e.value:void 0===this.value?void 0===e.value:this.value===e.value))}}var u,g,f,p;!function(t){t.IMPOSSIBLE="IMPOSSIBLE",t.SUCCESS="SUCCESS",t.FAILURE="FAILURE"}(u||(u={}));class v{actionOutcome;action;constructor(e,i){this.actionOutcome=t.validateExistence(e,"The action outcome cannot be null or undefined."),this.action=t.validateExistence(i,"The action cannot be null or undefined.")}getActionOutcome(){return this.actionOutcome}getAction(){return this.action}}!function(t){t.NORTH="NORTH",t.EAST="EAST",t.SOUTH="SOUTH",t.WEST="WEST"}(g||(g={}));class w{x;y;constructor(e,i){this.x=t.validateExistence(e,"The x coordinate cannot be null or undefined."),this.y=t.validateExistence(i,"The y coordinate cannot be null or undefined.")}getX(){return this.x}getY(){return this.y}clone(){return new w(this.x,this.y)}getForwardCoord(e){if(t.exists(e)){if(e===g.NORTH)return new w(this.x,this.y-1n);if(e===g.EAST)return new w(this.x+1n,this.y);if(e===g.SOUTH)return new w(this.x,this.y+1n);if(e===g.WEST)return new w(this.x-1n,this.y);throw new Error("The orientation is invalid.")}throw new Error("The orientation cannot be null or undefined.")}getLeftCoord(e){if(t.exists(e)){if(e===g.NORTH)return new w(this.x-1n,this.y);if(e===g.EAST)return new w(this.x,this.y-1n);if(e===g.SOUTH)return new w(this.x+1n,this.y);if(e===g.WEST)return new w(this.x,this.y+1n);throw new Error("The orientation is invalid.")}throw new Error("The orientation cannot be null or undefined.")}getRightCoord(e){if(t.exists(e)){if(e===g.NORTH)return new w(this.x+1n,this.y);if(e===g.EAST)return new w(this.x,this.y+1n);if(e===g.SOUTH)return new w(this.x-1n,this.y);if(e===g.WEST)return new w(this.x,this.y-1n);throw new Error("The orientation is invalid.")}throw new Error("The orientation cannot be null or undefined.")}getForwardLeftCoord(e){if(t.exists(e)){if(e===g.NORTH)return new w(this.x-1n,this.y-1n);if(e===g.EAST)return new w(this.x+1n,this.y-1n);if(e===g.SOUTH)return new w(this.x+1n,this.y+1n);if(e===g.WEST)return new w(this.x-1n,this.y+1n);throw new Error("The orientation is invalid.")}throw new Error("The orientation cannot be null or undefined.")}getForwardRightCoord(e){if(t.exists(e)){if(e===g.NORTH)return new w(this.x+1n,this.y-1n);if(e===g.EAST)return new w(this.x+1n,this.y+1n);if(e===g.SOUTH)return new w(this.x-1n,this.y+1n);if(e===g.WEST)return new w(this.x-1n,this.y-1n);throw new Error("The orientation is invalid.")}throw new Error("The orientation cannot be null or undefined.")}sum(t){return new w(this.x+t.x,this.y+t.y)}increment(t){return new w(this.x+t,this.y+t)}sub(t){return new w(this.x-t.x,this.y-t.y)}decrement(t){return new w(this.x-t,this.y-t)}toJsonObject(){return{x:this.x.toString(),y:this.y.toString()}}static fromJsonObject(e){if(t.exists(e)){if(t.exists(e.x)){if(t.exists(e.y))return new w(BigInt(e.x),BigInt(e.y));throw new Error("The y coordinate cannot be null or undefined.")}throw new Error("The x coordinate cannot be null or undefined.")}throw new Error("The JSON representation cannot be null or undefined.")}toString(){return`(${this.x}, ${this.y})`}equals(e){return!!t.exists(e)&&(this===e||e instanceof w&&this.x===e.x&&this.y===e.y)}static fromString(e){if(t.exists(e)){if(e.length<5)throw new Error("The coordinate string is invalid.");{const t=e.substring(1,e.indexOf(",")),i=e.substring(e.indexOf(",")+2,e.length-1);return new w(BigInt(t),BigInt(i))}}throw new Error("The coordinate string cannot be null or undefined.")}}class m{key;value;constructor(t,e){this.key=t,this.value=e}getKey(){return this.key}getValue(){return this.value}setValue(t){this.value=t}}class E{entries;constructor(){this.entries=[]}put(e,i){let o=this.getEntry(e);t.exists(o)?o.setValue(i):this.entries.push(new m(e,i))}get(e){const i=this.getEntry(e);return t.exists(i)?i.getValue():null}remove(e){const i=this.getEntry(e);t.exists(i)&&this.entries.splice(this.entries.indexOf(i),1)}containsKey(e){return t.exists(this.getEntry(e))}containsValue(t){for(let e of this.entries)if(e.getValue()===t)return!0;return!1}size(){return this.entries.length}isEmpty(){return 0===this.entries.length}clear(){this.entries=[]}getKeys(){return this.entries.map((t=>t.getKey()))}getValues(){return this.entries.map((t=>t.getValue()))}getEntry(t){return this.entries.find((e=>e.getKey().equals(t)))}toString(){let t="";for(let e of this.entries)t+=e.getKey()+" : "+e.getValue()+"\n";return t}equals(t){if(this.size()!==t.size())return!1;for(let e of this.entries)if(!t.containsKey(e.getKey())||t.get(e.getKey())!==e.getValue())return!1;return!0}clone(){const t=new E;for(let e of this.entries)t.put(e.getKey(),e.getValue());return t}static fromMap(t){const e=new E;for(let[i,o]of t)e.put(i,o);return e}toMap(){const t=new Map;for(let e of this.entries)t.set(e.getKey(),e.getValue());return t}static fromObject(t){const e=new E;for(let i in t)e.put(i,t[i]);return e}[Symbol.iterator](){let t=0,e=this.entries;return{next:()=>{if(t<e.length){const i=e[t];return t++,{value:[i.getKey(),i.getValue()],done:!1}}return{value:void 0,done:!0}}}}forEach(t){for(let e of this.entries)t(e.getValue(),e.getKey(),this)}}class b{}class A extends b{content;senderID;recipientID;constructor(e,i,o){super(),this.content=t.validateExistence(e,"The content cannot be null or undefined."),this.senderID=t.validateExistence(i,"The sender ID cannot be null or undefined."),this.recipientID=t.validateExistence(o,"The recipient ID cannot be null or undefined.")}getContent(){return this.content}getSenderID(){return this.senderID}getRecipientID(){return this.recipientID}}class T{constructor(){}static getLeft(t){switch(t){case g.NORTH:return g.WEST;case g.SOUTH:return g.EAST;case g.EAST:return g.NORTH;case g.WEST:return g.SOUTH;default:throw new Error("Invalid orientation.")}}static getRight(t){switch(t){case g.NORTH:return g.EAST;case g.SOUTH:return g.WEST;case g.EAST:return g.SOUTH;case g.WEST:return g.NORTH;default:throw new Error("Invalid orientation.")}}static getOpposite(t){switch(t){case g.NORTH:return g.SOUTH;case g.SOUTH:return g.NORTH;case g.EAST:return g.WEST;case g.WEST:return g.EAST;default:throw new Error("Invalid orientation.")}}}!function(t){t.CENTER="CENTER",t.FORWARD="FORWARD",t.LEFT="LEFT",t.RIGHT="RIGHT",t.FORWARDLEFT="FORWARDLEFT",t.FORWARDRIGHT="FORWARDRIGHT"}(f||(f={}));class D extends b{locations;actionResults;constructor(e,i){super(),this.locations=new Map,this.actionResults=D.validateActionResults(i);for(const i of e.keys()){if(!t.exists(i))throw new Error("The position cannot be null or undefined.");if(!t.exists(e.get(i)))throw new Error("The location appearance cannot be null or undefined.");this.locations.set(i,e.get(i))}}static validateActionResults(e){if(t.allExist(e)){if(0===e.length)throw new Error("The action results array cannot be empty.");return e}throw new Error("The action results cannot be null or undefined, or contain null or undefined elements.")}getLocations(){return this.locations}getLocationAt(e){return this.locations.has(e)&&t.exists(this.locations.get(e))?c.of(this.locations.get(e)):c.empty()}getCenter(){return this.getLocationAt(f.CENTER)}getLeft(){return this.getLocationAt(f.LEFT)}getRight(){return this.getLocationAt(f.RIGHT)}getForward(){return this.getLocationAt(f.FORWARD)}getForwardLeft(){return this.getLocationAt(f.FORWARDLEFT)}getForwardRight(){return this.getLocationAt(f.FORWARDRIGHT)}getOwnID(){return this.getCenter().orElseThrow().getActorAppearance().orElseThrow().getID()}getOwnColour(){return this.getCenter().orElseThrow().getActorAppearance().orElseThrow().getColour()}getOwnOrientation(){return this.getCenter().orElseThrow().getActorAppearance().orElseThrow().getOrientation()}getOwnCoordinates(){return this.getCenter().orElseThrow().getCoord()}getActionResults(){return this.actionResults}isWallImmediatelyAhead(){return this.getCenter().orElseThrow().hasWallOn(this.getOwnOrientation())}isWallOneStepAhead(){return!this.isWallImmediatelyAhead()&&this.getForward().orElseThrow().hasWallOn(this.getOwnOrientation())}isWallVisibleSomewhereAhead(){return this.isWallImmediatelyAhead()||this.isWallOneStepAhead()}isWallImmediatelyToTheLeft(){return this.getCenter().orElseThrow().hasWallOn(T.getLeft(this.getOwnOrientation()))}isWallOneStepToTheLeft(){return!this.isWallImmediatelyToTheLeft()&&this.getLeft().orElseThrow().hasWallOn(T.getLeft(this.getOwnOrientation()))}isWallVisibleSomewhereToTheLeft(){return this.isWallImmediatelyToTheLeft()||this.isWallOneStepToTheLeft()}isWallImmediatelyToTheRight(){return this.getCenter().orElseThrow().hasWallOn(T.getRight(this.getOwnOrientation()))}isWallOneStepToTheRight(){return!this.isWallImmediatelyToTheRight()&&this.getRight().orElseThrow().hasWallOn(T.getRight(this.getOwnOrientation()))}isWallVisibleSomewhereToTheRight(){return this.isWallImmediatelyToTheRight()||this.isWallOneStepToTheRight()}}class C{static validateActions(e){if(!t.allExist(e))throw new Error("The actions array cannot be null or undefined, or contain null or undefined elements.");if(0===e.length)throw new Error("At least one action per cycle must by attempted by each actor.");if(e.length>2)throw new Error("At most two actions per cycle can be attempted by each actor.");if(2===e.length&&e[0]instanceof n&&e[1]instanceof n)throw new Error("At most one physical action per cycle can be attempted by each actor.");if(2===e.length&&e[0]instanceof i&&e[1]instanceof i)throw new Error("At most one communicative action per cycle can be attempted by each actor.")}}class y{grid;constructor(e){this.grid=t.validateExistence(e,"The grid cannot be null or undefined.")}getGridSize(){return Math.sqrt(this.grid.size())}getGrid(){return this.grid}getLocation(t){return c.ofNullable(this.grid.get(t))}getActors(){const t=[];for(const[e,i]of this.grid){const e=i.getActor();e.isPresent()&&t.push(e.orElseThrow())}return t}getActorsIDs(){const t=[];for(let[e,i]of this.grid){const e=i.getActor();e.isPresent()&&t.push(e.orElseThrow().getID())}return t}getActorsIDsExcept(t){const e=[];for(let[i,o]of this.grid){const i=o.getActor();i.isPresent()&&i.orElseThrow().getID()!==t&&e.push(i.orElseThrow().getID())}return e}getActorByID(t){for(let[e,i]of this.grid){const e=i.getActor();if(e.isPresent()&&e.orElseThrow().getID()===t)return e}return c.empty()}getActorByCoord(t){return this.getLocation(t).flatMap((t=>t.getActor()))}getActorCoordByID(t){for(let[e,i]of this.grid){const o=i.getActor();if(o.isPresent()&&o.orElseThrow().getID()===t)return c.of(e)}return c.empty()}addActorToLocation(e,i){if(!t.exists(e))throw new Error("The coordinates of the location cannot be null or undefined.");if(!t.exists(i))throw new Error("The actor cannot be null or undefined.");if(this.getActorByCoord(e).isPresent())throw new Error("There is already an actor at the location.");this.getLocation(e).ifPresent((t=>t.addActor(i)))}popActorByCoord(t){return this.getLocation(t).flatMap((t=>t.popActor()))}moveActor(e,i){if(!t.exists(e))throw new Error("The coordinates of the origin location cannot be null or undefined.");if(!t.exists(i))throw new Error("The coordinates of the destination location cannot be null or undefined.");if(e.equals(i))throw new Error("The destination location cannot be the same as the origin location.");if(!this.getActorByCoord(e).isPresent())throw new Error("There is no actor at the origin location.");if(this.getActorByCoord(i).isPresent())throw new Error("There is already an actor at the destination location.");{const t=this.popActorByCoord(e).orElseThrow();this.getLocation(i).orElseThrow().addActor(t)}}turnActor(e,i){if(!t.exists(e))throw new Error("The coordinates of the actor location cannot be null or undefined.");if(!this.getActorByCoord(e).isPresent())throw new Error("There is no actor at the origin location.");this.getActorByCoord(e).orElseThrow().turn(i)}getDirtsIDs(){const t=[];for(let[e,i]of this.grid){const e=i.getDirt();e.isPresent()&&t.push(e.orElseThrow().getID())}return t}getDirtByID(t){for(let[e,i]of this.grid){const e=i.getDirt();if(e.isPresent()&&e.orElseThrow().getID()===t)return e}return c.empty()}getDirtByCoord(t){return this.getLocation(t).flatMap((t=>t.getDirt()))}getDirtCoordByID(t){for(let[e,i]of this.grid){const o=i.getDirt();if(o.isPresent()&&o.orElseThrow().getID()===t)return c.of(e)}return c.empty()}cleanDirtByCoord(e){if(!t.exists(e))throw new Error("The coordinates of the dirt location cannot be null or undefined.");if(!this.getDirtByCoord(e).isPresent())throw new Error("There is no dirt at the location.");this.getLocation(e).orElseThrow().removeDirt()}addDirtToLocation(e,i){if(!t.exists(e))throw new Error("The coordinates of the location cannot be null or undefined.");if(!t.exists(i))throw new Error("The dirt cannot be null or undefined.");if(this.getDirtByCoord(e).isPresent())throw new Error("There is already a dirt at the location.");this.getLocation(e).ifPresent((t=>t.addDirt(i)))}}!function(t){t.GREEN="GREEN",t.ORANGE="ORANGE",t.WHITE="WHITE",t.USER="USER"}(p||(p={}));const x={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let I;const k=new Uint8Array(16);function S(){if(!I&&(I="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!I))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return I(k)}const O=[];for(let t=0;t<256;++t)O.push((t+256).toString(16).slice(1));const B=function(t,e,i){if(x.randomUUID&&!e&&!t)return x.randomUUID();const o=(t=t||{}).random||(t.rng||S)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e){i=i||0;for(let t=0;t<16;++t)e[i+t]=o[t];return e}return function(t,e=0){return(O[t[e+0]]+O[t[e+1]]+O[t[e+2]]+O[t[e+3]]+"-"+O[t[e+4]]+O[t[e+5]]+"-"+O[t[e+6]]+O[t[e+7]]+"-"+O[t[e+8]]+O[t[e+9]]+"-"+O[t[e+10]]+O[t[e+11]]+O[t[e+12]]+O[t[e+13]]+O[t[e+14]]+O[t[e+15]]).toLowerCase()}(o)};class L{id;constructor(){this.id=B()}getID(){return this.id}equals(e){return!!t.exists(e)&&(this===e||e instanceof L&&this.id===e.id)}}class _{dirtID;colour;constructor(e,i){this.dirtID=t.validateExistence(e,"The dirt ID cannot be null or undefined."),this.colour=t.validateExistence(i,"The dirt colour cannot be null or undefined.")}getID(){return this.dirtID}getColour(){return this.colour}equals(e){return!!t.exists(e)&&(this===e||e instanceof _&&this.dirtID===e.dirtID&&this.colour===e.colour)}}class W extends L{colour;constructor(e){super(),this.colour=t.validateExistence(e,"The dirt colour cannot be null or undefined.")}getColour(){return this.colour}equals(e){return!!t.exists(e)&&(this===e||e instanceof W&&super.equals(e)&&this.colour===e.colour)}getAppearance(){return new _(this.getID(),this.colour)}toJsonObject(){return{colour:this.getColour()}}static fromJsonObject(e){if(!t.exists(e))throw new Error("The dirt JSON object cannot be null or undefined.");if(!t.exists(e.colour))throw new Error("The colour of a `VWDirt` cannot be null or undefined.");const i=e.colour;return new W(i)}}var R,N;!function(t){t.LEFT="left",t.RIGHT="right"}(R||(R={}));class V{actorID;colour;orientation;constructor(e,i,o){this.actorID=t.validateExistence(e,"The actor ID cannot be null or undefined."),this.colour=t.validateExistence(i,"The actor colour cannot be null or undefined."),this.orientation=t.validateExistence(o,"The actor orientation cannot be null or undefined.")}getID(){return this.actorID}getColour(){return this.colour}getOrientation(){return this.orientation}}class P{core;nextActions;constructor(e){this.core=t.validateExistence(e,"The mind core cannot be null or undefined."),this.nextActions=[]}perceive(t,e){this.core.perceive(t,e)}revise(){this.core.revise()}decide(){this.nextActions=this.core.decide()}execute(){return this.nextActions}getMindCore(){return this.core}}class F extends P{constructor(t){super(t)}}class G extends L{colour;orientation;mind;observationSensor;listeningSensor;physicalActuator;CommunicativeActuator;constructor(e,i,o,n,r,s,a){super(),this.colour=t.validateExistence(e,"The colour cannot be null or undefined."),this.orientation=t.validateExistence(i,"The orientation cannot be null or undefined."),this.mind=t.validateExistence(o,"The mind cannot be null or undefined."),this.observationSensor=null==n?c.empty():c.of(n),this.listeningSensor=null==r?c.empty():c.of(r),this.physicalActuator=null==s?c.empty():c.of(s),this.CommunicativeActuator=null==a?c.empty():c.of(a)}getColour(){return this.colour}getOrientation(){return this.orientation}getMind(){return this.mind}getObservationSensor(){return this.observationSensor}getListeningSensor(){return this.listeningSensor}getPhysicalActuator(){return this.physicalActuator}getCommunicativeActuator(){return this.CommunicativeActuator}getAppearance(){return new V(this.getID(),this.getColour(),this.getOrientation())}turn(e){if(!t.exists(e))throw new Error("The turning direction cannot be null or undefined.");if(e===R.LEFT)this.orientation=T.getLeft(this.orientation);else{if(e!==R.RIGHT)throw new Error("The turning direction is invalid.");this.orientation=T.getRight(this.orientation)}}cycle(){const t=this.getObservationSensor().orElseThrow().sourceAll().orElseThrow(),e=G.mergeObservations(t),i=this.sourceMessages();this.getMind().perceive(e,i),this.getMind().revise(),this.getMind().decide();const o=this.getMind().execute();C.validateActions(o),this.executeActions(o)}sourceMessages(){const t=[];return this.getListeningSensor().ifPresent((e=>e.sourceAll().ifPresent((e=>t.push(...e))))),t}static mergeObservations(e){if(t.allExist(e)){if(0===e.length)throw new Error("At least one observation must be present.");if(1===e.length)return e[0];if(2===e.length){const t=e[0].getActionResults().concat(e[1].getActionResults());return new D(e[1].getLocations(),t)}throw new Error("At most two observations can be present.")}throw new Error("The observations array cannot be null or undefined, or contain null or undefined observations.")}executeActions(t){for(const e of t)if(e instanceof n)this.getPhysicalActuator().orElseThrow().sink(e);else{if(!(e instanceof i))throw new Error("The action is not supported.");this.getCommunicativeActuator().orElseThrow().sink(e)}}toJsonObject(e){if(!t.exists(e))throw new Error("The actor mind core path cannot be null or undefined.");return{colour:this.getColour(),orientation:this.getOrientation(),mind:e}}reset(){this.mind=new F(this.mind.getMindCore().newCore())}}class M extends G{constructor(t,e,i,o,n,r,s){super(M.validateColourForCleaningAgent(t),e,i,o,n,r,s)}static validateColourForCleaningAgent(e){if(t.exists(e)){if(e===p.USER)throw new Error("The colour of a cleaning agent cannot be USER.");return e}throw new Error("The colour cannot be null or undefined.")}}class H extends G{constructor(t,e,i,o){super(p.USER,t,e,i,void 0,o)}}class U{queue;constructor(){this.queue=[]}enqueue(e){if(!t.exists(e))throw new Error("The perception cannot be null or undefined.");this.queue.push(e)}dequeue(){const e=this.queue.shift();if(t.exists(e))return e;throw new Error("No perceptions to dequeue.")}peek(){const e=this.queue[0];if(t.exists(e))return e;throw new Error("No perceptions to peek.")}isEmpty(){return 0===this.queue.length}}class z{actions;constructor(){this.actions=new U}sink(e){if(!t.exists(e))throw new Error("The action cannot be null or undefined.");this.actions.enqueue(e)}sinkAll(e){if(!t.allExist(e))throw new Error("The actions cannot be null or undefined.");e.forEach((t=>this.sink(t)))}source(){if(this.actions.isEmpty())throw new Error("No actions to source.");return this.actions.dequeue()}sourceAll(){if(this.actions.isEmpty())throw new Error("No actions to source.");{const t=[];for(;!this.actions.isEmpty();)t.push(this.actions.dequeue());return t}}hasPendingActions(){return!this.actions.isEmpty()}}class j extends z{}class J extends j{sink(e){if(!t.exists(e))throw new Error("The action cannot be null or undefined.");if(e instanceof s)throw new Error("A cleaning agent cannot drop dirt.");super.sink(e)}}class q extends z{}class K{perceptions;constructor(){this.perceptions=new U}sink(e){if(!t.exists(e))throw new Error("The perception cannot be null or undefined.");this.perceptions.enqueue(e)}sinkAll(e){if(!t.allExist(e))throw new Error("The perceptions cannot be null or undefined.");e.forEach((t=>this.sink(t)))}source(){return this.perceptions.isEmpty()?c.empty():c.of(this.perceptions.dequeue())}sourceAll(){if(this.perceptions.isEmpty())return c.empty();{let t=[];for(;!this.perceptions.isEmpty();)t.push(this.perceptions.dequeue());return c.of(t)}}}class $ extends K{}class X extends K{}class Y extends j{sink(e){if(!t.exists(e))throw new Error("The action cannot be null or undefined.");if(e instanceof r)throw new Error("A user cannot clean dirt.");super.sink(e)}}!function(t){t[t.BASIC=0]="BASIC",t[t.ADVANCED=1]="ADVANCED"}(N||(N={}));class Q{observation;messages;cumulativeEffort=0n;mindCoreFilePath;reviseMethod;decideMethod;getLatestObservation(){return this.observation}getLatestMessages(){return this.messages}getMindCoreFilePath(){return this.mindCoreFilePath}setMindCoreFilePath(t){this.mindCoreFilePath=t}getOwnID(){return this.observation.getOwnID()}getOwnColour(){return this.observation.getOwnColour()}getOwnOrientation(){return this.observation.getOwnOrientation()}getOwnCoordinates(){return this.observation.getOwnCoordinates()}perceive(e,i){this.observation=t.validateExistence(e,"The observation cannot be null or undefined."),this.messages=t.validateAllExistence(i,"The messages cannot be null or undefined.")}revise(){t.validateExistence(this.reviseMethod,"The revise method cannot be null or undefined.")()}decide(){return t.validateExistence(this.decideMethod,"The decide method cannot be null or undefined.")()}getCumulativeEffort(){return this.cumulativeEffort}incrementEffort(e){if(!t.exists(e))throw new Error("The effort cannot be null or undefined.");this.cumulativeEffort+=e}static loadFromFile(t){throw new Error("Not yet implemented.")}static import(t){throw new Error("Not yet implemented.")}construct(e,i,o){this.mindCoreFilePath=t.validateExistence(e,"The mind core file path cannot be null or undefined."),this.reviseMethod=t.validateExistence(i,"The revise method cannot be null or undefined."),this.decideMethod=t.validateExistence(o,"The decide method cannot be null or undefined.")}newCore(){let t=new this.constructor;return t.construct(this.mindCoreFilePath,this.reviseMethod,this.decideMethod),t}}class Z extends Q{difficultyLevel;constructor(e){super(),this.difficultyLevel=t.exists(e)?e:N.BASIC,this.setMindCoreFilePath("/index.js")}getDifficultyLevel(){return this.difficultyLevel}switchDifficultyLevel(){this.difficultyLevel===N.BASIC?this.difficultyLevel=N.ADVANCED:this.difficultyLevel=N.BASIC}revise(){}decide(){if(this.difficultyLevel===N.BASIC)return this.decideBasic();if(this.difficultyLevel===N.ADVANCED)return this.decideAdvanced();throw new Error("Unknown difficulty level.")}decideBasic(){return this.getLatestObservation().isWallImmediatelyAhead()?this.decideIfWallAheadAndBasic():this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.decideIfOnDirtAndBasic():this.actRandomly(.2,.2,.45,.075,.075)}decideIfWallAheadAndBasic(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?[new h(this.getOwnID(),R.RIGHT)]:this.getLatestObservation().isWallImmediatelyToTheRight()?[new h(this.getOwnID(),R.LEFT)]:this.turnRandomly()}decideIfOnDirtAndBasic(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?this.moveOrTurnRandomly(.6,0,.4):this.getLatestObservation().isWallImmediatelyToTheRight()?this.moveOrTurnRandomly(.6,.4,0):this.moveOrTurnRandomly(.5,.25,.25)}decideAdvanced(){return this.getLatestObservation().isWallImmediatelyAhead()?this.decideIfWallAheadAndAdvanced():this.isActorImmediatelyAhead()?this.decideIfActorAheadAndAdvanced():this.isActorImmediatelyToTheLeft()&&this.isActorImmediatelyToTheRight()?this.dropOrMoveRandomly(.1,.1,.8):this.isActorImmediatelyToTheLeft()&&!this.getLatestObservation().isWallImmediatelyToTheRight()?this.moveOrTurnRandomly(.5,0,.5):this.isActorImmediatelyToTheRight()&&!this.getLatestObservation().isWallImmediatelyToTheLeft()?this.moveOrTurnRandomly(.5,.5,0):this.getLatestObservation().isWallImmediatelyToTheLeft()?this.decideIfWallToTheLeftAndAdvanced():this.getLatestObservation().isWallImmediatelyToTheRight()?this.decideIfWallToTheRightAndAdvanced():this.actRandomly(.15,.15,.6,.05,.05)}decideIfWallAheadAndAdvanced(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?[new h(this.getOwnID(),R.RIGHT)]:this.getLatestObservation().isWallImmediatelyToTheRight()?[new h(this.getOwnID(),R.LEFT)]:this.isActorImmediatelyToTheLeft()&&this.isActorImmediatelyToTheRight()?this.turnRandomly():this.isActorImmediatelyToTheLeft()?[new h(this.getOwnID(),R.RIGHT)]:this.isActorImmediatelyToTheRight()?[new h(this.getOwnID(),R.LEFT)]:this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.turnRandomly():this.actRandomly(.075,.075,.6,0,.25)}decideIfWallToTheLeftAndAdvanced(){return this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.moveOrTurnRandomly(.9,0,.1):this.actRandomly(.075,.075,.6,0,.25)}decideIfWallToTheRightAndAdvanced(){return this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.moveOrTurnRandomly(.9,.1,0):this.actRandomly(.075,.075,.6,.25,0)}decideIfActorAheadAndAdvanced(){return this.getLatestObservation().isWallImmediatelyToTheLeft()?[new h(this.getOwnID(),R.RIGHT)]:this.getLatestObservation().isWallImmediatelyToTheRight()?[new h(this.getOwnID(),R.LEFT)]:this.isActorImmediatelyToTheLeft()&&this.isActorImmediatelyToTheRight()?this.dropRandomDirt():this.isActorImmediatelyToTheLeft()?[new h(this.getOwnID(),R.RIGHT)]:this.isActorImmediatelyToTheRight()?[new h(this.getOwnID(),R.LEFT)]:this.getLatestObservation().getCenter().orElseThrow().hasDirt()?this.turnRandomly():this.actRandomly(.25,.25,0,.25,.25)}isActorImmediatelyAhead(){return!this.getLatestObservation().isWallImmediatelyAhead()&&this.getLatestObservation().getCenter().orElseThrow().hasActor()}isActorImmediatelyToTheLeft(){return!this.getLatestObservation().isWallImmediatelyToTheLeft()&&this.getLatestObservation().getLeft().orElseThrow().hasActor()}isActorImmediatelyToTheRight(){return!this.getLatestObservation().isWallImmediatelyToTheRight()&&this.getLatestObservation().getRight().orElseThrow().hasActor()}actRandomly(t,e,i,o,n){Z.validateWeights([t,e,i,o,n]);const r=Math.random(),a=(d=0,t=>d+=t);var d;const c=[t,e,i,o,n].map(a);if(r<c[0])return[new s(this.getOwnID(),p.GREEN)];if(r<c[1])return[new s(this.getOwnID(),p.ORANGE)];if(r<c[2])return[new l(this.getOwnID())];if(r<c[3])return[new h(this.getOwnID(),R.LEFT)];if(r<c[4])return[new h(this.getOwnID(),R.RIGHT)];throw new Error("This should never happen.")}static validateWeights(e){if(!t.allExist(e))throw new Error("The weights array cannot be null or undefined, or contain null or undefined values.");if(e.some((t=>t<0)))throw new Error("The weights cannot be negative.");if(e.some((t=>t>1)))throw new Error("The weights cannot be greater than 1.0.");Z.validateWeightsSum(e.reduce(((t,e)=>t+e),0))}static validateWeightsSum(t){if(t<1)throw new Error("The weights cannot sum to less than 1.0.");if(t>1)throw new Error("The weights cannot sum to more than 1.0.")}turnRandomly(){return this.actRandomly(0,0,0,.5,.5)}moveOrTurnRandomly(t,e,i){return this.actRandomly(0,0,t,e,i)}dropOrMoveRandomly(t,e,i){return this.actRandomly(t,e,i,0,0)}dropRandomDirt(){return this.actRandomly(.5,.5,0,0,0)}newCore(){return new Z(this.difficultyLevel)}}class tt extends P{constructor(){super(new Z)}}class et extends Q{constructor(){super(),this.construct("/index.js",this.revise,this.decide)}revise(){}decide(){return[new a(this.getOwnID())]}newCore(){return new et}}class it{constructor(){}static createVWActorFromJSONObject(e){if(t.exists(e)){if(t.exists(e.colour)){if(e.colour===p.USER)return this.createVWUserFromJSONObject(e);if(Object.values(p).includes(e.colour))return this.createVWCleaningAgentFromJSONObject(e);throw new Error(`The colour of a \`VWActor\` cannot be "${e.colour}".`)}throw new Error("The colour of a `VWActor` cannot be null or undefined.")}throw new Error("The JSON representation of a `VWActor` cannot be null or undefined.")}static createVWCleaningAgentFromJSONObject(e){if(t.exists(e)){if(t.exists(e.colour)){if(e.colour===p.USER)throw new Error(`The colour of a \`VWCleaningAgent\` cannot be "${p.USER}".`);if(Object.values(p).includes(e.colour)){if(t.exists(e.orientation)){if(Object.values(g).includes(e.orientation)){if(t.exists(e.mind)){const t=p[e.colour],i=g[e.orientation],o="hysteretic"===e.mind?new et:Q.loadFromFile(e.mind),n=new F(o),r=new X,s=new $,a=new J,l=new q;return new M(t,i,n,r,s,a,l)}throw new Error("The path of the mind of a `VWCleaningAgent` cannot be null or undefined.")}throw new Error(`The orientation of a \`VWCleaningAgent\` cannot be "${e.orientation}".`)}throw new Error("The orientation of a `VWCleaningAgent` cannot be null or undefined.")}throw new Error(`The colour of a \`VWCleaningAgent\` cannot be "${e.colour}".`)}throw new Error("The colour of a `VWCleaningAgent` cannot be null or undefined.")}throw new Error("The JSON representation of a `VWCleaningAgent` cannot be null or undefined.")}static createVWUserFromJSONObject(e){if(t.exists(e)){if(t.exists(e.colour)){if(e.colour!==p.USER)throw new Error(`The colour of a \`VWUser\` must be "${p.USER}".`);if(t.exists(e.orientation)){if(Object.values(g).includes(e.orientation)){const t=g[e.orientation],i=new tt,o=new X,n=new Y;return new H(t,i,o,n)}throw new Error(`The orientation of a \`VWUser\` cannot be "${e.orientation}".`)}throw new Error("The orientation of a `VWUser` cannot be null or undefined.")}throw new Error("The colour of a `VWUser` cannot be null or undefined.")}throw new Error("The JSON representation of a `VWUser` cannot be null or undefined.")}static createVWActorFacingNorth(e,i){if(t.exists(e)){if(e===p.USER)return this.createVWUserFacingNorth();if(Object.values(p).includes(e))return this.createVWCleaningAgentFacingNorth(e,i);throw new Error(`The colour of a \`VWActor\` cannot be "${e}".`)}throw new Error("The colour of a `VWActor` cannot be null or undefined.")}static createVWCleaningAgentFacingNorth(e,i){if(t.exists(e)){if(e===p.USER)throw new Error(`The colour of a \`VWCleaningAgent\` cannot be "${p.USER}".`);if(Object.values(p).includes(e)){if(null==i)throw new Error("The simulation options cannot be null or undefined.");{const o=g.NORTH,n=t.exists(i.getTeleora())?Q.import(i.getTeleora()):new et,r=new F(n),s=new X,a=new $,l=new J,d=new q;return new M(e,o,r,s,a,l,d)}}throw new Error(`The colour of a \`VWCleaningAgent\` cannot be "${e}".`)}throw new Error("The colour of a `VWCleaningAgent` cannot be null or undefined.")}static createVWUserFacingNorth(){const t=g.NORTH,e=new tt,i=new X,o=new Y;return new H(t,e,i,o)}}class ot{coord;actorAppearance;dirtAppearance;wall;constructor(e,i,o,n){this.coord=t.validateExistence(e,"The coordinates cannot be null or undefined."),this.wall=ot.validateWall(i),this.actorAppearance=c.ofNullable(o),this.dirtAppearance=c.ofNullable(n)}static validateWall(e){if(t.exists(e)){if(4!==e.size)throw new Error("The wall must have 4 sides.");if(e.has(g.NORTH)&&e.has(g.EAST)&&e.has(g.SOUTH)&&e.has(g.WEST))return e;throw new Error("The wall must have 4 sides.")}throw new Error("The wall cannot be null or undefined.")}getID(){return this.coord.toString()}getCoord(){return this.coord}hasActor(){return this.actorAppearance.isPresent()}hasCleaningAgent(){return this.actorAppearance.isPresent()&&this.actorAppearance.orElseThrow().getColour()!==p.USER}hasUser(){return this.actorAppearance.isPresent()&&this.actorAppearance.orElseThrow().getColour()===p.USER}getActorAppearance(){return this.actorAppearance}hasDirt(){return this.dirtAppearance.isPresent()}getDirtAppearance(){return this.dirtAppearance}getWall(){return this.wall}hasWallOn(t){return this.wall.get(t)}hasWallOnNorth(){return this.hasWallOn(g.NORTH)}hasWallOnEast(){return this.hasWallOn(g.EAST)}hasWallOnSouth(){return this.hasWallOn(g.SOUTH)}hasWallOnWest(){return this.hasWallOn(g.WEST)}}class nt{coord;actor;dirt;wall;constructor(e,i,o,n){this.coord=t.validateExistence(e,"The coordinates cannot be null or undefined."),this.wall=nt.validateWall(i),this.actor=c.ofNullable(o),this.dirt=c.ofNullable(n)}static validateWall(e){if(t.exists(e)){if(4!==e.size)throw new Error("The wall must have 4 sides.");if(e.has(g.NORTH)&&e.has(g.EAST)&&e.has(g.SOUTH)&&e.has(g.WEST))return e;throw new Error("The wall must have 4 sides.")}throw new Error("The wall cannot be null or undefined.")}hasActor(){return this.actor.isPresent()}hasCleaningAgent(){return this.actor.isPresent()&&this.actor.orElseThrow().getAppearance().getColour()!==p.USER}hasUser(){return this.actor.isPresent()&&this.actor.orElseThrow().getAppearance().getColour()===p.USER}getActor(){return this.actor}addActor(e){if(this.hasActor())throw new Error("There is already an actor in this location.");if(!t.exists(e))throw new Error("The actor cannot be null or undefined.");this.actor=c.of(e)}removeActor(){if(!this.hasActor())throw new Error("There is no actor in this location.");this.actor=c.empty()}removeActorIfPresent(){this.hasActor()&&this.removeActor()}popActor(){const t=this.getActor();return t.isPresent()&&this.removeActor(),t}hasDirt(){return this.dirt.isPresent()}getDirt(){return this.dirt}addDirt(e){if(this.hasDirt())throw new Error("There is already a dirt in this location.");if(!t.exists(e))throw new Error("The dirt cannot be null or undefined.");this.dirt=c.of(e)}removeDirt(){if(!this.hasDirt())throw new Error("There is no dirt in this location.");this.dirt=c.empty()}removeDirtIfPresent(){this.hasDirt()&&this.removeDirt()}getCoord(){return this.coord}getWall(){return this.wall}hasWallOn(t){return this.wall.get(t)}hasWallOnNorth(){return this.hasWallOn(g.NORTH)}hasWallOnEast(){return this.hasWallOn(g.EAST)}hasWallOnSouth(){return this.hasWallOn(g.SOUTH)}hasWallOnWest(){return this.hasWallOn(g.WEST)}getAppearance(){return this.hasActor()&&this.hasDirt()?new ot(this.coord,this.wall,this.getActor().orElseThrow().getAppearance(),this.getDirt().orElseThrow().getAppearance()):this.hasActor()?new ot(this.coord,this.wall,this.getActor().orElseThrow().getAppearance(),void 0):this.hasDirt()?new ot(this.coord,this.wall,void 0,this.getDirt().orElseThrow().getAppearance()):new ot(this.coord,this.wall)}toJsonObject(t){const e={coord:this.coord.toJsonObject(),wall:{north:this.hasWallOnNorth(),east:this.hasWallOnEast(),south:this.hasWallOnSouth(),west:this.hasWallOnWest()}};return this.hasActor()&&(e.actor=this.getActor().orElseThrow().toJsonObject(t)),this.hasDirt()&&(e.dirt=this.getDirt().orElseThrow().toJsonObject()),e}static fromJsonObject(e){if(t.exists(e)){if(t.exists(e.wall)){if(t.exists(e.coord))return nt.fromJsonObjectHelper(w.fromJsonObject(e.coord),e.wall,e.actor,e.dirt);throw new Error("The JSON representation of a `VWLocation` must have a `coord` property.")}throw new Error("The JSON representation of a `VWLocation` must have a `wall` property.")}throw new Error("The JSON representation of a `VWLocation` cannot be null or undefined.")}static fromJsonObjectHelper(e,i,o,n){const r=nt.constructWallFromData(i),s=t.exists(o)?c.of(it.createVWActorFromJSONObject(o)):c.empty(),a=t.exists(n)?c.of(W.fromJsonObject(n)):c.empty();return s.isPresent()&&a.isPresent()?new nt(e,r,s.orElseThrow(),a.orElseThrow()):s.isPresent()?new nt(e,r,s.orElseThrow(),void 0):a.isPresent()?new nt(e,r,void 0,a.orElseThrow()):new nt(e,r)}static constructWallFromData(e){const i=new Map;if(t.exists(e)){if(t.exists(e.north)){if(t.exists(e.east)){if(t.exists(e.south)){if(t.exists(e.west))return i.set(g.NORTH,e.north),i.set(g.EAST,e.east),i.set(g.SOUTH,e.south),i.set(g.WEST,e.west),i;throw new Error("The wall must have a `west` property.")}throw new Error("The wall must have a `south` property.")}throw new Error("The wall must have an `east` property.")}throw new Error("The wall must have a `north` property.")}throw new Error("The wall cannot be null or undefined.")}static generateWallFromCoordAndGridSize(t,e){const i=new Map;return i.set(g.NORTH,0n===t.getY()),i.set(g.EAST,t.getX()===BigInt(e)-1n),i.set(g.SOUTH,t.getY()===BigInt(e)-1n),i.set(g.WEST,0n===t.getX()),i}}class rt{actorColourBeforeAction;actorOrientationBeforeAction;actorCoordBeforeAction;dirtBeforeAction;getActorColourBeforeAction(){return this.actorColourBeforeAction}setActorColourBeforeAction(e){if(!t.exists(e))throw new Error("The actor colour cannot be null or undefined.");this.actorColourBeforeAction=e}getActorOrientationBeforeAction(){return this.actorOrientationBeforeAction}setActorOrientationBeforeAction(e){if(!t.exists(e))throw new Error("The actor orientation cannot be null or undefined.");this.actorOrientationBeforeAction=e}getActorCoordBeforeAction(){return this.actorCoordBeforeAction}setActorCoordBeforeAction(e){if(!t.exists(e))throw new Error("The actor coord cannot be null or undefined.");this.actorCoordBeforeAction=e}getDirtBeforeAction(){return this.dirtBeforeAction}setDirtBeforeAction(e){if(!t.exists(e))throw new Error("The dirt cannot be null or undefined.");this.dirtBeforeAction=e}attempt(e,i){if(t.exists(e)){if(t.exists(i)){if(this.isPossible(e,i)){this.setActorColourBeforeAction(i.getActorByID(e.getActorID()).orElseThrow().getColour()),this.setActorOrientationBeforeAction(i.getActorByID(e.getActorID()).orElseThrow().getOrientation()),this.setActorCoordBeforeAction(i.getActorCoordByID(e.getActorID()).orElseThrow()),this.setDirtBeforeAction(i.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getDirt());const t=this.perform(e,i);return this.succeeded(e,i)?t:new v(u.FAILURE,e)}return new v(u.IMPOSSIBLE,e)}throw new Error("The environment cannot be null or undefined.")}throw new Error("The action cannot be null or undefined.")}static isActorInEnv(t,e){return e.getActorByID(t).isPresent()}checkAllInvariants(t,e){return rt.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkOrientationAfterAction(t,e)&&this.checkCoordAfterAction(t,e)&&this.checkDirtAfterAction(e)}checkColourAfterAction(t,e){return this.getActorColourBeforeAction()===e.getActorByID(t.getActorID()).orElseThrow().getColour()}checkOrientationAfterAction(t,e){return this.getActorOrientationBeforeAction()===e.getActorByID(t.getActorID()).orElseThrow().getOrientation()}checkCoordAfterAction(t,e){return this.getActorCoordBeforeAction().equals(e.getActorCoordByID(t.getActorID()).orElseThrow())}checkDirtAfterAction(t){return this.getDirtBeforeAction().equals(t.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getDirt())}}class st extends rt{isPossible(t,e){try{return rt.isActorInEnv(t.getActorID(),e)&&e.getActorByID(t.getActorID()).orElseThrow().getCommunicativeActuator().isPresent()}catch(t){return!1}}perform(t,e){try{return e.sendMessageToRecipients(t)?new v(u.SUCCESS,t):new v(u.FAILURE,t)}catch(e){return new v(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)}catch(t){return!1}}checkInvariants(t,e){return this.checkAllInvariants(t,e)}}class at extends rt{isPossible(t,e){try{return rt.isActorInEnv(t.getActorID(),e)&&at.isActorCleaningAgent(t,e)&&at.actorLocationHasCompatibleDirt(t,e)}catch(t){return!1}}static isActorCleaningAgent(t,e){const i=e.getActorByID(t.getActorID()).orElseThrow().getColour();return Object.values(p).includes(i)&&i!==p.USER}static actorLocationHasCompatibleDirt(t,e){const i=e.getActorCoordByID(t.getActorID()),o=e.getActorByID(t.getActorID()).orElseThrow().getColour();return i.isPresent()&&e.getLocation(i.orElseThrow()).orElseThrow().hasDirt()&&at.canClean(o,i,e)}static canClean(t,e,i){return t===p.WHITE||t===i.getLocation(e.orElseThrow()).orElseThrow().getDirt().orElseThrow().getColour()}perform(t,e){try{return e.cleanDirtByCoord(this.getActorCoordBeforeAction()),new v(u.SUCCESS,t)}catch(t){return new v(u.FAILURE,t.message)}}succeeded(t,e){try{return this.checkInvariants(t,e)&&this.checkDirtRemoved(e)}catch(t){return!1}}checkInvariants(t,e){return rt.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkOrientationAfterAction(t,e)&&this.checkCoordAfterAction(t,e)}checkDirtRemoved(t){return!t.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasDirt()}}class lt extends rt{isPossible(t,e){try{return rt.isActorInEnv(t.getActorID(),e)&&lt.isActorUser(t,e)&&lt.actorLocationHasNoDirt(t,e)}catch(t){return!1}}static isActorUser(t,e){return e.getActorByID(t.getActorID()).orElseThrow().getColour()===p.USER}static actorLocationHasNoDirt(t,e){const i=e.getActorCoordByID(t.getActorID());return i.isPresent()&&!e.getLocation(i.orElseThrow()).orElseThrow().hasDirt()}perform(t,e){try{return e.addDirtToLocation(this.getActorCoordBeforeAction(),new W(t.getColour())),new v(u.SUCCESS,t)}catch(e){return new v(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)&&this.checkDirtAdded(t,e)}catch(t){return!1}}checkInvariants(t,e){return rt.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkOrientationAfterAction(t,e)&&this.checkCoordAfterAction(t,e)}checkDirtAdded(t,e){return e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasDirt()&&e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getDirt().orElseThrow().getColour()===t.getColour()}}class dt extends rt{isPossible(t,e){try{return rt.isActorInEnv(t.getActorID(),e)}catch(t){return!1}}perform(t,e){try{return new v(u.SUCCESS,t)}catch(e){return new v(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)}catch(t){return!1}}checkInvariants(t,e){return this.checkAllInvariants(t,e)}}class ht extends rt{isPossible(t,e){try{return rt.isActorInEnv(t.getActorID(),e)&&ht.targetExists(t,e)&&ht.targetHasNoActor(t,e)}catch(t){return!1}}static targetExists(t,e){const i=e.getActorCoordByID(t.getActorID()),o=e.getActorByID(t.getActorID()).orElseThrow().getOrientation();return i.isPresent()&&!e.getLocation(i.orElseThrow()).orElseThrow().hasWallOn(o)}static targetHasNoActor(t,e){try{const i=e.getActorCoordByID(t.getActorID()).orElseThrow(),o=e.getActorByID(t.getActorID()).orElseThrow().getOrientation();if(e.getLocation(i).orElseThrow().hasWallOn(o))return!1;{const t=i.getForwardCoord(o);return e.getLocation(t).isPresent()&&!e.getLocation(t).orElseThrow().hasActor()}}catch(t){return!1}}perform(t,e){try{const i=this.getActorCoordBeforeAction().getForwardCoord(this.getActorOrientationBeforeAction());return e.getLocation(i).isPresent()?(e.moveActor(this.getActorCoordBeforeAction(),i),new v(u.SUCCESS,t)):new v(u.FAILURE,t)}catch(e){return new v(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)&&this.checkOriginalLocation(t,e)&&ht.checkTargetLocation(t,e)}catch(t){return!1}}checkInvariants(t,e){return rt.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkOrientationAfterAction(t,e)&&this.checkDirtAfterAction(e)}checkOriginalLocation(t,e){return this.noActorInOriginalLocation(e)||this.differentActorInOriginalLocation(t.getActorID(),e)}noActorInOriginalLocation(t){return!t.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasActor()}differentActorInOriginalLocation(t,e){return e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().hasActor()&&e.getLocation(this.getActorCoordBeforeAction()).orElseThrow().getActor().orElseThrow().getID()!==t}static checkTargetLocation(t,e){const i=e.getActorCoordByID(t.getActorID());return i.isPresent()&&e.getLocation(i.orElseThrow()).orElseThrow().hasActor()&&e.getLocation(i.orElseThrow()).orElseThrow().getActor().orElseThrow().getID()===t.getActorID()}}class ct extends rt{isPossible(t,e){try{return rt.isActorInEnv(t.getActorID(),e)&&e.getActorByID(t.getActorID()).orElseThrow().getCommunicativeActuator().isPresent()}catch(t){return!1}}perform(t,e){try{return e.sendMessageToRecipients(t)?new v(u.SUCCESS,t):new v(u.FAILURE,t)}catch(e){return new v(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)}catch(t){return!1}}checkInvariants(t,e){return this.checkAllInvariants(t,e)}}class ut extends rt{isPossible(t,e){try{return rt.isActorInEnv(t.getActorID(),e)}catch(t){return!1}}perform(t,e){try{return e.turnActor(this.getActorCoordBeforeAction(),t.getTurningDirection()),new v(u.SUCCESS,t)}catch(e){return new v(u.FAILURE,t)}}succeeded(t,e){try{return this.checkInvariants(t,e)&&this.checkOrientationAfterTurn(t,e)}catch(t){return!1}}checkInvariants(t,e){return rt.isActorInEnv(t.getActorID(),e)&&this.checkColourAfterAction(t,e)&&this.checkCoordAfterAction(t,e)&&this.checkDirtAfterAction(e)}checkOrientationAfterTurn(t,e){const i=e.getActorByID(t.getActorID()).orElseThrow().getOrientation();return t.getTurningDirection()===R.LEFT?i===T.getLeft(this.getActorOrientationBeforeAction()):t.getTurningDirection()===R.RIGHT&&i===T.getRight(this.getActorOrientationBeforeAction())}}class gt{ambient;cycleNumber;constructor(e){this.ambient=t.validateExistence(e,"The ambient cannot be null or undefined."),this.cycleNumber=0}getAmbient(){return this.ambient}getCycleNumber(){return this.cycleNumber}resetCycleNumber(){this.cycleNumber=0}getGridSize(){return this.ambient.getGridSize()}getLocation(t){return this.ambient.getLocation(t)}getActorsIDs(){return this.ambient.getActorsIDs()}getActorsIDsExcept(t){return this.ambient.getActorsIDsExcept(t)}getActorByID(t){return this.ambient.getActorByID(t)}getActorByCoord(t){return this.ambient.getActorByCoord(t)}getActorCoordByID(t){return this.ambient.getActorCoordByID(t)}addActorToLocation(t,e){this.ambient.addActorToLocation(t,e)}moveActor(t,e){this.ambient.moveActor(t,e)}turnActor(t,e){this.ambient.turnActor(t,e)}getDirtsIDs(){return this.ambient.getDirtsIDs()}getDirtByID(t){return this.ambient.getDirtByID(t)}getDirtByCoord(t){return this.ambient.getDirtByCoord(t)}getDirtCoordByID(t){return this.ambient.getDirtCoordByID(t)}cleanDirtByCoord(t){this.ambient.cleanDirtByCoord(t)}addDirtToLocation(t,e){this.ambient.addDirtToLocation(t,e)}cycle(){console.log("Start of cycle #"+this.cycleNumber+"..."),0===this.cycleNumber&&this.forceInitialPerceptionToActors(),this.ambient.getActors().forEach((t=>this.cycleActor(t))),console.log("Environment after the actions: "),console.log(this.toJsonObject()),console.log(JSON.stringify(this.toJsonObject(),null,4)),console.log("End of cycle #"+this.cycleNumber+"..."),this.cycleNumber++}forceInitialPerceptionToActors(){this.ambient.getActors().forEach((t=>this.forceInitialPerceptionToActor(t)))}forceInitialPerceptionToActor(t){const e=new v(u.IMPOSSIBLE,new a(t.getID()));this.sendResultToActor(e,!1)}cycleActor(t){t.cycle(),this.executeActorActions(t)}executeActorActions(t){const e=[];t.getPhysicalActuator().orElseThrow().hasPendingActions()&&t.getPhysicalActuator().orElseThrow().sourceAll().forEach((t=>e.push(t))),t.getCommunicativeActuator().isPresent()&&t.getCommunicativeActuator().orElseThrow().hasPendingActions()&&t.getCommunicativeActuator().orElseThrow().sourceAll().forEach((t=>e.push(t))),C.validateActions(e),e.forEach((t=>this.executeAction(t)))}executeAction(t){gt.getExecutorFor(t).ifPresentOrElse((e=>{const i=e.attempt(t,this);this.sendResultToActor(i,!0)}),(()=>{throw new Error("No executor found for the action "+t+".")}))}static getExecutorFor(t){return t instanceof a?c.of(new dt):t instanceof l?c.of(new ht):t instanceof h?c.of(new ut):t instanceof r?c.of(new at):t instanceof s?c.of(new lt):t instanceof d?c.of(new ct):t instanceof o?c.of(new st):c.empty()}sendResultToActor(t,e){const i=new Map,o=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow(),n=this.getActorByCoord(o).orElseThrow().getOrientation(),r=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getForwardCoord(n),s=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getLeftCoord(n),a=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getRightCoord(n),l=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getForwardLeftCoord(n),d=this.getActorCoordByID(t.getAction().getActorID()).orElseThrow().getForwardRightCoord(n);this.ambient.getGrid().containsKey(o)&&i.set(f.CENTER,this.ambient.getGrid().get(o).getAppearance()),this.ambient.getGrid().containsKey(r)&&i.set(f.FORWARD,this.ambient.getGrid().get(r).getAppearance()),this.ambient.getGrid().containsKey(s)&&i.set(f.LEFT,this.ambient.getGrid().get(s).getAppearance()),this.ambient.getGrid().containsKey(a)&&i.set(f.RIGHT,this.ambient.getGrid().get(a).getAppearance()),this.ambient.getGrid().containsKey(l)&&i.set(f.FORWARDLEFT,this.ambient.getGrid().get(l).getAppearance()),this.ambient.getGrid().containsKey(d)&&i.set(f.FORWARDRIGHT,this.ambient.getGrid().get(d).getAppearance());const h=new D(i,[t]);this.getActorByCoord(o).orElseThrow().getObservationSensor().ifPresent((t=>t.sink(h))),this.getActorByCoord(o).orElseThrow().getMind().getMindCore().incrementEffort(e?t.getAction().getEffort():0n)}sendMessageToRecipients(t){try{return(t.getRecipientsIDs().length>0?t.getRecipientsIDs():this.getActorsIDsExcept(t.getActorID())).forEach((e=>this.sendMessageToRecipient(t,e))),!0}catch(t){return!1}}sendMessageToRecipient(t,e){this.getActorByID(e).ifPresent((i=>i.getListeningSensor().ifPresent((i=>i.sink(new A(t.getContent(),t.getActorID(),e))))))}toJsonObject(){return{locations:this.serialiseLocations()}}serialiseLocations(){let t=[];for(let e of this.ambient.getGrid().getValues())t.push(this.serialiseLocation(e));return t}serialiseLocation(e){if(t.exists(e)){if(e.hasActor()){const t=this.getActorMindCorePath(e.getActor().orElseThrow().getMind().getMindCore());return e.toJsonObject(t)}return e.toJsonObject()}throw new Error("The location cannot be null or undefined.")}getActorMindCorePath(t){return t.getMindCoreFilePath()}static newEnvironment(e,i,o){return t.validateExistence(e,"The options cannot be null or undefined."),t.exists(e.getStateToLoad())?gt.fromJsonObject(o,i):gt.newEmptyVWEnvironment(i)}static fromJsonObject(e,i){if(t.exists(e)){if(t.exists(e.locations)){if(Array.isArray(e.locations)){if(t.allExist(e.locations)){if(t.exists(i))return gt.fromJsonObjectHelper(e,i);throw new Error("The config cannot be null or undefined.")}throw new Error("The 'locations' array cannot contain null or undefined values.")}throw new Error("The 'locations' property must be an array.")}throw new Error("The state to load must contain a 'locations' property.")}throw new Error("The state to load cannot be null or undefined.")}static fromJsonObjectHelper(t,e){const i=gt.loadLocations(t.locations);return gt.validateGrid(i,e),new gt(new y(i))}static loadLocations(e){const i=new E;for(const o of e){if(!t.exists(o.coord))throw new Error("The location coordinates cannot be null or undefined.");i.put(w.fromJsonObject(o.coord),nt.fromJsonObject(o))}return i}static validateGrid(e,i){if(!t.exists(e))throw new Error("The grid cannot be null or undefined.");if(!t.exists(i))throw new Error("The config cannot be null or undefined.");if(!t.exists(i.min_environment_dim))throw new Error("The config must contain a 'min_environment_dim' property.");if(!t.exists(i.max_environment_dim))throw new Error("The config must contain a 'max_environment_dim' property.");gt.validateGridHelper(e,i)}static validateGridHelper(t,e){const i=Math.sqrt(t.size());gt.validateGridSize(i,e)}static validateGridSize(t,e){if(t!==Math.floor(t))throw new Error("The grid must be a square.");if(t<e.min_environment_dim)throw new Error(`The grid size is too small (min: "${e.min_environment_dim}").`);if(t>e.max_environment_dim)throw new Error(`The grid size is too big (max: "${e.max_environment_dim}").`)}static newEmptyVWEnvironment(e,i){if(t.exists(e))return gt.newEmptyVWEnvironmentHelper(e,i);throw new Error("The config cannot be null or undefined.")}static newEmptyVWEnvironmentHelper(e,i){const o=t.exists(i)?i:BigInt(e.initial_environment_dim);gt.validateGridSize(Number(o),e);const n=new E;for(let t=0n;t<o;t++)for(let e=0n;e<o;e++){const i=new w(t,e);n.put(i,new nt(i,nt.generateWallFromCoordAndGridSize(i,o)))}return new gt(new y(n))}resetAndMaintainElements(){this.ambient.getActors().forEach((t=>t.reset())),this.cycleNumber=0}}class ft{constructor(){}static displayError(t){document.getElementById("error_div").innerText=t,document.getElementById("error_div").removeAttribute("hidden"),document.getElementById("error_div").addEventListener("click",(()=>ft.hideError()))}static hideError(){document.getElementById("error_div").innerText="",document.getElementById("error_div").hidden=!0}}class pt{speed;autoplay;stateToLoad;tooltipsActive;maxNumberOfCycles;efforts;teleora;constructor(){this.setDefaultOptions()}setDefaultOptions(){this.speed=0,this.autoplay=!1,this.stateToLoad=void 0,this.tooltipsActive=!0,this.maxNumberOfCycles=void 0,this.efforts=new Map,this.teleora=void 0}getSpeed(){return this.speed}setSpeed(t){this.speed=t}isAutoplayActive(){return this.autoplay}activateAutoplay(){this.autoplay=!0}deactivateAutoplay(){this.autoplay=!1}getStateToLoad(){return this.stateToLoad}setStateToLoad(t){this.stateToLoad=t}areTooltipsActive(){return this.tooltipsActive}activateTooltips(){this.tooltipsActive=!0}deactivateTooltips(){this.tooltipsActive=!1}getMaxNumberOfCycles(){return this.maxNumberOfCycles}setMaxNumberOfCycles(t){this.maxNumberOfCycles=t}getEfforts(){return this.efforts}setEfforts(e){this.efforts=t.validateExistence(e)}setEffort(t,e){this.efforts.set(t,e)}getTeleora(){return this.teleora}setTeleora(t){this.teleora=t}}class vt{div;img;packed;constructor(e){if(!t.exists(e))throw new Error("The path of the initial view image cannot be null or undefined.");this.div=document.createElement("div"),this.div.id="initial_view_div",this.div.hidden=!0,this.img=document.createElement("img"),this.img.id="initial_view_img",this.img.src=e,this.packed=!1}pack(){if(this.packed)console.log("The initial view div is already packed.");else{if(!t.exists(this.div))throw new Error("Cannot pack: the initial view div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot pack: the initial view div is not hidden (it must be before packing it).");if(!t.exists(this.img))throw new Error("Cannot pack: the image is null or undefined.");this.div.appendChild(this.img),this.packed=!0}}unpack(){if(this.packed){if(!t.exists(this.div))throw new Error("Cannot unpack: the initial view div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot unpack: the initial view div is not hidden (it must be before unpacking it).");if(!t.exists(this.img))throw new Error("Cannot unpack: the image is null or undefined.");this.div.removeChild(this.img),this.packed=!1}else console.log("The initial view div is already unpacked.")}show(){if(!t.exists(this.div))throw new Error("Cannot show: the initial view div is null or undefined.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the initial view div is not packed.");this.div.hidden=!1}else console.log("The initial view div is already shown.")}hide(){if(!t.exists(this.div))throw new Error("Cannot hide: the initial view div is null or undefined.");if(this.div.hidden)console.log("The initial view div is already hidden.");else{if(!this.packed)throw new Error("Cannot hide: the initial view div is not packed.");this.div.hidden=!0}}getDiv(){return t.validateExistence(this.div,"Cannot get the initial view div: the div is null or undefined.")}isPacked(){return this.packed}isHidden(){return this.getDiv().hidden}}class wt{callback;button;constructor(e,i,o,n){if(!t.exists(e))throw new Error("The text of the button cannot be null or undefined.");if(!t.exists(i))throw new Error("The id of the button cannot be null or undefined.");if(!t.exists(o))throw new Error("The callback of the button cannot be null or undefined.");this.callback=o,this.button=document.createElement("button"),this.button.id=i,this.button.innerHTML=e,this.button.addEventListener("click",this.callback),this.addClasses(n)}addClasses(e){t.allExist(e)&&e.forEach((t=>this.button.classList.add(t)))}getButton(){return this.button}}class mt{div;startButton;optionsButton;guideButton;packed;constructor(e,i,o){if(!t.exists(e))throw new Error("The start callback cannot be null or undefined.");if(!t.exists(i))throw new Error("The options callback cannot be null or undefined.");if(!t.exists(o))throw new Error("The guide callback cannot be null or undefined.");this.div=document.createElement("div"),this.div.id="initial_view_buttons_div",this.div.hidden=!0,this.startButton=new wt("Start","start_button",e.bind(this),["initial_buttons"]),this.optionsButton=new wt("Options","options_button",i.bind(this),["initial_buttons"]),this.guideButton=new wt("Guide","guide_button",o.bind(this),["initial_buttons"]),this.packed=!1}pack(){if(this.packed)console.log("The initial view buttons div is already packed.");else{if(!t.exists(this.div))throw new Error("Cannot pack: the initial view buttons div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot pack: the initial view buttons div is not hidden (it must be before packing it).");if(!t.exists(this.startButton))throw new Error("Cannot pack: the start button is null or undefined.");if(!t.exists(this.guideButton))throw new Error("Cannot pack: the guide button is null or undefined.");if(!t.exists(this.optionsButton))throw new Error("Cannot pack: the options button is null or undefined.");this.div.appendChild(this.startButton.getButton()),this.div.appendChild(this.optionsButton.getButton()),this.div.appendChild(this.guideButton.getButton()),this.packed=!0}}unpack(){if(this.packed){if(!t.exists(this.div))throw new Error("Cannot unpack: the initial view buttons div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot unpack: the initial view buttons div is not hidden (it must be before unpacking it).");if(!t.exists(this.startButton))throw new Error("Cannot unpack: the start button is null or undefined.");if(!t.exists(this.guideButton))throw new Error("Cannot unpack: the guide button is null or undefined.");if(!t.exists(this.optionsButton))throw new Error("Cannot unpack: the options button is null or undefined.");this.div.removeChild(this.startButton.getButton()),this.div.removeChild(this.guideButton.getButton()),this.div.removeChild(this.optionsButton.getButton()),this.packed=!1}else console.log("The initial view buttons div is already unpacked.")}show(){if(!t.exists(this.div))throw new Error("Cannot show: the initial view buttons div is null or undefined.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the initial view buttons div is not packed.");this.div.hidden=!1}else console.log("The initial view buttons div is already shown.")}hide(){if(!t.exists(this.div))throw new Error("Cannot hide: the initial view buttons div is null or undefined.");if(this.div.hidden)console.log("The initial view buttons div is already hidden.");else{if(!this.packed)throw new Error("Cannot hide: the initial buttons view div is not packed.");this.div.hidden=!0}}getDiv(){return t.validateExistence(this.div,"Cannot get the initial view buttons div: the div is null or undefined.")}isPacked(){return this.packed}isHidden(){return this.getDiv().hidden}}class Et{constructor(){}static createDivWithLabel(e,i,o,n,r){let s=document.createElement("div");s.id=e,t.allExist(n)&&s.classList.add(...n);let a=Et.createLabel(i,o,r);return s.appendChild(a),s}static createLabel(e,i,o){let n=document.createElement("label");return n.htmlFor=e,n.innerText=i,t.allExist(o)&&n.classList.add(...o),n}static createCheckbox(e,i,o){let n=document.createElement("input");return n.type="checkbox",n.id=e,n.checked=!!t.exists(i)&&i,t.allExist(o)&&n.classList.add(...o),n}static createFileInput(e,i,o){let n=document.createElement("input");return n.type="file",n.id=e,n.accept=t.exists(i)?i:"",t.allExist(o)&&n.classList.add(...o),n}static createNumberInputsDivs(t,e,i,o,n){let r=[];return t.forEach((t=>{const s=t.toLowerCase()+i,a=t.toLowerCase()+e;let l=Et.createNumberInput(s),d=Et.createDivWithLabel(a,s,t,o,n);d.appendChild(l),r.push(d)})),r}static createNumberInput(e,i,o,n,r,s){let a=document.createElement("input");return a.type="number",a.id=e,a.min=t.exists(o)?o.toString():"",a.max=t.exists(n)?n.toString():"",a.step=t.exists(r)?r.toString():"",a.value=t.exists(s)?s.toString():"",t.allExist(i)&&a.classList.add(...i),a}static createOptionElement(e,i,o,n){let r=document.createElement("option");return r.id=e,r.value=i,r.textContent=o,t.allExist(n)&&r.classList.add(...n),r}static createSelectElement(e,i,o,n){let r=document.createElement("select");return r.id=e,t.allExist(n)&&r.classList.add(...n),i.forEach((e=>{const i=t.exists(o)?o+e:e;let n=Et.createOptionElement(i,e,e);r.appendChild(n)})),r}}class bt{dialog;speedSelectorDiv;autoplaySelectorDiv;stateToLoadSelectorDiv;stateToLoadInputCallback;tooltipsSelectorDiv;maxNumberOfCyclesSelectorDiv;effortsSelectorDiv;teleoraSelectorDiv;teleoraInputCallback;okButton;okButtonCallback;cancelButton;cancelButtonCallback;packed;constructor(t,e,i,o){this.dialog=document.createElement("dialog"),this.dialog.id="options_dialog",this.okButtonCallback=t,this.cancelButtonCallback=e,this.stateToLoadInputCallback=i,this.teleoraInputCallback=o,this.constructOptionsDialog(),this.packed=!1}constructSpeedSelectorDiv(){this.speedSelectorDiv=Et.createDivWithLabel("speed_selector_div","speed_selector","Speed",["option_div"],["option_div_label"]);let t=Et.createSelectElement("speed_values",this.generateSpeedValues(),"speed_value_",["option_subdiv"]);this.speedSelectorDiv.appendChild(t)}generateSpeedValues(){let t=[];for(let e=0;e<1e3;e++){const i=e/1e3;t.push(i.toString())}return t}constructAutoplayCheckboxDiv(){this.autoplaySelectorDiv=Et.createDivWithLabel("autoplay_checkbox_div","autoplay_checkbox","Autoplay",["option_div"],["option_div_label"]);let t=Et.createCheckbox("autoplay_checkbox",!1,["option_subdiv"]);this.autoplaySelectorDiv.appendChild(t)}constructStateToLoadSelectorDiv(){this.stateToLoadSelectorDiv=Et.createDivWithLabel("state_to_load_input_div","state_to_load_upload_input","State to load",["option_div"],["option_div_label"]);let t=Et.createFileInput("state_to_load_upload_input",".json",["option_subdiv"]);t.addEventListener("change",this.stateToLoadInputCallback),this.stateToLoadSelectorDiv.appendChild(t)}constructTooltipsCheckboxDiv(){this.tooltipsSelectorDiv=Et.createDivWithLabel("tooltips_checkbox_div","tooltips_checkbox","Tooltips",["option_div"],["option_div_label"]);let t=Et.createCheckbox("tooltips_checkbox",!1,["option_subdiv"]);this.tooltipsSelectorDiv.appendChild(t)}constructMaxNumberOfCyclesSelectorDiv(){this.maxNumberOfCyclesSelectorDiv=Et.createDivWithLabel("max_number_of_cycles_input_div","max_number_of_cycles_input","Max number of cycles",["option_div"],["option_div_label"]);let t=Et.createNumberInput("max_number_of_cycles_input",["option_subdiv"]);this.maxNumberOfCyclesSelectorDiv.appendChild(t)}constructEffortsSelectorDiv(){this.effortsSelectorDiv=Et.createDivWithLabel("efforts_inputs_div","efforts_selector","Effort values",["option_div"],["option_div_label"]),Et.createNumberInputsDivs(bt.getActionNames(),"_effort_div","_effort_input",["effort_option_div"],["option_div_label"]).forEach((t=>this.effortsSelectorDiv.appendChild(t)))}static getActionNames(){return["VWIdleAction","VWMoveAction","VWTurnAction","VWCleanAction","VWDropDirtAction","VWSpeakAction","VWBroadcastAction"]}constructTeleoraSelectorDiv(){this.teleoraSelectorDiv=Et.createDivWithLabel("teleora_input_div","teleora_selector","Teleora mind cores to load",["option_div"],["option_div_label"]);let t=Et.createFileInput("teleora_upload_input",".tel",["option_subdiv"]);t.addEventListener("change",this.teleoraInputCallback),this.teleoraSelectorDiv.appendChild(t)}constructOkButton(){this.okButton=new wt("OK","options_dialog_ok_button",this.okButtonCallback.bind(this))}constructCancelButton(){this.cancelButton=new wt("Cancel","options_dialog_cancel_button",this.cancelButtonCallback.bind(this))}pack(){if(this.packed)console.log("The options dialog is already packed.");else{if(!t.exists(this.dialog))throw new Error("Cannot pack the options dialog: the dialog is null or undefined.");if(!t.exists(this.speedSelectorDiv))throw new Error("Cannot pack the options dialog: the speed selector div is null or undefined.");if(!t.exists(this.autoplaySelectorDiv))throw new Error("Cannot pack the options dialog: the autoplay selector div is null or undefined.");if(!t.exists(this.stateToLoadSelectorDiv))throw new Error("Cannot pack the options dialog: the state to load selector div is null or undefined.");if(!t.exists(this.tooltipsSelectorDiv))throw new Error("Cannot pack the options dialog: the tooltips selector div is null or undefined.");if(!t.exists(this.maxNumberOfCyclesSelectorDiv))throw new Error("Cannot pack the options dialog: the max number of cycles selector div is null or undefined.");if(!t.exists(this.effortsSelectorDiv))throw new Error("Cannot pack the options dialog: the efforts selector div is null or undefined.");if(!t.exists(this.teleoraSelectorDiv))throw new Error("Cannot pack the options dialog: the teleora selector div is null or undefined.");if(!t.exists(this.okButton))throw new Error("Cannot pack the options dialog: the ok button is null or undefined.");if(!t.exists(this.cancelButton))throw new Error("Cannot pack the options dialog: the cancel button is null or undefined.");this.dialog.appendChild(this.speedSelectorDiv),this.dialog.appendChild(this.autoplaySelectorDiv),this.dialog.appendChild(this.stateToLoadSelectorDiv),this.dialog.appendChild(this.tooltipsSelectorDiv),this.dialog.appendChild(this.maxNumberOfCyclesSelectorDiv),this.dialog.appendChild(this.effortsSelectorDiv),this.dialog.appendChild(this.teleoraSelectorDiv),this.dialog.appendChild(this.okButton.getButton()),this.dialog.appendChild(this.cancelButton.getButton()),this.packed=!0}}unpack(){this.dialog.close()}constructOptionsDialog(){this.constructSpeedSelectorDiv(),this.constructAutoplayCheckboxDiv(),this.constructStateToLoadSelectorDiv(),this.constructTooltipsCheckboxDiv(),this.constructMaxNumberOfCyclesSelectorDiv(),this.constructEffortsSelectorDiv(),this.constructTeleoraSelectorDiv(),this.constructOkButton(),this.constructCancelButton()}getDialog(){return t.validateExistence(this.dialog,"Cannot get the options dialog: the dialog is null or undefined.")}isPacked(){return this.packed}isHidden(){return this.getDialog().hidden}}class At{div;optionsDialog;okButtonCallback;cancelButtonCallback;stateToLoadInputCallback;teleoraInputCallback;packed;constructor(t,e,i,o){this.div=document.createElement("div"),this.div.id="options_dialog_div",this.div.hidden=!0,this.okButtonCallback=t,this.cancelButtonCallback=e,this.stateToLoadInputCallback=i,this.teleoraInputCallback=o,this.optionsDialog=new bt(this.okButtonCallback,this.cancelButtonCallback,this.stateToLoadInputCallback,this.teleoraInputCallback),this.packed=!1}pack(){if(this.packed)console.log("The options dialog div is already packed.");else{if(!t.exists(this.div))throw new Error("Cannot pack: the options dialog div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot pack: the options dialog div is not hidden (it must be before packing it).");if(!t.exists(this.optionsDialog))throw new Error("Cannot pack: the options dialog is null or undefined.");this.optionsDialog.pack(),this.div.appendChild(this.optionsDialog.getDialog()),this.packed=!0}}unpack(){if(this.packed){if(!t.exists(this.div))throw new Error("Cannot unpack: the options dialog div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot unpack: the options dialog div is not hidden (it must be before unpacking it).");if(!t.exists(this.optionsDialog))throw new Error("Cannot unpack: the options dialog is null or undefined.");this.div.removeChild(this.optionsDialog.getDialog()),this.optionsDialog.unpack(),this.packed=!1}else console.log("The options dialog div is already unpacked.")}show(){if(!t.exists(this.div))throw new Error("Cannot show: the options dialog div is null or undefined.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the options dialog div is not packed.");if(!this.optionsDialog.getDialog().isConnected)throw new Error("Cannot show: the options dialog is not connected.");this.optionsDialog.getDialog().showModal(),this.div.hidden=!1}else console.log("The options dialog div is already shown.")}hide(){if(!t.exists(this.div))throw new Error("Cannot hide: the options dialog div is null or undefined.");if(this.div.hidden)console.log("The options dialog div is already hidden.");else{if(!this.packed)throw new Error("Cannot hide: the options dialog div is not packed.");this.div.hidden=!0}}getDiv(){return t.validateExistence(this.div,"Cannot get the options dialog div: the div is null or undefined.")}isPacked(){return this.packed}isHidden(){return this.getDiv().hidden}}class Tt{div;displayedImage;packed;constructor(t){this.div=document.createElement("div"),this.div.classList.add("draggable-body-div"),this.div.hidden=!0,this.addDragEventsListeners(),this.displayedImage=document.createElement("img"),this.displayedImage.src=t,this.displayedImage.classList.add("draggable-image"),this.packed=!1}addDragEventsListeners(){this.div.addEventListener("dragstart",(t=>{t.target.classList.add("dragging"),t.dataTransfer.setData("source","draggable-image")})),this.div.addEventListener("dragend",(t=>{t.target.classList.remove("dragging")}))}pack(){if(this.packed)console.log("The draggable body is already packed.");else{if(!t.exists(this.div))throw new Error("Cannot pack: the draggable body's div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot pack: the draggable body's div is not hidden (it must be before packing it).");if(!t.exists(this.displayedImage))throw new Error("Cannot pack: the draggable body's div is null or undefined.");this.div.appendChild(this.displayedImage),this.packed=!0}}unpack(){if(this.packed){if(!t.exists(this.div))throw new Error("Cannot unpack: the draggable body's div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot unpack: the draggable body's div is not hidden (it must be before packing it).");if(!t.exists(this.displayedImage))throw new Error("Cannot unpack: the draggable body's image is null or undefined.");this.div.removeChild(this.displayedImage),this.packed=!1}else console.log("The draggable body's div is already unpacked.")}show(){if(!t.exists(this.div))throw new Error("Cannot show: the draggable body's div is null or undefined.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the draggable body's div is not packed.");this.div.hidden=!1}else console.log("The draggable body's div is already shown.")}hide(){if(!t.exists(this.div))throw new Error("Cannot hide: the draggable body's div is null or undefined.");if(this.div.hidden)console.log("The draggable body's div is already shown.");else{if(!this.packed)throw new Error("Cannot hide: the draggable body's div is not packed.");this.div.hidden=!1}}getDiv(){return t.validateExistence(this.div,"Cannot get the draggable body's div: it is null or undefined.")}isPacked(){return this.packed}isHidden(){return this.getDiv().hidden}}class Dt{div;leftDiv;rightDiv;draggableBodies;packed;gridSize;constructor(t){this.div=document.createElement("div"),this.div.id="draggable_bodies_div",this.div.hidden=!0,this.leftDiv=document.createElement("div"),this.leftDiv.id="draggable_bodies_left_div",this.div.hidden=!0,this.rightDiv=document.createElement("div"),this.rightDiv.id="draggable_bodies_right_div",this.div.hidden=!0,this.createDraggableBodies(),this.gridSize=t,this.packed=!1}createDraggableBodies(){this.draggableBodies=[],Dt.createAllImagesPaths(["green_north","orange_north","white_north","user_north"],["green_dirt","orange_dirt"],".png","/envs/vacuumworld-ts/res/images/locations/","actor/","dirt/").forEach((t=>this.draggableBodies.push(new Tt(t))))}static createAllImagesPaths(t,e,i,o,n,r){const s=[];return t.forEach((t=>{s.push(o+n+t+i)})),e.forEach((t=>{s.push(o+r+t+i)})),s}updateGridSize(e){this.gridSize=t.validateExistence(e,"The grid size is null or undefined.")}pack(){if(this.packed)console.log("The draggable bodies div is already packed.");else{if(!t.exists(this.div))throw new Error("Cannot pack the draggable bodies div: it is null or undefined.");if(!this.div.hidden)throw new Error("Cannot pack: the draggable bodies div is not hidden (it must be before packing it).");if(!t.exists(this.gridSize))throw new Error("Cannot pack the draggable bodies div: the grid size is null or undefined.");if(!t.allExist(this.draggableBodies))throw new Error("Cannot pack the draggable bodies div: the draggable bodies array is null or undefined, or contains null or undefined elements.");this.packDependingOnGridSize(),this.packed=!0}}packDependingOnGridSize(){this.gridSize<this.draggableBodies.length?this.packTwoColumns():this.packOneColumn()}packTwoColumns(){const t=this.draggableBodies.length,e=Math.floor(t/2);for(let t=0;t<e;t++)this.draggableBodies[t].pack(),this.leftDiv.appendChild(this.draggableBodies[t].getDiv());for(let i=e;i<t;i++)this.draggableBodies[i].pack(),this.rightDiv.appendChild(this.draggableBodies[i].getDiv());this.div.appendChild(this.leftDiv),this.div.appendChild(this.rightDiv)}packOneColumn(){this.draggableBodies.forEach((t=>{t.pack(),this.leftDiv.appendChild(t.getDiv()),this.div.appendChild(this.leftDiv)}))}unpack(){if(this.packed){if(!t.exists(this.div))throw new Error("Cannot unpack the draggable bodies div: it is null or undefined.");if(!this.div.hidden)throw new Error("Cannot unpack: the draggable bodies div is not hidden (it must be before packing it).");if(!t.exists(this.gridSize))throw new Error("Cannot unpack the draggable bodies div: the grid size is null or undefined.");if(!t.allExist(this.draggableBodies))throw new Error("Cannot unpack the draggable bodies div: the draggable bodies array is null or undefined, or contains null or undefined elements.");this.unpackDependingOnGridSize(),this.packed=!0}else console.log("The draggable bodies div is already unpacked.")}unpackDependingOnGridSize(){this.gridSize<this.draggableBodies.length?this.unpackTwoColumns():this.unpackOneColumn()}unpackTwoColumns(){const t=this.draggableBodies.length,e=Math.floor(t/2);for(let t=0;t<e;t++)this.leftDiv.removeChild(this.draggableBodies[t].getDiv()),this.draggableBodies[t].unpack();for(let i=e;i<t;i++)this.leftDiv.removeChild(this.draggableBodies[i].getDiv()),this.draggableBodies[i].unpack();this.div.removeChild(this.leftDiv),this.div.removeChild(this.rightDiv)}unpackOneColumn(){this.draggableBodies.forEach((t=>{this.leftDiv.removeChild(t.getDiv()),t.unpack()})),this.div.removeChild(this.leftDiv)}show(){if(!t.exists(this.div))throw new Error("Cannot show: the draggable bodies div is null or undefined.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the draggable bodies div is not packed.");this.draggableBodies.forEach((t=>t.show())),this.leftDiv.hidden=!1,this.rightDiv.hidden=!1,this.div.hidden=!1}else console.log("The draggable bodies div is already shown.")}hide(){if(!t.exists(this.div))throw new Error("Cannot hide: the draggable bodies div is null or undefined.");if(this.div.hidden)console.log("The draggable bodies div is already shown.");else{if(!this.packed)throw new Error("Cannot hide: the draggable bodies div is not packed.");this.draggableBodies.forEach((t=>t.hide())),this.div.hidden=!0,this.leftDiv.hidden=!0,this.rightDiv.hidden=!0}}getDiv(){return this.div}isPacked(){return this.packed}isHidden(){return t.exists(this.div)&&this.div.hidden}}class Ct{div;gridSize;gridMap;draggableBodiesDiv;packed;constructor(){this.div=document.createElement("div"),this.div.id="grid_div",this.div.classList.add("grid","center-aligned"),this.div.hidden=!0,this.draggableBodiesDiv=new Dt,this.packed=!1}static validateGridSize(e){if(!t.exists(e)||e<=0)throw new Error("Cannot create a grid with no size.");return e}static validateGrid(e){if(t.exists(e)){if([...e.getKeys()].some((t=>null==t)))throw new Error("Cannot create a grid with null or undefined coordinates.");if([...e.getValues()].some((t=>null==t)))throw new Error("Cannot create a grid with null or undefined cells.");return e}throw new Error("Cannot create a grid without cells.")}createTableForGrid(){let t=document.createElement("table");t.classList.add("grid-table");for(let e=0;e<this.gridSize;e++){let i=document.createElement("tr");i.classList.add("grid-row");for(let t=0;t<this.gridSize;t++){let o=document.createElement("td");o.classList.add("grid-cell");const n=new w(BigInt(t),BigInt(e));o.appendChild(this.gridMap.get(n).getDiv()),i.appendChild(o)}t.appendChild(i)}return t}updateGrid(t,e){this.gridSize=Ct.validateGridSize(t),this.gridMap=Ct.validateGrid(e),this.draggableBodiesDiv.updateGridSize(this.gridSize)}pack(){if(!t.exists(this.gridSize)||this.gridSize<=0)throw new Error("Cannot pack a grid that has no size.");if(!t.exists(this.div))throw new Error("Cannot pack a grid that has no div.");if(!t.exists(this.gridMap))throw new Error("Cannot pack a grid that has no cells.");if(!t.exists(this.draggableBodiesDiv))throw new Error("Cannot pack a grid that has not got a draggable bodies div.");if(!this.packed){this.gridMap.forEach((t=>t.pack()));let t=this.createTableForGrid();this.div.appendChild(t),this.div.appendChild(this.draggableBodiesDiv.getDiv()),this.packed=!0}}unpack(){if(this.packed){if(!t.exists(this.div))throw new Error("Cannot unpack: the grid div is null or undefined.");if(!t.exists(this.gridMap))throw new Error("Cannot unpack: the grid map is null or undefined.");if(0===this.div.childElementCount)throw new Error("Cannot unpack: the grid div has no children.");if(!t.exists(this.draggableBodiesDiv))throw new Error("Cannot pack a grid that has not got a draggable bodies div.");this.div.removeChild(this.div.firstChild),this.gridMap.forEach((t=>t.unpack())),this.div.removeChild(this.draggableBodiesDiv.getDiv()),this.gridMap=null,this.packed=!1}else console.log("The initial view div is already unpacked.")}show(){if(!t.exists(this.div))throw new Error("Cannot show a grid that has no div.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the grid div is not packed.");this.div.hidden=!1}else console.log("The grid div is already shown.")}hide(){if(!t.exists(this.div))throw new Error("Cannot hide: the grid div is null or undefined.");if(this.div.hidden)console.log("The grid div is already hidden.");else{if(!this.packed)throw new Error("Cannot hide: the grid div is not packed.");this.div.hidden=!0}}getDiv(){return t.validateExistence(this.div,"Cannot get the grid div: the div is null or undefined.")}getDraggableBodiesDiv(){return t.validateExistence(this.draggableBodiesDiv,"Cannot get the draggable bodies div: the div is null or undefined.")}setDraggableBodiesDiv(e){if(!t.exists(e))throw new Error("Cannot set the draggable bodies div: it is null or undefined.");this.draggableBodiesDiv=e}isPacked(){return this.packed}isHidden(){return this.getDiv().hidden}}class yt{div;packed;constructor(){this.div=document.createElement("div"),this.div.id="simulation_controls_div",this.div.hidden=!0,this.packed=!1}pack(){}unpack(){}show(){}hide(){}getDiv(){return t.validateExistence(this.div,"Cannot get the internal simulation controls div: the div is null or undefined.")}isPacked(){return this.packed}isHidden(){return this.getDiv().hidden}}class xt{cell;locationAppearance;displayedImage;dropCallback;rotateCallback;doubleClickCallback;packed;constructor(e){this.locationAppearance=t.validateExistence(e,"Cannot create a cell without a location appearance."),this.createLocationImage(),this.cell=document.createElement("div"),this.cell.classList.add("cell"),this.cell.id=`cell-${e.getCoord().getX()}-${e.getCoord().getY()}`,this.packed=!1}addCallbacks(t,e,i){this.dropCallback=t,this.rotateCallback=e,this.doubleClickCallback=i,this.addListeners()}createLocationImage(){this.displayedImage=document.createElement("img"),this.displayedImage.src=this.getCellImageSrc(),this.displayedImage.classList.add("location-image","dropzone")}addListeners(){this.addDropListeners(),this.addClickListener(),this.addDoubleClickListener(),this.addRotateListener()}addDropListeners(){this.displayedImage.addEventListener("dragover",(t=>t.preventDefault())),this.displayedImage.addEventListener("dragenter",(t=>{if("draggable-image"===t.dataTransfer.getData("source")&&t.target.classList.contains("dropzone")){t.target.classList.add("dragover");for(const t of document.getElementsByClassName("selected"))t.classList.remove("selected")}})),this.displayedImage.addEventListener("dragleave",(t=>{t.target.classList.contains("dropzone")&&t.target.classList.remove("dragover")})),this.displayedImage.addEventListener("drop",(e=>{if(e.preventDefault(),e.target.classList.contains("dropzone")){e.target.classList.remove("dragover");const i=document.getElementsByClassName("dragging")[0];t.exists(i)&&(this.locationAppearance=this.dropCallback(i.src,this.locationAppearance),e.target.src=this.getCellImageSrc(),console.log("Dropped."))}}))}addClickListener(){this.displayedImage.addEventListener("click",(t=>{if(t.target.classList.contains("dropzone")){const t=!this.displayedImage.classList.contains("selected");for(const t of document.getElementsByClassName("selected"))t.classList.remove("selected");t&&this.displayedImage.classList.add("selected")}}))}addDoubleClickListener(){this.displayedImage.addEventListener("dblclick",(t=>{t.target.classList.contains("dropzone")&&(this.locationAppearance=this.doubleClickCallback(this.locationAppearance),t.target.src=this.getCellImageSrc(),console.log("Removed."))}))}addRotateListener(){document.addEventListener("keydown",this.rotate.bind(this))}rotate(e){t.exists(this.displayedImage)&&this.displayedImage.classList.contains("selected")&&this.locationAppearance.hasActor()&&("ArrowRight"===e.code?(this.locationAppearance=this.rotateCallback(R.RIGHT,this.locationAppearance),this.displayedImage.src=this.getCellImageSrc(),console.log("Rotated the actor clockwise.")):"ArrowLeft"===e.code&&(this.locationAppearance=this.rotateCallback(R.LEFT,this.locationAppearance),this.displayedImage.src=this.getCellImageSrc(),console.log("Rotated the actor counter-clockwise.")))}getCellImageSrc(){if(t.exists(this.locationAppearance))return this.locationAppearance.hasActor()?this.getCellImageSrcIfActorIsPresent():this.locationAppearance.hasDirt()?this.getCellImageSrcIfDirtIsPresent():"envs/vacuumworld-ts/res/images/locations/empty.png";throw new Error("Cannot get the image src for a cell for which no location appearance is available.")}getCellImageSrcIfActorIsPresent(){const t=this.locationAppearance.getActorAppearance().orElseThrow().getOrientation(),e=this.locationAppearance.getActorAppearance().orElseThrow().getColour(),i=t.toString().toLowerCase();return`envs/vacuumworld-ts/res/images/locations/actor/${e.toString().toLowerCase()}_${i}.png`}getCellImageSrcIfDirtIsPresent(){return`envs/vacuumworld-ts/res/images/locations/dirt/${this.locationAppearance.getDirtAppearance().orElseThrow().getColour().toString().toLowerCase()}_dirt.png`}pack(){if(!t.exists(this.displayedImage))throw new Error("Cannot pack a cell that has no image.");if(!t.exists(this.locationAppearance))throw new Error("Cannot pack a cell for which no location appearance is available.");if(!t.exists(this.cell))throw new Error("Cannot pack a non-existent cell.");this.packed||(this.cell.appendChild(this.displayedImage),this.packed=!0)}unpack(){this.packed&&(this.cell.removeChild(this.displayedImage),this.locationAppearance=null,this.displayedImage=null,this.packed=!1)}show(){}hide(){}getDiv(){return t.validateExistence(this.cell,"Cannot get the cell: the cell is null or undefined.")}isPacked(){return this.packed}isHidden(){return this.getDiv().hidden}}class It{gridSize;config;gridDiv;environment;options;canRun;paused;replaceGridDivCallback;hideDraggableBodiesDivCallback;replaceDraggableBodiesDivCallback;hideSimulationControlsDivCallback;replaceSimulationControlsDivCallback;constructor(e,i,o){this.config=t.validateExistence(o,"Cannot create a simulation without a config."),this.gridSize=It.validateGridSize(e,o),this.environment=t.validateExistence(e,"Cannot create a simulation without an environment."),this.gridDiv=this.createGrid(!0),this.options=t.validateExistence(i,"Cannot create a simulation without options."),this.canRun=!0,this.paused=!1}setCallbacks(t,e,i,o,n){this.replaceGridDivCallback=t,this.replaceDraggableBodiesDivCallback=i,this.hideDraggableBodiesDivCallback=e,this.hideSimulationControlsDivCallback=o,this.replaceSimulationControlsDivCallback=n}getGridDiv(){return this.gridDiv}getEnvironment(){return this.environment}getConfig(){return this.config}static validateGridSize(e,i){if(t.validateExistence(e,"Cannot create a simulation without an environment."),t.validateExistence(i,"Cannot create a simulation without a config."),!t.exists(i.min_environment_dim)||i.min_environment_dim<=0)throw new Error("The config must have a `min_environment_dim` key.");if(!t.exists(i.max_environment_dim)||i.max_environment_dim<=0)throw new Error("The config must have a `max_environment_dim` key.");if(i.min_environment_dim>i.max_environment_dim)throw new Error("Invalid config: the value of `max_environment_dim` must be greater or equal to the value of `min_environment_dim`.");if(e.getGridSize()<i.min_environment_dim||e.getGridSize()>i.max_environment_dim)throw new Error(`The grid size must be between ${i.min_environment_dim} and ${i.max_environment_dim} (inclusive).`);return e.getGridSize()}createGrid(t){let e=new E;this.environment.getAmbient().getGrid().forEach(((i,o)=>{let n=new xt(i.getAppearance());t&&n.addCallbacks(this.dropCallback.bind(this),this.rotateCallback.bind(this),this.doubleClickCallback.bind(this)),e.put(o,n)}));let i=new Ct;return i.updateGrid(this.gridSize,e),i}dropCallback(t,e){const i=e.getCoord();if(t.endsWith("green_north.png"))this.environment.getLocation(i).ifPresent((t=>t.removeActorIfPresent())),this.environment.getLocation(i).ifPresent((t=>t.addActor(it.createVWActorFacingNorth(p.GREEN,this.options))));else if(t.endsWith("orange_north.png"))this.environment.getLocation(i).ifPresent((t=>t.removeActorIfPresent())),this.environment.getLocation(i).ifPresent((t=>t.addActor(it.createVWActorFacingNorth(p.ORANGE,this.options))));else if(t.endsWith("white_north.png"))this.environment.getLocation(i).ifPresent((t=>t.removeActorIfPresent())),this.environment.getLocation(i).ifPresent((t=>t.addActor(it.createVWActorFacingNorth(p.WHITE,this.options))));else if(t.endsWith("user_north.png"))this.environment.getLocation(i).ifPresent((t=>t.removeActorIfPresent())),this.environment.getLocation(i).ifPresent((t=>t.addActor(it.createVWActorFacingNorth(p.USER,this.options))));else if(t.endsWith("green_dirt.png"))this.environment.getLocation(i).ifPresent((t=>t.removeDirtIfPresent())),this.environment.getLocation(i).ifPresent((t=>t.addDirt(new W(p.GREEN))));else{if(!t.endsWith("orange_dirt.png"))throw new Error("Invalid image src.");this.environment.getLocation(i).ifPresent((t=>t.removeDirtIfPresent())),this.environment.getLocation(i).ifPresent((t=>t.addDirt(new W(p.ORANGE))))}return this.environment.getLocation(i).orElseThrow().getAppearance()}doubleClickCallback(t){const e=t.getCoord();return this.environment.getLocation(e).ifPresent((t=>{t.hasActor()?t.removeActor():t.hasDirt()&&t.removeDirt()})),this.environment.getLocation(e).orElseThrow().getAppearance()}rotateCallback(t,e){const i=e.getCoord();return this.environment.getLocation(i).ifPresent((e=>{e.hasActor()&&this.environment.turnActor(i,t)})),this.environment.getLocation(i).orElseThrow().getAppearance()}showSimulation(){this.gridDiv=this.createGrid(!0),this.replaceGridDivCallback(this.gridDiv),this.gridDiv.pack(),this.replaceDraggableBodiesDivCallback(this.gridSize),this.gridDiv.show()}cycleSimulation(){this.validateCallbacks(),this.paused=!1,this.canRun=!0,console.log("Simulation starting..."),console.log("Initial environment: "),console.log(this.environment.toJsonObject()),console.log(console.log(JSON.stringify(this.environment.toJsonObject(),null,4))),this.mainLoop()}validateCallbacks(){if(!t.exists(this.replaceGridDivCallback))throw new Error("Cannot cycle the simulation without a callback to replace the grid div.");if(!t.exists(this.hideDraggableBodiesDivCallback))throw new Error("Cannot cycle the simulation without a callback to hide the draggable bodies div.");if(!t.exists(this.replaceDraggableBodiesDivCallback))throw new Error("Cannot cycle the simulation without a callback to replace the draggable bodies div.");if(!t.exists(this.hideSimulationControlsDivCallback))throw new Error("Cannot cycle the simulation without a callback to hide the simulation controls div.");if(!t.exists(this.replaceSimulationControlsDivCallback))throw new Error("Cannot cycle the simulation without a callback to replace the simulation controls div.")}async mainLoop(){void 0===this.options.getMaxNumberOfCycles()?await this.loopForever():await this.loopNumberOfTimes(),this.paused=!1,this.canRun=!1,this.showStoppedSimulationControls(),this.environment.resetAndMaintainElements(),this.showSimulation()}showStoppedSimulationControls(){document.getElementById("external_run_button").hidden=!1,document.getElementById("external_pause_button").hidden=!0,document.getElementById("external_resume_button").hidden=!0,document.getElementById("external_stop_button").hidden=!0,document.getElementById("external_reset_button").hidden=!1,document.getElementById("external_speed_button").hidden=!0,document.getElementById("external_save_button").hidden=!1,document.getElementById("external_load_button").hidden=!1,document.getElementById("external_guide_button").hidden=!1}async loopForever(){for(;this.canRun;)await this.stayPausedIfNeeded(),this.canRun&&await this.doOneCycle()}async loopNumberOfTimes(){for(let t=0;t<this.options.getMaxNumberOfCycles();t++)this.canRun&&(await this.stayPausedIfNeeded(),this.canRun&&await this.doOneCycle())}async doOneCycle(){this.environment.cycle(),this.gridDiv.hide(),this.gridDiv.unpack(),this.gridDiv=this.createGrid(!1),this.replaceGridDivCallback(this.gridDiv),this.gridDiv.pack(),this.gridDiv.show(),await this.delay(1e3-1e3*this.options.getSpeed())}delay(t){return new Promise((e=>setTimeout(e,t)))}async stayPausedIfNeeded(){for(;this.paused;)await this.delay(100)}stop(){this.canRun=!1,this.paused=!1}pause(){this.paused=!0}resume(){this.paused=!1}}class kt{div;initialViewDiv;initialViewButtonsDiv;optionsDialogDiv;gridDiv;simulationControlsDiv;options;simulation;packed;constructor(e){if(!t.exists(e))throw new Error("The path of the initial view image cannot be null or undefined.");this.div=document.createElement("div"),this.div.id="platform_div",this.div.classList.add("center-aligned"),this.div.hidden=!0,this.initialViewDiv=new vt(e),this.initialViewButtonsDiv=new mt(this.start.bind(this),this.showOptionsDialog.bind(this),this.guide),this.optionsDialogDiv=new At(this.saveNewOptions.bind(this),this.discardNewOptions.bind(this),this.loadState.bind(this),this.loadTeleora.bind(this)),this.gridDiv=new Ct,this.simulationControlsDiv=new yt,this.options=new pt,this.packed=!1}showOptionsDialog(){if(!t.exists(this.optionsDialogDiv))throw new Error("Cannot show the options dialog div: it is null or undefined.");this.optionsDialogDiv.pack(),this.optionsDialogDiv.show()}loadState(){const t=document.getElementById("state_to_load_upload_input").files[0],e=new FileReader;e.onload=t=>{this.options.setStateToLoad(JSON.parse(t.target.result))},e.readAsText(t)}loadTeleora(){const t=document.getElementById("teleora_upload_input").files[0],e=new FileReader;e.onload=t=>{this.options.setTeleora(t.target.result)},e.readAsText(t)}start(){try{this.setActionEfforts();const t={initial_environment_dim:8,min_environment_dim:3,max_environment_dim:13};this.options.isAutoplayActive()?this.run(t,!0):this.run(t,!1)}catch(t){ft.displayError(t),console.error(t)}}run(t,e){let i=gt.newEnvironment(this.options,t,this.options.getStateToLoad());this.simulation=new It(i,this.options,t),this.simulation.setCallbacks(this.replaceGridDiv.bind(this),this.hideDraggableBodiesDiv.bind(this),this.replaceDraggableBodiesDiv.bind(this),this.hideSimulationControlsDiv.bind(this),this.replaceSimulationControlsDiv.bind(this)),this.initialViewDiv.hide(),this.initialViewButtonsDiv.hide(),this.initialViewDiv.unpack(),this.initialViewButtonsDiv.unpack(),this.showExternalSimulationControls(),e?this.simulation.cycleSimulation():this.simulation.showSimulation()}showExternalSimulationControls(){document.getElementById("external_simulation_controls_div").hidden=!1,this.showStoppedSimulationControls(),document.getElementById("external_run_button").addEventListener("click",(()=>{this.showRunningSimulationControls(),this.simulation.cycleSimulation()})),document.getElementById("external_stop_button").addEventListener("click",(()=>{this.showStoppedSimulationControls(),this.simulation.stop(),this.simulation.getEnvironment().resetAndMaintainElements(),this.simulation=new It(this.simulation.getEnvironment(),this.options,this.simulation.getConfig()),this.simulation.setCallbacks(this.replaceGridDiv.bind(this),this.hideDraggableBodiesDiv.bind(this),this.replaceDraggableBodiesDiv.bind(this),this.hideSimulationControlsDiv.bind(this),this.replaceSimulationControlsDiv.bind(this)),this.simulation.showSimulation()})),document.getElementById("external_pause_button").addEventListener("click",(()=>{this.showPausedSimulationControls(),this.simulation.pause()})),document.getElementById("external_resume_button").addEventListener("click",(()=>{this.showRunningSimulationControls(),this.simulation.resume()})),document.getElementById("external_speed_button").addEventListener("click",(()=>{this.options.setSpeed(Math.max(.999,this.options.getSpeed()+.1))})),document.getElementById("external_reset_button").addEventListener("click",(()=>{this.showStoppedSimulationControls(),this.simulation.stop(),this.simulation=new It(gt.newEmptyVWEnvironment(this.simulation.getConfig()),this.options,this.simulation.getConfig()),this.simulation.setCallbacks(this.replaceGridDiv.bind(this),this.hideDraggableBodiesDiv.bind(this),this.replaceDraggableBodiesDiv.bind(this),this.hideSimulationControlsDiv.bind(this),this.replaceSimulationControlsDiv.bind(this)),this.simulation.showSimulation()})),document.getElementById("external_guide_button").addEventListener("click",this.guide)}showRunningSimulationControls(){document.getElementById("external_run_button").hidden=!0,document.getElementById("external_pause_button").hidden=!1,document.getElementById("external_resume_button").hidden=!0,document.getElementById("external_stop_button").hidden=!1,document.getElementById("external_reset_button").hidden=!0,document.getElementById("external_speed_button").hidden=!1,document.getElementById("external_save_button").hidden=!0,document.getElementById("external_load_button").hidden=!0,document.getElementById("external_guide_button").hidden=!0}showStoppedSimulationControls(){document.getElementById("external_run_button").hidden=!1,document.getElementById("external_pause_button").hidden=!0,document.getElementById("external_resume_button").hidden=!0,document.getElementById("external_stop_button").hidden=!0,document.getElementById("external_reset_button").hidden=!1,document.getElementById("external_speed_button").hidden=!0,document.getElementById("external_save_button").hidden=!1,document.getElementById("external_load_button").hidden=!1,document.getElementById("external_guide_button").hidden=!1}showPausedSimulationControls(){document.getElementById("external_run_button").hidden=!0,document.getElementById("external_pause_button").hidden=!0,document.getElementById("external_resume_button").hidden=!1,document.getElementById("external_stop_button").hidden=!1,document.getElementById("external_reset_button").hidden=!0,document.getElementById("external_speed_button").hidden=!0,document.getElementById("external_save_button").hidden=!0,document.getElementById("external_load_button").hidden=!0,document.getElementById("external_guide_button").hidden=!0}replaceGridDiv(e){if(!t.exists(e))throw new Error("Cannot replace the grid div: the new grid div is null or undefined.");this.div.replaceChild(e.getDiv(),this.gridDiv.getDiv()),this.gridDiv=e}hideDraggableBodiesDiv(){t.validateExistence(this.gridDiv,"The grid div cannot be null or undefined."),t.validateExistence(this.gridDiv.getDraggableBodiesDiv(),"The draggable bodies div cannot be null or undefined."),this.gridDiv.getDraggableBodiesDiv().hide()}replaceDraggableBodiesDiv(e){t.validateExistence(e,"The grid size cannot be null or undefined."),t.validateExistence(this.gridDiv,"The grid div cannot be null or undefined."),t.validateExistence(this.gridDiv.getDraggableBodiesDiv(),"The draggable bodies div cannot be null or undefined.");let i=new Dt(e);i.pack(),this.gridDiv.getDiv().replaceChild(i.getDiv(),this.gridDiv.getDraggableBodiesDiv().getDiv()),this.gridDiv.setDraggableBodiesDiv(i),this.gridDiv.getDraggableBodiesDiv().show()}hideSimulationControlsDiv(){if(!t.exists(this.simulationControlsDiv))throw new Error("Cannot hide the simulation controls div: it is null or undefined.");this.simulationControlsDiv.hide()}replaceSimulationControlsDiv(e){if(!t.exists(e))throw new Error("Cannot replace the simulation controls div: the new simulation controls div is null or undefined.");this.div.replaceChild(e.getDiv(),this.simulationControlsDiv.getDiv()),this.simulationControlsDiv=e}setActionEfforts(){a.overrideDefaultEffort(this.options.getEfforts().get("VWIdleAction")),l.overrideDefaultEffort(this.options.getEfforts().get("VWMoveAction")),h.overrideDefaultEffort(this.options.getEfforts().get("VWTurnAction")),r.overrideDefaultEffort(this.options.getEfforts().get("VWCleanAction")),s.overrideDefaultEffort(this.options.getEfforts().get("VWDropDirtAction")),d.overrideDefaultEffort(this.options.getEfforts().get("VWSpeakAction")),o.overrideDefaultEffort(this.options.getEfforts().get("VWBroadcastAction"))}saveNewOptions(){if(!t.exists(this.optionsDialogDiv))throw new Error("Cannot hide the options dialog div: it is null or undefined.");this.saveOptions(),this.closeAndDestroyOptionsDialog(),this.printOptions("Options saved:")}saveOptions(){this.parseSimulationSpeed(),this.parseAutoplayFlag(),this.parseTooltipsFlag(),this.parseMaxNumberOfCycles(),this.parseEfforts()}parseSimulationSpeed(){const t=parseFloat(document.getElementById("speed_values").value);isNaN(t)?this.options.setSpeed(0):this.options.setSpeed(t)}parseAutoplayFlag(){document.getElementById("autoplay_checkbox").checked?this.options.activateAutoplay():this.options.deactivateAutoplay()}parseTooltipsFlag(){document.getElementById("tooltips_checkbox").checked?this.options.activateTooltips():this.options.deactivateTooltips()}parseMaxNumberOfCycles(){const e=document.getElementById("max_number_of_cycles_input").value;t.exists(e)&&""!==e?this.options.setMaxNumberOfCycles(parseInt(e)):this.options.setMaxNumberOfCycles(void 0)}parseEfforts(){let e=new Map;for(const i of kt.getActionNames()){const o=document.getElementById(i.toLowerCase()+"_effort_input").value;t.exists(o)&&""!==o?e.set(i,BigInt(parseInt(o))):e.set(i,void 0)}this.options.setEfforts(e)}static getActionNames(){return["VWIdleAction","VWMoveAction","VWTurnAction","VWCleanAction","VWDropDirtAction","VWSpeakAction","VWBroadcastAction"]}discardNewOptions(){if(!t.exists(this.optionsDialogDiv))throw new Error("Cannot hide the options dialog div: it is null or undefined.");this.closeAndDestroyOptionsDialog(),this.printOptions("Options discarded. The current options are:")}closeAndDestroyOptionsDialog(){this.optionsDialogDiv.hide(),this.optionsDialogDiv.unpack()}printOptions(t){console.log(t),console.log("Speed: "+this.options.getSpeed()),console.log("Autoplay active: "+this.options.isAutoplayActive()),console.log("Saved state to load: "+this.options.getStateToLoad()),console.log("Tooltips active: "+this.options.areTooltipsActive()),console.log("Max number of cycles: "+this.options.getMaxNumberOfCycles()),console.log("Efforts:"),kt.getActionNames().forEach((t=>console.log("- "+t+": "+this.options.getEfforts().get(t)))),console.log("Teleora file to load: "+this.options.getTeleora())}guide(){window.open("https://github.com/dicelab-rhul/web-agent/")}pack(){if(this.packed)console.log("The platform div is already packed.");else{if(!t.exists(this.div))throw new Error("Cannot pack: the platform div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot pack: the platform div is not hidden (it must be before packing it).");if(!t.exists(this.initialViewDiv))throw new Error("Cannot pack: the initial view div is null or undefined.");if(!t.exists(this.initialViewButtonsDiv))throw new Error("Cannot pack: the initial view buttons div is null or undefined.");if(!t.exists(this.optionsDialogDiv))throw new Error("Cannot pack: the options dialog div is null or undefined.");if(!t.exists(this.gridDiv))throw new Error("Cannot pack: the grid div is null or undefined.");if(!t.exists(this.simulationControlsDiv))throw new Error("Cannot pack: the simulation controls div is null or undefined.");this.initialViewDiv.pack(),this.initialViewButtonsDiv.pack(),this.optionsDialogDiv.pack(),this.div.appendChild(this.initialViewDiv.getDiv()),this.div.appendChild(this.initialViewButtonsDiv.getDiv()),this.div.appendChild(this.optionsDialogDiv.getDiv()),this.div.appendChild(this.gridDiv.getDiv()),this.div.appendChild(this.simulationControlsDiv.getDiv()),this.packed=!0}}unpack(){if(this.packed){if(!t.exists(this.div))throw new Error("Cannot unpack: the platform div is null or undefined.");if(!this.div.hidden)throw new Error("Cannot unpack: the platform div is not hidden (it must be before unpacking it).");if(!t.exists(this.initialViewDiv))throw new Error("Cannot unpack: the initial view div is null or undefined.");if(!t.exists(this.initialViewButtonsDiv))throw new Error("Cannot unpack: the initial view buttons div is null or undefined.");if(!t.exists(this.optionsDialogDiv))throw new Error("Cannot unpack: the options dialog div is null or undefined.");if(!t.exists(this.gridDiv))throw new Error("Cannot unpack: the grid div is null or undefined.");if(!t.exists(this.simulationControlsDiv))throw new Error("Cannot unpack: the simulation controls div is null or undefined.");this.div.removeChild(this.initialViewDiv.getDiv()),this.div.removeChild(this.initialViewButtonsDiv.getDiv()),this.div.removeChild(this.optionsDialogDiv.getDiv()),this.div.removeChild(this.gridDiv.getDiv()),this.div.removeChild(this.simulationControlsDiv.getDiv()),this.packed=!1}else console.log("The platform div is already unpacked.")}show(){if(!t.exists(this.div))throw new Error("Cannot show: the platform div is null or undefined.");if(this.div.hidden){if(!this.packed)throw new Error("Cannot show: the platform div is not packed.");this.initialViewDiv.show(),this.initialViewButtonsDiv.show(),this.div.hidden=!1}else console.log("The platform div is already shown.")}hide(){if(!t.exists(this.div))throw new Error("Cannot hide: the platform div is null or undefined.");if(this.div.hidden)console.log("The platform div is already hidden.");else{if(!this.packed)throw new Error("Cannot hide: the platform div is not packed.");this.initialViewDiv.hide(),this.initialViewButtonsDiv.hide(),this.optionsDialogDiv.hide(),this.gridDiv.hide(),this.simulationControlsDiv.hide(),this.div.hidden=!0}}getDiv(){return t.validateExistence(this.div,"Cannot get the platform div: the div is null or undefined.")}isPacked(){return this.packed}isHidden(){return this.getDiv().hidden}}(new class{run(){this.setTitle("VacuumWorld");let t=new kt("/envs/vacuumworld-ts/res/images/start_menu.png");t.pack(),document.getElementById("container_div").appendChild(t.getDiv()),t.show()}setTitle(e){t.exists(e)&&""!==e&&(document.title=e)}}).run()})();